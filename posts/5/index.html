
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>El SysAdmin del 3er Mundo</title>
  <meta name="author" content="låzaro">

  
  <meta name="description" content="Una de mis grandes testarudeces (profesionales) siempre ha sido la negativa a
usar ext4. Acostumbrado a los discos IDE, siempre me pareció que el &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uranio-235.github.io/posts/5/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El SysAdmin del 3er Mundo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">El SysAdmin del 3er Mundo</a></h1>
  
    <h2>luchando contra el subdesarrollo en todos los frentes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com.cu" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uranio-235.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archivo</a></li>
  <li><a href="/blog/categories/rails/">Ruby on Rails</a></li>
  <li><a href="/blog/categories/destacado/">Destacado</a></li>
  <li><a href="/blog/categories/razonemos/">Razonemos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-03T23:08:27-04:00'><span class='date'>03/06/2015</span> <span class='time'>11:08 pm</span></time>
        
           | <a href="/blog/2015/06/03/transando-a-ext4/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/03/transando-a-ext4/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Una de mis grandes testarudeces (profesionales) siempre ha sido la negativa a
usar ext4. Acostumbrado a los discos IDE, siempre me pareció que el journal
escribía demasiado en el disco. Además, solía verse ext4dev y eso me sonaba a
que se usaría mi sistema como ratón de laboratorio.</p>

<p>Tanta fue mi fobia, que hoy en día aún uso discos montados en ext2. Por ejemplo,
mi laptop estaba montada en ext2 hasta ahora mismo; también la partición /home
del servidor LTSP.</p>

<p>Un fallo eléctrico reciente, me demostró que el journal es un mal necesario. En
discos de tanta escritura, como es el caso del /home de los clientes ligeros, la
integridad de los datos es definitivamente una clave para el sistema. Además,
todo el que usó ext4dev no se quejó nunca.</p>

<figure class='code'><figcaption><span>&#8220;tune2fs&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tune2fs -O extents,uninit_bg,dir_index /dev/sda2
</span></code></pre></td></tr></table></div></figure>


<p>Con eso, le pones a tu ext2 todas las gangarreas del 4. A este punto, reza
porque no se valla luz! Hay que dar otro paso y es pasar un fsck.</p>

<figure class='code'><figcaption><span>&#8220;tune2fs&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tune2fs -c <span class="m">0</span> /dev/sda <span class="o">&amp;&amp;</span> reboot
</span></code></pre></td></tr></table></div></figure>


<p>Marca el disco para chequear y reinicia. Cuando levante, verás que da unos palos
raros ahí pero tú tranquilo.</p>

<p>Las memorias si las dejo con ext2. Pues no necesitan un journal escribiendo
tanto y acortando su vida útil.</p>

<p>Lo próximo que instale, lo haré con BtrFS que está <em>más mejoL en todavía</em>. Dice
tener un soporte especial para discos SSD con lo cual me imagino que para las
memorias flash sea más óptimo.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-01T21:13:05-04:00'><span class='date'>01/06/2015</span> <span class='time'>9:13 pm</span></time>
        
           | <a href="/blog/2015/06/01/pacman-bajo-el-microscopio/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/01/pacman-bajo-el-microscopio/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>En este post, me propongo mostrarle algunas de las bondades de pacman. Cualquier
que conozca Arch Linux, sabe de lo que estoy hablando.</p>

<p>Veremos bien de cerca el engranaje de está compleja maquinaria.</p>

<p>Pacman, es una herramienta lo suficientemente versátil como para llevar el
nombre de &ldquo;administrador de paquetes&rdquo;. Su nombre es un juego de palabras que
proviene de juntar las palabras &ldquo;PACkage MANager&rdquo;.</p>

<p>A diferencia de ciertas y determinadas distribuciones (entiéndase debian); que
requieren más de 3 softwares para esa pincha. Pacman solo es autosuficiente para
gestionar la paquetería. La herramienta repo-add, está incluída dentro del
paquete de pacman y se usa para crear repositorios personalizados.</p>

<figure class='code'><figcaption><span>&#8220;huevo de pascua de pacman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>repo-elephant
</span><span class='line'>     __
</span><span class='line'>    <span class="s1">&#39;. \</span>
</span><span class='line'><span class="s1">     &#39;</span>- <span class="se">\</span>
</span><span class='line'>      / /_         .---.
</span><span class='line'>     / <span class="p">|</span> <span class="se">\\</span>,.<span class="se">\/</span>--.//    <span class="o">)</span>
</span><span class='line'>     <span class="p">|</span>  <span class="se">\/</span>/        <span class="o">)</span>/  /
</span><span class='line'>      <span class="se">\ </span> <span class="s1">&#39; ^ ^    /    )____.----..  6</span>
</span><span class='line'><span class="s1">       &#39;</span>.____.    .___/            <span class="se">\.</span>_<span class="o">)</span>
</span><span class='line'>          .<span class="se">\/</span>.                      <span class="o">)</span>
</span><span class='line'>           <span class="s1">&#39;\                       /</span>
</span><span class='line'><span class="s1">           _/ \/    ).        )    (</span>
</span><span class='line'><span class="s1">          /#  .!    |        /\    /</span>
</span><span class='line'><span class="s1">          \  C// #  /&#39;</span>-----<span class="s1">&#39;&#39;</span>/ <span class="c">#  /</span>
</span><span class='line'>       .   <span class="s1">&#39;C/ |    |    |   |    |mrf  ,</span>
</span><span class='line'><span class="s1">       \), .. .&#39;</span>OOO-<span class="s1">&#39;. ..&#39;</span>OOO<span class="s1">&#39;OOO-&#39;</span>. ..<span class="se">\(</span>,
</span></code></pre></td></tr></table></div></figure>


<p>Como ya sabrán (o se darán por enterado) Arch Linux no es por release, si no que
un canal en constante desarrollo, hace como upstream, donde se depositan los
paquetes consideraros estables. Esto es lo que en distribuciones estáticas se
llamara &ldquo;repo&rdquo;. Pacman lleva la ardua tarea de mantener el sistema debidamente
actualizado. Nuestro sistema no tendrá &ldquo;actualizaciones&rdquo; si no que evolucionará
constantemente desde el &ldquo;core&rdquo;, escalando horizontalmente el sistema completo.</p>

<p>De esta manera se logra el mítico equilibrio entre estabilidad y novedad.</p>

<p>Para ello, pacman debe tener constancia local de la lista de paquetes que hay en
el upstream. Estas listas son ficheros de textos, comprimidos con gzip, que
contienen información acerca de lo que hay arriba. Por ejemplo, contiene la URL
de como descargarlos.</p>

<p>Para pacman, instalar un paquete o alar está lista, es casi la misma operación.
Se llama &ldquo;sync&rdquo; (sincronizar)</p>

<figure class='code'><figcaption><span>&#8220;-Sy&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Sy
</span></code></pre></td></tr></table></div></figure>


<p>Pero puedes de un solo viaje, sincronizar y actualizar todo el sistema.</p>

<figure class='code'><figcaption><span>&#8220;lo úlitmo que trajo el barco </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Syu
</span></code></pre></td></tr></table></div></figure>


<p>Buscar un paquete también es una operación de sincronización.</p>

<figure class='code'><figcaption><span>&#8220;buscar fulanito&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Ss fulanito
</span></code></pre></td></tr></table></div></figure>


<p>También puedes, bajar la lista, actualizar el sistema e instalar algo de un solo
golpe.</p>

<figure class='code'><figcaption><span>&#8220;todo junto&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Syu fulanito
</span></code></pre></td></tr></table></div></figure>


<p>Pacman irá a los sitios que tiene declarado en el fichero: <strong>/etc/pacman.d/mirrorlist</strong>
y bajará esos ficheros. Seguidamente los depositará en el directorio /var/lib/pacman/sync/</p>

<figure class='code'><figcaption><span>&#8220;bases de datos&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>file /var/lib/pacman/sync/*.db
</span><span class='line'>/var/lib/pacman/sync/archlinuxfr.db: gzip compressed data, last modified: Thu May <span class="m">21</span> 04:31:59 2015, from Unix
</span><span class='line'>/var/lib/pacman/sync/community.db:   gzip compressed data, last modified: Fri May <span class="m">29</span> 08:47:01 2015, from Unix
</span><span class='line'>/var/lib/pacman/sync/core.db:        gzip compressed data, last modified: Wed May <span class="m">27</span> 19:02:40 2015, from Unix
</span><span class='line'>/var/lib/pacman/sync/extra.db:       gzip compressed data, last modified: Fri May <span class="m">29</span> 04:27:15 2015, from Unix
</span></code></pre></td></tr></table></div></figure>


<p>Ahora nuestro sistema sabe lo que hay &ldquo;arriba&rdquo; (en el repo) y está listo para
compararlo con lo que está &ldquo;abajo&rdquo; (instalado). La información sobre todo los
paquetes que el sistema tiene instalado, se almacena en el directorio
<strong>/var/lib/pacman/local/</strong></p>

<p>La lista es muy grande para mostrarla. Pero dentro hay directorios con la
versión de cada programa instalado. Dentro de ese subdirectorio, hay 4 ficheros
que contiene la información del paquete instalado.</p>

<p>Por ejemplo, el paquete <strong>ruby</strong>, en su versión <strong>2.2.2-1</strong> responde al
directorio <strong>/var/lib/pacman/local/ruby-2.2.2-1</strong></p>

<p>Cada directorio, contiene 4 ficheros:</p>

<figure class='code'><figcaption><span>&#8220;metainfo de un paquete instalado&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>ls /var/lib/pacman/local/ruby-2.2.2-1/
</span><span class='line'>desc  files  install  mtree
</span></code></pre></td></tr></table></div></figure>


<p>El fichero <strong>desc</strong> contiene la información que describe al paquete, versión,
nombre, etc..</p>

<p>El fichero <strong>files</strong> contiene la lista de ficheros que instala dicho paquete.</p>

<p>El fichero <strong>install</strong> contiene una serie de comando disparadores, como
post_install. Dentro de install, se declaró una función llamada post_install()
que será llamada cuando el paquete termine de ser instalado.</p>

<p>Por último, <strong>mtree</strong> (que está comprimido con gz) contiene lo mismo que files,
pero con la suma MD5 de cada fichero. Esto es usado por pacman para verificar la
integridad de los archivos instalados.</p>

<p>Por ejemplo, si quisiéramos ver que ficheros contiene el paquete ruby, podríamos
ver el contenido del fichero <strong>files</strong> pero sería más fácil usar el comando
<strong>Query</strong> con el argumento <strong>list</strong></p>

<figure class='code'><figcaption><span>&#8220;pacman -Ql fulano&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>pacman -Ql ruby<span class="p">|</span>grep <span class="s1">&#39;/usr/bin/&#39;</span>
</span><span class='line'>ruby /usr/bin/
</span><span class='line'>ruby /usr/bin/erb
</span><span class='line'>ruby /usr/bin/gem
</span><span class='line'>ruby /usr/bin/irb
</span><span class='line'>ruby /usr/bin/rake
</span><span class='line'>ruby /usr/bin/rdoc
</span><span class='line'>ruby /usr/bin/ri
</span><span class='line'>ruby /usr/bin/ruby
</span></code></pre></td></tr></table></div></figure>


<p>El principal fichero de pacman, es <strong>/etc/pacman.conf</strong> y a diferencia de otros
package managers, este es bien sencillo. Además, es MUY personalizable.</p>

<p>Por ejemplo, la cláusala XferCommand, permite especificar que comando usar para
bajar los paquetes. Las variables, %u y %o serán enviadas como URL del paquetes
y fichero en disco.</p>

<figure class='code'><figcaption><span>&#8216;scope de</span><a href='/etc/pacman.conf''>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/pacman.conf<span class="p">|</span>grep Xfer
</span><span class='line'><span class="c">#XferCommand = /usr/bin/curl --retry-delay 5 --progress-bar -C - -f %u &gt; %o</span>
</span><span class='line'><span class="nv">XferCommand</span> <span class="o">=</span> /usr/bin/wget --no-cache -t <span class="m">0</span> -T <span class="m">10</span> --max-redirect<span class="o">=</span><span class="m">0</span> -w <span class="m">5</span> --passive-ftp -c -O %o %u
</span></code></pre></td></tr></table></div></figure>


<p>Ese es un buen ejemplo de una configuración para wget en conexiones &ldquo;hostiles&rdquo;.
Para que tengas una idea de cuan personalizable puede llegar a ser:</p>

<figure class='code'><figcaption><span>&#8220;NoExtract&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/pacman.conf<span class="p">|</span>grep NoEx
</span><span class='line'><span class="nv">NoExtract</span> <span class="o">=</span> *.mo
</span></code></pre></td></tr></table></div></figure>


<p>En este caso, los ficheros <strong>.mo</strong> no serán extraídos de los paquetes durante el
proceso de instalación. Como yo uso el sistema en inglés, no me interesa tener
las traducciones de sepetecientos idiomas.</p>

<p>Los paquetes que instales, irán al directorio <strong>/var/cache/pacman/pkg/</strong> y
podrías usar dicho directorio como repo para compartirlo con aquellos que no
tiene acceso a internet; o bien, llevártelo para tu casa, lugar donde te
integras al grupo antes mencionado.</p>

<p>Quizás te interese crear tu propio repo. La idea de crear un repo a partir de la
cache, le ha tirado un cabo a una pila de gente. En un viaje reciente que hice
por el oriente de la isla, cargué mi laptop con todo el software necesario he
instalé 3 servidores con arch <strong>sin conectarme a internet</strong> (vergonzosa hazaña).</p>

<p>Con esta opción:</p>

<figure class='code'><figcaption><span>&#8220;mantener paquetes&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/pacman.conf<span class="p">|</span>grep Clea
</span><span class='line'><span class="nv">CleanMethod</span> <span class="o">=</span> KeepCurrent
</span></code></pre></td></tr></table></div></figure>


<p>Aquellos paquetes que una vez fuero instalados se mantienen. Por tanto, supón
que quieres tener en la otra máquina (la de tu casa) &ldquo;geary&rdquo; el cliente de
correo. Simplemente lo instalas y lo desinstalas en la máquina privilegiada.</p>

<figure class='code'><figcaption><span>&#8220;cacheando paquetes&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -S geary <span class="o">&amp;&amp;</span> pacman -R geary
</span></code></pre></td></tr></table></div></figure>


<p>Ahora el paquete está en la cache, y aunque ya no está en el sistema, se
conservará en la cache hasta que no lo borres. Claro, esto tiene como desventaja
que no se bajarán actualizaciones para ese paquete.</p>

<p>En mi caso, yo tengo este escripcito al que llamo <strong>mkrepo.sh</strong></p>

<figure class='code'><figcaption><span>mkrepo.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c"># elimina esa base de datos</span>
</span><span class='line'>rm /var/cache/pacman/pkg/custom.db.tar.gz
</span><span class='line'>
</span><span class='line'><span class="c"># crea una nueva</span>
</span><span class='line'>repo-add /var/cache/pacman/pkg/custom.db.tar.gz /var/cache/pacman/pkg/*.pkg.tar.xz
</span><span class='line'>
</span><span class='line'><span class="c"># dime que tengo que poner</span>
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;&#39;&#39;</span>
</span><span class='line'><span class="s1">[mirepo]</span>
</span><span class='line'><span class="s1">SigLevel = Optional TrustAll</span>
</span><span class='line'><span class="s1">Server = http://localhost:8080</span>
</span><span class='line'><span class="s1">&#39;&#39;&#39;</span>
</span><span class='line'><span class="c"># sírvelo con darkhttpd</span>
</span><span class='line'>darkhttpd /var/cache/pacman/pkg/ --chroot --port 8080
</span></code></pre></td></tr></table></div></figure>


<p>Al correrlo, la cache se indexa; lista para ser usada como repo. El script hace
un <strong>echo</strong>, para recordarte como sería la configuración que debes poner en
/etc/pacman.conf para usar ese repo.</p>

<p>Finalmente, darkhttpd (un servidor web que viene con el Live de arch) sirve ese
repo.</p>

<p>Quizás tengas una memoria flash donde creas el repo. En ese caso, bastaría con
especificar una linea Server con la dirección file:///</p>

<p>Server = file:///media/MEMORIA/repo/</p>

<p>Simple verdad?</p>

<p>Pensé hacer esta entrada más larga, pero sería aburrir al lector. En cambio,
ahora ya sabes una parte, te dejo que investigues el resto.</p>

<h4>Happy Hacking!</h4>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-28T18:46:04-04:00'><span class='date'>28/05/2015</span> <span class='time'>6:46 pm</span></time>
        
           | <a href="/blog/2015/05/28/cambiar-user-agent-en-squid/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/05/28/cambiar-user-agent-en-squid/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>En esta sofocante tarde de verano cubano y en un lugar que no diré, me encontré
detrás de un proxy administrador por la
<a href="http://es.wikipedia.org/wiki/Schutzstaffel">Schutzstaffel</a>. Lo que no se
parezca a un navegador, NO PASA. Por tanto, Ruby, Wget y demás, NO pinchan.</p>

<p>Por suerte, tengo la costumbre de usar un squid local, para no tener que estar
configurando el navegador. En ese squid declaro como padre el squid del momento
(ya sea salud u otro) y ahí pongo el nombre de usuario con la contraseña una
sola vez. Si estás en cuba y tienes una laptop con linux, te aconsejo que acates
esa costumbre.</p>

<p>Solución:</p>

<p>Reescribir el encabezado User-Agent de las peticiones en el squid local. Así
todas salen de un supuesto firefox.</p>

<figure class='code'><figcaption><span>&#8220;/etc/squid/squid.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>request_header_access User-Agent deny all
</span><span class='line'>request_header_replace User-Agent Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> U<span class="p">;</span> Linux i686<span class="p">;</span> en-US<span class="p">;</span> rv:1.8.1.4<span class="o">)</span> Gecko/20070515 Firefox/2.0.0.4
</span></code></pre></td></tr></table></div></figure>


<p>   <blockquote><p>Al carajo albañiles que se acabó la mezcla.</p></blockquote></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-26T16:32:02-04:00'><span class='date'>26/05/2015</span> <span class='time'>4:32 pm</span></time>
        
           | <a href="/blog/2015/05/26/nic-bonding/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/05/26/nic-bonding/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recién terminé el servidor de LTSP; pero aún estoy como niño con juguete nuevo,
viendo que otra gangarrea le puedo poner. En la <a href="http://gutl.jovenclub.cu/">lista de GUTL</a> un colega
me comentó que sería bueno darle explotación a ambas tarjetas de red. Enseguida
dijo lo primero en que piensan mis coterráneos, un proxy. Yo le comenté que le
había hecho un bonding, operación a la cual yo denomíno &ldquo;albóndiga&rdquo; y consiste
en levantar una interfaz de red especial que usa dos tarjetas de red como si
fueran una.</p>

<p>Esto; para un servidor de tanto tráfico como es el caso de ltsp, es un verdadero
batazo. Otros colegas parecieron sorprendidos al ver tal cosa y me pidieron que
escribiera un tutorial de como hacerlo; sobre todo para que llegase a aquellos
que no tienen internet.</p>

<p>Instala un paquete llamado  <strong>ifenslave</strong></p>

<figure class='code'><figcaption><span>&#8220;instalando ifenslave&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aptitude install ifenslave
</span></code></pre></td></tr></table></div></figure>


<p>Luego declaras en &ldquo;/etc/network/interfaces&rdquo; una interfaz llamada bond0 en la
cual declaras que interface quieres unir.</p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/network/interfaces&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@ganker:~# cat /etc/network/interfaces
</span><span class='line'><span class="c"># This file describes the network interfaces available on your system</span>
</span><span class='line'><span class="c"># and how to activate them. For more information, see interfaces(5).</span>
</span><span class='line'>
</span><span class='line'><span class="nb">source</span> /etc/network/interfaces.d/*
</span><span class='line'>
</span><span class='line'><span class="c"># The loopback network interface</span>
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>auto bond0
</span><span class='line'>iface bond0 inet static
</span><span class='line'>    address 10.1.1.3
</span><span class='line'>    netmask 255.255.255.0
</span><span class='line'>    network 10.1.1.0
</span><span class='line'>    gateway 10.1.1.1
</span><span class='line'>    dns-nameservers 10.1.1.1
</span><span class='line'>    dns-search hcg.sld.cu
</span><span class='line'>    slaves eth0 eth1
</span><span class='line'>    bond_mode active-backup
</span><span class='line'>    bond_miimon 100
</span><span class='line'>    bond_downdelay 200
</span><span class='line'>    bond_updelay 200
</span></code></pre></td></tr></table></div></figure>


<p>Donde eth0 y eth1 son las interfaces que se unirán. Eso es todo&hellip;</p>

<p>OJO! Si tienes un cortafuegos que involucre reglas de interfaces, ya tienestarea
pa la casa.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-23T01:46:08-04:00'><span class='date'>23/05/2015</span> <span class='time'>1:46 am</span></time>
        
           | <a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/05/23/ltsp-en-debian8-y-salud/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Problema</h3>

<p>21 de Mayo: La situación de los clientes ligeros en el Calixto no da más. El
servidor DHCP del ardence dejó pinchar sin previo aviso. El encargado de los
clientes ligeros, reinstaló todo y siguió sin pinchar. Luego determinó que era
culpa de un virus. El incha-cojones de Windows vuelve a hacer de la suya.
Mientras tanto, el caos se ríe de todos y se frota las manos.</p>

<p>A la novena llamada preguntando &ldquo;cuando se arreglan los clientes ligeros&rdquo;
determiné que la situación llevaba medidas drásticas, siendo hora de pasar el
servidor al lado oscuro de la fuerza.</p>

<p>Plan de migración: El miembro sobre la mesa.</p>

<p>Tiempo estimado: Menos del que te imaginas.</p>

<p>Por un lado, 6 clientes ligeros con un windows XP que se arrastra en los 128
megas de RAM y un servidor dongan de manufactura vietnamita. Por el otro, más de
6 usuarios quejándose porque su sistema funciona lento, cuando le da la gana y
además deben reiniciar más de 10 veces al día. Eso sin contar que deben tener la
información en memorias flash, porque no se guardan los cambios en las imágenes.</p>

<h3>Solución</h3>

<p>Linux Terminal Server Project, más conocido como &ldquo;LTSP&rdquo;.</p>

<p>Instalar ltsp es un proceso relativamente fácil, sobre todo cuando tienes un
tubo de internet a full.</p>

<p>Pero detrás del proxy satánico de infomed; la cosa se vuelve un tanto compleja.</p>

<p>Por suerte, el repo de debian en infomed está bien afinadito y ahora con el tubo
de 2 megas, la cosa mejora considerablemente.</p>

<p>Hay dos maneras de hacer esto, la fácil y novel; o la difícil y tediosa. En caso
de la fácil, bastará con instalar el paquete &ldquo;ltsp-server-standalone&rdquo;; el cual
instalará y configurará todo la orquesta de software requerido para pinchar lo
que se conoce como ltsp. Entre ellos, el servidor dhcp de ics, el servidor
tftp-hpa, la maritrónica que sirve la SWAP por nfs y todo el rebortillo de cosas
que requiere NFS.</p>

<p>Corre esto y ponte cómodo, que va pa largo&hellip;</p>

<figure class='code'><figcaption><span>&#8220;ltsp-build-client&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> ltsp-build-client --http-proxy http://127.0.0.1:3128 <span class="se">\</span>
</span><span class='line'> --mirror http://ftp.sld.cu/debian --security-mirror http://ftp.sld.cu/debian/ <span class="se">\</span>
</span><span class='line'> --copy-sourceslist --copy-package-cache
</span></code></pre></td></tr></table></div></figure>


<p>El comando que corriste, generó un fichero de configuración para el servidor
dhcp de isc. Te sugiero que lo uses como DHCP.</p>

<figure class='code'><figcaption><span>&#8220;ltsp-build-client&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cp /etc/ltsp/dhcpd.conf /etc/dhcp/dhcpd.conf
</span><span class='line'>systemctl restart isc-dhcp-server
</span></code></pre></td></tr></table></div></figure>


<p>Muy importante NFS. En el fichero <strong>/etc/exports</strong> ponemos esto:</p>

<figure class='code'><figcaption><span>&#8220;contenido de</span><a href='/etc/exports"'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/opt/ltsp *<span class="o">(</span>ro,no_root_squash,async,no_subtree_check<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>y reiniciamos el servicio de NFS</p>

<figure class='code'><figcaption><span>&#8220;reiniciando nfs&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl restart nfs-kernel-server
</span></code></pre></td></tr></table></div></figure>


<p>Cuando butees una máquina, el login no te pinchará. Deberás correr esto:</p>

<figure class='code'><figcaption><span>&#8220;crear el squash&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ltsp-update-sshkeys
</span><span class='line'>ltsp-update-image --config-nbd
</span></code></pre></td></tr></table></div></figure>


<p>La imagen que se instaló en /opt no es más que la matriz para crear un squashfs
que se le sirve a los clientes. Con ese comando, reflejamos los cambios
volviendo a crear la imagen &ldquo;squashada&rdquo;.</p>

<p>Con eso te digo que si haces un cambio en la imagen, deberás correr ese comando.</p>

<p>Ahora bien. Para que no queden lagunas mentales:</p>

<h3>Todo lo que tendrán los usuarios, ESTÁ EN EL SERVIDOR</h3>

<p>Por tanto, hay que instalar una interfaz visual EN EL SERVIDOR. Será lo que los
clientes pinchen. Por supuesto, no necesariamente el servidor tiene que correr
dicha interfaz. En mi caso yo instalé solo sistema base y luego corrí esto:</p>

<figure class='code'><figcaption><span>&#8220;instalar lxde completo&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aptitude install task-lxde-desktop
</span></code></pre></td></tr></table></div></figure>


<p>Ahora el servidor está equipado con una interfaz visual, pero no la pincha, ya
que no le instalamos ningún &ldquo;display manager&rdquo;; por tanto, las X no arrancan. El
display manager lo tiene la imagen que levantan los clientes; nada menos que
LDM.</p>

<p>Los clientes levantan un LDM e inician sesión remota en el servidor.</p>

<h2>¿se entendió?</h2>

<p>Toas las instrucciones que cargará esta interfaz gráfica minimalista (el LDM de
los clientes ligeros), se declaran en el fichero /opt/ltsp/i386/etc/lts.conf a
mi me quedó así la primera versión de este fichero.</p>

<figure class='code'><figcaption><span>&#8220;/opt/ltsp/i386/etc/lts.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>default<span class="o">]</span>
</span><span class='line'>    <span class="nv">LTSP_CONFIG</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">SOUND</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">LOCALDEV</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">CONFIGURE_X</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">LDM_SESSION</span><span class="o">=</span>/usr/bin/startlxde
</span></code></pre></td></tr></table></div></figure>


<p>Dice que está configurado, que tiene sonido, que use dispositivos locales, que
configure las X dinámicamente y que arranque lxde como sesión por defecto.</p>

<p>Y ahí empezaron mis problemas. En mi caso, las canchanfletas que usé como
clientes ligeros, tenían una tarjeta de video unichrome más extraña que un
calsoncillo con tirantes. La pantalla se veía con una capa verde delante. Nunca
había visto cosa igual.</p>

<p>Solución. Levanta un cliente ligero, entra en la consola (con
Ctrl+Alt+F1) y ejecuta:</p>

<figure class='code'><figcaption><span>&#8220;/opt/ltsp/i386/etc/lts.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>X -configure
</span></code></pre></td></tr></table></div></figure>


<p>Eso te creará el fichero xorg.conf.new EN EL CLIENTE. A ese punto, se habrá
generado una configuración de X decente. Pero ese fichero hay que ponerlo EN EL
SERVIDOR:</p>

<figure class='code'><figcaption><span>&#8220;monta que te queda&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>scp xorg.conf root@servidor:/opt/ltsp/i386/etc/X11/xorg.conf
</span></code></pre></td></tr></table></div></figure>


<p>Ahora además, al servidor hay que especificarle que las X NO se auto-configuren
y que en cambio, usen el fichero dado. Todo eso lo haremos en /opt/ltsp/i386/etc/lts.conf</p>

<figure class='code'><figcaption><span>&#8220;/opt/ltsp/i386/etc/lts.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>default<span class="o">]</span>
</span><span class='line'>    <span class="nv">LTSP_CONFIG</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">SOUND</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">LOCALDEV</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">LDM_SESSION</span><span class="o">=</span>/usr/bin/startlxde
</span><span class='line'>    <span class="nv">CONFIGURE_X</span><span class="o">=</span>False
</span><span class='line'>    <span class="nv">X_CONF</span><span class="o">=</span>/etc/X11/xorg.conf
</span><span class='line'>    <span class="nv">X_MODE_0</span><span class="o">=</span>1024x768
</span><span class='line'>    <span class="nv">MODULE_01</span> <span class="o">=</span> <span class="s2">&quot;usb-storage&quot;</span>
</span><span class='line'>    <span class="nv">MODULE_02</span> <span class="o">=</span> <span class="s2">&quot;sd_mod&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dice ahora que: Está configurado, tiene sonido, dispositivos locales (pa que
pinchen las memorias flash), que levante lxde, que NO configure las X, que use
el fichero dado, que la resolución de su pantalla 0 (la única) es de 1024x768 y
además que meta ese par de módulos, pa que pinchen los puertos USB.</p>

<p>Por supuesto, en el chroot que levanta el cliente, la ruta absoluta
/etc/X11/xorg.conf es completamente válida.</p>

<p>¡¡Ah, y no olvides volver a crear la imagen!!</p>

<h3>pero de vuelta al servidor</h3>

<p>Entre los palos más comunes, vemos uno que al iniciar la sesión dice que el
usuario &ldquo;fulano&rdquo; no pertenece a netdev y que por tanto, el puñetero data-bus no
arranca.</p>

<figure class='code'><figcaption><span>&#8220;agregando a netdev&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adduser fulano netdev
</span><span class='line'>systemctl restart dbus
</span></code></pre></td></tr></table></div></figure>


<p>Otro palo común es que las memorias NTFS se montan como solo lectura. Solución,
instala ntfs-3g EN EL CHROOT que está en /opt y vuelve a crear la imagen.</p>

<h3>Nota para los mentequieta:</h3>

<p>Los usuarios se crean EN EL SERVIDOR no en la imagen.</p>

<h3>Sugerencias</h3>

<p>Cada cosa que los clientes ejecuten, lo harán en el servidor, y puedes ponerte a
mirar con htop que proceso se está metiendo la RAM o el CPU, detener dicho
proceso y requerir al usuario. Porque verás los procesos y el usuario que lo
ejecuta. Déjame recordarte que Linux, es un sistema multitarea y multiusuarios
de verdad.</p>

<p>En mi caso, el servidor (los &ldquo;dongan&rdquo; vietnamitas) tiene dos discos duros. Monté
uno para el sistema y la swap, el otro lo dejé para el /home.</p>

<p>Mi servidor tiene 512 de RAM y aún con 4 clientes ligeros no ha llenado la mitad
de la memoria. ¿Dime tu con 1 Giga de RAM?</p>

<p>Por defecto, los homes de los usuarios se crean con permisos que los hace
visibles entre si. Ejecuta: &ldquo;chmod 770 /home/fulano&rdquo; cada vez que crees un
usuario. Si no, el home de este usuario será visible por los demás usuarios.</p>

<p>¿Has pensando que ahora es más fácil hacerle salvas a las cosas? Todo está en el
/home.</p>

<p>No olvides decirle al usuario que ahora pueden hacer y guardar cambios en su
&ldquo;perfil&rdquo; (como ellos le llaman) pues algunos están acostumbrados a que el
cliente ligero No guarda cambios.</p>

<p>Puedes decirle a tus usuarios que su perfil puede ser abierto desde cualquier
cliente ligero de la flota. Lo cual les da cierta &ldquo;movilidad&rdquo;.</p>

<p>Puedes decirle que si su cliente ligero se rompe no se preocupe, que su
información está a salvo. Incluso, le recuerdas además que puede abrir su perfil
desde otro cliente ligero que esté en la misma flota.</p>

<p>Puedes hacer configuraciones individuales de cada máquina en el fichero
<strong>/opt/ltsp/i386/etc/lts.conf</strong></p>

<p>En donde dice <strong>[default]</strong> puedes poner la MAC del
cliente.</p>

<figure class='code'><figcaption><span>&#8220;/opt/ltsp/i386/etc/lts.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># configuración genérica</span>
</span><span class='line'><span class="o">[</span>default<span class="o">]</span>
</span><span class='line'>    <span class="nv">LTSP_CONFIG</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">SOUND</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">LOCALDEV</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">LDM_SESSION</span><span class="o">=</span>/usr/bin/startlxde
</span><span class='line'>    <span class="nv">CONFIGURE_X</span><span class="o">=</span>False
</span><span class='line'>    <span class="nv">X_CONF</span><span class="o">=</span>/etc/X11/xorg.conf
</span><span class='line'>    <span class="nv">X_MODE_0</span><span class="o">=</span>1024x768
</span><span class='line'>    <span class="nv">MODULE_01</span> <span class="o">=</span> <span class="s2">&quot;usb-storage&quot;</span>
</span><span class='line'>    <span class="nv">MODULE_02</span> <span class="o">=</span> <span class="s2">&quot;sd_mod&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># configuración de un cliente individual el</span>
</span><span class='line'><span class="c"># jefe no quiere que oiga música ni use</span>
</span><span class='line'><span class="c"># memorias flash</span>
</span><span class='line'><span class="o">[</span>00:90:4b:a2:55:05<span class="o">]</span>
</span><span class='line'>    <span class="nv">LTSP_CONFIG</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">SOUND</span><span class="o">=</span>False
</span><span class='line'>    <span class="nv">LOCALDEV</span><span class="o">=</span>False
</span><span class='line'>    <span class="nv">LDM_SESSION</span><span class="o">=</span>/usr/bin/startlxde
</span><span class='line'>    <span class="nv">CONFIGURE_X</span><span class="o">=</span>True
</span><span class='line'>    <span class="nv">X_MODE_0</span><span class="o">=</span>1024x768
</span><span class='line'>
</span><span class='line'><span class="c"># EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Una buena idea, es usar un dhcp con las MAC e ip fijas para cada usuario, sería
una mejor manera de cortar el bacalao. Así el servidor solo le respondería a sus
clientes. Además, en caso de tener múltiples servidores de clientes ligeros, no
tendrás otra opción, pues si no, cada cliente ligero buteará por donde mejor la
parezca y seguro no querrás eso.</p>

<p>En el servidor DHCP central, rechaza las MAC de los clientes si se dirigen al
puerto 67, para que no reciban dicho servicio, así lo obligas a bootear por el
servidor de clientes ligeros.</p>

<figure class='code'><figcaption><span>&#8220;iptables&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iptables -A INPUT -p tcp --dport <span class="m">67</span> -m mac --mac-source 00:90:4b:a2:55:05 -j DROP
</span><span class='line'>iptables -A INPUT -p udp --dport <span class="m">67</span> -m mac --mac-source 00:90:4b:a2:55:05 -j DROP
</span></code></pre></td></tr></table></div></figure>


<p>Lo ideal sería que el DHCP central tuviera las direcciones MAC de los clientes y
le diera los parámetros de buteo a cada cual, pero eso aún no lo he logrado.
Hay algo que tiene que ver con el parámetro &ldquo;next server&rdquo;. He logrado que estos
den con el tftp adecuado, pero luego tratan de contactar al propio servidor DHCP
como servidor NFS.</p>

<p>También podrías tener un firewall en el servidor de clientes ligeros. Que
permite el DHCP solo a las MAC de los clientes. Así no le das DHCP a cualquiera.
Además, podrías decirle también a ese servidor, que solo permite el tráfico de
las MAC de los clientes ligeros. No me parece que un servidor como ese tenga que
ser alcanzado por otra máquina.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-22T02:48:23-05:00'><span class='date'>22/02/2015</span> <span class='time'>2:48 am</span></time>
        
           | <a href="/blog/2015/02/22/rails-sin-turbolink/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/02/22/rails-sin-turbolink/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Una de las cosas que más me gusta de Rails 4.2 es que al fin se pueden crear
aplicaciones SIN Turbolink. En versiones anterior estábamos obligados a
deshabilitarlo luego de inicializada una App nueva y las cosas no siempre salían
como esperábamos.</p>

<p>Una de las características de las que se jacta la <a href="http://guides.rubyonrails.org/asset_pipeline.html">asset pipeline</a> de rails
es que los Sprockets cargan de manera individual para cada controlador&hellip;</p>

<p>Al menos eso dicen&hellip;</p>

<p>Pero con la introducción de Turbolinks y con el cuento de la comprimidera, se
cargan todos los Srockets de todos los controladores; formando tremenda
morsilla.</p>

<p>A todas esas, necesitas execjs instalado y por supuesto, nodejs o el dichoso
therubyracer (ambos me caen como una patada en un cordal).</p>

<p>Los que usan CoffeScript (le tienen miedo a JavaScript puro) necesitan toda esa
porquería y por otra parte, al que no le guste andar enseñando su código
JavaScript (porque son unos egoístas) Turbolinks y Uglifier les comprime y les
hace tremenda morsilla ilegible a simple vista. Fíjese que bien le queda el
nombre a la gema que comprime el JavaScript &ldquo;uglifier&rdquo;, algo así como &ldquo;afeador&rdquo;.</p>

<p>Este cubano que está aquí, prefiere los &ldquo;.js.erb&rdquo; constantes y sonantes. Así que
se pueden meter Turbolinks donde mejor le quepa. Mis &ldquo;.js&rdquo; están bajo la GPL y
bien comentados, para todo el que quiera leerlos.</p>

<p>Entonces vamos crear una App de rails, libre de Turbolinks, CoffeScript y demás
gangárreas.</p>

<h3>rails new ejemplo -T &ndash;skip-turbolinks</h3>

<p>Al Gemfile le quitamos la porquería, a mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;Gemfile&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#source &#39;https://rubygems.org&#39;</span>
</span><span class='line'><span class="n">source</span> <span class="s2">&quot;file:///media/sdb1/ruby/repo/&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Bundle edge Rails instead: gem &#39;rails&#39;, github: &#39;rails/rails&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.2.0&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Use sqlite3 as the database for Active Record</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Use jquery as the JavaScript library</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bueno corre bundle install y terminamos la primera fase.</p>

<p>Los próximo será localizar el layout principal y decirle que en que incluye solo
los Sprockets que macheen a este controlador.</p>

<p>Lo que teníamos así:</p>

<figure class='code'><figcaption><span>&#8220;application.html.erb ORIGINAl&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>Ejemplo<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag    &#39;application&#39;, media: &#39;all&#39; %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag &#39;application&#39; %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= csrf_meta_tags %&gt;
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span>%= yield %&gt;
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nos debe quedar así:</p>

<figure class='code'><figcaption><span>&#8220;application.html.erb MODIFICADO&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>Ejemplo<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag    &#39;application&#39; %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag &#39;application&#39; %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag params[:controller] %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag params[:controller] %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= csrf_meta_tags %&gt;
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span>%= yield %&gt;
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>NO QUITAMOS el &lsquo;application&rsquo;, si no cargará SOLAMENTE los del controlador y nos
interesa que a través de application se carguen otros; por ejemplo, nuestra css
principal que debe estar presente en todas las rutas.</p>

<p>OJO! Ahora debemos quitar el require_tree en &lsquo;application&rsquo; de los sprockets,
tanto CSS como JS. Ya que si no, sería lo mismo, al cargar application, se
cargarían TODOS los Sprockets.</p>

<p>Además, seguro tiene tu CSS que quieres usar en TODO tu proyecto. Las declaramos
ahí.</p>

<figure class='code'><figcaption><span>&#8220;application.js ANTES&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// This is a manifest file that&#39;ll be compiled into application.js, which will include all the files</span>
</span><span class='line'><span class="c1">// listed below.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,</span>
</span><span class='line'><span class="c1">// or any plugin&#39;s vendor/assets/javascripts directory can be referenced here using a relative path.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// It&#39;s not advisable to add code directly here, but if you do, it&#39;ll appear at the bottom of the</span>
</span><span class='line'><span class="c1">// compiled file.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details</span>
</span><span class='line'><span class="c1">// about supported directives.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'><span class="c1">//= require_tree . // esto lo quitamos</span>
</span></code></pre></td></tr></table></div></figure>


<p>Quitando la porquería:</p>

<figure class='code'><figcaption><span>&#8220;application.js DESPUÉS&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora hacemos lo mismo con las CSS</p>

<figure class='code'><figcaption><span>&#8220;application.css ANTES&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/*</span>
</span><span class='line'><span class="c"> * This is a manifest file that&#39;ll be compiled into application.css, which will include all the files</span>
</span><span class='line'><span class="c"> * listed below.</span>
</span><span class='line'><span class="c"> *</span>
</span><span class='line'><span class="c"> * Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,</span>
</span><span class='line'><span class="c"> * or any plugin&#39;s vendor/assets/stylesheets directory can be referenced here using a relative path.</span>
</span><span class='line'><span class="c"> *</span>
</span><span class='line'><span class="c"> * You&#39;re free to add application-wide styles to this file and they&#39;ll appear at the bottom of the</span>
</span><span class='line'><span class="c"> * compiled file so the styles you add here take precedence over styles defined in any styles</span>
</span><span class='line'><span class="c"> * defined in the other CSS/SCSS files in this directory. It is generally better to create a new</span>
</span><span class='line'><span class="c"> * file per style scope.</span>
</span><span class='line'><span class="c"> *</span>
</span><span class='line'><span class="c"> *= require_tree .</span>
</span><span class='line'><span class="c"> *= require_self</span>
</span><span class='line'><span class="c"> */</span>
</span></code></pre></td></tr></table></div></figure>


<p>Luego de la dieta</p>

<figure class='code'><figcaption><span>&#8220;application.css DESPUÉS</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/*</span>
</span><span class='line'><span class="c"> *= require_self</span>
</span><span class='line'><span class="c"> *= require tu_css_general</span>
</span><span class='line'><span class="c"> */</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hasta aquí todo está lindo, pero resulta que al pasar por el pipeline, te dice
una asset del controlador se filtró pa afuera y no será servida. Pero además da
palo!</p>

<p>Hay 2 maneras de solucionar esto.</p>

<ul>
<li> La fácil de copiar y manter; pero difícil de entender</li>
<li> La que viene por defecto, fácil de entender y difícil de recordar o mantener</li>
</ul>


<p>Una manera, compleja y absoluta:</p>

<p>Una vez más, los initializer salvan el día. Al initializers de las assets le agregamos esto:</p>

<figure class='code'><figcaption><span>&#8220;config/initializers/assets.rb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Be sure to restart your server when you modify this file.</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Version of your assets, change this if you want to expire all your assets.</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Add additional assets to the asset load path</span>
</span><span class='line'><span class="c1"># Rails.application.config.assets.paths &lt;&lt; Emoji.images_path</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Precompile additional assets.</span>
</span><span class='line'><span class="c1"># application.js, application.css, and all non-JS/CSS in app/assets folder are already added.</span>
</span><span class='line'><span class="c1"># Rails.application.config.assets.precompile += %w( search.js )</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># AQUÍ</span>
</span><span class='line'><span class="c1"># le agregamos esto, tal como sale en la documentación oficial</span>
</span><span class='line'><span class="c1"># http://guides.rubyonrails.org/asset_pipeline.html#precompiling-assets</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">&lt;&lt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">path</span> <span class="o">=~</span> <span class="sr">/\.(css|js)\z/</span>
</span><span class='line'>    <span class="n">full_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">to_path</span>
</span><span class='line'>    <span class="n">app_assets_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;assets&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_path</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">full_path</span><span class="o">.</span><span class="n">starts_with?</span> <span class="n">app_assets_path</span>
</span><span class='line'>      <span class="kp">true</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="kp">false</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>En la documentación oficial sale ese burumba como remiendo para compilar todas
las Assets pero tiene un logger true y false; lo cual da palo en rails 4.2 (y
creo que en todos). Además: Para que loguear que se compiló toda es mierda? Si
fallar la compilación; será logueado por el controlador ;)</p>

<p>La simple y difícil de mantener:</p>

<p>Sin la brujería anterior, habría que usar lo que dice el comentario y poner
junto a search.js el resto de las assets. Quizás tú uses su CSS en solo fichero,
siendo el caso, con añadir ese solo fichero, resolvió el problema.</p>

<p>El rollo vendrá en que si agrega una CSS más tarde, no se recordará que debe
compilarla; agregando el nombre al array donde está search.js.</p>

<p>Nota para lo imbéciles: El fichero &ldquo;search.js&rdquo; es un ejemplo. Quítalo y pon el
nombre de tu Asset</p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;config/initializers/assets.rb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="sx">%w( tu_css_general.css tu_framework.js )</span>
</span></code></pre></td></tr></table></div></figure>


<p>¿Por qué esto es tan complejo? Porque Rails exhorta a sus usaurios a usar
Turbolinks (realmente es la mejor opción) y la configuración por defecto, deja
que Turbolinks se ocupe de esas cosas.</p>

<h3>Turbolink es una muy buena opción!</h3>

<p>Sobre todo para aplicaciones de cara a internet o bien de cara a una red lenta
(infomed u otro PPP de Cuba). A mi en los personal Turbolinks me resulta un
estorbo a la hora de desplegar una aplicación de rails en una máquina que
carece de nodejs. Por ejemplo, algunos de mis clientes usan Ubuntu del año 4.</p>

<h3>En mi opinión:</h3>

<ul>
<li><p> Turbolinks es un asco, tiene que mejorar mucho todavía</p></li>
<li><p> CoffeScript sobra, al final debes saber JavaScript para programar con Coffe</p></li>
</ul>


<p>   <blockquote><p>Donde V8 o nodejs sean un problema, turbolinks lo será.</p><footer><strong>Murphy</strong> <cite>Ley De Turbolinks</cite></footer></blockquote></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/6">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>

	<span id="qrcode"></span>

	<h1>Lo m&aacute;s reciente</h1>

	<ul id="recent_posts">
		
		<li class="post">
			<a href="/blog/2015/11/12/rc-dot-local-en-systemd/">rc.local en systemd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/las-mujeres-gordas/">las mujeres gordas</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/tls-y-ssl-en-postfix/">tls y ssl en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/20/compartir-la-wifi/">compartir la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/01/squid-transparente/">squid transparente</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/19/will-paginate/">will_paginate</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/12/date-select-en-espanol/">date_select en español</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/11/openvas-en-archlinux/">OpenVAS en Archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/anadir-verbo-a-un-scaffold/">añadir verbo a un scaffold</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/asset-pipeline-en-production/">asset pipeline en production</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/12/systemd-automount/">systemd automount</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/21/sasl-homeclub-only/">SASL homeclub only</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/19/delay-pools-de-squid/">delay pools de squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/12/rails-con-mongodb/">rails con mongodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/06/zentyal/">Zentyal</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/01/bundle/">bundle</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/12/02/welcome-aboard/">welcome aboard</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/10/28/proxy-automatico/">proxy automático</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/24/verdial-y-el-imagis/">la pena de verdial</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/05/palos-de-wordpress/">palos de wordpress</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/el-server-de-correo/">el servidor de correo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/mas-de-ocs/">más de OCS</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/15/subdesarrollo/">subdesarrollo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/11/ocs-inventory/">ocs-inventory</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/08/select-en-bootstrap/">select en bootstrap</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/05/empirico/">empíricos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/27/crear-un-chroot-con-debian/">crear un chroot con debian</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/10/autenticador-sql-en-el-proxy/">autenticador SQL en el proxy</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/postfix-entrando-en-el-baile/">postfix entrando en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/dovecot-entra-en-el-baile/">dovecot entra en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/05/02/wordpress-para-todos/">wordpress para todos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/06/squid-en-infomed/">el toten de proxies</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/04/en-la-cumbre-del-vedado/">el &#8220;calisto&#8221; garcía</a>
		</li>
		
	</ul>
	
	<span id="qrcode_bajo"></span>

</section>

<!-- muestra el qrcode si no estámos en la raiz -->
<script type="text/javascript">
if (location.pathname!='/') {

	// calcula un monto de bitcoins al azaar
   var btc=0;
   while (btc<0.0010 || btc>0.0080 ) {
      var btc=(Math.random()/100).toString().slice(0,6);
   }

	// coge el span
	var elspan=document.getElementById("qrcode");

	// métele la imágen
	elspan.innerHTML='<img class="right" src="/images/direccion.png" width="300" height="500" title="" >';

	// y ponlo en el enlace
   elspan.innerHTML='<p>Me contento con <strong>'+btc+' BTC</strong></p>'+elspan.innerHTML;

	// ponlo abajo también
   document.getElementById("qrcode_bajo").innerHTML='<br>'+elspan.innerHTML;


}
</script>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - låzaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'uranio-235';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
