
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>El SysAdmin del 3er Mundo</title>
  <meta name="author" content="låzaro">

  
  <meta name="description" content="compartir la wifi 20/10/2015 11:36 pm | Comments Cada vez que paso por
23, me cuentro mil y una
red cuyo ESSID tiene el sufijo Conectify delante. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uranio-235.github.io/posts/7/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El SysAdmin del 3er Mundo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">El SysAdmin del 3er Mundo</a></h1>
  
    <h2>luchando contra el subdesarrollo en todos los frentes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uranio-235.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archivo</a></li>
  <li><a href="/blog/categories/rails/">Ruby on Rails</a></li>
  <li><a href="/blog/categories/destacado/">Destacado</a></li>
  <li><a href="/blog/categories/razonemos/">Razonemos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/20/compartir-la-wifi/">compartir la wifi</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-20T23:36:19-04:00'><span class='date'>20/10/2015</span> <span class='time'>11:36 pm</span></time>
        
           | <a href="/blog/2015/10/20/compartir-la-wifi/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/20/compartir-la-wifi/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/23_gente.jpg" width="300" height="500" title="" ></p>

<p>Cada vez que paso por
<a href="http://www.ecured.cu/index.php/Calle_23_%28Vedado%29">23</a>, me cuentro mil y una
red cuyo ESSID tiene el sufijo <strong>Conectify</strong> delante. Insultado por semejante
derroche de windows, le comentaba a un colega, que daba tristeza no ver un
linuxero ahí conectado.</p>

<p>El socio me dijo: -en linux no se puede compartir la wifi</p>

<p>PA DARLE POR LA CARA!</p>

<p>Dos paquetes nada más que hacen falta: <strong>iw</strong>, <strong>hostapd</strong></p>

<p>La idea es:</p>

<ul>
<li>crear una interfaz wifi como estacion</li>
<li>crear una interfaz wifi como AP</li>
<li>crear un interfaz bridge (puente)</li>
<li>declarar que la interfaz de salida del puente, es la estación</li>
<li>echar a andar el AP por software</li>
</ul>


<h3>¿SE ENTENDIÓ?</h3>

<p>Si tienes el puñetero NetworkManager corriendo, este es un buen momento para
pararlo.</p>

<p>La interfaz que usualmente vez como <strong>wlan0</strong> es en realidad <strong>phy0</strong>. ¿Quieres
verlo? Corre esto:</p>

<figure class='code'><figcaption><span>iw</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iw dev wlan0 del
</span></code></pre></td></tr></table></div></figure>


<p>¿Te fijaste que<strong> wlan0</strong> desapareció? No te preocupes, puedes volver a crearla.
Así:</p>

<figure class='code'><figcaption><span>iw</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iw phy phy0 interface add estacion0 <span class="nb">type </span>station
</span></code></pre></td></tr></table></div></figure>


<p>Como mismo hicimos una estación, podemos hacer un AP.</p>

<figure class='code'><figcaption><span>iw</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iw phy phy0 interface add hotspot0 <span class="nb">type </span>__ap
</span></code></pre></td></tr></table></div></figure>


<p>Ahora creamos la interfaz de puente y le asignamos a <strong>wlan0</strong> como extremo de
salida.</p>

<figure class='code'><figcaption><span>br0</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip link add name br0 <span class="nb">type </span>bridge
</span><span class='line'>iw dev estacion0 <span class="nb">set </span>4addr on
</span><span class='line'>ip link <span class="nb">set </span>dev estacion0 promisc on
</span><span class='line'>ip link <span class="nb">set </span>dev estacion0 up
</span><span class='line'>ip link <span class="nb">set </span>dev estacion0 master br0
</span><span class='line'>ip link <span class="nb">set </span>up dev br0
</span></code></pre></td></tr></table></div></figure>


<p>En letra de molde:</p>

<ul>
<li>crea un bridge llamado br0</li>
<li>dile que lleva ipv4 (requerido, no se por qué)</li>
<li>pon la interfaz en modo promiscuo</li>
<li>levanta el enlace de estaicon0</li>
<li>coloca a estacion0 como interfaz de salida del túnel</li>
<li>levanta el bridge</li>
</ul>


<p>Ahora viene lo más importante, el AP. El fichero <strong>/etc/hostapd/hostapd.conf</strong>
contendrá la configuración de nuestros AP. A mi me quedó así:</p>

<figure class='code'><figcaption><span>/etc/hostapd/hostapd.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># el nombre de tu wifi</span>
</span><span class='line'><span class="nv">ssid</span><span class="o">=</span>Linux
</span><span class='line'>
</span><span class='line'><span class="c"># la contraseña de tu wifi</span>
</span><span class='line'><span class="nv">wpa_passphrase</span><span class="o">=</span>secretisisimo
</span><span class='line'>
</span><span class='line'><span class="c"># la interfaz de red que hará de AP</span>
</span><span class='line'><span class="nv">interface</span><span class="o">=</span>hostspot0
</span><span class='line'>
</span><span class='line'><span class="c"># el puente al que se acoplará</span>
</span><span class='line'><span class="nv">bridge</span><span class="o">=</span>br0
</span><span class='line'>
</span><span class='line'><span class="c"># el canal, lo puede seleccionar manual</span>
</span><span class='line'><span class="c"># pero un valor de 0, hará el survey.</span>
</span><span class='line'><span class="c"># Mejor que el ap lo seleccione, así</span>
</span><span class='line'><span class="c"># no chocas con ningún canal de etecsa en 23</span>
</span><span class='line'><span class="c"># y aprovechemos ahora que podemos hacer lo</span>
</span><span class='line'><span class="c"># que nos de la gana con el espectro radioeléctrico</span>
</span><span class='line'><span class="nv">channel</span><span class="o">=</span>0
</span><span class='line'>
</span><span class='line'><span class="c"># no toques más nada de aquí pa abajo</span>
</span><span class='line'><span class="nv">auth_algs</span><span class="o">=</span>3
</span><span class='line'><span class="nv">driver</span><span class="o">=</span>nl80211
</span><span class='line'><span class="nv">hw_mode</span><span class="o">=</span>g
</span><span class='line'><span class="nv">logger_stdout</span><span class="o">=</span>-1
</span><span class='line'><span class="nv">logger_stdout_level</span><span class="o">=</span>2
</span><span class='line'><span class="nv">max_num_sta</span><span class="o">=</span>5
</span><span class='line'><span class="nv">rsn_pairwise</span><span class="o">=</span>CCMP
</span><span class='line'><span class="nv">wpa</span><span class="o">=</span>2
</span><span class='line'><span class="nv">wpa_key_mgmt</span><span class="o">=</span>WPA-PSK
</span><span class='line'><span class="nv">wpa_pairwise</span><span class="o">=</span>TKIP CCMP
</span></code></pre></td></tr></table></div></figure>


<p>y arráncalo:</p>

<figure class='code'><figcaption><span>systemctl</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl start hostapd
</span></code></pre></td></tr></table></div></figure>


<p>Desde entonces, lo que se conecte a tu wifi con ESSID &ldquo;Linux&rdquo; en este caso, irá
a dar a la red que tengas conectada en tu Wifi. En este caso la red de br0, cuyo
otro extremo sería la wifi de etecsa.</p>

<p>Lo mismo puede hacer cambiando el extremo del tunel. Por ejemplo, con eth0
saldría hacia una red cableada. Una manera de meter una WiFi en una red.</p>

<h4>Además</h4>

<p>De esta misma forma, si tuvieras dos tarjetas wifi, pones una como AP y le pones
la otra como extremo del puente.</p>

<h4>OJO</h4>

<p>Otra cosa, si tienes corriendo el <strong>NetworkManager</strong> no podrás echar a andar
<strong>hostapd</strong>. Páralo, arranca hostapd y vuelve a hechar a andar el
NetworkManager.</p>

<p>   <blockquote><p>La técnica es la técnica y sin técnica, no hay técnica.</p><footer><strong>Teófilo Stevenson</strong> <cite><a href='https://es.wikipedia.org/wiki/Te%C3%B3filo_Stevenson'>Boxeador Cubano</a></cite></footer></blockquote></p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.08 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-18T13:19:01-04:00'><span class='date'>18/10/2015</span> <span class='time'>1:19 pm</span></time>
        
           | <a href="/blog/2015/10/18/systemd-timesyncd/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/18/systemd-timesyncd/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mantener un reloj sincronizado y en hora, siempre ha sido un dilema. Algunas
personas no reconocen la necesidad de esto; y además son tan imbéciles, que
luego se quejan cuando la desfasada fecha de su computadora les impide
conectarse a un sitio SSL.</p>

<p>En los servidores y en las estaciones de trabajo que se respeten; siempre ha
sido una opción usar un cliente NTP. Pero los ntp, cuando la fecha no está en el
día adecuado, no se toman la molestia de sincronizar. En los raspberry-pi eso
puede llegar a ser un tremendo problema, ya que NO tienen reloj de hardware y ni
siquiera conservan la fecha.</p>

<p>El tan criticado <a href="https://es.wikipedia.org/wiki/Systemd">Systemd</a>, tiene una
solución para este problema. Sucia y burda, pero muy eficiente. Normalmente, los
&ldquo;clientes&rdquo; <a href="https://es.wikipedia.org/wiki/Network_Time_Protocol">NTP</a>, son
cliente y servidor. En el caso de systemd-timsyncd, no se tomaron la molestia de
implementar un servidor; solamente un cliente minimalista. Además, guarda las
sincronizaciones en un fichero, para determinar si tu reloj de hardware se
adelante o atraza y contrarrestar dicho efecto.</p>

<p>Lo bueno que tiene es que agarra la fecha y hora de cualquier parte; luego, la
setea sin chistar. La configuración es sencillísima. Localiza el fichero:</p>

<p><strong>/etc/systemd/timesyncd.conf</strong></p>

<p>Declárale un servidor principal y si te da la gana, uno o varios adicionales. A
mi me quedó así:</p>

<figure class='code'><figcaption><span>/etc/systemd/timesyncd.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#  This file is part of systemd.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c">#  systemd is free software; you can redistribute it and/or modify it</span>
</span><span class='line'><span class="c">#  under the terms of the GNU Lesser General Public License as published by</span>
</span><span class='line'><span class="c">#  the Free Software Foundation; either version 2.1 of the License, or</span>
</span><span class='line'><span class="c">#  (at your option) any later version.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># You can override the directives in this file by creating files in</span>
</span><span class='line'><span class="c"># /etc/systemd/timesyncd.conf.d/*.conf.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># See timesyncd.conf(5) for details</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>Time<span class="o">]</span>
</span><span class='line'><span class="nv">NTP</span><span class="o">=</span>time.hcg.sld.cu
</span><span class='line'><span class="nv">FallbackNTP</span><span class="o">=</span>time.sld.cu time.microsoft.com
</span></code></pre></td></tr></table></div></figure>


<p>Generalmente, mi laptop está en el calixto, por eso puse mi servidor local como
primario; pero si no lo estuviera, de seguro <strong>time.sld.cu</strong> sería alcanzable. En
el dificilísimo caso de que estuviera de cara a internet, quizás responda el de
microsoft, que no está malo. Por cierto, los comentarios del fichero son
bastante útiles, vale la pena leerlos.</p>

<p>Por último, lo más importante, habilitar y arrancar el servicio:</p>

<p>systemctl <strong>start</strong> systemd-timesyncd.service</p>

<p>systemctl <strong>enable</strong> systemd-timesyncd.service</p>

<p>Para saber el estado del servicio, corre:</p>

<p><strong>timedatectl</strong></p>

<p>Te dirá la hora local y la UTC; te dirá además si está sincronizando por NTP.
Con ese comando puede hacer un montón de operaciones, por ejemplo, setear la
hora civilizadamente, ya que este la pone en el <a href="https://es.wikipedia.org/wiki/Reloj_en_tiempo_real">RTC</a> también.</p>

<p>   <blockquote><p>No existe juez más justo, que el pasar del tiempo.</p></blockquote></p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.05 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-16T12:40:04-04:00'><span class='date'>16/10/2015</span> <span class='time'>12:40 pm</span></time>
        
           | <a href="/blog/2015/10/16/palo-con-la-wifi/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/16/palo-con-la-wifi/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Vale la pena hacer una entrada de esto, porque podría ser el problema de alguien
que como yo; se cansó de alarse los pelos y buscar en google.</p>

<p>Recién no se cuando me bajé una versión de algo que involucra al networkmanager
y BUN! La wifi, cada vez que levantaba al susodicho, se bloqueaba.</p>

<p>El problema parecía estar en el fichero:</p>

<p><strong>/var/lib/NetworkManager/NetworkManager.state</strong></p>

<p>No se porque, decía tener la wifi deshabilitada. El fichero contiene algo como
esto:</p>

<figure class='code'><figcaption><span>NetworkManager.state</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>main<span class="o">]</span>
</span><span class='line'><span class="nv">NetworkingEnabled</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">WirelessEnabled</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">WWANEnabled</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">WimaxEnabled</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>No se por qué, la clave <strong>NetworkingEnabled</strong> estaba con valor <strong>false</strong> y al
arrancar NetworkManager, bloqueaba la wifi, al punto que al levantarla
manualmente, me decía que tenía que desbloquearla con rfkill. Para el que no lo
sepa, con rfkill se pueden bloquear los radios.</p>

<p>Si por casualidad tienes alguno bloqueado, ejecuta:</p>

<p>rfkill unblock all</p>

<p>Cosa que tenía que ejecutar cada vez que arrancaba el dichóso NetworkManager</p>

<p>Probé apagar la wifi y arrancar el networkmanager con la wifi apagada, para ver
si eso cambiaba algo en el fichero antes mencionado; pero no. Lo cual me llevó a
la conclusión de que no fue una metedura de pata mía si no, un bug.</p>

<p>Ponerle atributo inmutable a ese fichero podría ser una solución, pero todo lo
que está en /var suele ser un dato volátil que señala el estado de algo, así que
ponerle inmutable podría causar fallos en la aplicación.</p>

<p>Si ese fichero está en /var es porque el network manager dumpea ahí su estado,
fíjese que está junto a los lease del DHCP. No tengo certeza de que modificando
esa configuración manualmente esta persista; pero ya llevo una semana con el
problema resuelto.</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.03 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-15T14:38:20-04:00'><span class='date'>15/10/2015</span> <span class='time'>2:38 pm</span></time>
        
           | <a href="/blog/2015/10/15/repo-de-fdroid/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/15/repo-de-fdroid/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&ldquo;La que se avecina&rdquo;, sería una buena manera para describir la revolución de
aparatos con android que habrá en el Calixto García muy pronto. Yo siempre con
el paso al frente y las luz larga (modestia y aparte) estuve pensando que tener
nuestro propio repositorio de aplicaciones para android; sería una buena manera
de mantener a todo el mundo bien actualizado, sobre todo a aquellos que no
tienen acceso a internet.</p>

<p>Para el que no lo conozca, <a href="https://f-droid.org/">fdroid</a> es una herramienta
cliente para repositorios de android, osea como google market pero libre.</p>

<p>La mecánica es sencilla: Bajo los paquetes con
<a href="http://www.aptoide.com">aptoide</a>, verifico que sean seguros y copio la cache
para el directorio repo/ de fdroid en el servidor con <a href="https://acrosync.com/">acrosync</a></p>

<p>En el repo de debian y en AUR, el paquete se llama <strong>fdroidserver</strong>. La rutina
de instalación ya la conoces.</p>

<p>Creamos el directorio donde meteremos el repo, en mi caso, aquí:</p>

<figure class='code'><figcaption><span>mkdir</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -p /srv/http/fdroid/repo
</span></code></pre></td></tr></table></div></figure>


<p>Creamos la configuración de nginx, a mi me quedó así:</p>

<figure class='code'><figcaption><span>nginx.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>server <span class="o">{</span>
</span><span class='line'>     listen   10.1.1.14:80<span class="p">;</span>
</span><span class='line'>     listen   10.1.1.14:443 ssl<span class="p">;</span>
</span><span class='line'>     server_name android.hcg.sld.cu<span class="p">;</span>
</span><span class='line'>     location / <span class="o">{</span>
</span><span class='line'>     root /srv/http/fdroid/repo/<span class="p">;</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Un virtualhost nombrado <em>android</em>. <strong>No olvide crear el puntero DNS</strong></p>

<p>Ahora, ve al directorio raíz del repo, OJO <strong>A LA RAIZ</strong>, NO a donde dice repo/.</p>

<figure class='code'><figcaption><span>fdroid</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /srv/http/fdroid/
</span><span class='line'>fdroid init
</span></code></pre></td></tr></table></div></figure>


<p>Te preguntará por la <strong>android-sdk</strong>, por lo general, está en /opt/android-sdk,
dale la ruta.</p>

<p>¿¿No tienes la SDK de android?? Ah pues estás muy jodio&hellip; En el caso de arch,
el repo de bbqlinux contiene la sdk completa, solo para 64 bits.</p>

<p>Pero volviendo con fdroid:</p>

<p>Ahora debe habérse creado el directorio <strong>repo/</strong> dentro del directorio
<strong>/srv/http/fdroid</strong> y es ahí donde copiarás las APK.</p>

<p>cp /donde/esten/tus/*.apk /srv/http/fdroid/<strong>repo/</strong></p>

<p>Pero claro, querrás que tu repo se identifique.  El fichero
<strong>/srv/http/fdroid/config.py</strong> contiene lo que buscas. Por la linea trenta y
pico; a mi me quedó así:</p>

<figure class='code'><figcaption><span>config.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="n">repo_url</span> <span class="o">=</span> <span class="s">&quot;http://android.hcg.sld.cu&quot;</span>
</span><span class='line'><span class="n">repo_name</span> <span class="o">=</span> <span class="s">&quot;Calixto Garcia&quot;</span>
</span><span class='line'><span class="n">repo_icon</span> <span class="o">=</span> <span class="s">&quot;calixto_xsm.png&quot;</span>
</span><span class='line'><span class="n">repo_description</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">Repositorio de aplicaciones de android del calixto. Intentaremos proveerle</span>
</span><span class='line'><span class="s">aplicaciones debidamente actualizadas. Sientase libre de colaborar, trayendonos</span>
</span><span class='line'><span class="s">las mas recientes APK.</span>
</span><span class='line'><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ah! y sin tildes, si no, python se vuelve loco con el encoding.</p>

<p>Ahora vamos a crear el índice inicial, pero eso mismo comando lo correrás cuando
agregues aplicaciones a tu repo.</p>

<figure class='code'><figcaption><span>fdroid</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>fdroid update --create-metadata
</span></code></pre></td></tr></table></div></figure>


<p>OJO!! Asegúrate de que las APK no tengan un espacio en su nombre; muchísimo
menos un caracter raro. Si todo salió bien debes ver algo como &ldquo;Generating
metada&rdquo;.</p>

<p>Con eso terminaste el servidor&hellip; Ve a fdroid y ponle la URL del virtualhost
como repo, luego update y listo&hellip;</p>

<p>¿Cómo se hace? Facilito. Párate en la primer pantalla, aprieta el botón de menú
del dispositivo y toca donde dice &ldquo;Gestionar Repositorios&rdquo; o en inglés, &ldquo;Manage
Repos&rdquo;</p>

<p>Desactiva los respos inalcanzables y añade tu repo local. Luego actualiza y
listo, verás las aplicaciones disponibles.</p>

<p>Ya solo te quedaría instalar un rsync que desemboque en el repo y con
<a href="https://acrosync.com/">acrosync</a> subes la cache de aptotide para el repo, así
como lo estoy haciendo yo ahora.</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.07 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-08T21:45:55-04:00'><span class='date'>08/10/2015</span> <span class='time'>9:45 pm</span></time>
        
           | <a href="/blog/2015/10/08/prawn-pdf-con-ruby/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/08/prawn-pdf-con-ruby/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>De siempre, los usuarios que fueron forzados a abandonar
<a href="https://es.wikipedia.org/wiki/Microsoft_Access">MSAcces</a> por un motivo u otro;
sienten un incontenible necesidad por los &ldquo;informes&rdquo;.</p>

<p>A la hora de imprimir, muchos usaurios no entienden que un HTML se imprima.
Incluso, habiéndoles hecho un javascript que muestra el diálogo de impresión,
simplemente lo cierra y me preguntan &ldquo;¿y ahora que hago con esto?&rdquo;</p>

<p>En recientes diálogos con un bibliotecario (que hereda la clase Usuario) me dijo
que la gente entiende más de imprimir PDF.</p>

<p>Hacer un PDF me pareció una tare bastante compleja; y lo es, pero
<a href="http://prawn.majesticseacreature.com">Prawn</a> lo hace de una manera casi
increíble. Para no aburrirte con el cuento, te mostraré como montarlo arriba del
tren.</p>

<p><strong>EjemploController</strong> que tu conoce:</p>

<figure class='code'><figcaption><span>&#8220;ejemplo_controller.rb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># el controlador bin ban bin ban</span>
</span><span class='line'><span class="k">class</span> <span class="nc">EjemploController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">def</span> <span class="nf">accion</span> <span class="c1"># la acción, como se llame</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># a según el sapo, la pedrá</span>
</span><span class='line'>      <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1"># tírame el pdf</span>
</span><span class='line'>         <span class="nb">format</span><span class="o">.</span><span class="n">pdf</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># tráeme al animal</span>
</span><span class='line'>            <span class="nb">require</span> <span class="s1">&#39;prawn&#39;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># créame un nuevo documento pdf</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">=</span><span class="no">Prawn</span><span class="o">::</span><span class="no">Document</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># tírame el banner, el H1 como quien dice, tamaño de fuente 25px en negrita</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">formatted_text</span> <span class="o">[</span> <span class="p">{</span><span class="ss">text</span><span class="p">:</span> <span class="s1">&#39;El título del documentos&#39;</span><span class="p">,</span><span class="ss">size</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span><span class="ss">styles</span><span class="p">:</span> <span class="o">[</span><span class="ss">:bold</span><span class="o">]</span><span class="p">}</span> <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># hazle una rallita horizontal debano al header</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">stroke_horizontal_line</span> <span class="mi">0</span><span class="p">,</span><span class="mi">235</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># mueve el cursor pa abajo</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">move_down</span> <span class="mi">20</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># la variable cuerpo contiene un texto laaaaaaargooo en HTML</span>
</span><span class='line'>            <span class="c1"># un HTML muy rudimentario, Prawn lo interpresta, por ejemplo</span>
</span><span class='line'>            <span class="c1"># las cláusulas &lt;strong&gt;</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">text</span> <span class="vi">@cuerpo</span><span class="p">,</span> <span class="ss">inline_format</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># por jemeplo, itera en el modelo User y escribe sus nombres</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">user</span> <span class="k">in</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Nombre: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">nombre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="ss">inline_format</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">move_down</span> <span class="mi">10</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Edad: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">edad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="ss">inline_format</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">move_down</span> <span class="mi">30</span>
</span><span class='line'>            <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># tírala!!!</span>
</span><span class='line'>            <span class="n">send_data</span> <span class="vi">@pdf</span><span class="o">.</span><span class="n">render</span><span class="p">,</span> <span class="ss">filename</span><span class="p">:</span> <span class="s2">&quot;solicitud.pdf&quot;</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">end</span> <span class="c1"># format</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">end</span> <span class="c1"># respond_to</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">end</span> <span class="c1"># def</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span> <span class="c1"># class</span>
</span></code></pre></td></tr></table></div></figure>


<p>Vamos a dividir en sílabas:</p>

<h4>Línea 7</h4>

<p>Rails, la acción responde a múltiples mime-types</p>

<h4>Línea 10</h4>

<p>Rails, application/pdf responde a la extensión PDF <em>format.pdf do</em></p>

<h4>Línea 13</h4>

<p>Carga la librería, sí, ya se que en Rails debes hacer eso en un initializer, de
cualquier manera, aún, luego de haberlo agregado a tu Gemfile, no te olvides de
requerirla, ya sea en un initializer o en el controlador.</p>

<h4>Línea 16</h4>

<p>Crea un nuevo PDF y almacénalo en la variable de instancia <strong>@pdf</strong></p>

<h4>Línea 19</h4>

<p>El método <strong>formatted_text</strong>, recibe como argumento un array de hashes</p>

<p>Cada array en un bloque de texto y contiene un hash. La clave :text contiene el
texto a renderizar, :size el tamaño y :style el estilo de fuente.</p>

<h4>Línea 22</h4>

<p>Trazar línea horizontal, el método <strong>stroke_horizontal_line</strong> recibe como
argumento, de donde, a donde debe trazar la línea.</p>

<h4>Pasemos a la línea 41</h4>

<p>El método <strong>render</strong> devuelve el PDF. Si lo sacas con <strong>puts</strong> verás el PDF
crudo. Podrías también tirarlo pa un fichero así:</p>

<figure class='code'><figcaption><span>&#8220;fulanito.pdf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>   <span class="no">IO</span><span class="o">.</span><span class="n">write</span> <span class="s1">&#39;fulanito.pdf&#39;</span><span class="p">,</span><span class="vi">@pdf</span><span class="o">.</span><span class="n">render</span>
</span></code></pre></td></tr></table></div></figure>


<p>A los usuarios le encantan los PDF, hazlos feliz ;)</p>

<p>   <blockquote><p>Existen dos tipos de personas,<br/>   las que hacen lo que le dicen; y,<br/>   las que dicen lo que hay que hacer.</p><footer><strong>Lázaro Armando</strong></footer></blockquote></p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.04 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-05T21:45:45-04:00'><span class='date'>05/10/2015</span> <span class='time'>9:45 pm</span></time>
        
           | <a href="/blog/2015/10/05/assets-por-controlador/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/05/assets-por-controlador/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>NUNCA</strong>, he logrado entender, porque el asset pipeline de Rails carga
<strong>TODAS</strong> las porquerías de todos los controladores en todas las vistas.</p>

<p>¡¡¡Como si fuese poco tener que cargar el mismo javascript por controlador!!!</p>

<p>La documentación dice que puedes cargar solamente el del controlador; pero
cuando la sigues al pie de la letra; Rails te da tremendo palo, diciendo que una
asset se escapó sin compilar. La &ldquo;una&rdquo; suele ser la del controlador que estés
cargando, o sea, todas.</p>

<p>La solución que plantea la documentación, es un Proc asqueroso que tampoco
pincha.</p>

<p>Te cuento como lo hice:</p>

<p>Primero tienes que quitar la cláusula &ldquo;<strong>require_tree .</strong>&rdquo; del <strong>application.js</strong></p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// This is a manifest file that&#39;ll be compiled into application.js, which will include all the files</span>
</span><span class='line'><span class="c1">// listed below.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,</span>
</span><span class='line'><span class="c1">// or any plugin&#39;s vendor/assets/javascripts directory can be referenced here using a relative path.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// It&#39;s not advisable to add code directly here, but if you do, it&#39;ll appear at the bottom of the</span>
</span><span class='line'><span class="c1">// compiled file.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// Read Sprockets README (https://github.com/rails/sprockets#sprockets-directives) for details</span>
</span><span class='line'><span class="c1">// about supported directives.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'><span class="c1">//= require turbolinks</span>
</span><span class='line'><span class="c1">//  require_tree . fíjate que quitamos el =</span>
</span><span class='line'><span class="nx">Turbolinks</span><span class="p">.</span><span class="nx">enableProgressBar</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora vamos a dar un toque mágico para que las assets se compilen de manera
dinámica, sin tener que colocarle manualmente al arreglo los nuevos .js
generados. El fichero <strong>config/initializers/assets.rb</strong> me quedó así; <strong>OJO</strong> que es
una linea bien larga:</p>

<figure class='code'><figcaption><span>&#8220;assets.rb - ojo con la linea larga&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Be sure to restart your server when you modify this file.</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Version of your assets, change this if you want to expire all your assets.</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Add additional assets to the asset load path</span>
</span><span class='line'><span class="c1"># Rails.application.config.assets.paths &lt;&lt; Emoji.images_path</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Precompile additional assets.</span>
</span><span class='line'><span class="c1"># application.js, application.css, and all non-JS/CSS in app/assets folder are already added.</span>
</span><span class='line'><span class="c1"># Rails.application.config.assets.precompile += %w( search.js )</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># compila todo lo que te encuentres por el camino</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">to_path</span><span class="p">,</span><span class="s1">&#39;app/assets/javascripts/*.j*&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># activa el debug de la asset pipeline, solo en entorno de desarrollo</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENV&#39;</span><span class="o">]</span> <span class="ow">and</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENV&#39;</span><span class="o">].</span><span class="n">include?</span> <span class="s1">&#39;development&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Podría hacer lo mismo con las CSS si usa un poquito la células grises. Note como
además, agregamos que se debugue la asset pipeline si y solo si estamos en
development.</p>

<p>Pero no hemos terminado, la vista lleva unos toques&hellip; pues debemos decirle lo
más importante, que cargue solo las .js de su controlador. A mi me quedó así:</p>

<p>  &lt;%= javascript_include_tag params[:controller] %></p>

<figure class='code'><figcaption><span>&#8220;app/views/layouts/application.html.erb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>El Título<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag    &#39;application&#39;, media: &#39;all&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag &#39;application&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;
</span><span class='line'>  <span class="c">&lt;!-- carga solo las .js del controlador dado --&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag params[:controller] %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= csrf_meta_tags %&gt;
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span>%= yield %&gt;
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahí te das cuenta que el que carga todo, es el manifest (application.js) con su
&ldquo;requiere_tree .&rdquo; pero la cláusula en la línea 8 le dice que cargue la .js del
controlador especificado en <strong>params[:controller]</strong></p>

<p>Bueno así debe pinchar con javascript y con CoffeScript, al menos a mi me pinchó
con ambos. Veamos que trae rails 5 con esto, porque la mejora urge&hellip;</p>

<p>Si la cosa sigue así en la versión 5, me estoy mudando para Volt</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.06 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>

	<h1>Lo m&aacute;s reciente</h1>

	<ul id="recent_posts">
		
		<li class="post">
			<a href="/blog/2016/11/14/openvpn-user-plus-pass/">openvpn user+pass</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/el-domain-pop/">recolección DomainPOP</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/domainpop-con-postfix/">domainpop con postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/tunel-6in4/">túnel 6in4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/cortafuegos-ipv6-sencillo/">cortafuegos ipv6 sencillo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/poniendo-direcciones-ipv6/">las reglas del juego ipv6</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/ipv6/">la resolución 185/2016</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/04/dirver-broadcom/">driver broadcom</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/09/22/audifonos-blutu/">audífonos blutú</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/09/16/dispatcher-script/">dispatcher script</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/08/16/password-de-windows/">password de windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/08/15/repositorio-de-iso-en-xen/">Local ISO en xen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/31/kiwix-como-servicio/">kiwix como servicio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/17/hibernar-en-archlinux/">hibernar en archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/17/rsync-basico/">rsync básico</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/20/correos-del-cron/">correos del cron</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/18/dkim-y-spf-en-postfix/">dkim y spf en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/06/desacelerar-mouse/">desacelerar mouse</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/05/12/deshabilitar-historial-de-bash/">deshabilitar historial de bash</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/04/29/reparar-archivos-de-innodb/">reparar archivos de innodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/04/01/wpa2-con-freeradius/">WPA2 con freeradius</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/14/misterio-con-ethernet-foxconn/">misterio con ethernet foxconn</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/07/cargar-rvm/">cargar rvm</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/22/data-confirm-en-un-boton/">data confirm en un boton</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/20/hooks-de-pacman/">los hooks de pacman</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/01/arch-compartir-paquetes/">arch compartir paquetes</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/25/hostname-arbitrario-en-bind9/">bind9, registro arbitratio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/19/espejos-de-clamav/">espejos de clamav y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/14/clamav-en-windows/">clamav en windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/12/14/servidor-jabber-con-prosody/">servidor jabber con prosody</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/29/mc-demora-en-abrir/">mc demora en abrir</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/23/desmume-ultralento/">desmume ultralento</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/22/certificado-autofirmado/">certificado autofirmado</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/12/rc-dot-local-en-systemd/">rc.local en systemd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/las-mujeres-gordas/">las mujeres gordas</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/tls-y-ssl-en-postfix/">tls y ssl en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/20/compartir-la-wifi/">compartir la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/01/squid-transparente/">squid transparente</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/19/will-paginate/">will_paginate</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/12/date-select-en-espanol/">date_select en español</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/11/openvas-en-archlinux/">OpenVAS en Archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/anadir-verbo-a-un-scaffold/">añadir verbo a un scaffold</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/asset-pipeline-en-production/">asset pipeline en production</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/12/systemd-automount/">systemd automount</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/21/sasl-homeclub-only/">SASL homeclub only</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/19/delay-pools-de-squid/">delay pools de squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/12/rails-con-mongodb/">rails con mongodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/06/zentyal/">Zentyal</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/01/bundle/">bundle</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/12/02/welcome-aboard/">welcome aboard</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/10/28/proxy-automatico/">proxy automático</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/24/verdial-y-el-imagis/">la pena de verdial</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/05/palos-de-wordpress/">palos de wordpress</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/el-server-de-correo/">el servidor de correo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/mas-de-ocs/">más de OCS</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/15/subdesarrollo/">subdesarrollo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/11/ocs-inventory/">ocs-inventory</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/08/select-en-bootstrap/">select en bootstrap</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/05/empirico/">empíricos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/27/crear-un-chroot-con-debian/">crear un chroot con debian</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/10/autenticador-sql-en-el-proxy/">autenticador SQL en el proxy</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/postfix-entrando-en-el-baile/">postfix entrando en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/dovecot-entra-en-el-baile/">dovecot entra en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/05/02/wordpress-para-todos/">wordpress para todos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/06/squid-en-infomed/">el toten de proxies</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/04/en-la-cumbre-del-vedado/">el &#8220;calisto&#8221; garcía</a>
		</li>
		
	</ul>
	
</section>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - låzaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'uranio-235';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>
</html>
