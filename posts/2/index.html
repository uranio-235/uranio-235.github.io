
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>El SysAdmin del 3er Mundo</title>
  <meta name="author" content="låzaro">

  
  <meta name="description" content="Sigo con mi plan de &ldquo;civilizarme&rdquo;, me he propuesto dejar de parecer un friki en
materia de software. He cambiado i3 por MATE (en la &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uranio-235.github.io/posts/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El SysAdmin del 3er Mundo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">El SysAdmin del 3er Mundo</a></h1>
  
    <h2>luchando contra el subdesarrollo en todos los frentes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com.cu" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uranio-235.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archivo</a></li>
  <li><a href="/blog/categories/rails/">Ruby on Rails</a></li>
  <li><a href="/blog/categories/destacado/">Destacado</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-10T18:28:48-04:00'><span class='date'>10/09/2015</span> <span class='time'>6:28 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sigo con mi plan de &ldquo;civilizarme&rdquo;, me he propuesto dejar de parecer un friki en
materia de software. He cambiado i3 por MATE (en la máquina personal) e incluso
tengo un tema en el grub. Intenté cambiar Atom por Vim, evolution por mutt y
double-cmd por mc; pero por gusto, acabé virando pa atrá.</p>

<p>Una de las cosas que antes solía molestarme en las distros duras como debian,
era el hecho de que no tuvieran una pantalla bien bonita mientras buteaban.
Ubuntu por ejemplo, te pone las bolitas.</p>

<p>Archlinux es particularmente rápido buteando, pero aún tenía conmigo mismo la
deuda del bootscren pendiente.</p>

<p>Resulta que ya splashy no se usa, ahora la talla es un software con nombre de
almendrón: Plymouth</p>

<p>Plymouth, es una proyecto de fedora, para proveer una pantalla de buteo a nivel
de framebuffer. Hoy en día casi todas las distros butean con el framebuffer en
la máxima resolución posible, así que me imagino que Plymouth sea algo bastante
simple.</p>

<p>En el repo de arch no está incluido pero como todo, está disponible en AUR. La
rutina ya la conoces. Selecciona el que dice plymouth pelao.</p>

<figure class='code'><figcaption><span>&#8220;yaourt&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yaourt plymouth
</span></code></pre></td></tr></table></div></figure>


<p>Ahora vamos a cambiar unos parámetros en el generador de imágenes de inicio.
Localiza el fichero <strong>/etc/mkinitcpio.conf</strong> y ahí vamos a cambiar unos
parámetros.</p>

<p>Primero necesitaremos poner el <strong>HOOK</strong> para plymouth. La documentación advierte
que debe ser después de <strong>base</strong> y de <strong>udev</strong>, así que mejor <strong>ponlo de
último</strong>. Por tanto, dentro de las comillas colocarás <strong>plymouth</strong> como un
objeto más de dicha lista; como el último.</p>

<figure class='code'><figcaption><span>&#8220;/etc/mkinitcpio.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">HOOKS</span><span class="o">=</span><span class="s2">&quot;base udev fulanito menganito el_ultimo plymouth&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Nota para los imbéciles:</strong> <em>Si copias y pegas el código anterior, el sistema no te arrancará más.</em></p>

<p>Necesitaremos el módulo apropiado para pinchar el framebufer. En mi caso,
desgraciadamente, uso nvidia, así que me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/mkinitcpio.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">MODULES</span><span class="o">=</span><span class="s2">&quot;nouveau&quot;</span>
</span><span class='line'><span class="c">#MODULES=&quot;i915&quot;</span>
</span><span class='line'><span class="c">#MODULES=&quot;radeon&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fíjate que los demás quedaron a modo de comentario. Te aclaro que <strong>i915</strong> es
para las tarjetas de video Intel.</p>

<p>Ahora tenemos que decirle al grub, que incluya el parámetro <strong>splash</strong> en la
linea de buteo. Eso lo hacemos editando el fichero <strong>/etc/default/grub</strong></p>

<figure class='code'><figcaption><span>&#8220;/etc/default/grub&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&quot;quiet splash&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yo en lo personal suelo quitarle &ldquo;quiet&rdquo; porque me gusta ver lo que hace el
sistema mientras butea. Aunque ya no da tiempo. Como te dije, los sistemas
modernos butean MUY rápido. Es más el tiempo en que carga init o el display
manager, que el de buteo como tal.</p>

<p>Más adelante veremos que hacer para que la pantalla se vea más tiempo, por ahora
terminemos de configurar. Tanto el grub como initramfs, tienen que reflejar los
cambios</p>

<figure class='code'><figcaption><span>&#8220;reflejando cambios&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>grub-mkconfig -o /boot/grub/grub.cfg
</span><span class='line'>mkinitcpio -p linux
</span></code></pre></td></tr></table></div></figure>


<p>Si usas linux-lts, corre:</p>

<figure class='code'><figcaption><span>&#8220;reflejando cambios&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkinitcpio -p linux-lts
</span></code></pre></td></tr></table></div></figure>


<p>Algo que suele molestar, es que el display manager te caiga en la cara de
pronto. Arch suele manejar bien ese tema, pero por si acaso, nos aseguramos de
habilitar la unit para cada display manager.</p>

<p>En mi caso yo uso slim y corrí:</p>

<figure class='code'><figcaption><span>&#8220;enable&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl <span class="nb">enable </span>slim-plymouth.service
</span></code></pre></td></tr></table></div></figure>


<p>Puede que el tuyo sea:</p>

<ul>
<li>gdm-plymouth.service</li>
<li>kdm-plymouth.service</li>
<li>lxdm-plymouth.service</li>
</ul>


<p>Con eso ya debe estar listo para pinchar pero vamos a darle unos toquesitos
finales.</p>

<p>El fichero <strong>/etc/plymouth/plymouthd.conf</strong> contiene los parámetros de
configuración de plymouth. El mío luce así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/plymouth/plymouthd.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/plymouth/plymouthd.conf
</span><span class='line'><span class="c"># Distribution defaults. Changes to this file will get overwritten during</span>
</span><span class='line'><span class="c"># upgrades.</span>
</span><span class='line'><span class="o">[</span>Daemon<span class="o">]</span>
</span><span class='line'><span class="nv">Theme</span><span class="o">=</span>tribar
</span><span class='line'><span class="nv">ShowDelay</span><span class="o">=</span>2
</span></code></pre></td></tr></table></div></figure>


<p>El parámetro <strong>ShowDelay</strong>, define que tiempo se mostrará la pantalla. Como ya
te dije, arch a mi me butea en segundos. Si pones 5 ahí, la pantalla de buteo se
mostrará cinco segundos. Dos buteando y otros tres pa que tu la mires mostrando
su animación. Yo cuando terminé de verla correr la primera vez; desinstalé
plymouth. No me interesa tener 2 segundos adicionales de media por el mero hecho
de que sea más bonito.</p>

<p>El otro parámetro, <strong>Theme</strong>, setea el tema que usarás. Para ver que temas
tienes en el menú, corre:</p>

<figure class='code'><figcaption><span>&#8220;plymouth-set-default-theme&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>plymouth-set-default-theme -l
</span><span class='line'>details
</span><span class='line'>fade-in
</span><span class='line'>glow
</span><span class='line'>script
</span><span class='line'>solar
</span><span class='line'>spinfinity
</span><span class='line'>spinner
</span><span class='line'>text
</span><span class='line'>tribar
</span></code></pre></td></tr></table></div></figure>


<p>A mi me gustó &ldquo;tribar&rdquo; y el que viene por defecto también está lindo, pero es
una copia al carbón de MacOS.</p>

<h4>OJO!</h4>

<p>Cada vez que cambies un parámetro ahí, debes correr &ldquo;mkinitcpio -p&rdquo;</p>

<p>Ah! Una cosita, si en algún momento quieres ver lo que está haciendo el kernel
por detrás de plymouth, presiona &ldquo;home&rdquo; mientras butea.</p>

<p>Eso es todo. ¡Reinicia!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-07T22:36:56-04:00'><span class='date'>07/09/2015</span> <span class='time'>10:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>En paises con internet lento (adivina a cual me refiero) el mero hecho de clonar
un repositorio de git; puede llegar a ser un verdadero problema.</p>

<figure class='code'><figcaption><span>&#8220;git&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone --depth<span class="o">=</span><span class="m">1</span> http://repositorio.tld/fulanito/aplicacion.git
</span></code></pre></td></tr></table></div></figure>


<p>¿Rápido verdad? Es que solo cogió el HEAD, no el historial de commits completo.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-07T20:32:57-04:00'><span class='date'>07/09/2015</span> <span class='time'>8:32 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tener los dos kernel y elegir cual butear con el grub al principio; no es algo
sencillo en archlinux.</p>

<p>Por defecto, el grub dice tener dichas entradas en un submenú que nunca se ve.
Para lograrlo, tenemos que hacer unos paces mágicos en el fichero:</p>

<h4>/etc/default/grub</h4>

<p>Primero instalamos los kernels; el lts y el fresco.</p>

<figure class='code'><figcaption><span>&#8220;los kernels&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -S linux linux-lts
</span></code></pre></td></tr></table></div></figure>


<p>Ahora la configuración con la que logré eso, fue agregándole al final estas
lineas:</p>

<figure class='code'><figcaption><span>&#8220;/etc/default/grub&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">GRUB_DISABLE_SUBMENU</span><span class="o">=</span>y
</span><span class='line'><span class="nv">GRUB_DEFAULT</span><span class="o">=</span>saved
</span><span class='line'><span class="nv">GRUB_SAVEDEFAULT</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con eso, se salva la última entrada ejecutada. Por que, lo más obvio, es que la
próxima vez que arranques, se cargue el último kernel que usaste. Lo inusual
sería que cambies de opinión y cargues otro. Desgraciadamente, si como yo, usas
btrfs como sistema de archivo, grub no podrá escribir el fichero con la última
entrada seleccionada. Incluso te dará un error, diciendo que no puede escribir
el fichero no se que.</p>

<p>Seguimos&hellip; Localiza y la linea de recovery y ponla en false:</p>

<figure class='code'><figcaption><span>&#8220;/etc/default/grub&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Uncomment to disable generation of recovery mode menu entries</span>
</span><span class='line'><span class="nv">GRUB_DISABLE_RECOVERY</span><span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>NO SE POR QUE</strong>, pero no se generan las dichosas entradas si eso no está en
false. Además, tener el menú de recovery es bastante útil, en estas distros
volátiles, uno nunca sabe cuando le va a hacer falta.</p>

<p>Paso final, generar el grub.cfg</p>

<figure class='code'><figcaption><span>&#8220;grub-mkconfig&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>grub-mkconfig -o /boot/grub/grub.cfg
</span></code></pre></td></tr></table></div></figure>


<p>Va y si quieres, no es obligado, pero para probar, <strong>REINICIA</strong>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/01/squid-transparente/">squid transparente</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-01T14:23:00-04:00'><span class='date'>01/09/2015</span> <span class='time'>2:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>La era de SSL, parece haber dejado a los proxies trasparentes un tanto pasados
de moda. Los tiempos en que dos lineas de iptables resolvían el problema,
simplemente quedaron atrás. Ahora necesitamos las dos lineas de iptables y un
poquito más.</p>

<p>Recientemente la comunidad de NetFilter (iptables) y la de squid, ha unido
esfuerzos para crear solución. El protocolo TPROXY de iptables, entra en juego
con la maquinaria de squid; dando lugar a un nateo especial. Aunque un está en
pañales, el asunto promete. En esta entrada no le daremos cobertura a Tproxy,
pero en la próxima pienso hacerlo.</p>

<p>Esta la dejaremos reservada para &ldquo;ssl_bump&rdquo;</p>

<p>Squid desarrolló un sistema especial para cachear y generar los certificados SSL
que requiere. Esto al principio fue tema de discusión. Siempre que hay una
aplicación externa, las vulnerabilidades se sirven con cuchara grande.
Finalmente squid lo logró y desarrolló una especie de:</p>

<p>&ldquo;ataque MITM corporativizado&rdquo;</p>

<p>Como dirían los aldeanos: &ldquo;mamando se quita el frío&rdquo;, así que empezemos&hellip;</p>

<p>Primero y principioso, es dejar nuestro squid funcionando con una ACL bien
<em>lazy</em>.  Digamos por ejemplo, que la red 192.168.10.0/24 pasará a través del
proxy transparente.</p>

<figure class='code'><figcaption><span>&#8220;squid.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>acl red_transparente src 192.168.10.0/24
</span><span class='line'>http_access allow red_transparente
</span></code></pre></td></tr></table></div></figure>


<p>Necesitaremos generar un certificado SSL en nuestro squid, certificado que; con
suerte, el navegador se lo comerá con papa, creyendo que va pal sitio de verdad.</p>

<p>Una vez que el usuario acepte este certificado. TODOS los sitios que pidan,
vendrán con este certificado.</p>

<figure class='code'><figcaption><span>&#8220;openssl&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/squid/
</span><span class='line'>mkdir ssl_cert
</span><span class='line'><span class="nb">cd </span>ssl_cert
</span><span class='line'>openssl req -new -newkey rsa:1024 -days <span class="m">365</span> -nodes -x509 -keyout squid.pem -out squid.pem
</span></code></pre></td></tr></table></div></figure>


<p>Ahora le decimos a calamardo, que escuche por el 3129 como interceptor. Además,
le pondremos una serie de parametros que harán un funcionar al ssl_bumper. A mi
me quedó así:</p>

<h4>OJO con la segunda lina, es muy larga</h4>

<figure class='code'><figcaption><span>&#8220;squid.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>http_port 0.0.0.0:3128
</span><span class='line'>http_port 0.0.0.0:3129 intercept ssl-bump generate-host-certificates<span class="o">=</span>on <span class="nv">dynamic_cert_mem_cache_size</span><span class="o">=</span>4MB <span class="nv">cert</span><span class="o">=</span>/etc/squid/ssl_cert/squid.pem
</span></code></pre></td></tr></table></div></figure>


<p>Ahora inicializamos el depósito donde colocaremos los certificados que vallamos
cogiendo.</p>

<figure class='code'><figcaption><span>&#8220;ssl_crtd&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/usr/lib/squid/ssl_crtd -c -s /etc/squid/certificados
</span></code></pre></td></tr></table></div></figure>


<p>Y le configuramos la maquinaria diabólica a squid.</p>

<figure class='code'><figcaption><span>&#8220;squid.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">dynamic_cert_mem_cache_size</span><span class="o">=</span>4MB <span class="nv">cert</span><span class="o">=</span>/etc/squid/ssl_cert/squid.pem
</span><span class='line'>ssl_bump none localhost
</span><span class='line'>ssl_bump server-first all
</span><span class='line'>sslcrtd_program /usr/lib/squid/ssl_crtd -s /etc/squid/certificados -M 4MB
</span><span class='line'>sslcrtd_children 5
</span></code></pre></td></tr></table></div></figure>


<p>Entonces NetFilter en juego. Nuevamente salen a la palestras las dos lineas
clásicas.</p>

<figure class='code'><figcaption><span>&#8220;iptables&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iptables -t nat -A PREROUTING -i wlan0 -p tcp -m tcp --dport <span class="m">80</span> -j REDIRECT --to-ports 3129
</span><span class='line'>iptables -t nat -A PREROUTING -i wlan0 -p tcp -m tcp --dport <span class="m">443</span> -j REDIRECT --to-ports 3129
</span></code></pre></td></tr></table></div></figure>


<p>Claro, esto no lo es todo, vas a necesitar un DNS que apunte TODAS las
direcciones URL a tu proxy.</p>

<p>Eso lo veremos en la próxima entrada ;)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-28T12:21:58-04:00'><span class='date'>28/08/2015</span> <span class='time'>12:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Vamos de atrás pa alante, el truco primero y la muela después.</p>

<figure class='code'><figcaption><span>&#8220;nmap&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># nmap -O -v 10.1.1.1|grep -i uptime</span>
</span><span class='line'>Uptime guess: 18.006 days <span class="o">(</span>since Fri Aug <span class="m">10</span> 12:24:47 2015<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>¿Que acaba de suceder?</h4>

<p>Calculamos el tiempo que lleva el servidor remoto en pie. Fíjese que nos dice la
fecha en la que el servidor arrancó.</p>

<h4>¿Para que sirve esta información?</h4>

<p>Para poner al responsable de la computadora remota <em>contra las cuerdas</em> en una
situación crítica donde el momento de encendido o apagado de la máquina podría
ser crucial.</p>

<h4>Ejemplos:</h4>

<p>Nuestro proveedor, el servidor proxy padre, afirma descaradamente que NO ha
tenido problemas técnicos, pero nosotros sabemos que sí. En una discución
crucial podría dejarle caer la pregunta. <em>¿Entonces porque su servidor se
reinició el día tal?</em></p>

<p>Un servicio determinado falla a una hora determinada de la noche. Con esto
podríamos saber si el servidor se está reiniciando, cuando y con que frecuencia.</p>

<p>El proveedor dice que ha tenido que reiniciar el servidor cuando en realidad
nunca lo ha hecho.</p>

<p>El usuario dice que la máquina se le reinicia constantemente.</p>

<p>El usuario o el proveedor afirman que la máquina fue encendida a una hora
determinada. O por el contrario, se afirma que la máquina a esa hora NO estaba
encendida y el uptime dice lo contrario.</p>

<p>   <blockquote><p>Saque usted, sus propias concluciones&hellip;</p><footer><strong>Taladrid</strong> <cite>Pasaje a Lo Desconocido</cite></footer></blockquote></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/19/will-paginate/">will_paginate</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-19T14:58:30-04:00'><span class='date'>19/07/2015</span> <span class='time'>2:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>De siempre, en materia de web la paginación ha sido tremendo rollo. A mi en lo
personal no me gustan los paginadores; pienso que nadie los usa. Pero siempre
hay un cliente que pide con mucho fervor detallitos que consideran importantes.</p>

<p>Una de las cosas que me gusta de MongoMapper es que viene con un paginador
integrado, pero este no es el caso.</p>

<p>No entiendo porque carajo ActiveRecords, que se jacta (con razón) de ser la ORM
definitiva; no tiene un puñetero soporte nativo para la paginación. O porque
esta subestimada gema, llamada
<a href="https://github.com/mislav/will_paginate/">will_paginate</a> no viene incluida en
el Gemfile que trae RoR por defecto. Se harían un buen favor.</p>

<p>La cuestión es que will_paginate hace muy simple la tediosa tarea de paginar.</p>

<figure class='code'><figcaption><span>&#8216;instalando will_paginate&#8217;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s1">&#39;gem &quot;will_paginate&quot;&#39;</span> &gt;&gt; Gemfile
</span><span class='line'>bundle update
</span></code></pre></td></tr></table></div></figure>


<p>Ahora veamos como se pagina un modelo. Tengamos el ejemplo típico, el
controlador &ldquo;User&rdquo; con los 1500 usuarios.</p>

<figure class='code'><figcaption><span>&#8220;controlador del scaffold users&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="vi">@users</span><span class="o">=</span><span class="no">User</span>
</span><span class='line'>  <span class="o">.</span><span class="n">all</span>
</span><span class='line'>  <span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">:page</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">,</span> <span class="ss">:per_page</span> <span class="o">=&gt;</span> <span class="mi">15</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;updated_at asc&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>OJO! De la 3ra linea, te puedes tomar el atrevimiento de modificar el 15 y poner
el número que te de la gana; pero NO toques al símbolo :page y su valor. En este
caso, el 15 representa la cantidad de elementos que mostraremos por página.</p>

<p>Te digo que no toques el params[:page] porque will_paginate lo hace todo solo.
En la vista solo tienes que poner esto</p>

<figure class='code'><figcaption><span>&#8220;app/views/users/index.html.erb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">   &lt;div class=&quot;text-center&quot;&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">will_paginate</span> <span class="vi">@users</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">   &lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente queda algo de lo más discreto pero 100% funcional:</p>

<div class="text-center">
<div class="pagination">
<span class="previous_page disabled">&#8592; Anterior</span>
<em class="current">1</em>
<a rel="next" href="#">2</a> <a href="#">3</a>
<a href="#">4</a>
<a href="#">5</a>
<a href="#">6</a> <a href="#">7</a>
<a href="#">8</a> <a href="#">9</a>
<span class="gap">&hellip;</span>
<a href="#">28</a>
<a href="#">29</a>
<a class="next_page" rel="next" href="#">Próximo &#8594;</a>
</div></div>


<p>¡COOOOÑOóOOO! En español y todo. Por supuesto,  no es magia. Lo que pasa que el
que hizo la gema, la hizo con tremendo cariño y parece conocer muy bien la API
de ruby on rails; con lo cual tuvo muy en cuenta, la parte del i18n.</p>

<p>Ejecute lo siguiente:</p>

<figure class='code'><figcaption><span>&#8220;contenido de la gema&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem cont will_paginate<span class="p">|</span>grep en.yml
</span></code></pre></td></tr></table></div></figure>


<p>Guíate por ese fichero y añádele a tu locale la traducción relacionada con
will_paginate, en mi caso, quedo así:</p>

<figure class='code'><figcaption><span>&#8220;en.yml&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">en</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># el locales de will_paginate</span>
</span><span class='line'>  <span class="l-Scalar-Plain">will_paginate</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">previous_label</span><span class="p-Indicator">:</span> <span class="s">&quot;&amp;#8592;</span><span class="nv"> </span><span class="s">Anterior&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">next_label</span><span class="p-Indicator">:</span> <span class="s">&quot;Próximo</span><span class="nv"> </span><span class="s">&amp;#8594;&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">page_gap</span><span class="p-Indicator">:</span> <span class="s">&quot;&amp;hellip;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>¡¡A paginar se ha dicho!!</p>

<p>Thanks to <strong>Mislav Marohnić</strong> for you good job; developing will_paginate</p>

<p>Si te ha gustado will_paginate, escríbele un <a href="mailto:mislav.marohnic@gmail.com">correo al autor</a>
y muéstrale tu agradecimiento. Yo ya lo hize ;)</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/01/squid-transparente/">squid transparente</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/19/will-paginate/">will_paginate</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/12/date-select-en-espanol/">date_select en español</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/11/openvas-en-archlinux/">OpenVAS en Archlinux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/05/anadir-verbo-a-un-scaffold/">añadir verbo a un scaffold</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/05/asset-pipeline-en-production/">asset pipeline en production</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/12/systemd-automount/">systemd automount</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/21/sasl-homeclub-only/">SASL homeclub only</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/19/delay-pools-de-squid/">delay pools de squid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/12/rails-con-mongodb/">rails con mongodb</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/06/zentyal/">Zentyal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/01/bundle/">bundle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/02/welcome-aboard/">welcome aboard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/28/proxy-automatico/">proxy automático</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/24/verdial-y-el-imagis/">la pena de verdial</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/05/palos-de-wordpress/">palos de wordpress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/25/el-server-de-correo/">el servidor de correo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/25/mas-de-ocs/">más de OCS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/15/subdesarrollo/">subdesarrollo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/11/ocs-inventory/">ocs-inventory</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/08/select-en-bootstrap/">select en bootstrap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/05/empirico/">empíricos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/27/crear-un-chroot-con-debian/">crear un chroot con debian</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/10/autenticador-sql-en-el-proxy/">autenticador SQL en el proxy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/09/postfix-entrando-en-el-baile/">postfix entrando en el baile</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/09/dovecot-entra-en-el-baile/">dovecot entra en el baile</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/02/wordpress-para-todos/">wordpress para todos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/06/squid-en-infomed/">el toten de proxies</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/04/en-la-cumbre-del-vedado/">el &#8220;calisto&#8221; garcía</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - låzaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
