
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>El SysAdmin del 3er Mundo</title>
  <meta name="author" content="låzaro">

  
  <meta name="description" content="bootstrap en rails 4 30/06/2015 12:19 pm | Comments Pensaba escribir una entrada sobre como hacer que se vean los glyphicons luego
de instalar la &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uranio-235.github.io/posts/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El SysAdmin del 3er Mundo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">El SysAdmin del 3er Mundo</a></h1>
  
    <h2>luchando contra el subdesarrollo en todos los frentes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uranio-235.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archivo</a></li>
  <li><a href="/blog/categories/rails/">Ruby on Rails</a></li>
  <li><a href="/blog/categories/destacado/">Destacado</a></li>
  <li><a href="/blog/categories/razonemos/">Razonemos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-30T12:19:42-04:00'><span class='date'>30/06/2015</span> <span class='time'>12:19 pm</span></time>
        
           | <a href="/blog/2015/06/30/bootstrap-en-rails-4/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/30/bootstrap-en-rails-4/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Pensaba escribir una entrada sobre como hacer que se vean los glyphicons luego
de instalar la gema de boostrap en rails 4; pero, recientemente he recibido
numerosas críticas, sobre entradas de mi blog. Dicen que hablo sobre como
solucionar problemas de cosas que ni si quiera conocen pero al parecer están muy
buenas.</p>

<p><a href="http://getbootstrap.com">Bootstrap</a> es un framework CSS patrocinado por Twitter
y es el fin de los dolores de cabeza para todo el que como yo, le tiene terror a
programar CSS. Por supuesto, como todo en materia de framework, tiene sus pro y
sus contras.</p>

<p>La ventaja de usar un framework, es que te ahorras un mundo de código. La
ventaja además; de usar un framework CSS, es que estás de manera automática
arriba de los último en materia de CSS.</p>

<p>La desventaja de usar un Framework (cea CSS o no) es que en la mayoría de los
casos, carga mil y un elemento que nunca usarás. Por ejemplo, tengo una
aplicación que NO usa carrousel; pero como está hecha a la carrera, no he tenido
tiempo de determinar que elementos o no cargar con bootstrap. Por definición, se
cargan todos.</p>

<p>En nuestro Gemfile, debemos declarar que use bootstrap así:</p>

<figure class='code'><figcaption><span>&#8220;scope del Gemfile&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;twitter-bootstrap-rails&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Luego, procedemos a la instalación del tema CSS, en mi caso, como no uso less ni
nada de eso, lo hago así:</p>

<figure class='code'><figcaption><span>&#8220;instalando el engine&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails generate bootstrap:install static
</span></code></pre></td></tr></table></div></figure>


<p>Con eso, supuestamente ya está listo. Pero como todo en ruby on rails se queda
atrás, resulta que el asset pipeline moderno no carga las fuentes y en el
fichero <strong>application.css</strong> hay que añadirle el siguiente código:</p>

<figure class='code'><figcaption><span>&#8220;app/assets/stylesheets/application.css&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* Esto va al final de la CSS */</span>
</span><span class='line'>
</span><span class='line'><span class="k">@font-face</span> <span class="p">{</span>
</span><span class='line'>  <span class="nt">font-family</span><span class="o">:</span> <span class="s1">&#39;Glyphicons Halflings&#39;</span><span class="o">;</span>
</span><span class='line'>  <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="s1">&#39;../assets/glyphicons-halflings-regular.eot&#39;</span><span class="o">);</span>
</span><span class='line'>  <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="s1">&#39;../assets/glyphicons-halflings-regular.eot?#iefix&#39;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;embedded-opentype&#39;</span><span class="o">),</span>
</span><span class='line'>       <span class="nt">url</span><span class="o">(</span><span class="s1">&#39;../assets/glyphicons-halflings-regular.woff&#39;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;woff&#39;</span><span class="o">),</span>
</span><span class='line'>       <span class="nt">url</span><span class="o">(</span><span class="s1">&#39;../assets/glyphicons-halflings-regular.ttf&#39;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;truetype&#39;</span><span class="o">),</span>
</span><span class='line'>       <span class="nt">url</span><span class="o">(</span><span class="s1">&#39;../assets/glyphicons-halflings-regular.svg#glyphicons_halflingsregular&#39;</span><span class="o">)</span> <span class="nt">format</span><span class="o">(</span><span class="s1">&#39;svg&#39;</span><span class="o">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>¿Qué como conseguí eso? Ni preguntes, me lo mandó por correo un salvaje de la
materia.</p>

<p>Otra cosa:</p>

<p>Si no sabes usar boostrap, te recomiendo que le eches un vistazo. Si sabes
escribir CSS, te recomiendo que lo veas igual, pues tiene una buena API para
personalizarlo como te de la gana.</p>

<h3>pero está la gema bootstrap-sass</h3>

<p>Sí, ya se que está <a href="http://badge.fury.io/rb/bootstrap-sass">bootstrap-sass</a>,
que es además <em>es el port oficial de bootstrap</em> y que rails usa
<a href="http://sass-lang.com">SASS</a>; pero te imaginarás el criterio que tengo sobre
sass.</p>

<p>Por mi, coffe-script y sass pueden cogerlos, doblarlos bien y meterselos ambos
en el&hellip;. BOLSILLO. El programador web que no quiera aprender JavaScript y CSS
está embarcao. Por otra parte, para aprender SASS y CoffeScript hay que saber
CSS y JavaScript :D ¿Que problema verdad?</p>

<h3>Helpers de utildad</h3>

<p>La diferencia entre bootstrap-sass y twitter-bootstrap-rails  es que
boostrap-sass la hizo la gente de bootstrap y la segunda, la hicieron usuarios
de ruby on rails&hellip;</p>

<p>Te explico:</p>

<figure class='code'><figcaption><span>&#8220;fulanito.erb.html&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">nav_bar</span> <span class="ss">brand</span><span class="p">:</span> <span class="s2">&quot;Páfata&quot;</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">menu_text</span> <span class="s2">&quot;El texto de la barra&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Eso generará un navbar como este:</p>

<figure class='code'><figcaption><span>&#8220;render output&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-default&quot;</span> <span class="na">role=</span><span class="s">&quot;navigation&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href=</span><span class="s">&quot;http://127.0.0.1:3000/&quot;</span><span class="nt">&gt;</span>Páfata<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;navbar-text&quot;</span><span class="nt">&gt;</span>El texto de la barra<span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;&lt;/nav&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si eso no te pareció emocionante, mira el helper de flash. Ponte tu que halla un
error y lo metes en el flash.</p>

<figure class='code'><figcaption><span>&#8220;ejemplo_controller.rb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">fulanito</span>
</span><span class='line'>   <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]=</span><span class="s1">&#39;Bofatás! El error del milenio&#39;</span>
</span><span class='line'>   <span class="n">render</span> <span class="ss">:fulanito</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>En la vista, pones está simple linea:</p>

<figure class='code'><figcaption><span>&#8220;fulanito.erb.html&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">bootstrap_flash</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Y se renderiza:</p>

<figure class='code'><figcaption><span>&#8220;render output&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alert fade in alert-danger &quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;close&quot;</span><span class="na">data-dismiss=</span><span class="s">&quot;alert&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/button&gt;</span>
</span><span class='line'>Bofatás! El error del milenio
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Échale un vistazo al link de abajo, pa que veas como renderizan breadcumb
declarando los componentes en los controladores.</p>

<p>Mas detalles aquí: <a href="https://github.com/seyhunak/twitter-bootstrap-rails">https://github.com/seyhunak/twitter-bootstrap-rails</a></p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.09 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-14T18:36:49-04:00'><span class='date'>14/06/2015</span> <span class='time'>6:36 pm</span></time>
        
           | <a href="/blog/2015/06/14/revocar-certificados-de-ovpn/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/14/revocar-certificados-de-ovpn/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Acá en mi tierra, SSL es algo relativamente novedoso. Hasta el otro día, las
conexiones cifradas eran la peste; pero ahora resulta que el SSL es
prácticamente obligatorio.</p>

<p>En el episodio anterior, hablábamos sobre OpenVPN. Mencionamos que la
autenticación podría hacerse a nivel de certificados.</p>

<p>Algunos retrógrados preferirían hacerlo con nombre de usuario y contraseña, pero
realmente emitir un certificado para cada cliente, es un método más seguro y
simple.</p>

<p>El objetivo es deshacernos de un cliente</p>

<p>En el ejemplo anterior teníamos a &ldquo;cliente1&rdquo;. Por N motivo, no queremos que
cliente1 se conecte más. El que no sepa lo que es la CRL (Certificate Revocation
List) me imagino que acabará poniendo disímiles direcciones ip en el cortafuegos.</p>

<p>Primero, revocamos el certificado que le dimos al cliente.</p>

<figure class='code'><figcaption><span>&#8220;revocando certificado&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/openvpn/easy-rsa
</span><span class='line'><span class="nb">source</span> ./vars
</span><span class='line'>./revoke-full cliente1
</span><span class='line'>Using configuration from /etc/openvpn/easy-rsa/openssl-1.0.0.cnf
</span><span class='line'>Revoking Certificate 02.
</span><span class='line'>Data Base Updated
</span><span class='line'>Using configuration from /etc/openvpn/easy-rsa/openssl-1.0.0.cnf
</span><span class='line'>cliente1.crt: <span class="nv">C</span> <span class="o">=</span> CU, <span class="nv">ST</span> <span class="o">=</span> HAV, <span class="nv">L</span> <span class="o">=</span> Plaza, <span class="nv">O</span> <span class="o">=</span> DOMINIO, <span class="nv">OU</span> <span class="o">=</span> DOMINIO, <span class="nv">CN</span> <span class="o">=</span>
</span><span class='line'>cliente1, <span class="nv">name</span> <span class="o">=</span> RSA, <span class="nv">emailAddress</span> <span class="o">=</span> vpn@dominio.cu
</span><span class='line'>error <span class="m">23</span> at <span class="m">0</span> depth lookup:certificate revoked
</span></code></pre></td></tr></table></div></figure>


<p>Como ve en la última linea, dice que se ha cometido un error 23, porque no se
pudo ver la firma. EL certificado ha sido revocado.</p>

<p>Ahora debemos instruir al servidor de que el fichero <strong>keys/crl.pem</strong> contiene
la lista de certificados revocados. A la configuración del servidor, le
agregamos la cláusula <strong>crl-verify</strong> y como argumento le damos la ruta absoluta
al crl.pem</p>

<figure class='code'><figcaption><span>&#8220;crl.pem&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s1">&#39;crl-verify crl.pem&#39;</span> &gt;&gt; /etc/openvpn/servidor.conf
</span><span class='line'>ln -s /etc/openvpn/easy-rsa/keys/crl.pem
</span></code></pre></td></tr></table></div></figure>


<p>No se puede especificar una ruta completa porque no pincha, no me preguntes por
que. El crl.pem debe estar en el mismo directorio que el fichero de
configuración del servidor.</p>

<p><strong>OJO</strong> No olvide reinciar el servidor!</p>

<p>Probemos como le va a un cliente con su certificado revocado.</p>

<figure class='code'><figcaption><span>&#8220;cliente1 embarcao&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@rasp openvpn<span class="o">]</span><span class="c"># openvpn --config cliente1.conf </span>
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> OpenVPN 2.3.6 i686-pc-linux-gnu <span class="o">[</span>SSL <span class="o">(</span>OpenSSL<span class="o">)]</span> <span class="o">[</span>LZO<span class="o">]</span> <span class="o">[</span>EPOLL<span class="o">]</span> <span class="o">[</span>MH<span class="o">]</span> <span class="o">[</span>IPv6<span class="o">]</span> built on Dec  <span class="m">2</span> 2014
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> library versions: OpenSSL 1.0.2a <span class="m">19</span> Mar 2015, LZO 2.09
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> WARNING: No server certificate verification method has been enabled.  See http://openvpn.net/howto.html#mitm <span class="k">for</span> more info.
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> Attempting to establish TCP connection with <span class="o">[</span>AF_INET<span class="o">]</span>192.168.24.1:443 <span class="o">[</span>nonblock<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> TCP connection established with <span class="o">[</span>AF_INET<span class="o">]</span>192.168.24.1:443
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> TCPv4_CLIENT link <span class="nb">local</span>: <span class="o">[</span>undef<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:49 <span class="m">2015</span> TCPv4_CLIENT link remote: <span class="o">[</span>AF_INET<span class="o">]</span>192.168.24.1:443
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:50 <span class="m">2015</span> VERIFY OK: <span class="nv">depth</span><span class="o">=</span>1, <span class="nv">C</span><span class="o">=</span>CU, <span class="nv">ST</span><span class="o">=</span>HAV, <span class="nv">L</span><span class="o">=</span>Plaza, <span class="nv">O</span><span class="o">=</span>DOMINIO, <span class="nv">OU</span><span class="o">=</span>DOMINIO, <span class="nv">CN</span><span class="o">=</span>DOMINIO CA, <span class="nv">name</span><span class="o">=</span>RSA, <span class="nv">emailAddress</span><span class="o">=</span>vpn@dominio.cu
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:50 <span class="m">2015</span> VERIFY OK: <span class="nv">depth</span><span class="o">=</span>0, <span class="nv">C</span><span class="o">=</span>CU, <span class="nv">ST</span><span class="o">=</span>HAV, <span class="nv">L</span><span class="o">=</span>Plaza, <span class="nv">O</span><span class="o">=</span>DOMINIO, <span class="nv">OU</span><span class="o">=</span>dominio, <span class="nv">CN</span><span class="o">=</span>vpn.dominio.cu, <span class="nv">name</span><span class="o">=</span>RSA, <span class="nv">emailAddress</span><span class="o">=</span>vpn@dominio.cu
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:50 <span class="m">2015</span> write TCPv4_CLIENT: Broken pipe <span class="o">(</span><span class="nv">code</span><span class="o">=</span>32<span class="o">)</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:50 <span class="m">2015</span> write TCPv4_CLIENT: Broken pipe <span class="o">(</span><span class="nv">code</span><span class="o">=</span>32<span class="o">)</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:50 <span class="m">2015</span> Connection reset, restarting <span class="o">[</span>0<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 19:02:50 <span class="m">2015</span> SIGUSR1<span class="o">[</span>soft,connection-reset<span class="o">]</span> received, process restarting
</span></code></pre></td></tr></table></div></figure>


<p>Como ve, el servidor &ldquo;le cuelga&rdquo; y le deja hablando. Porque el certificado que
el cliente está mandándole, no le cuadra.</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.08 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/12/systemd-automount/">systemd automount</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-12T12:18:10-04:00'><span class='date'>12/06/2015</span> <span class='time'>12:18 pm</span></time>
        
           | <a href="/blog/2015/06/12/systemd-automount/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/12/systemd-automount/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Resulta que el todopoderoso <a href="https://wiki.archlinux.org/index.php/Systemd">systemd</a>
tiene un soporte para automontar discos.</p>

<p>Aún sigo pensando que nadie inventa un software para auto<strong>des</strong>montar discos.
No le veo sentido a que algo se monte automáticamente si luego hay que
desmontarlo de manera manual. Ese <strong>autofs</strong> que te motaba las memorias al
pararte sobre el punto de montaje y luego te las desmontaba al rato de estar sin
usa, que tiempo aquellos. Puedo bueno, systemd-automount trata de hacer algo
similar y casi lo logra.</p>

<p>Pero como te decía, el automount&hellip;</p>

<p>Si en el fstab usas la opción <strong>x-systemd.automount</strong>, las unidades reflejadas
en el fstab se montarán de manera automática cuando se haga contacto con el
punto de montaje y el dispositivo esté presente.</p>

<figure class='code'><figcaption><span>&#8220;fstab&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/dev/sdb1   /mnt/sdb1  auto  rw,users,x-systemd.automount,noauto  <span class="m">0</span>  0
</span></code></pre></td></tr></table></div></figure>


<p>Al posarte en un directorio que sea punto de montaje, este se montará de manera
automática. Si quieres que quede escopetón de verdad, usa estas opciones:</p>

<figure class='code'><figcaption><span>&#8220;opciones&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>nofail,x-systemd.automount,x-systemd.device-timeout<span class="o">=</span>2s,sync,rw,user,noauto
</span></code></pre></td></tr></table></div></figure>


<p>Así, no se monta desde el arranque (y no cuelga el arranque) y si el dispositivo
tarde 2 segundos en cargarse se rinde; esto es muy bueno para las memorias que
dan palo o para unidades de red que podrían estar no disponibles en el momento
que se le solicitan.</p>

<p>Lo único bueno que tiene esto sobre udisk, es que puedes especificar los
parámetros y opciones con las que montarás el disco, no como en udisk que se
monta con las opciones que le de la gana a el; te guste o no.</p>

<p>Además, no te imagino instalando udisk es un servidor :D</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.09 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-07T18:18:17-04:00'><span class='date'>07/06/2015</span> <span class='time'>6:18 pm</span></time>
        
           | <a href="/blog/2015/06/07/openvpn-en-arch/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/07/openvpn-en-arch/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>En Arch, todo es tan novedoso como complicado. Montar un servidor de VPN, pasa a
ser una verdadera complicación. Pero todo empieza por el primer paso y termina
cuando menos te lo esperas o más embullado estás.</p>

<figure class='code'><figcaption><span>&#8220;el viejo pacman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -S openvpn easy-rsa
</span></code></pre></td></tr></table></div></figure>


<h4>Aspectos legales</h4>

<p>Antes de comenzar. Déjeme recordarle que transmitir cifrados en algunos países
es algo complicado desde el punto de vista legal.</p>

<p>En cuba, te aclaro, que necesitas anexar un permiso de la FAR a tu Licencia de
Red. En casi ningún país las redes VPN son &ldquo;al flai&rdquo;, ya que las mismas, siempre
tienen un punto en alguna entidad, lo cual compromete mucho a esa red; así que
mi recomendación: Póngase al tanto de las leyes antes de hacer una VPN.</p>

<p>Para esta prueba, usaré una red compuesta por un solo cable. En un extremo está
mi laptop y en el otro, el RaspBerry Pi; secuaz de todos mis más beligerantes
experimentos.</p>

<h3>Empezando</h3>

<p>Lo primero es crear el llamado &ldquo;Master Certificate Authority&rdquo; (por sus siglas &ldquo;CA&rdquo;)</p>

<p>La herramienta easy-rsa ha evolucionado tanto, que ya ni su madre la reconoce.
Razón por la cual toda la documentación parece estar escrita con una herramienta
totalmente diferente.</p>

<p>Los escript se encuentran en /usr/share así que los traeremos a nuestro
zoológico.</p>

<figure class='code'><figcaption><span>&#8220;easy-rsa&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/openvpn/
</span><span class='line'>cp -ru /usr/share/easy-rsa/ ./
</span><span class='line'><span class="nb">cd </span>easy-rsa
</span></code></pre></td></tr></table></div></figure>


<p>Lo último que copiamos, el ficherito <strong>vars</strong>; es la materia prima de esta obra.
Ahí pondremos los parámetros de nuestro certificado. Abre el fichero <strong>vars</strong> y
edítale los parámetros obvios, están al fondo y comienzan por <strong>KEY_</strong></p>

<p>Cuando hallas terminado, ejecuta esto:</p>

<figure class='code'><figcaption><span>&#8221;./vars&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source</span> ./vars
</span><span class='line'>./clean-all
</span><span class='line'>./build-ca
</span></code></pre></td></tr></table></div></figure>


<p>Verás como se genera el certificado y aunque te pregunta por los parámetros, los
tiene ya por defecto. Solo es cuestión de presionar Enter y listo.</p>

<p>Ahora usando el CA, generamos el certificado del servidor.</p>

<figure class='code'><figcaption><span>&#8220;el certificado del servidor&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./build-key-server vpn.dominio.cu
</span></code></pre></td></tr></table></div></figure>


<p>Te preguntará lo mismo y un password; ponle cualquier <em>mierda entrópica</em> y sigue
pa alante.</p>

<h3>OJO!! No toques enter a lo loco. Firma todos los certificados</h3>

<p>A este punto el directorio <strong>keys/</strong> contiene más de lo que te imaginas. Pero el
servidor necesita los parámetros de un tal <a href="http://www.rsasecurity.com/rsalabs/node.asp?id=2248">Diffie Hellman</a>
para pinchar. Ponte cómodo y ejecuta:</p>

<figure class='code'><figcaption><span>&#8220;Deffie Hellman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./build-dh
</span><span class='line'>Generating DH parameters, <span class="m">2048</span> bit long safe prime, generator 2
</span><span class='line'>This is going to take a long <span class="nb">time</span>
</span></code></pre></td></tr></table></div></figure>


<p>Una vez que la pantalla se halla llenado de punticos, te quedará editar el
fichero de configuración a tu antojo. El mío me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/openvpn/servidor.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># la ip en la que esucha el servidor</span>
</span><span class='line'><span class="nb">local </span>0.0.0.0
</span><span class='line'>
</span><span class='line'><span class="c"># puerto https</span>
</span><span class='line'>port 443
</span><span class='line'>
</span><span class='line'><span class="c"># protocolo</span>
</span><span class='line'>proto tcp
</span><span class='line'><span class="c">#proto udp</span>
</span><span class='line'>
</span><span class='line'><span class="c"># el tipo de interfaz de tunel</span>
</span><span class='line'><span class="p">;</span>dev tap
</span><span class='line'>dev tun
</span><span class='line'>
</span><span class='line'><span class="c"># los certificados del servidor</span>
</span><span class='line'>ca /etc/openvpn/easy-rsa/keys/ca.crt
</span><span class='line'>cert /etc/openvpn/easy-rsa/keys/vpn.dominio.cu.crt
</span><span class='line'>
</span><span class='line'><span class="c"># ATENCIÓN!!</span>
</span><span class='line'><span class="c"># mantén este fichero en secreto absoluto</span>
</span><span class='line'>key /etc/openvpn/easy-rsa/keys/vpn.dominio.cu.key
</span><span class='line'>
</span><span class='line'><span class="c"># Diffie Hellman</span>
</span><span class='line'>dh /etc/openvpn/easy-rsa/keys/dh2048.pem
</span><span class='line'>
</span><span class='line'><span class="c"># nuestra red es una subnet</span>
</span><span class='line'>topology subnet
</span><span class='line'>
</span><span class='line'><span class="c"># configuramos la red que tendrá nuestra VPN</span>
</span><span class='line'><span class="c"># dándole este rango, el servidor coge la 1,</span>
</span><span class='line'><span class="c"># usamos un rango raro, pa que no choque</span>
</span><span class='line'>server 10.8.0.0 255.255.255.0
</span><span class='line'>
</span><span class='line'><span class="c"># mantiene la misma ip para cada cliente</span>
</span><span class='line'><span class="c"># aún después de reiniciado el servidor</span>
</span><span class='line'>ifconfig-pool-persist ipp.txt
</span><span class='line'>
</span><span class='line'><span class="c"># con esta opción, los clientes se ven entre ellos</span>
</span><span class='line'><span class="c"># sin esta opción, cada cliente es individual hacia el server</span>
</span><span class='line'>client-to-client
</span><span class='line'>
</span><span class='line'><span class="c"># si esto está habilitado, varios cliente se conectarán</span>
</span><span class='line'><span class="c"># usando un mismo certificado. Muy bueno si tienes un</span>
</span><span class='line'><span class="c"># certificado para cada grupo de clientes, o el mismo</span>
</span><span class='line'><span class="c"># certificado para todos los clientes.</span>
</span><span class='line'>duplicate-cn
</span><span class='line'>
</span><span class='line'><span class="c"># Preguntale &quot;¿estás ahí?&quot; cada 10 segundos</span>
</span><span class='line'>keepalive <span class="m">10</span> 120
</span><span class='line'>
</span><span class='line'><span class="c"># habilita la compresión de datos</span>
</span><span class='line'>comp-lzo
</span><span class='line'>
</span><span class='line'><span class="c"># el máximo número de clientes permitidos</span>
</span><span class='line'>max-clients 1
</span><span class='line'>
</span><span class='line'><span class="c"># corre como nobody, menos privilegios</span>
</span><span class='line'>user nobody
</span><span class='line'>group nobody
</span><span class='line'>persist-key
</span><span class='line'>persist-tun
</span><span class='line'>
</span><span class='line'><span class="c"># este fichero NO se llena</span>
</span><span class='line'><span class="c"># ya que se reescribe constantemente</span>
</span><span class='line'><span class="c"># mostrando el estado de la VPN</span>
</span><span class='line'>status openvpn-status.log
</span><span class='line'>
</span><span class='line'><span class="c"># esto si se pone gordo, así que no logueamos</span>
</span><span class='line'><span class="p">;</span>log         openvpn.log
</span><span class='line'><span class="p">;</span>log-append  openvpn.log
</span><span class='line'>
</span><span class='line'><span class="c"># Que loguear?</span>
</span><span class='line'><span class="c"># 0 solo errores fatales</span>
</span><span class='line'><span class="c"># 4 cuentame que hay</span>
</span><span class='line'><span class="c"># 5 y 6 muy últil para depurar problemas de conexión</span>
</span><span class='line'><span class="c"># 9 solo los desarrolladores usarían esta escandalera</span>
</span><span class='line'>verb 3
</span><span class='line'>
</span><span class='line'><span class="c"># no muestres repetidos</span>
</span><span class='line'><span class="c">#mute 20</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>OJO!</strong> Mira a ver donde metes el fichero <strong>servidor.conf</strong>, no sea que los
crees dentro del directorio easy-rsa y luego no lo encuentres.</p>

<p>Corre <strong>openvpn &ndash;config servidor.conf</strong> COMO ROOT, vamos a probarlo a ver como
suena:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema openvpn<span class="o">]</span><span class="c"># openvpn --config servidor.conf</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> OpenVPN 2.3.6 i686-pc-linux-gnu <span class="o">[</span>SSL <span class="o">(</span>OpenSSL<span class="o">)]</span> <span class="o">[</span>LZO<span class="o">]</span> <span class="o">[</span>EPOLL<span class="o">]</span> <span class="o">[</span>MH<span class="o">]</span> <span class="o">[</span>IPv6<span class="o">]</span> built on Dec  <span class="m">2</span> 2014
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> library versions: OpenSSL 1.0.2a <span class="m">19</span> Mar 2015, LZO 2.09
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> WARNING: --ifconfig-pool-persist will not work with --duplicate-cn
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> Diffie-Hellman initialized with <span class="m">2048</span> bit key
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> Socket Buffers: <span class="nv">R</span><span class="o">=[</span>87380-&gt;131072<span class="o">]</span> <span class="nv">S</span><span class="o">=[</span>16384-&gt;131072<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> TUN/TAP device tun0 opened
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> TUN/TAP TX queue length <span class="nb">set </span>to 100
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> do_ifconfig, tt-&gt;ipv6<span class="o">=</span>0, tt-&gt;did_ifconfig_ipv6_setup<span class="o">=</span>0
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:12 <span class="m">2015</span> /usr/bin/ip link <span class="nb">set </span>dev tun0 up mtu 1500
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> /usr/bin/ip addr add dev tun0 10.8.0.1/24 broadcast 10.8.0.255
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> GID <span class="nb">set </span>to nobody
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> UID <span class="nb">set </span>to nobody
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> Listening <span class="k">for</span> incoming TCP connection on <span class="o">[</span>undef<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> TCPv4_SERVER link <span class="nb">local</span> <span class="o">(</span>bound<span class="o">)</span>: <span class="o">[</span>undef<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> TCPv4_SERVER link remote: <span class="o">[</span>undef<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> MULTI: multi_init called, <span class="nv">r</span><span class="o">=</span><span class="m">256</span> <span class="nv">v</span><span class="o">=</span>256
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> IFCONFIG POOL: <span class="nv">base</span><span class="o">=</span>10.8.0.2 <span class="nv">size</span><span class="o">=</span>252, <span class="nv">ipv6</span><span class="o">=</span>0
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> IFCONFIG POOL LIST
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> MULTI: TCP INIT <span class="nv">maxclients</span><span class="o">=</span><span class="m">1</span> <span class="nv">maxevents</span><span class="o">=</span>5
</span><span class='line'>Sun Jun <span class="m">14</span> 14:00:13 <span class="m">2015</span> Initialization Sequence Completed
</span></code></pre></td></tr></table></div></figure>


<p><strong>BELLO!</strong></p>

<p>Note como en este ejemplo, se usó la opción duplicate-cn y este dice que no
podrá mentener una ip por cliente, porque lógicamente, un mismo certificado será
usado por dicímiles cliente (en este ejemplo). En producción, le recomiendo que
emita un certificado para cada cliente.</p>

<p>A partir de este momento, habrá una Unit con el nombre del fichero &ldquo;.conf&rdquo;
detrás de la arroba:</p>

<p><strong>openvpn@CONFIGURACION.service</strong></p>

<p>Osea, como el fichero se llama <strong>servidor.conf</strong> la unit se llama
<strong>openvpn@servidor.service</strong></p>

<p>¿Se etendió?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl start openvpn@servidor.service
</span><span class='line'>systemctl <span class="nb">enable </span>openvpn@servidor.service
</span></code></pre></td></tr></table></div></figure>


<h3>Ahora los clientes</h3>

<p>Como ya vimos, los clientes pueden tener un certificado para cada uno o bien un
por cada cliente. En este caso, generaremos un certificado para un cliente.</p>

<p>El cliente necesitará un fichero de configuración y sus pertinentes
certificados.</p>

<figure class='code'><figcaption><span>&#8220;certificados para cliente1&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/openvpn/easy-rsa
</span><span class='line'>./build-key cliente1
</span></code></pre></td></tr></table></div></figure>


<p><strong>OJO!</strong> No aprietes enter a lo loco! Presiona &ldquo;y&rdquo; en el momento de autofirmar
los certificados.</p>

<p>Ya tenemos sus certficados, ahora le hacemos el fichero de configuración. En mi
caso, prefiero tener un directorio para cada cliente. Así es solo cuestión de
empaquetar y mandarle todo. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;cliente1/&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/openvpn/
</span><span class='line'>mkdir cliente1
</span><span class='line'><span class="nb">cd </span>cliente1
</span><span class='line'>cp /etc/openvpn/easy-rsa/keys/ca.crt ./
</span><span class='line'>cp /etc/openvpn/easy-rsa/keys/cliente1.crt ./
</span><span class='line'>cp /etc/openvpn/easy-rsa/keys/cliente1.key ./
</span></code></pre></td></tr></table></div></figure>


<p><strong>MUCHO CUIDADO</strong> con lo que copias! Por nada del mundo copies el fichero &ldquo;.key&rdquo;
<strong>DEL SERVIDOR</strong> Si no tu VPN se volverá un ballú y cualquier podría montar un
servidor, engañando a tus cliente.</p>

<p>El fichero <strong>servidor.key</strong> es la identificación mediante la cual openvpn
garantiza ser legítimamente quien dice ser.</p>

<p>Finalmente creamos el fichero de configuración <strong>DEL CLIENTE</strong>. En windows y en
android, un fichero cuya extensión sea <strong>.ovpn</strong> es una configuración de VPN.
Por tanto, es conveniente nombrarlo así. Claro, al no ser &ldquo;.conf&rdquo;, no podrá ser
disparado desde systemcl, o al menos yo, no he hecho la prueba.</p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/openvpn/cliente1/cliente1.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>client
</span><span class='line'>remote 10.1.1.1 443
</span><span class='line'>dev tun
</span><span class='line'>proto tcp
</span><span class='line'>resolv-retry infinite
</span><span class='line'>nobind
</span><span class='line'>persist-key
</span><span class='line'>persist-tun
</span><span class='line'>verb 2
</span><span class='line'>ca ca.crt
</span><span class='line'>cert ./cliente1.crt
</span><span class='line'>key ./cliente1.key
</span><span class='line'>comp-lzo
</span></code></pre></td></tr></table></div></figure>


<p>Empaquetamos y le mandamos al cliente la configuración, por correo o por como
sea, en este caso, lo copié por ssh para el raspberry.</p>

<figure class='code'><figcaption><span>&#8220;cliente1.zip&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema openvpn<span class="o">]</span><span class="c"># zip cliente1.zip cliente1/*</span>
</span><span class='line'>  adding: cliente1/ca.crt <span class="o">(</span>deflated 35%<span class="o">)</span>
</span><span class='line'>  adding: cliente1/cliente1.conf <span class="o">(</span>deflated 28%<span class="o">)</span>
</span><span class='line'>  adding: cliente1/cliente1.crt <span class="o">(</span>deflated 47%<span class="o">)</span>
</span><span class='line'>  adding: cliente1/cliente1.key <span class="o">(</span>deflated 23%<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Del otro lado lo levanté y quedó así:</p>

<figure class='code'><figcaption><span>&#8220;cliente1.zip&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@rasp cliente1<span class="o">]</span><span class="c"># openvpn --config cliente1.conf </span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> OpenVPN 2.3.6 i686-pc-linux-gnu <span class="o">[</span>SSL <span class="o">(</span>OpenSSL<span class="o">)]</span> <span class="o">[</span>LZO<span class="o">]</span> <span class="o">[</span>EPOLL<span class="o">]</span> <span class="o">[</span>MH<span class="o">]</span> <span class="o">[</span>IPv6<span class="o">]</span> built on Dec  <span class="m">2</span> 2014
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> library versions: OpenSSL 1.0.2a <span class="m">19</span> Mar 2015, LZO 2.09
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> WARNING: No server certificate verification method has been enabled.  See http://openvpn.net/howto.html#mitm <span class="k">for</span> more info.
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> Attempting to establish TCP connection with <span class="o">[</span>AF_INET<span class="o">]</span>127.0.0.1:443 <span class="o">[</span>nonblock<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> TCP connection established with <span class="o">[</span>AF_INET<span class="o">]</span>127.0.0.1:443
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> TCPv4_CLIENT link <span class="nb">local</span>: <span class="o">[</span>undef<span class="o">]</span>
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> TCPv4_CLIENT link remote: <span class="o">[</span>AF_INET<span class="o">]</span>127.0.0.1:443
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> VERIFY OK: <span class="nv">depth</span><span class="o">=</span>1, <span class="nv">C</span><span class="o">=</span>CU, <span class="nv">ST</span><span class="o">=</span>HAV, <span class="nv">L</span><span class="o">=</span>Plaza, <span class="nv">O</span><span class="o">=</span>UNAICC, <span class="nv">OU</span><span class="o">=</span>UNAICC, <span class="nv">CN</span><span class="o">=</span>UNAICC CA, <span class="nv">name</span><span class="o">=</span>RSA, <span class="nv">emailAddress</span><span class="o">=</span>vpn@unaicc.cu
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> VERIFY OK: <span class="nv">depth</span><span class="o">=</span>0, <span class="nv">C</span><span class="o">=</span>CU, <span class="nv">ST</span><span class="o">=</span>HAV, <span class="nv">L</span><span class="o">=</span>Plaza, <span class="nv">O</span><span class="o">=</span>UNAICC, <span class="nv">OU</span><span class="o">=</span>UNAICC, <span class="nv">CN</span><span class="o">=</span>vpn.unaicc.cu, <span class="nv">name</span><span class="o">=</span>RSA, <span class="nv">emailAddress</span><span class="o">=</span>vpn@unaicc.cu
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> Data Channel Encrypt: Cipher <span class="s1">&#39;BF-CBC&#39;</span> initialized with <span class="m">128</span> bit key
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> Data Channel Encrypt: Using <span class="m">160</span> bit message <span class="nb">hash</span> <span class="s1">&#39;SHA1&#39;</span> <span class="k">for</span> HMAC authentication
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> Data Channel Decrypt: Cipher <span class="s1">&#39;BF-CBC&#39;</span> initialized with <span class="m">128</span> bit key
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> Data Channel Decrypt: Using <span class="m">160</span> bit message <span class="nb">hash</span> <span class="s1">&#39;SHA1&#39;</span> <span class="k">for</span> HMAC authentication
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, <span class="m">2048</span> bit RSA
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:36 <span class="m">2015</span> <span class="o">[</span>vpn.unaicc.cu<span class="o">]</span> Peer Connection Initiated with <span class="o">[</span>AF_INET<span class="o">]</span>127.0.0.1:443
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:39 <span class="m">2015</span> TUN/TAP device tun1 opened
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:39 <span class="m">2015</span> do_ifconfig, tt-&gt;ipv6<span class="o">=</span>0, tt-&gt;did_ifconfig_ipv6_setup<span class="o">=</span>0
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:39 <span class="m">2015</span> /usr/bin/ip link <span class="nb">set </span>dev tun1 up mtu 1500
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:39 <span class="m">2015</span> /usr/bin/ip addr add dev tun1 10.8.0.2/24 broadcast 10.8.0.255
</span><span class='line'>Sun Jun <span class="m">14</span> 14:34:39 <span class="m">2015</span> Initialization Sequence Completed
</span></code></pre></td></tr></table></div></figure>


<p>Al descomprimir el zip, copia todo en /etc/openvpn/ y usa systemctl para que
arranque.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cp cliente1/* /etc/openvpn/
</span><span class='line'>systemctl start openvpn@cliente1.service
</span><span class='line'>systemctl <span class="nb">enable </span>openvpn@cliente1.service
</span></code></pre></td></tr></table></div></figure>


<h3>y entonces iptables?</h3>

<p>Si tus cliente se conectarán por la interfaz eth0, solo necesitarás el puerto
443 abierto. En este caso, la VPN pincha por el 443. Si tienes un servidor web
público el brinco es diferente. Te recomiendo que uses una máquina solamente
para servidor OpenVPN y dejes es único puerto abierto.</p>

<p>La interfaz de la VPN es tun0, así que ahí le dejas abierto los servicios que
entiendas.</p>

<p>   <blockquote><p>La seguridad informática no es secreta, pero si discreta.</p></blockquote></p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.06 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-03T23:08:27-04:00'><span class='date'>03/06/2015</span> <span class='time'>11:08 pm</span></time>
        
           | <a href="/blog/2015/06/03/transando-a-ext4/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/03/transando-a-ext4/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Una de mis grandes testarudeces (profesionales) siempre ha sido la negativa a
usar ext4. Acostumbrado a los discos IDE, siempre me pareció que el journal
escribía demasiado en el disco. Además, solía verse ext4dev y eso me sonaba a
que se usaría mi sistema como ratón de laboratorio.</p>

<p>Tanta fue mi fobia, que hoy en día aún uso discos montados en ext2. Por ejemplo,
mi laptop estaba montada en ext2 hasta ahora mismo; también la partición /home
del servidor LTSP.</p>

<p>Un fallo eléctrico reciente, me demostró que el journal es un mal necesario. En
discos de tanta escritura, como es el caso del /home de los clientes ligeros, la
integridad de los datos es definitivamente una clave para el sistema. Además,
todo el que usó ext4dev no se quejó nunca.</p>

<figure class='code'><figcaption><span>&#8220;tune2fs&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tune2fs -O extents,uninit_bg,dir_index /dev/sda2
</span></code></pre></td></tr></table></div></figure>


<p>Con eso, le pones a tu ext2 todas las gangarreas del 4. A este punto, reza
porque no se valla luz! Hay que dar otro paso y es pasar un fsck.</p>

<figure class='code'><figcaption><span>&#8220;tune2fs&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tune2fs -c <span class="m">0</span> /dev/sda <span class="o">&amp;&amp;</span> reboot
</span></code></pre></td></tr></table></div></figure>


<p>Marca el disco para chequear y reinicia. Cuando levante, verás que da unos palos
raros ahí pero tú tranquilo.</p>

<p>Las memorias si las dejo con ext2. Pues no necesitan un journal escribiendo
tanto y acortando su vida útil.</p>

<p>Lo próximo que instale, lo haré con BtrFS que está <em>más mejoL en todavía</em>. Dice
tener un soporte especial para discos SSD con lo cual me imagino que para las
memorias flash sea más óptimo.</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.03 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-01T21:13:05-04:00'><span class='date'>01/06/2015</span> <span class='time'>9:13 pm</span></time>
        
           | <a href="/blog/2015/06/01/pacman-bajo-el-microscopio/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/06/01/pacman-bajo-el-microscopio/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>En este post, me propongo mostrarle algunas de las bondades de pacman. Cualquier
que conozca Arch Linux, sabe de lo que estoy hablando.</p>

<p>Veremos bien de cerca el engranaje de está compleja maquinaria.</p>

<p>Pacman, es una herramienta lo suficientemente versátil como para llevar el
nombre de &ldquo;administrador de paquetes&rdquo;. Su nombre es un juego de palabras que
proviene de juntar las palabras &ldquo;PACkage MANager&rdquo;.</p>

<p>A diferencia de ciertas y determinadas distribuciones (entiéndase debian); que
requieren más de 3 softwares para esa pincha. Pacman solo es autosuficiente para
gestionar la paquetería. La herramienta repo-add, está incluída dentro del
paquete de pacman y se usa para crear repositorios personalizados.</p>

<figure class='code'><figcaption><span>&#8220;huevo de pascua de pacman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>repo-elephant
</span><span class='line'>     __
</span><span class='line'>    <span class="s1">&#39;. \</span>
</span><span class='line'><span class="s1">     &#39;</span>- <span class="se">\</span>
</span><span class='line'>      / /_         .---.
</span><span class='line'>     / <span class="p">|</span> <span class="se">\\</span>,.<span class="se">\/</span>--.//    <span class="o">)</span>
</span><span class='line'>     <span class="p">|</span>  <span class="se">\/</span>/        <span class="o">)</span>/  /
</span><span class='line'>      <span class="se">\ </span> <span class="s1">&#39; ^ ^    /    )____.----..  6</span>
</span><span class='line'><span class="s1">       &#39;</span>.____.    .___/            <span class="se">\.</span>_<span class="o">)</span>
</span><span class='line'>          .<span class="se">\/</span>.                      <span class="o">)</span>
</span><span class='line'>           <span class="s1">&#39;\                       /</span>
</span><span class='line'><span class="s1">           _/ \/    ).        )    (</span>
</span><span class='line'><span class="s1">          /#  .!    |        /\    /</span>
</span><span class='line'><span class="s1">          \  C// #  /&#39;</span>-----<span class="s1">&#39;&#39;</span>/ <span class="c">#  /</span>
</span><span class='line'>       .   <span class="s1">&#39;C/ |    |    |   |    |mrf  ,</span>
</span><span class='line'><span class="s1">       \), .. .&#39;</span>OOO-<span class="s1">&#39;. ..&#39;</span>OOO<span class="s1">&#39;OOO-&#39;</span>. ..<span class="se">\(</span>,
</span></code></pre></td></tr></table></div></figure>


<p>Como ya sabrán (o se darán por enterado) Arch Linux no es por release, si no que
un canal en constante desarrollo, hace como upstream, donde se depositan los
paquetes consideraros estables. Esto es lo que en distribuciones estáticas se
llamara &ldquo;repo&rdquo;. Pacman lleva la ardua tarea de mantener el sistema debidamente
actualizado. Nuestro sistema no tendrá &ldquo;actualizaciones&rdquo; si no que evolucionará
constantemente desde el &ldquo;core&rdquo;, escalando horizontalmente el sistema completo.</p>

<p>De esta manera se logra el mítico equilibrio entre estabilidad y novedad.</p>

<p>Para ello, pacman debe tener constancia local de la lista de paquetes que hay en
el upstream. Estas listas son ficheros de textos, comprimidos con gzip, que
contienen información acerca de lo que hay arriba. Por ejemplo, contiene la URL
de como descargarlos.</p>

<p>Para pacman, instalar un paquete o alar está lista, es casi la misma operación.
Se llama &ldquo;sync&rdquo; (sincronizar)</p>

<figure class='code'><figcaption><span>&#8220;-Sy&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Sy
</span></code></pre></td></tr></table></div></figure>


<p>Pero puedes de un solo viaje, sincronizar y actualizar todo el sistema.</p>

<figure class='code'><figcaption><span>&#8220;lo úlitmo que trajo el barco </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Syu
</span></code></pre></td></tr></table></div></figure>


<p>Buscar un paquete también es una operación de sincronización.</p>

<figure class='code'><figcaption><span>&#8220;buscar fulanito&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Ss fulanito
</span></code></pre></td></tr></table></div></figure>


<p>También puedes, bajar la lista, actualizar el sistema e instalar algo de un solo
golpe.</p>

<figure class='code'><figcaption><span>&#8220;todo junto&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -Syu fulanito
</span></code></pre></td></tr></table></div></figure>


<p>Pacman irá a los sitios que tiene declarado en el fichero: <strong>/etc/pacman.d/mirrorlist</strong>
y bajará esos ficheros. Seguidamente los depositará en el directorio /var/lib/pacman/sync/</p>

<figure class='code'><figcaption><span>&#8220;bases de datos&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>file /var/lib/pacman/sync/*.db
</span><span class='line'>/var/lib/pacman/sync/archlinuxfr.db: gzip compressed data, last modified: Thu May <span class="m">21</span> 04:31:59 2015, from Unix
</span><span class='line'>/var/lib/pacman/sync/community.db:   gzip compressed data, last modified: Fri May <span class="m">29</span> 08:47:01 2015, from Unix
</span><span class='line'>/var/lib/pacman/sync/core.db:        gzip compressed data, last modified: Wed May <span class="m">27</span> 19:02:40 2015, from Unix
</span><span class='line'>/var/lib/pacman/sync/extra.db:       gzip compressed data, last modified: Fri May <span class="m">29</span> 04:27:15 2015, from Unix
</span></code></pre></td></tr></table></div></figure>


<p>Ahora nuestro sistema sabe lo que hay &ldquo;arriba&rdquo; (en el repo) y está listo para
compararlo con lo que está &ldquo;abajo&rdquo; (instalado). La información sobre todo los
paquetes que el sistema tiene instalado, se almacena en el directorio
<strong>/var/lib/pacman/local/</strong></p>

<p>La lista es muy grande para mostrarla. Pero dentro hay directorios con la
versión de cada programa instalado. Dentro de ese subdirectorio, hay 4 ficheros
que contiene la información del paquete instalado.</p>

<p>Por ejemplo, el paquete <strong>ruby</strong>, en su versión <strong>2.2.2-1</strong> responde al
directorio <strong>/var/lib/pacman/local/ruby-2.2.2-1</strong></p>

<p>Cada directorio, contiene 4 ficheros:</p>

<figure class='code'><figcaption><span>&#8220;metainfo de un paquete instalado&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>ls /var/lib/pacman/local/ruby-2.2.2-1/
</span><span class='line'>desc  files  install  mtree
</span></code></pre></td></tr></table></div></figure>


<p>El fichero <strong>desc</strong> contiene la información que describe al paquete, versión,
nombre, etc..</p>

<p>El fichero <strong>files</strong> contiene la lista de ficheros que instala dicho paquete.</p>

<p>El fichero <strong>install</strong> contiene una serie de comando disparadores, como
post_install. Dentro de install, se declaró una función llamada post_install()
que será llamada cuando el paquete termine de ser instalado.</p>

<p>Por último, <strong>mtree</strong> (que está comprimido con gz) contiene lo mismo que files,
pero con la suma MD5 de cada fichero. Esto es usado por pacman para verificar la
integridad de los archivos instalados.</p>

<p>Por ejemplo, si quisiéramos ver que ficheros contiene el paquete ruby, podríamos
ver el contenido del fichero <strong>files</strong> pero sería más fácil usar el comando
<strong>Query</strong> con el argumento <strong>list</strong></p>

<figure class='code'><figcaption><span>&#8220;pacman -Ql fulano&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>pacman -Ql ruby<span class="p">|</span>grep <span class="s1">&#39;/usr/bin/&#39;</span>
</span><span class='line'>ruby /usr/bin/
</span><span class='line'>ruby /usr/bin/erb
</span><span class='line'>ruby /usr/bin/gem
</span><span class='line'>ruby /usr/bin/irb
</span><span class='line'>ruby /usr/bin/rake
</span><span class='line'>ruby /usr/bin/rdoc
</span><span class='line'>ruby /usr/bin/ri
</span><span class='line'>ruby /usr/bin/ruby
</span></code></pre></td></tr></table></div></figure>


<p>El principal fichero de pacman, es <strong>/etc/pacman.conf</strong> y a diferencia de otros
package managers, este es bien sencillo. Además, es MUY personalizable.</p>

<p>Por ejemplo, la cláusala XferCommand, permite especificar que comando usar para
bajar los paquetes. Las variables, %u y %o serán enviadas como URL del paquetes
y fichero en disco.</p>

<figure class='code'><figcaption><span>&#8216;scope de</span><a href='/etc/pacman.conf''>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/pacman.conf<span class="p">|</span>grep Xfer
</span><span class='line'><span class="c">#XferCommand = /usr/bin/curl --retry-delay 5 --progress-bar -C - -f %u &gt; %o</span>
</span><span class='line'><span class="nv">XferCommand</span> <span class="o">=</span> /usr/bin/wget --no-cache -t <span class="m">0</span> -T <span class="m">10</span> --max-redirect<span class="o">=</span><span class="m">0</span> -w <span class="m">5</span> --passive-ftp -c -O %o %u
</span></code></pre></td></tr></table></div></figure>


<p>Ese es un buen ejemplo de una configuración para wget en conexiones &ldquo;hostiles&rdquo;.
Para que tengas una idea de cuan personalizable puede llegar a ser:</p>

<figure class='code'><figcaption><span>&#8220;NoExtract&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/pacman.conf<span class="p">|</span>grep NoEx
</span><span class='line'><span class="nv">NoExtract</span> <span class="o">=</span> *.mo
</span></code></pre></td></tr></table></div></figure>


<p>En este caso, los ficheros <strong>.mo</strong> no serán extraídos de los paquetes durante el
proceso de instalación. Como yo uso el sistema en inglés, no me interesa tener
las traducciones de sepetecientos idiomas.</p>

<p>Los paquetes que instales, irán al directorio <strong>/var/cache/pacman/pkg/</strong> y
podrías usar dicho directorio como repo para compartirlo con aquellos que no
tiene acceso a internet; o bien, llevártelo para tu casa, lugar donde te
integras al grupo antes mencionado.</p>

<p>Quizás te interese crear tu propio repo. La idea de crear un repo a partir de la
cache, le ha tirado un cabo a una pila de gente. En un viaje reciente que hice
por el oriente de la isla, cargué mi laptop con todo el software necesario he
instalé 3 servidores con arch <strong>sin conectarme a internet</strong> (vergonzosa hazaña).</p>

<p>Con esta opción:</p>

<figure class='code'><figcaption><span>&#8220;mantener paquetes&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/pacman.conf<span class="p">|</span>grep Clea
</span><span class='line'><span class="nv">CleanMethod</span> <span class="o">=</span> KeepCurrent
</span></code></pre></td></tr></table></div></figure>


<p>Aquellos paquetes que una vez fuero instalados se mantienen. Por tanto, supón
que quieres tener en la otra máquina (la de tu casa) &ldquo;geary&rdquo; el cliente de
correo. Simplemente lo instalas y lo desinstalas en la máquina privilegiada.</p>

<figure class='code'><figcaption><span>&#8220;cacheando paquetes&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pacman -S geary <span class="o">&amp;&amp;</span> pacman -R geary
</span></code></pre></td></tr></table></div></figure>


<p>Ahora el paquete está en la cache, y aunque ya no está en el sistema, se
conservará en la cache hasta que no lo borres. Claro, esto tiene como desventaja
que no se bajarán actualizaciones para ese paquete.</p>

<p>En mi caso, yo tengo este escripcito al que llamo <strong>mkrepo.sh</strong></p>

<figure class='code'><figcaption><span>mkrepo.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c"># elimina esa base de datos</span>
</span><span class='line'>rm /var/cache/pacman/pkg/custom.db.tar.gz
</span><span class='line'>
</span><span class='line'><span class="c"># crea una nueva</span>
</span><span class='line'>repo-add /var/cache/pacman/pkg/custom.db.tar.gz /var/cache/pacman/pkg/*.pkg.tar.xz
</span><span class='line'>
</span><span class='line'><span class="c"># dime que tengo que poner</span>
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;&#39;&#39;</span>
</span><span class='line'><span class="s1">[mirepo]</span>
</span><span class='line'><span class="s1">SigLevel = Optional TrustAll</span>
</span><span class='line'><span class="s1">Server = http://localhost:8080</span>
</span><span class='line'><span class="s1">&#39;&#39;&#39;</span>
</span><span class='line'><span class="c"># sírvelo con darkhttpd</span>
</span><span class='line'>darkhttpd /var/cache/pacman/pkg/ --chroot --port 8080
</span></code></pre></td></tr></table></div></figure>


<p>Al correrlo, la cache se indexa; lista para ser usada como repo. El script hace
un <strong>echo</strong>, para recordarte como sería la configuración que debes poner en
/etc/pacman.conf para usar ese repo.</p>

<p>Finalmente, darkhttpd (un servidor web que viene con el Live de arch) sirve ese
repo.</p>

<p>Quizás tengas una memoria flash donde creas el repo. En ese caso, bastaría con
especificar una linea Server con la dirección file:///</p>

<p>Server = file:///media/MEMORIA/repo/</p>

<p>Simple verdad?</p>

<p>Pensé hacer esta entrada más larga, pero sería aburrir al lector. En cambio,
ahora ya sabes una parte, te dejo que investigues el resto.</p>

<h4>Happy Hacking!</h4>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.09 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/9">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/7">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>

	<h1>Lo m&aacute;s reciente</h1>

	<ul id="recent_posts">
		
		<li class="post">
			<a href="/blog/2016/08/16/password-de-windows/">password de windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/31/kiwix-como-servicio/">kiwix como servicio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/17/hibernar-en-archlinux/">hibernar en archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/17/rsync-basico/">rsync básico</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/20/correos-del-cron/">correos del cron</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/18/dkim-y-spf-en-postfix/">dkim y spf en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/06/desacelerar-mouse/">desacelerar mouse</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/05/12/deshabilitar-historial-de-bash/">deshabilitar historial de bash</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/04/29/reparar-archivos-de-innodb/">reparar archivos de innodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/04/01/wpa2-con-freeradius/">WPA2 con freeradius</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/14/misterio-con-ethernet-foxconn/">misterio con ethernet foxconn</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/07/cargar-rvm/">cargar rvm</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/22/data-confirm-en-un-boton/">data confirm en un boton</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/20/hooks-de-pacman/">los hooks de pacman</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/01/arch-compartir-paquetes/">arch compartir paquetes</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/25/hostname-arbitrario-en-bind9/">bind9, registro arbitratio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/19/espejos-de-clamav/">espejos de clamav y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/14/clamav-en-windows/">clamav en windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/12/14/servidor-jabber-con-prosody/">servidor jabber con prosody</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/29/mc-demora-en-abrir/">mc demora en abrir</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/23/desmume-ultralento/">desmume ultralento</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/22/certificado-autofirmado/">certificado autofirmado</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/12/rc-dot-local-en-systemd/">rc.local en systemd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/las-mujeres-gordas/">las mujeres gordas</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/tls-y-ssl-en-postfix/">tls y ssl en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/20/compartir-la-wifi/">compartir la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/01/squid-transparente/">squid transparente</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/19/will-paginate/">will_paginate</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/12/date-select-en-espanol/">date_select en español</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/11/openvas-en-archlinux/">OpenVAS en Archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/anadir-verbo-a-un-scaffold/">añadir verbo a un scaffold</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/asset-pipeline-en-production/">asset pipeline en production</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/12/systemd-automount/">systemd automount</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/21/sasl-homeclub-only/">SASL homeclub only</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/19/delay-pools-de-squid/">delay pools de squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/12/rails-con-mongodb/">rails con mongodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/06/zentyal/">Zentyal</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/01/bundle/">bundle</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/12/02/welcome-aboard/">welcome aboard</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/10/28/proxy-automatico/">proxy automático</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/24/verdial-y-el-imagis/">la pena de verdial</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/05/palos-de-wordpress/">palos de wordpress</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/el-server-de-correo/">el servidor de correo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/mas-de-ocs/">más de OCS</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/15/subdesarrollo/">subdesarrollo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/11/ocs-inventory/">ocs-inventory</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/08/select-en-bootstrap/">select en bootstrap</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/05/empirico/">empíricos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/27/crear-un-chroot-con-debian/">crear un chroot con debian</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/10/autenticador-sql-en-el-proxy/">autenticador SQL en el proxy</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/postfix-entrando-en-el-baile/">postfix entrando en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/dovecot-entra-en-el-baile/">dovecot entra en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/05/02/wordpress-para-todos/">wordpress para todos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/06/squid-en-infomed/">el toten de proxies</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/04/en-la-cumbre-del-vedado/">el &#8220;calisto&#8221; garcía</a>
		</li>
		
	</ul>
	
</section>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - låzaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'uranio-235';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>
</html>
