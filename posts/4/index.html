
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>El SysAdmin del 3er Mundo</title>
  <meta name="author" content="låzaro">

  
  <meta name="description" content="Vale la pena hacer una entrada de esto, porque podría ser el problema de alguien
que como yo; se cansó de alarse los pelos y buscar en google. Recién &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uranio-235.github.io/posts/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El SysAdmin del 3er Mundo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">El SysAdmin del 3er Mundo</a></h1>
  
    <h2>luchando contra el subdesarrollo en todos los frentes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com.cu" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uranio-235.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archivo</a></li>
  <li><a href="/blog/categories/rails/">Ruby on Rails</a></li>
  <li><a href="/blog/categories/destacado/">Destacado</a></li>
  <li><a href="/blog/categories/razonemos/">Razonemos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-16T12:40:04-04:00'><span class='date'>16/10/2015</span> <span class='time'>12:40 pm</span></time>
        
           | <a href="/blog/2015/10/16/palo-con-la-wifi/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/16/palo-con-la-wifi/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Vale la pena hacer una entrada de esto, porque podría ser el problema de alguien
que como yo; se cansó de alarse los pelos y buscar en google.</p>

<p>Recién no se cuando me bajé una versión de algo que involucra al networkmanager
y BUN! La wifi, cada vez que levantaba al susodicho, se bloqueaba.</p>

<p>El problema parecía estar en el fichero:</p>

<p><strong>/var/lib/NetworkManager/NetworkManager.state</strong></p>

<p>No se porque, decía tener la wifi deshabilitada. El fichero contiene algo como
esto:</p>

<figure class='code'><figcaption><span>NetworkManager.state</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>main<span class="o">]</span>
</span><span class='line'><span class="nv">NetworkingEnabled</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">WirelessEnabled</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">WWANEnabled</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">WimaxEnabled</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>No se por qué, la clave <strong>NetworkingEnabled</strong> estaba con valor <strong>false</strong> y al
arrancar NetworkManager, bloqueaba la wifi, al punto que al levantarla
manualmente, me decía que tenía que desbloquearla con rfkill. Para el que no lo
sepa, con rfkill se pueden bloquear los radios.</p>

<p>Si por casualidad tienes alguno bloqueado, ejecuta:</p>

<p>rfkill unblock all</p>

<p>Cosa que tenía que ejecutar cada vez que arrancaba el dichóso NetworkManager</p>

<p>Probé apagar la wifi y arrancar el networkmanager con la wifi apagada, para ver
si eso cambiaba algo en el fichero antes mencionado; pero no. Lo cual me llevó a
la conclusión de que no fue una metedura de pata mía si no, un bug.</p>

<p>Ponerle atributo inmutable a ese fichero podría ser una solución, pero todo lo
que está en /var suele ser un dato volátil que señala el estado de algo, así que
ponerle inmutable podría causar fallos en la aplicación.</p>

<p>Si ese fichero está en /var es porque el network manager dumpea ahí su estado,
fíjese que está junto a los lease del DHCP. No tengo certeza de que modificando
esa configuración manualmente esta persista; pero ya llevo una semana con el
problema resuelto.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-15T14:38:20-04:00'><span class='date'>15/10/2015</span> <span class='time'>2:38 pm</span></time>
        
           | <a href="/blog/2015/10/15/repo-de-fdroid/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/15/repo-de-fdroid/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&ldquo;La que se avecina&rdquo;, sería una buena manera para describir la revolución de
aparatos con android que habrá en el Calixto García muy pronto. Yo siempre con
el paso al frente y las luz larga (modestia y aparte) estuve pensando que tener
nuestro propio repositorio de aplicaciones para android; sería una buena manera
de mantener a todo el mundo bien actualizado, sobre todo a aquellos que no
tienen acceso a internet.</p>

<p>Para el que no lo conozca, <a href="https://f-droid.org/">fdroid</a> es una herramienta
cliente para repositorios de android, osea como google market pero libre.</p>

<p>La mecánica es sencilla: Bajo los paquetes con
<a href="http://www.aptoide.com">aptoide</a>, verifico que sean seguros y copio la cache
para el directorio repo/ de fdroid en el servidor con <a href="https://acrosync.com/">acrosync</a></p>

<p>En el repo de debian y en AUR, el paquete se llama <strong>fdroidserver</strong>. La rutina
de instalación ya la conoces.</p>

<p>Creamos el directorio donde meteremos el repo, en mi caso, aquí:</p>

<figure class='code'><figcaption><span>mkdir</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -p /srv/http/fdroid/repo
</span></code></pre></td></tr></table></div></figure>


<p>Creamos la configuración de nginx, a mi me quedó así:</p>

<figure class='code'><figcaption><span>nginx.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>server <span class="o">{</span>
</span><span class='line'>     listen   10.1.1.14:80<span class="p">;</span>
</span><span class='line'>     listen   10.1.1.14:443 ssl<span class="p">;</span>
</span><span class='line'>     server_name android.hcg.sld.cu<span class="p">;</span>
</span><span class='line'>     location / <span class="o">{</span>
</span><span class='line'>     root /srv/http/fdroid/repo/<span class="p">;</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Un virtualhost nombrado <em>android</em>. <strong>No olvide crear el puntero DNS</strong></p>

<p>Ahora, ve al directorio raíz del repo, OJO <strong>A LA RAIZ</strong>, NO a donde dice repo/.</p>

<figure class='code'><figcaption><span>fdroid</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /srv/http/fdroid/
</span><span class='line'>fdroid init
</span></code></pre></td></tr></table></div></figure>


<p>Te preguntará por la <strong>android-sdk</strong>, por lo general, está en /opt/android-sdk,
dale la ruta.</p>

<p>¿¿No tienes la SDK de android?? Ah pues estás muy jodio&hellip; En el caso de arch,
el repo de bbqlinux contiene la sdk completa, solo para 64 bits.</p>

<p>Pero volviendo con fdroid:</p>

<p>Ahora debe habérse creado el directorio <strong>repo/</strong> dentro del directorio
<strong>/srv/http/fdroid</strong> y es ahí donde copiarás las APK.</p>

<p>cp /donde/esten/tus/*.apk /srv/http/fdroid/<strong>repo/</strong></p>

<p>Pero claro, querrás que tu repo se identifique.  El fichero
<strong>/srv/http/fdroid/config.py</strong> contiene lo que buscas. Por la linea trenta y
pico; a mi me quedó así:</p>

<figure class='code'><figcaption><span>config.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="n">repo_url</span> <span class="o">=</span> <span class="s">&quot;http://android.hcg.sld.cu&quot;</span>
</span><span class='line'><span class="n">repo_name</span> <span class="o">=</span> <span class="s">&quot;Calixto Garcia&quot;</span>
</span><span class='line'><span class="n">repo_icon</span> <span class="o">=</span> <span class="s">&quot;calixto_xsm.png&quot;</span>
</span><span class='line'><span class="n">repo_description</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">Repositorio de aplicaciones de android del calixto. Intentaremos proveerle</span>
</span><span class='line'><span class="s">aplicaciones debidamente actualizadas. Sientase libre de colaborar, trayendonos</span>
</span><span class='line'><span class="s">las mas recientes APK.</span>
</span><span class='line'><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ah! y sin tildes, si no, python se vuelve loco con el encoding.</p>

<p>Ahora vamos a crear el índice inicial, pero eso mismo comando lo correrás cuando
agregues aplicaciones a tu repo.</p>

<figure class='code'><figcaption><span>fdroid</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>fdroid update --create-metadata
</span></code></pre></td></tr></table></div></figure>


<p>OJO!! Asegúrate de que las APK no tengan un espacio en su nombre; muchísimo
menos un caracter raro. Si todo salió bien debes ver algo como &ldquo;Generating
metada&rdquo;.</p>

<p>Con eso terminaste el servidor&hellip; Ve a fdroid y ponle la URL del virtualhost
como repo, luego update y listo&hellip;</p>

<p>¿Cómo se hace? Facilito. Párate en la primer pantalla, aprieta el botón de menú
del dispositivo y toca donde dice &ldquo;Gestionar Repositorios&rdquo; o en inglés, &ldquo;Manage
Repos&rdquo;</p>

<p>Desactiva los respos inalcanzables y añade tu repo local. Luego actualiza y
listo, verás las aplicaciones disponibles.</p>

<p>Ya solo te quedaría instalar un rsync que desemboque en el repo y con
<a href="https://acrosync.com/">acrosync</a> subes la cache de aptotide para el repo, así
como lo estoy haciendo yo ahora.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-08T21:45:55-04:00'><span class='date'>08/10/2015</span> <span class='time'>9:45 pm</span></time>
        
           | <a href="/blog/2015/10/08/prawn-pdf-con-ruby/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/08/prawn-pdf-con-ruby/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>De siempre, los usuarios que fueron forzados a abandonar
<a href="https://es.wikipedia.org/wiki/Microsoft_Access">MSAcces</a> por un motivo u otro;
sienten un incontenible necesidad por los &ldquo;informes&rdquo;.</p>

<p>A la hora de imprimir, muchos usaurios no entienden que un HTML se imprima.
Incluso, habiéndoles hecho un javascript que muestra el diálogo de impresión,
simplemente lo cierra y me preguntan &ldquo;¿y ahora que hago con esto?&rdquo;</p>

<p>En recientes diálogos con un bibliotecario (que hereda la clase Usuario) me dijo
que la gente entiende más de imprimir PDF.</p>

<p>Hacer un PDF me pareció una tare bastante compleja; y lo es, pero
<a href="http://prawn.majesticseacreature.com">Prawn</a> lo hace de una manera casi
increíble. Para no aburrirte con el cuento, te mostraré como montarlo arriba del
tren.</p>

<p><strong>EjemploController</strong> que tu conoce:</p>

<figure class='code'><figcaption><span>&#8220;ejemplo_controller.rb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># el controlador bin ban bin ban</span>
</span><span class='line'><span class="k">class</span> <span class="nc">EjemploController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">def</span> <span class="nf">accion</span> <span class="c1"># la acción, como se llame</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># a según el sapo, la pedrá</span>
</span><span class='line'>      <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1"># tírame el pdf</span>
</span><span class='line'>         <span class="nb">format</span><span class="o">.</span><span class="n">pdf</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># tráeme al animal</span>
</span><span class='line'>            <span class="nb">require</span> <span class="s1">&#39;prawn&#39;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># créame un nuevo documento pdf</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">=</span><span class="no">Prawn</span><span class="o">::</span><span class="no">Document</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># tírame el banner, el H1 como quien dice, tamaño de fuente 25px en negrita</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">formatted_text</span> <span class="o">[</span> <span class="p">{</span><span class="ss">text</span><span class="p">:</span> <span class="s1">&#39;El título del documentos&#39;</span><span class="p">,</span><span class="ss">size</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span><span class="ss">styles</span><span class="p">:</span> <span class="o">[</span><span class="ss">:bold</span><span class="o">]</span><span class="p">}</span> <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># hazle una rallita horizontal debano al header</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">stroke_horizontal_line</span> <span class="mi">0</span><span class="p">,</span><span class="mi">235</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># mueve el cursor pa abajo</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">move_down</span> <span class="mi">20</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># la variable cuerpo contiene un texto laaaaaaargooo en HTML</span>
</span><span class='line'>            <span class="c1"># un HTML muy rudimentario, Prawn lo interpresta, por ejemplo</span>
</span><span class='line'>            <span class="c1"># las cláusulas &lt;strong&gt;</span>
</span><span class='line'>            <span class="vi">@pdf</span><span class="o">.</span><span class="n">text</span> <span class="vi">@cuerpo</span><span class="p">,</span> <span class="ss">inline_format</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># por jemeplo, itera en el modelo User y escribe sus nombres</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">user</span> <span class="k">in</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Nombre: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">nombre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="ss">inline_format</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">move_down</span> <span class="mi">10</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">text</span> <span class="s2">&quot;Edad: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">edad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="ss">inline_format</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>               <span class="vi">@pdf</span><span class="o">.</span><span class="n">move_down</span> <span class="mi">30</span>
</span><span class='line'>            <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1"># tírala!!!</span>
</span><span class='line'>            <span class="n">send_data</span> <span class="vi">@pdf</span><span class="o">.</span><span class="n">render</span><span class="p">,</span> <span class="ss">filename</span><span class="p">:</span> <span class="s2">&quot;solicitud.pdf&quot;</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">end</span> <span class="c1"># format</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">end</span> <span class="c1"># respond_to</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">end</span> <span class="c1"># def</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span> <span class="c1"># class</span>
</span></code></pre></td></tr></table></div></figure>


<p>Vamos a dividir en sílabas:</p>

<h4>Línea 7</h4>

<p>Rails, la acción responde a múltiples mime-types</p>

<h4>Línea 10</h4>

<p>Rails, application/pdf responde a la extensión PDF <em>format.pdf do</em></p>

<h4>Línea 13</h4>

<p>Carga la librería, sí, ya se que en Rails debes hacer eso en un initializer, de
cualquier manera, aún, luego de haberlo agregado a tu Gemfile, no te olvides de
requerirla, ya sea en un initializer o en el controlador.</p>

<h4>Línea 16</h4>

<p>Crea un nuevo PDF y almacénalo en la variable de instancia <strong>@pdf</strong></p>

<h4>Línea 19</h4>

<p>El método <strong>formatted_text</strong>, recibe como argumento un array de hashes</p>

<p>Cada array en un bloque de texto y contiene un hash. La clave :text contiene el
texto a renderizar, :size el tamaño y :style el estilo de fuente.</p>

<h4>Línea 22</h4>

<p>Trazar línea horizontal, el método <strong>stroke_horizontal_line</strong> recibe como
argumento, de donde, a donde debe trazar la línea.</p>

<h4>Pasemos a la línea 41</h4>

<p>El método <strong>render</strong> devuelve el PDF. Si lo sacas con <strong>puts</strong> verás el PDF
crudo. Podrías también tirarlo pa un fichero así:</p>

<figure class='code'><figcaption><span>&#8220;fulanito.pdf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>   <span class="no">IO</span><span class="o">.</span><span class="n">write</span> <span class="s1">&#39;fulanito.pdf&#39;</span><span class="p">,</span><span class="vi">@pdf</span><span class="o">.</span><span class="n">render</span>
</span></code></pre></td></tr></table></div></figure>


<p>A los usuarios le encantan los PDF, hazlos feliz ;)</p>

<p>   <blockquote><p>Existen dos tipos de personas,<br/>   las que hacen lo que le dicen; y,<br/>   las que dicen lo que hay que hacer.</p><footer><strong>Lázaro Armando</strong></footer></blockquote></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-05T21:45:45-04:00'><span class='date'>05/10/2015</span> <span class='time'>9:45 pm</span></time>
        
           | <a href="/blog/2015/10/05/assets-por-controlador/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/10/05/assets-por-controlador/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>NUNCA</strong>, he logrado entender, porque el asset pipeline de Rails carga
<strong>TODAS</strong> las porquerías de todos los controladores en todas las vistas.</p>

<p>¡¡¡Como si fuese poco tener que cargar el mismo javascript por controlador!!!</p>

<p>La documentación dice que puedes cargar solamente el del controlador; pero
cuando la sigues al pie de la letra; Rails te da tremendo palo, diciendo que una
asset se escapó sin compilar. La &ldquo;una&rdquo; suele ser la del controlador que estés
cargando, o sea, todas.</p>

<p>La solución que plantea la documentación, es un Proc asqueroso que tampoco
pincha.</p>

<p>Te cuento como lo hice:</p>

<p>Primero tienes que quitar la cláusula &ldquo;<strong>require_tree .</strong>&rdquo; del <strong>application.js</strong></p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// This is a manifest file that&#39;ll be compiled into application.js, which will include all the files</span>
</span><span class='line'><span class="c1">// listed below.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,</span>
</span><span class='line'><span class="c1">// or any plugin&#39;s vendor/assets/javascripts directory can be referenced here using a relative path.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// It&#39;s not advisable to add code directly here, but if you do, it&#39;ll appear at the bottom of the</span>
</span><span class='line'><span class="c1">// compiled file.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// Read Sprockets README (https://github.com/rails/sprockets#sprockets-directives) for details</span>
</span><span class='line'><span class="c1">// about supported directives.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'><span class="c1">//= require turbolinks</span>
</span><span class='line'><span class="c1">//  require_tree . fíjate que quitamos el =</span>
</span><span class='line'><span class="nx">Turbolinks</span><span class="p">.</span><span class="nx">enableProgressBar</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora vamos a dar un toque mágico para que las assets se compilen de manera
dinámica, sin tener que colocarle manualmente al arreglo los nuevos .js
generados. El fichero <strong>config/initializers/assets.rb</strong> me quedó así; <strong>OJO</strong> que es
una linea bien larga:</p>

<figure class='code'><figcaption><span>&#8220;assets.rb - ojo con la linea larga&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Be sure to restart your server when you modify this file.</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Version of your assets, change this if you want to expire all your assets.</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Add additional assets to the asset load path</span>
</span><span class='line'><span class="c1"># Rails.application.config.assets.paths &lt;&lt; Emoji.images_path</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Precompile additional assets.</span>
</span><span class='line'><span class="c1"># application.js, application.css, and all non-JS/CSS in app/assets folder are already added.</span>
</span><span class='line'><span class="c1"># Rails.application.config.assets.precompile += %w( search.js )</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># compila todo lo que te encuentres por el camino</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">to_path</span><span class="p">,</span><span class="s1">&#39;app/assets/javascripts/*.j*&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># activa el debug de la asset pipeline, solo en entorno de desarrollo</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENV&#39;</span><span class="o">]</span> <span class="ow">and</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENV&#39;</span><span class="o">].</span><span class="n">include?</span> <span class="s1">&#39;development&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Podría hacer lo mismo con las CSS si usa un poquito la células grises. Note como
además, agregamos que se debugue la asset pipeline si y solo si estamos en
development.</p>

<p>Pero no hemos terminado, la vista lleva unos toques&hellip; pues debemos decirle lo
más importante, que cargue solo las .js de su controlador. A mi me quedó así:</p>

<p>  &lt;%= javascript_include_tag params[:controller] %></p>

<figure class='code'><figcaption><span>&#8220;app/views/layouts/application.html.erb&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>El Título<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag    &#39;application&#39;, media: &#39;all&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag &#39;application&#39;, &#39;data-turbolinks-track&#39; =&gt; true %&gt;
</span><span class='line'>  <span class="c">&lt;!-- carga solo las .js del controlador dado --&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag params[:controller] %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= csrf_meta_tags %&gt;
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span>%= yield %&gt;
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahí te das cuenta que el que carga todo, es el manifest (application.js) con su
&ldquo;requiere_tree .&rdquo; pero la cláusula en la línea 8 le dice que cargue la .js del
controlador especificado en <strong>params[:controller]</strong></p>

<p>Bueno así debe pinchar con javascript y con CoffeScript, al menos a mi me pinchó
con ambos. Veamos que trae rails 5 con esto, porque la mejora urge&hellip;</p>

<p>Si la cosa sigue así en la versión 5, me estoy mudando para Volt</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-17T17:42:04-04:00'><span class='date'>17/09/2015</span> <span class='time'>5:42 pm</span></time>
        
           | <a href="/blog/2015/09/17/dhcp-por-grupos/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/09/17/dhcp-por-grupos/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>La fiebre LTSP sigue subiendo en el Calixto. La solución definitiva para toda
máquina que butee por la red, sin importar su cantidad de RAM o micro&hellip;</p>

<p>Pero cuando hay más de un servidor con DHCP en la misma red, se forma el rollo.</p>

<h4>isc-dhcp no se puede bloquear con iptables</h4>

<p>Si tienes alguna duda de la afirmación anterior, has la tarea y busca en google.
De nada vale ponerle un cortafuegos a cada servidor porque <strong>isc</strong> usa &ldquo;raw
packets&rdquo; y se caga en lo que diga iptables. Por suerte de afuera pa dentro eso
no se aplica. No obstante, ojo si pones un isc con múltiples interfaces, no sea
que acabes dándole DHCP al ruter.</p>

<p>En un ambiente como este, no queda otra que hacer un DHCP central con múltiples
parámetros, de forma que los clientes ligeros se agrupen por MAC address y se
seleccione el servidor adecuado a la hora de butear.</p>

<p>El fichero de configuración es <strong>/etc/dhcp/dhcpd.conf</strong> y bajo la declaración de
la subnet puedes poner una cláusula <strong>group</strong> para dar parámetros diferentes.</p>

<p>La sintaxis es sencilla:</p>

<figure class='code'><figcaption><span>&#8220;ejemplo&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>subnet <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>   parametros de la red
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>group <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>   parametros del grupo
</span><span class='line'>
</span><span class='line'>   host nombre <span class="o">{</span>
</span><span class='line'>      parametros del host
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tomemos el caso de dos servidores LTSP en la red, el 10.1.1.6 y el 10.1.1.3, a
mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/dhcp/dhcpd.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># vim:filetype=config</span>
</span><span class='line'>authoritative<span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># la red</span>
</span><span class='line'>subnet 10.1.1.0 netmask 255.255.255.0 <span class="o">{</span>
</span><span class='line'>    range 10.1.1.100 10.1.1.254<span class="p">;</span>
</span><span class='line'>    option domain-name <span class="s2">&quot;hcg.sld.cu&quot;</span><span class="p">;</span>
</span><span class='line'>    option domain-name-servers 10.1.1.1<span class="p">;</span>
</span><span class='line'>    option broadcast-address 10.1.1.255<span class="p">;</span>
</span><span class='line'>    option subnet-mask 255.255.255.0<span class="p">;</span>
</span><span class='line'><span class="o">}</span> <span class="c"># subnet</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># ganker y su pandilla, la gente de archivos médicos</span>
</span><span class='line'>group <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># clientes ligeros con linux y ltsp</span>
</span><span class='line'>    option root-path <span class="s2">&quot;/opt/ltsp/i386&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> substring<span class="o">(</span> option vendor-class-identifier, 0, <span class="m">9</span> <span class="o">)</span> <span class="o">=</span> <span class="s2">&quot;PXEClient&quot;</span> <span class="o">{</span>
</span><span class='line'>        filename <span class="s2">&quot;/ltsp/i386/pxelinux.0&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        filename <span class="s2">&quot;/ltsp/i386/nbi.img&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="c"># buteen por ganker</span>
</span><span class='line'>   next-server 10.1.1.3<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c"># los clientes</span>
</span><span class='line'>   host clganker1 <span class="o">{</span> hardware ethernet 00:1E:90:E1:B4:0A<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host clganker2 <span class="o">{</span> hardware ethernet 00:1E:90:E2:6E:1A<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host clganker3 <span class="o">{</span> hardware ethernet 00:1E:90:E2:75:B6<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host clganker4 <span class="o">{</span> hardware ethernet 00:1E:90:F5:E8:A5<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host clganker5 <span class="o">{</span> hardware ethernet 00:1E:90:F5:E9:88<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span> <span class="c"># ganker</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># atenea y su flotilla, el servidor de la biblioteca</span>
</span><span class='line'>group <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># clientes ligeros con linux y ltsp</span>
</span><span class='line'>    option root-path <span class="s2">&quot;/opt/ltsp/i386&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> substring<span class="o">(</span> option vendor-class-identifier, 0, <span class="m">9</span> <span class="o">)</span> <span class="o">=</span> <span class="s2">&quot;PXEClient&quot;</span> <span class="o">{</span>
</span><span class='line'>        filename <span class="s2">&quot;/ltsp/i386/pxelinux.0&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        filename <span class="s2">&quot;/ltsp/i386/nbi.img&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="c"># buteen por el servidor de la bibliteoca</span>
</span><span class='line'>   next-server 10.1.1.6<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c"># los clientes</span>
</span><span class='line'>   host biblioteca1 <span class="o">{</span> hardware ethernet 00:1E:90:E1:B4:0A<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host biblioteca2 <span class="o">{</span> hardware ethernet 00:1E:90:E2:6E:1A<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host biblioteca3 <span class="o">{</span> hardware ethernet 00:1E:90:E2:75:B6<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host biblioteca4 <span class="o">{</span> hardware ethernet 00:1E:90:F5:E8:A5<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>   host biblioteca5 <span class="o">{</span> hardware ethernet 00:1E:90:F5:E9:88<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span> <span class="c"># ganker</span>
</span></code></pre></td></tr></table></div></figure>


<p>¿Qué hicimos? Sencillo, declaramos un grupo con distintos parámetros, aunque en
este caso solo <strong>next-server</strong> es verdaderamente distinto. En ambos casos se
engatilla el mismo <strong>file-name</strong> y <strong>root-path</strong> ya que ambos servidores hay lo
mismo.  Pero quizás en su red usted tiene otro servidor bootp o PXE y no querrá
que las opciones de LTSP sean la misma.</p>

<p>Finalmente el parámetro <strong>next-server</strong> difiere y es que es este el que le da
porque servidor bootear.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-10T18:28:48-04:00'><span class='date'>10/09/2015</span> <span class='time'>6:28 pm</span></time>
        
           | <a href="/blog/2015/09/10/plymouth-boot-screen/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2015/09/10/plymouth-boot-screen/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sigo con mi plan de &ldquo;civilizarme&rdquo;, me he propuesto dejar de parecer un friki en
materia de software. He cambiado i3 por MATE (en la máquina personal) e incluso
tengo un tema en el grub. Intenté cambiar Atom por Vim, evolution por mutt y
double-cmd por mc; pero por gusto, acabé virando pa atrá.</p>

<p>Una de las cosas que antes solía molestarme en las distros duras como debian,
era el hecho de que no tuvieran una pantalla bien bonita mientras buteaban.
Ubuntu por ejemplo, te pone las bolitas.</p>

<p>Archlinux es particularmente rápido buteando, pero aún tenía conmigo mismo la
deuda del bootscren pendiente.</p>

<p>Resulta que ya splashy no se usa, ahora la talla es un software con nombre de
almendrón: <strong>Plymouth</strong></p>

<p>Plymouth, es una proyecto de fedora, para proveer una pantalla de buteo a nivel
de framebuffer. Hoy en día casi todas las distros butean con el framebuffer en
la máxima resolución posible, así que me imagino que Plymouth sea algo bastante
simple.</p>

<p>En el repo de arch no está incluido pero como todo, está disponible en AUR. La
rutina ya la conoces. Selecciona el que dice plymouth pelao.</p>

<figure class='code'><figcaption><span>&#8220;yaourt&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yaourt plymouth
</span></code></pre></td></tr></table></div></figure>


<p>Ahora vamos a cambiar unos parámetros en el generador de imágenes de inicio.
Localiza el fichero <strong>/etc/mkinitcpio.conf</strong> y ahí vamos a cambiar unas
cosillas.</p>

<p>Primero necesitaremos poner el <strong>HOOK</strong> para plymouth. La documentación advierte
que debe ser después de <strong>base</strong> y de <strong>udev</strong>, así que mejor <strong>ponlo de
último</strong>. Por tanto, dentro de las comillas colocarás <strong>plymouth</strong> como un
objeto más de dicha lista; como el último.</p>

<figure class='code'><figcaption><span>&#8220;/etc/mkinitcpio.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">HOOKS</span><span class="o">=</span><span class="s2">&quot;base udev fulanito menganito el_ultimo plymouth&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Nota para los imbéciles:</strong> <em>Si copias y pegas el código anterior, el sistema no te arrancará más.</em></p>

<p>Necesitaremos el módulo apropiado para pinchar el framebufer. En mi caso,
desgraciadamente, uso nvidia, así que me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/mkinitcpio.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">MODULES</span><span class="o">=</span><span class="s2">&quot;nouveau&quot;</span>
</span><span class='line'><span class="c">#MODULES=&quot;i915&quot;</span>
</span><span class='line'><span class="c">#MODULES=&quot;radeon&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fíjate que los demás quedaron a modo de comentario. Te aclaro que <strong>i915</strong> es
para las tarjetas de video Intel.</p>

<p>Si usas el blob oficial de nvidia, te jodiste. Ni sigas leyendo.</p>

<p>Ahora tenemos que decirle al grub, que incluya el parámetro <strong>splash</strong> en la
linea de buteo. Eso lo hacemos editando el fichero <strong>/etc/default/grub</strong></p>

<figure class='code'><figcaption><span>&#8220;/etc/default/grub&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&quot;quiet splash&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yo en lo personal suelo quitarle &ldquo;quiet&rdquo; porque me gusta ver lo que hace el
sistema mientras butea. Aunque ya no da tiempo. Como te dije, los sistemas
modernos butean MUY rápido. Es más el tiempo en que carga init o el display
manager, que el de buteo como tal.</p>

<p>Más adelante veremos que hacer para que la pantalla se vea más tiempo, por ahora
terminemos de configurar. Tanto el grub como initramfs, tienen que reflejar los
cambios</p>

<figure class='code'><figcaption><span>&#8220;reflejando cambios&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>grub-mkconfig -o /boot/grub/grub.cfg
</span><span class='line'>mkinitcpio -p linux
</span></code></pre></td></tr></table></div></figure>


<p>Si usas linux-lts, corre:</p>

<figure class='code'><figcaption><span>&#8220;reflejando cambios&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkinitcpio -p linux-lts
</span></code></pre></td></tr></table></div></figure>


<p>Algo que suele molestar, es que el display manager te caiga en la cara de
pronto. Arch suele manejar bien ese tema, pero por si acaso, nos aseguramos de
habilitar la unit para cada display manager.</p>

<p>En mi caso yo uso slim y corrí:</p>

<figure class='code'><figcaption><span>&#8220;enable&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl <span class="nb">enable </span>slim-plymouth.service
</span></code></pre></td></tr></table></div></figure>


<p>Puede que el tuyo sea:</p>

<ul>
<li>gdm-plymouth.service</li>
<li>kdm-plymouth.service</li>
<li>lxdm-plymouth.service</li>
</ul>


<p>Con eso ya debe estar listo para pinchar pero vamos a darle unos toquesitos
finales.</p>

<p>El fichero <strong>/etc/plymouth/plymouthd.conf</strong> contiene los parámetros de
configuración del mismo. El mío luce así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/plymouth/plymouthd.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/plymouth/plymouthd.conf
</span><span class='line'><span class="c"># Distribution defaults. Changes to this file will get overwritten during</span>
</span><span class='line'><span class="c"># upgrades.</span>
</span><span class='line'><span class="o">[</span>Daemon<span class="o">]</span>
</span><span class='line'><span class="nv">Theme</span><span class="o">=</span>tribar
</span><span class='line'><span class="nv">ShowDelay</span><span class="o">=</span>2
</span></code></pre></td></tr></table></div></figure>


<p>El parámetro <strong>ShowDelay</strong>, define que tiempo se mostrará la pantalla. Como ya
te dije, arch a mi me butea en segundos. Si pones 5 ahí, la pantalla de buteo se
mostrará cinco segundos. Dos buteando y otros tres pa que tu la mires mostrando
su animación.</p>

<p>Yo cuando terminé de verla correr la primera vez; desinstalé plymouth. No me
interesa tener 2 segundos adicionales de media por el mero hecho de que sea más
bonito.</p>

<p>El otro parámetro, <strong>Theme</strong>, setea el tema que usarás. Para ver que temas
tienes en el menú, corre:</p>

<figure class='code'><figcaption><span>&#8220;plymouth-set-default-theme&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>plymouth-set-default-theme -l
</span><span class='line'>details
</span><span class='line'>fade-in
</span><span class='line'>glow
</span><span class='line'>script
</span><span class='line'>solar
</span><span class='line'>spinfinity
</span><span class='line'>spinner
</span><span class='line'>text
</span><span class='line'>tribar
</span></code></pre></td></tr></table></div></figure>


<p>A mi me gustó &ldquo;tribar&rdquo; y el que viene por defecto también está lindo, pero es
una copia al carbón de MacOS.</p>

<h4>OJO!</h4>

<p>Cada vez que cambies un parámetro ahí, debes correr &ldquo;mkinitcpio -p&rdquo;</p>

<p>Ah! Una cosita, si en algún momento quieres ver lo que está haciendo el kernel
por detrás de plymouth, presiona &ldquo;home&rdquo; mientras butea.</p>

<p>Eso es todo. ¡Reinicia!</p>

<p>   <blockquote><p>Si no te queda bueno, al menos que te quede lindo.</p><footer><strong>Bill Gates</strong></footer></blockquote></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/5">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/3">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>

	<span id="qrcode"></span>

	<h1>Lo m&aacute;s reciente</h1>

	<ul id="recent_posts">
		
		<li class="post">
			<a href="/blog/2016/04/01/wpa2-con-freeradius/">WPA2 con freeradius</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/14/misterio-con-ethernet-foxconn/">misterio con ethernet foxconn</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/07/cargar-rvm/">cargar rvm</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/22/data-confirm-en-un-boton/">data confirm en un boton</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/20/hooks-de-pacman/">los hooks de pacman</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/01/arch-compartir-paquetes/">arch compartir paquetes</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/25/hostname-arbitrario-en-bind9/">bind9, registro arbitratio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/19/espejos-de-clamav/">espejos de clamav y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/14/clamav-en-windows/">clamav en windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/12/14/servidor-jabber-con-prosody/">servidor jabber con prosody</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/29/mc-demora-en-abrir/">mc demora en abrir</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/23/desmume-ultralento/">desmume ultralento</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/22/certificado-autofirmado/">certificado autofirmado</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/12/rc-dot-local-en-systemd/">rc.local en systemd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/las-mujeres-gordas/">las mujeres gordas</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/tls-y-ssl-en-postfix/">tls y ssl en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/20/compartir-la-wifi/">compartir la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/01/squid-transparente/">squid transparente</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/19/will-paginate/">will_paginate</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/12/date-select-en-espanol/">date_select en español</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/11/openvas-en-archlinux/">OpenVAS en Archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/anadir-verbo-a-un-scaffold/">añadir verbo a un scaffold</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/asset-pipeline-en-production/">asset pipeline en production</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/12/systemd-automount/">systemd automount</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/21/sasl-homeclub-only/">SASL homeclub only</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/19/delay-pools-de-squid/">delay pools de squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/12/rails-con-mongodb/">rails con mongodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/06/zentyal/">Zentyal</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/01/bundle/">bundle</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/12/02/welcome-aboard/">welcome aboard</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/10/28/proxy-automatico/">proxy automático</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/24/verdial-y-el-imagis/">la pena de verdial</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/05/palos-de-wordpress/">palos de wordpress</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/el-server-de-correo/">el servidor de correo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/mas-de-ocs/">más de OCS</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/15/subdesarrollo/">subdesarrollo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/11/ocs-inventory/">ocs-inventory</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/08/select-en-bootstrap/">select en bootstrap</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/05/empirico/">empíricos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/27/crear-un-chroot-con-debian/">crear un chroot con debian</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/10/autenticador-sql-en-el-proxy/">autenticador SQL en el proxy</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/postfix-entrando-en-el-baile/">postfix entrando en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/dovecot-entra-en-el-baile/">dovecot entra en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/05/02/wordpress-para-todos/">wordpress para todos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/06/squid-en-infomed/">el toten de proxies</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/04/en-la-cumbre-del-vedado/">el &#8220;calisto&#8221; garcía</a>
		</li>
		
	</ul>
	
	<span id="qrcode_bajo"></span>

</section>

<!-- muestra el qrcode si no estámos en la raiz -->
<script type="text/javascript">
if (location.pathname!='/') {

	// calcula un monto de bitcoins al azaar
   var btc=0;
   while (btc<0.0010 || btc>0.0080 ) {
      var btc=(Math.random()/100).toString().slice(0,6);
   }

	// coge el span
	var elspan=document.getElementById("qrcode");

	// métele la imágen
	elspan.innerHTML='<img class="right" src="/images/direccion.png" width="300" height="500" title="" >';

	// y ponlo en el enlace
   elspan.innerHTML='<p>Me contento con <strong>'+btc+' BTC</strong></p>'+elspan.innerHTML;

	// ponlo abajo también
   document.getElementById("qrcode_bajo").innerHTML='<br>'+elspan.innerHTML;


}
</script>



Include file &#8216;asides/googleplus.html _includes/google_analytics.html&#8217; contains invalid characters or sequencesIncluded file &#8216;asides/googleplus.html _includes/google_analytics.html&#8217; not found in _includes directory
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - låzaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'uranio-235';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>
</html>
