
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>El SysAdmin del 3er Mundo</title>
  <meta name="author" content="låzaro">

  
  <meta name="description" content="sysinfo en el motd 20/11/2016 5:13 pm | Comments Desde que lo vi en unbuntu server, había querido hacer que mi servidores
mostraran un overview en &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uranio-235.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="El SysAdmin del 3er Mundo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">El SysAdmin del 3er Mundo</a></h1>
  
    <h2>luchando contra el subdesarrollo en todos los frentes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uranio-235.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archivo</a></li>
  <li><a href="/blog/categories/rails/">Ruby on Rails</a></li>
  <li><a href="/blog/categories/destacado/">Destacado</a></li>
  <li><a href="/blog/categories/razonemos/">Razonemos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/20/sysinfo-en-el-motd/">sysinfo en el motd</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-11-20T17:13:27-05:00'><span class='date'>20/11/2016</span> <span class='time'>5:13 pm</span></time>
        
           | <a href="/blog/2016/11/20/sysinfo-en-el-motd/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2016/11/20/sysinfo-en-el-motd/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/sysinfo.png" width="400" height="500" title="" ></p>

<p>Desde que lo vi en unbuntu server, había querido hacer que mi servidores
mostraran un overview en el <a href="https://en.wikipedia.org/wiki/Motd_(Unix">MOTD</a>)</p>

<p>Al menos debian, tiene una manera de cambiar el MOTD dinamicamente. Para sazonar
bien el MOTD, vamos a usar figlet, una aplicación que genera letras en ascii-art a
partir de una palabra dada.</p>

<figure class='code'><figcaption><span>&#8220;instalando todo&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install figlet
</span></code></pre></td></tr></table></div></figure>


<p>El directorio <strong>/etc/update-motd.d/</strong> ejecutará en orden alfabético (o numérico
en nuestro caso) aquellos script cuya salida estandard, compondrán nuestro MOTD.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando el update-motd.d&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir /etc/update-motd.d/
</span><span class='line'><span class="nb">cd</span> /etc/update-motd.d/
</span><span class='line'>touch 00-header <span class="o">&amp;&amp;</span> touch 10-sysinfo <span class="o">&amp;&amp;</span> touch 90-footer
</span><span class='line'>chmod +x /etc/update-motd.d/*
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente, nos echamos el MOTD de debian por defecto; que no deja de
restregarnos en cara la falta de garantía.</p>

<p>Además, el fichero <strong>/var/run/motd</strong> contendrá nuestro motd resultante, así que
lo lincamos con el que borramos.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando el update-motd.d&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rm /etc/motd
</span><span class='line'>ln -s /var/run/motd /etc/motd
</span></code></pre></td></tr></table></div></figure>


<p>Por una cuestión de organización, usaremos 3 ficheros:</p>

<p><strong>00-header</strong> con lo que queremos poner primero. En este caso, el nombre y
version de la distribución, además de un mensajito de bienvenida.</p>

<figure class='code'><figcaption><span>&#8220;00-header&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="o">[</span> -r /etc/lsb-release <span class="o">]</span> <span class="o">&amp;&amp;</span> . /etc/lsb-release
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$DISTRIB_DESCRIPTION&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -x /usr/bin/lsb_release <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>        <span class="nv">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="k">$(</span>lsb_release -s -d<span class="k">)</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>figlet <span class="k">$(</span>hostname<span class="k">)</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;\n&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Welcome to %s (%s).\n&quot;</span> <span class="s2">&quot;$DISTRIB_DESCRIPTION&quot;</span> <span class="s2">&quot;$(uname -r)&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yo instalo los sistemas en inglés, así que para mantener todo parejo, escribimos
<em>güelcome</em> y lo hacemos con <strong>printf</strong> para procesar mejor los &ldquo;\n&rdquo; y que pinche
sin importar la shell que se esté usando.</p>

<p>El segundo fichero será <strong>01-sysinfo</strong> y contendrá la parte linda, de la memoria
RAM en uso, el CPU, la carga y la dirección ip de la primera interfaz.</p>

<p>Este script lo copié por ahí, ni me acuerdo donde, no em gusta que usa
<strong>ifconfig</strong>, ya lo modificaré con más calma.</p>

<figure class='code'><figcaption><span>&#8220;01-sysinfo&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">date</span><span class="o">=</span><span class="sb">`</span>date<span class="sb">`</span>
</span><span class='line'><span class="nv">load</span><span class="o">=</span><span class="sb">`</span>cat /proc/loadavg <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">root_usage</span><span class="o">=</span><span class="sb">`</span>df -h / <span class="p">|</span> awk <span class="s1">&#39;/\// {print $(NF-1)}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">memory_usage</span><span class="o">=</span><span class="sb">`</span>free -m <span class="p">|</span> awk <span class="s1">&#39;/Mem:/ { total=$2 } /buffers\/cache/ { used=$3 } END { printf(&quot;%3.1f%%&quot;, used/total*100)}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">swap_usage</span><span class="o">=</span><span class="sb">`</span>free -m <span class="p">|</span> awk <span class="s1">&#39;/Swap/ { printf(&quot;%3.1f%%&quot;, &quot;exit !$2;$3/$2*100&quot;) }&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">users</span><span class="o">=</span><span class="sb">`</span>users <span class="p">|</span> wc -w<span class="sb">`</span>
</span><span class='line'><span class="nb">time</span><span class="o">=</span><span class="sb">`</span>uptime <span class="p">|</span> grep -ohe <span class="s1">&#39;up .*&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/,/\ hours/g&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{ printf $2&quot; &quot;$3 }&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">processes</span><span class="o">=</span><span class="sb">`</span>ps aux <span class="p">|</span> wc -l<span class="sb">`</span>
</span><span class='line'><span class="nv">ip</span><span class="o">=</span><span class="sb">`</span>ifconfig <span class="k">$(</span>route <span class="p">|</span> grep default <span class="p">|</span> awk <span class="s1">&#39;{ print $8 }&#39;</span><span class="k">)</span> <span class="p">|</span> grep <span class="s2">&quot;inet addr&quot;</span> <span class="p">|</span> awk -F: <span class="s1">&#39;{print $2}&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;System information as of: $date&quot;</span>
</span><span class='line'><span class="nb">echo</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;System load:\t%s\tIP Address:\t%s\n&quot;</span> <span class="nv">$load</span> <span class="nv">$ip</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Memory usage:\t%s\tSystem uptime:\t%s\n&quot;</span> <span class="nv">$memory_usage</span> <span class="s2">&quot;$time&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Usage on /:\t%s\tSwap usage:\t%s\n&quot;</span> <span class="nv">$root_usage</span> <span class="nv">$swap_usage</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Local Users:\t%s\tProcesses:\t%s\n&quot;</span> <span class="nv">$users</span> <span class="nv">$processes</span>
</span><span class='line'><span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por último <strong>02-footer</strong> será la parte de abajo. Contendrá cualquier cosa que
quieras poner en el fichero <strong>/etc/modt.tail</strong> por ejemplo, una anotación que
quieras hacer específica para ese servidor. Se mostrará si existe el fichero.</p>

<figure class='code'><figcaption><span>&#8220;02-footer&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="o">[</span> -f /etc/motd.tail <span class="o">]</span> <span class="o">&amp;&amp;</span> cat /etc/motd.tail <span class="o">||</span> <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.04 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/14/openvpn-user-plus-pass/">openvpn user+pass</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-11-14T21:41:05-05:00'><span class='date'>14/11/2016</span> <span class='time'>9:41 pm</span></time>
        
           | <a href="/blog/2016/11/14/openvpn-user-plus-pass/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2016/11/14/openvpn-user-plus-pass/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Si bien, openvpn con una llave estática es algo bastante sencillo de configurar;
tiene un grave problema: Que solo un cliente puede conectarse a la vez. En un
escenario donde por ejemplo, queremos crear una vpn para múltiples servidores
que deben conectarse, usar un clave estática se vuelve un problema. Una
topología de anillo podría ayudarnos resolverlo, pero cada servidor debería ser
cliente y servidor a la vez. Una VPN autenticada por usuario y contraseña
resuelve el problema de la manera más simplificada posible.</p>

<p>Creamos la infraestructura de certificados:</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando easy-rsa&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>mkdir Downloads/vpn
</span><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span><span class="nb">cd </span>Downloads/vpn
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r /etc/easy-rsa/* ./
</span></code></pre></td></tr></table></div></figure>


<p>Si quieres, si te da la mariconería, edita los parámetros del fichero que acabas
de copiar, pa que pongas los parámetros bonitillos, si no, espera a que openssl
los pregunte; a lo mejor ni los pregunta.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionamiento de certificados&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa init-pki
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa build-ca nopass
</span></code></pre></td></tr></table></div></figure>


<p>Note que la cadena de texto <strong>tuservidor</strong> debe ser remplazada por el nombre de
tu actor asiático preferido o, por algún nombre de tu agrado para el servidor.</p>

<figure class='code'><figcaption><span>&#8220;creando el certificado del servidor&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa build-server-full tuservidor nopass
</span></code></pre></td></tr></table></div></figure>


<p>Ahora el <a href="https://es.wikipedia.org/wiki/Diffie-Hellman">Diffie Hellman</a>, MUY
importante. Ponte cómodo que va pa largo:</p>

<figure class='code'><figcaption><span>&#8220;creando el diffie hellman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa gen-dh
</span></code></pre></td></tr></table></div></figure>


<p>Tiramos todo eso para /etc/openvpn en un directorio que designaremos con el
nombre de &ldquo;servidor&rdquo; (por una cuestión de orden).</p>

<figure class='code'><figcaption><span>&#8220;/etc/openvpn/&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>mkdir /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp pki/ca.crt /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp pki/dh.pem /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r pki/private/*.* /etc/openvpn/servidor/
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r pki/issued/tuservidor.* /etc/openvpn/servidor/
</span></code></pre></td></tr></table></div></figure>


<p>Ya tenemos todo listo pa armar el muñeco. Ahora vamos a crear la configuración
del servidor. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;servidor.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span><span class="nb">cd</span> /etc/openvpn/
</span><span class='line'><span class="o">[</span>lazaro@artema openvpn<span class="o">]</span><span class="nv">$ </span>cat servidor.conf
</span><span class='line'><span class="c"># como y por donde escuhan</span>
</span><span class='line'>port 1194
</span><span class='line'>proto udp
</span><span class='line'>dev tun
</span><span class='line'>
</span><span class='line'><span class="c"># los certificados</span>
</span><span class='line'>ca /etc/openvpn/servidor/ca.crt
</span><span class='line'>cert  /etc/openvpn/servidor/tuservidor.crt
</span><span class='line'>key /etc/openvpn/servidor/tuservidor.key
</span><span class='line'>
</span><span class='line'><span class="c"># el diffie hellman</span>
</span><span class='line'>dh /etc/openvpn/servidor/dh.pem
</span><span class='line'>
</span><span class='line'><span class="c"># la red que vamos a operar</span>
</span><span class='line'>server 10.8.0.0 255.255.255.0
</span><span class='line'>
</span><span class='line'><span class="c"># manda un ping cada 10 segundos</span>
</span><span class='line'><span class="c"># y tumba el tunel si a los 120 no hay respuesta</span>
</span><span class='line'>keepalive <span class="m">10</span> 120
</span><span class='line'>
</span><span class='line'><span class="c"># usa la compresión lzo</span>
</span><span class='line'>comp-lzo
</span><span class='line'>
</span><span class='line'><span class="c"># opera con los siguientes privilegios</span>
</span><span class='line'><span class="c">#user nobody</span>
</span><span class='line'><span class="c">#group nogroup</span>
</span><span class='line'>
</span><span class='line'><span class="c"># esto es para reforzarlo</span>
</span><span class='line'>persist-key
</span><span class='line'>persist-tun
</span><span class='line'>
</span><span class='line'><span class="c"># que tan elocuente será</span>
</span><span class='line'>verb 3
</span><span class='line'>
</span><span class='line'><span class="c"># mándale estos parámetros al cliente</span>
</span><span class='line'>push <span class="s2">&quot;redirect-gateway def1&quot;</span>
</span><span class='line'>push <span class="s2">&quot;dhcp-option DNS 8.8.8.8&quot;</span>
</span><span class='line'>push <span class="s2">&quot;dhcp-option DNS 8.8.4.4&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># y he aquí el truco de la autenticación</span>
</span><span class='line'>plugin /usr/lib/openvpn/plugins/openvpn-plugin-auth-pam.so login
</span><span class='line'>client-cert-not-required
</span><span class='line'>username-as-common-name
</span></code></pre></td></tr></table></div></figure>


<p>Con eso tenemos el servidor pinchando. Ahora vamos a hacer un fichero <strong>.ovpn</strong>
genérico, para dar a entender como sería la configuración de nuestro cliente.</p>

<p><strong>OJO</strong> El certificado que se le dará al cliente será el <strong>ca.crt</strong></p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;cliente.ovpn&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema openvpn<span class="o">]</span><span class="nv">$ </span>cat tuservidor.ovpn
</span><span class='line'>client
</span><span class='line'>dev tun
</span><span class='line'>proto udp
</span><span class='line'>remote 192.168.0.1 1194
</span><span class='line'>remote-cert-tls server
</span><span class='line'>auth-user-pass ~/autenticacion.conf
</span><span class='line'>comp-lzo
</span><span class='line'>&lt;ca&gt;
</span><span class='line'>-----BEGIN CERTIFICATE-----
</span><span class='line'>Lorem ipsum ad his scripta blandit partiendo, eum fastidii
</span><span class='line'>accumsan euripidis in, eum liber hendrerit an. Qui ut wisi
</span><span class='line'>vocibus suscipiantur, quo dicit ridens inciderint id. Quo mundi
</span><span class='line'>lobortis reformidans eu, legimus senserit definiebas an eos. Eu
</span><span class='line'>sit tincidunt incorrupte definitionem, vis mutat affert
</span><span class='line'>percipit cu, eirmod consectetuer signiferumque eu per. In usu
</span><span class='line'>latine equidem dolores. Quo no falli viris intellegam, ut fugit
</span><span class='line'>veritus placerat per.  Ius id vidit volumus mandamus, vide
</span><span class='line'>veritus democritum te nec, ei eos debet libris consulatu. No
</span><span class='line'>mei ferri graeco dicunt, ad cum veri accommodare. Sed at malis
</span><span class='line'>omnesque delicata, usu et iusto zzril meliore. Dicunt maiorum
</span><span class='line'>eloquentiam cum cu, sit summo dolor essent te. Ne quodsi
</span><span class='line'>nusquam legendos has, ea dicit voluptua eloquentiam pro, ad sit
</span><span class='line'>quas qualisque. Eos vocibus deserunt quaestio ei.
</span><span class='line'>-----END CERTIFICATE-----
</span><span class='line'>&lt;/ca&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Cada cliente de OpenVPN tiene su librito&hellip; Pero ese .ovpn genérico, debe ser
capaz de ser importado sin problema.</p>

<p>Por una cuestión de orden y seguridad, yo borro la base con la que se creó todo:</p>

<figure class='code'><figcaption><span>&#8221;&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>rm -rf Downloads/vpn
</span></code></pre></td></tr></table></div></figure>


<p>Por cierto, cada configuración que pongas en <strong>/etc/openvpn</strong> cuya extensión
sea <strong>.conf</strong> se puede echar a andar con systemd.</p>

<figure class='code'><figcaption><span>&#8220;systemctl</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># systemctl status openvpn@servidor</span>
</span><span class='line'>● openvpn@servidor.service - OpenVPN connection to servidor
</span><span class='line'>   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/openvpn@.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
</span><span class='line'>   Active: inactive <span class="o">(</span>dead<span class="o">)</span>
</span><span class='line'>     Docs: man:openvpn<span class="o">(</span>8<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># file /etc/openvpn/servidor.conf </span>
</span><span class='line'>/etc/openvpn/servidor.conf: UTF-8 Unicode text
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.04 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/22/el-domain-pop/">recolección DomainPOP</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-22T22:44:36-04:00'><span class='date'>22/10/2016</span> <span class='time'>10:44 pm</span></time>
        
           | <a href="/blog/2016/10/22/el-domain-pop/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2016/10/22/el-domain-pop/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Esta entrada ha sido copiada de mi antiguo blog <a href="http://otherlinuxblog.blogspot.com">puheroska</a>.
Vale aclarar que la escribí en el 2012&hellip;</p>

<p>Se sabe poco sobre los orígenes de ese aborto de la naturaleza que es conocido
por algunos como &ldquo;recolección aPOP&rdquo; o por otros como &ldquo;DomainPOP&rdquo;.</p>

<p><img class="right" src="/images/apartado_postal.jpg" width="200" height="300" title="" ></p>

<p>Haciendo referencia al hecho de bajar todo el correo para un dominio de un pop
remoto. Muchos seguron lo identifican con un popular, potente y hermoso servidor
de correo, para windows llamado MDeamon (pronunciado por algunos como
&ldquo;emodimons&rdquo; y por otro como &ldquo;emdaimons&rdquo;). Muy conocido por su simple pero
elegante cliente web, el World Client. Entre sus <em>features</em>, podemos ver el
almacenamiento de TODO el correo de un dominio en un mismo buzón. Esto, sumado a
que en cuba todo el software es gratis :D lo convirtió en la herramienta
definitiva para las redes conmutadas.</p>

<p>Por otra parte, no todo se le impugna windows. Cuando aún el morro era de palo y
los cañones tiraban taquitos; ya citmatel usaba un CuciPOP (vean que clase de
nombre &ldquo;Cubic Circles = CuCiPOP&rdquo;) para depositar el correo de sus clientes por
lineas conmutadas; una clara implementación de aPOP. Esto resolvió ser la manera
mas burda pero eficiente para resolver el problema del correo en lineas
conmutadas.</p>

<p>Lo único que perturba este barato panorama, es el hecho de que si el correo
no tiene un To: bien claro, se jode todo y te ves obligado a usar MDeamon, que
en ese aspecto se saca todos los premios. Por su puesto, él es una de
la principales implementaciones de este modelo.</p>

<p>A menudo nos encontramos con que al bajar el correo con fetchmail, uno o varios
correos no van a su destino, y, por el contrario, van al postmaster sin tener
coincidencias de usuarios locales.</p>

<p>Hay quien esta acostumbrado a que el postmaster este LLENO de correos y eso
le parece normal, cuando el buen funcionamiento de un servidor, se mide por el
postmaster vacío.</p>

<p>Si un correo tiene un To: o un Cc: fetchmail lo parsea (del infintivo &ldquo;parsear&rdquo;)
y localiza una dirección de nuestro dominio basándose en que tiene el dominio en
la configuración. Como le dijimos &lsquo;is * here&rsquo; buscará cual nombre que este
delante de lo que se parezca a nuestro dominio y lo entregara.</p>

<p>Pero: Qué pasa si el To: o el Cc: NO tienen una dirección de nuestro dominio?</p>

<p>Supongamos que el correo viene Bcc: (blink carbon copy)</p>

<p>Como por ejemplo, los correos de listas de distribuciones, etc&hellip; En ese caso
los destinos se especifican en la orden RCPTO durante la sesión SMTP. Algunos
servidores incluyen encabezados como: &ldquo;Delivery-To&rdquo;,&ldquo;Envelope-To&rdquo; o
&ldquo;X-Orignial-To&rdquo; En mi opinión todos están de más, porque el Received: tiene esta
información; pero bueno, podríamos decirle a fetchmail que ademas de esos,
parsee encabezados Received: Eso parecería una solución, el único problema es
que no pincha :-P</p>

<h4>Hasta aquí la entrada de puheroska.</h4>

<p>En aquel momento consideraba eso &ldquo;un problema sin solución&rdquo;</p>

<p>Cuando llegué a salud, me encontré nuevamente con los DomainPOP, pero <strong>por
suerte</strong>, los exim de infomed hacen bien esa pincha y dejan plasmado el
destinatario en un encabezado &ldquo;Envelope-To&rdquo;</p>

<p>He aquí el fetchmailrc que tengo en el calixto:</p>

<figure class='code'><figcaption><span>&#8220;/etc/fetchmailrc&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Fichero de configuración de fethcmail, adecuado para los MultiPOP de infomed</span>
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>daemon 60
</span><span class='line'><span class="nb">set </span>postmaster <span class="s2">&quot;root&quot;</span>
</span><span class='line'><span class="nb">set </span>no bouncemail
</span><span class='line'><span class="nb">set </span>no spambounce
</span><span class='line'><span class="nb">set </span>logfile .fetchmail.log
</span><span class='line'><span class="nb">set </span>no syslog
</span><span class='line'>
</span><span class='line'>defaults
</span><span class='line'>    timeout 10
</span><span class='line'>    no keep
</span><span class='line'>    fetchall
</span><span class='line'>    expunge 5
</span><span class='line'>    dropstatus
</span><span class='line'>
</span><span class='line'>poll multipop.sld.cu port <span class="m">110</span> protocol pop3 localdomains tudominio.sld.cu
</span><span class='line'>    envelope <span class="m">1</span> <span class="s2">&quot;Envelope-to:&quot;</span>
</span><span class='line'>    no dns
</span><span class='line'>    username tuusuario
</span><span class='line'>    password tupassword
</span><span class='line'>    to * here
</span><span class='line'>    limitflush
</span><span class='line'>    smtphost localhost
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.08 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/22/domainpop-con-postfix/">domainpop con postfix</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-22T17:35:46-04:00'><span class='date'>22/10/2016</span> <span class='time'>5:35 pm</span></time>
        
           | <a href="/blog/2016/10/22/domainpop-con-postfix/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2016/10/22/domainpop-con-postfix/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Otra importante entrada que decidí migrar de <a href="http://otherlinuxblog.blogspot.com">puheroska</a></p>

<p>Es tan sencillo como crear un dominio virtual y asignarle usuarios reales. Para
no volverte loco pon el nombre del usaurio igual que el del dominoio.</p>

<p>Por ejemplo, crea dos usuarios, uno llamado <em>subdom</em> y un segndo llamado <em>otro</em>.
Luego crea el fichero /etc/postfix/virtual y ponle esto:</p>

<figure class='code'><figcaption><span>&#8220;/etc/postfix/virtual&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>@subdom.tudomionio.cu   subdom
</span><span class='line'>@otro.tudominio.cu      otro
</span></code></pre></td></tr></table></div></figure>


<p><strong>postmap</strong> que tú conoces y <strong>postfix reload</strong></p>

<figure class='code'><figcaption><span>&#8220;postmap&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>postmap /etc/postfix/virtual
</span><span class='line'>postfix reload
</span></code></pre></td></tr></table></div></figure>


<p>Ya hemos declarado que <em>subdom</em> y <em>otro</em>, serán usuarios y que todo lo que se envíe
a los dominios virtuales @otro.tudominio.cu será almacenado en /var/mail/otro</p>

<p>Finalmente en el /etc/main.cf pones:</p>

<figure class='code'><figcaption><span>&#8220;/etc/postfix/main.cf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">virtual_alias_domains</span> <span class="o">=</span> subdom.tudominio.cu otro.tudominio.cu
</span><span class='line'><span class="nv">virtual_alias_maps</span> <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/virtual
</span></code></pre></td></tr></table></div></figure>


<p>OJO no olvides que en <strong>mydestination</strong> y debes incluir ambos dominios virtuales.</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.07 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/22/tunel-6in4/">túnel 6in4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-22T03:18:11-04:00'><span class='date'>22/10/2016</span> <span class='time'>3:18 am</span></time>
        
           | <a href="/blog/2016/10/22/tunel-6in4/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2016/10/22/tunel-6in4/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Típico: Quiero darle cumplimiento a la resolución 185/2016, pero mi proveedor
no me ha dado una ipv6</p>

<p>¿Tienes una ipv4 pública? Felicidades, puedes jugar con ipv6</p>

<p>Existe una tecnología transisional poco recomendada que se conoce como <a href="https://es.wikipedia.org/wiki/6to4?">6in4</a>,
consiste en levantar un túnel especial que te permite hacerte con un rango ipv6
pa jugar y comer mierda, porque no es ipv6 puro. Supuestamente internet debe
tener servididores que hagan relay hacia ipv6 real pero hoy en día son cada vez
menos.</p>

<p>y ahora un mensaje:</p>

<p>Si bien <em>Hurricane Electric</em> provee <a href="http://tunnelbroker.net/">túneles</a>, siendo
esto una solución PERFECTA; hay que tener en cuenta que: No se con que cuchara
etecsa se coma eso.</p>

<p>Pero volviendo al tema:</p>

<p>Las grandes redes dual-stack como google y facebook, tiene sus 6in4 bien
afinaditos, así que a través de un 6in4 puedes perfectamente llegar a ellos.
En otros tiempo, esta solución me pinchó finísimo pero recientemente no la he
probado.</p>

<p>Digamos que tu ip pública es <strong>220.110.12.190</strong> Calculamos la ipv6 que te toca:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>   ipv6calc --quiet --action conv6to4 220.110.12.190
</span><span class='line'>2002:dc6e:cbe::
</span></code></pre></td></tr></table></div></figure>


<p>Digamos que devolvió el prefijo <strong>2002:dc6e:cbe::</strong> Ese será nuestro prefijo, para
meter cuantas direcciones querramos.</p>

<figure class='code'><figcaption><span>&#8220;creando el túnel&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip tunnel add tun6to4 mode sit ttl <span class="m">255</span> remote any <span class="nb">local </span>10.0.0.1
</span><span class='line'>ip link <span class="nb">set </span>tun6to4 up
</span><span class='line'>ip -6 addr add 2002:dc6e:cbe::1/16 dev tun6to4
</span></code></pre></td></tr></table></div></figure>


<p>Una vez levantada la interfaze, levantamos una puerta de enlace que saque todas
las direcciones ipv6 del túnel que traduce las ipv4:</p>

<figure class='code'><figcaption><span>&#8220;ruta&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip -6 route add 2000::/3 via ::192.88.99.1 dev tun6to4 metric 1
</span></code></pre></td></tr></table></div></figure>


<p>Nota que la dirección ::192.88.99.1 es así de palo, es una ruta especial que da
lugar al túnel 6in4.</p>

<p>Ahora, asignamos la primera dirección ipv6 a la interfaz pública (eth0):</p>

<figure class='code'><figcaption><span>&#8220;ip a&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip -6 addr add 2002:dc6e:cbe::cafe/64 dev eth0
</span></code></pre></td></tr></table></div></figure>


<p>A la interfaz de la LAN (eth1) le asignamos una ip también, pero le decimos que
::cafe es la puerta de enlace predeterminada. En su momento, el servidor con
debian me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/network/interfaces&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># la asignamos a la publica una ipv6</span>
</span><span class='line'>iface eth0 inet6 static
</span><span class='line'>        address 2002:a00:1::cafe
</span><span class='line'>        netmask 64
</span><span class='line'>
</span><span class='line'><span class="c"># y la interfaz de la LAN se asignamos otra</span>
</span><span class='line'><span class="c"># pero ::cafe será la puerta de enlace</span>
</span><span class='line'>iface eth1 inet6 static
</span><span class='line'>        address 2002:a00:1:21c:c0ff:feb2:91c2
</span><span class='line'>        netmask 64
</span><span class='line'>        gateway 2002:a00:1::cafe
</span></code></pre></td></tr></table></div></figure>


<p>En la entrada anterior vimos como usar el forward y como habilitarlo.
Recuerdas?</p>
</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.07 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/22/cortafuegos-ipv6-sencillo/">cortafuegos ipv6 sencillo</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-22T02:56:00-04:00'><span class='date'>22/10/2016</span> <span class='time'>2:56 am</span></time>
        
           | <a href="/blog/2016/10/22/cortafuegos-ipv6-sencillo/#disqus_thread"
             data-disqus-identifier="http://uranio-235.github.io/blog/2016/10/22/cortafuegos-ipv6-sencillo/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>En entradas anteriores mencionábamos la necesidad urgente de un cortafuegos para
ipv6. Aquí les va uno hipotético y sencillo:</p>

<p>Sean:</p>

<ul>
<li>la red 2001:db8:: /64</li>
<li>eth0 interfaz de cara al enlace</li>
<li>eth1 interfaz de cara a la LAN</li>
<li>2001:db8::1 servidor DNS</li>
<li>2001:db8::2 servidor de correo</li>
</ul>


<figure class='code'><figcaption><span>&#8220;firewall ipv6&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># al piedra angular</span>
</span><span class='line'>ip6tables -A INPUT   -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c"># nuestro ruter no tiene ningún servicio corriendo</span>
</span><span class='line'><span class="c"># así que no permitimos nada pa adentro</span>
</span><span class='line'>ip6tables -A INPUT -j DROP
</span><span class='line'>
</span><span class='line'><span class="c"># el forward desde internet hacia la LAN va descartado</span>
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -j DROP
</span><span class='line'>
</span><span class='line'><span class="c"># permitimos que las máquinas en la LAN vean los sitios web de internet</span>
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">80</span>  -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">443</span> -j ACCEPT
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># al servidor DNS le permitimos que encueste a otros servidores dns</span>
</span><span class='line'><span class="c"># nuestro servidor dns es un servidor de cache, para la LAN. Dice:</span>
</span><span class='line'><span class="c"># lo que venga por la lan, a salir por el enlace, proveniente del servidor DNS</span>
</span><span class='line'><span class="c"># y además, cuto puerto de destino sea el 53, permítelo</span>
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p udp --dport <span class="m">53</span> -s 2001:db8::01 -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">53</span> -s 2001:db8::01 -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c"># permitimos que el servidor de correo sea visible desde afuera</span>
</span><span class='line'><span class="c"># lo que venga, de afuera, pa adentro, protocolo tcp del puerto tal</span>
</span><span class='line'><span class="c"># y como destino sea la ip del servidor de correo, permítelo</span>
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -p tcp --dport <span class="m">25</span>  -d 2001:db8::2 -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -p tcp --dport <span class="m">80</span>  -d 2001:db8::2 -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -p tcp --dport <span class="m">110</span> -d 2001:db8::2 -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c"># el resto del tráfico proveniente de la LAN hacia internet, le hacemos reject</span>
</span><span class='line'><span class="c"># esto evita que los teléfonos no se queden locos intentando buscar salida</span>
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -j REJECT
</span><span class='line'>
</span><span class='line'><span class="c"># el resto del tráfico que venga de internet, le hacemos DROP</span>
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -j DROP
</span><span class='line'>
</span><span class='line'><span class="c"># habilita el forward</span>
</span><span class='line'>sysctl net.ipv6.conf.all.forwarding<span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


<p>Si este art&iacute;culo te result&oacute; interesante, considere donar 0.09 BTC: <a href="/images/direccion.png">1Kg4gu3e7u8HUw8bj5NbBciRg6Y56kuFCU</a> </p>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>

	<h1>Lo m&aacute;s reciente</h1>

	<ul id="recent_posts">
		
		<li class="post">
			<a href="/blog/2016/11/20/sysinfo-en-el-motd/">sysinfo en el motd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/11/14/openvpn-user-plus-pass/">openvpn user+pass</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/el-domain-pop/">recolección DomainPOP</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/domainpop-con-postfix/">domainpop con postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/tunel-6in4/">túnel 6in4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/cortafuegos-ipv6-sencillo/">cortafuegos ipv6 sencillo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/poniendo-direcciones-ipv6/">las reglas del juego ipv6</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/22/ipv6/">la resolución 185/2016</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/10/04/dirver-broadcom/">driver broadcom</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/09/22/audifonos-blutu/">audífonos blutú</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/09/16/dispatcher-script/">dispatcher script</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/08/16/password-de-windows/">password de windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/08/15/repositorio-de-iso-en-xen/">Local ISO en xen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/31/kiwix-como-servicio/">kiwix como servicio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/17/hibernar-en-archlinux/">hibernar en archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/07/17/rsync-basico/">rsync básico</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/20/correos-del-cron/">correos del cron</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/18/dkim-y-spf-en-postfix/">dkim y spf en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/06/06/desacelerar-mouse/">desacelerar mouse</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/05/12/deshabilitar-historial-de-bash/">deshabilitar historial de bash</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/04/29/reparar-archivos-de-innodb/">reparar archivos de innodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/04/01/wpa2-con-freeradius/">WPA2 con freeradius</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/14/misterio-con-ethernet-foxconn/">misterio con ethernet foxconn</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/03/07/cargar-rvm/">cargar rvm</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/22/data-confirm-en-un-boton/">data confirm en un boton</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/20/hooks-de-pacman/">los hooks de pacman</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/02/01/arch-compartir-paquetes/">arch compartir paquetes</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/25/hostname-arbitrario-en-bind9/">bind9, registro arbitratio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/19/espejos-de-clamav/">espejos de clamav y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2016/01/14/clamav-en-windows/">clamav en windows</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/12/14/servidor-jabber-con-prosody/">servidor jabber con prosody</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/29/mc-demora-en-abrir/">mc demora en abrir</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/23/desmume-ultralento/">desmume ultralento</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/22/certificado-autofirmado/">certificado autofirmado</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/12/rc-dot-local-en-systemd/">rc.local en systemd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/las-mujeres-gordas/">las mujeres gordas</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/11/03/tls-y-ssl-en-postfix/">tls y ssl en postfix</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/20/compartir-la-wifi/">compartir la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/18/systemd-timesyncd/">systemd-timesyncd</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/16/palo-con-la-wifi/">palo con la wifi</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/15/repo-de-fdroid/">repo de fdroid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/08/prawn-pdf-con-ruby/">prawn, pdf con ruby</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/10/05/assets-por-controlador/">assets por controlador</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/17/dhcp-por-grupos/">dhcp por grupos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/10/plymouth-boot-screen/">plymouth boot screen</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/git-clone-rapido/">git clone rápido</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/07/archlinux-dos-kernel/">archlinux con dos kernel</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/09/01/squid-transparente/">squid transparente</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/08/28/compute-remote-uptime/">compute remote uptime</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/19/will-paginate/">will_paginate</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/12/date-select-en-espanol/">date_select en español</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/11/openvas-en-archlinux/">OpenVAS en Archlinux</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/anadir-verbo-a-un-scaffold/">añadir verbo a un scaffold</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/07/05/asset-pipeline-en-production/">asset pipeline en production</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/30/bootstrap-en-rails-4/">bootstrap en rails 4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/14/revocar-certificados-de-ovpn/">revocar certificados de OVPN</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/12/systemd-automount/">systemd automount</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/07/openvpn-en-arch/">OpenVPN en Arch</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/03/transando-a-ext4/">transando a ext4</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/06/01/pacman-bajo-el-microscopio/">pacman bajo el microscopio</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/28/cambiar-user-agent-en-squid/">cambiar user agent con squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/26/nic-bonding/">NIC bonding</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/05/23/ltsp-en-debian8-y-salud/">ltsp en debian8 y salud</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/22/rails-sin-turbolink/">rails sin turbolinks</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/21/sasl-homeclub-only/">SASL homeclub only</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/19/delay-pools-de-squid/">delay pools de squid</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/12/rails-con-mongodb/">rails con mongodb</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/06/zentyal/">Zentyal</a>
		</li>
		
		<li class="post">
			<a href="/blog/2015/02/01/bundle/">bundle</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/12/02/welcome-aboard/">welcome aboard</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/10/28/proxy-automatico/">proxy automático</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/24/verdial-y-el-imagis/">la pena de verdial</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/09/05/palos-de-wordpress/">palos de wordpress</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/el-server-de-correo/">el servidor de correo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/25/mas-de-ocs/">más de OCS</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/15/subdesarrollo/">subdesarrollo</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/08/11/ocs-inventory/">ocs-inventory</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/08/select-en-bootstrap/">select en bootstrap</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/07/05/empirico/">empíricos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/27/crear-un-chroot-con-debian/">crear un chroot con debian</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/10/autenticador-sql-en-el-proxy/">autenticador SQL en el proxy</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/postfix-entrando-en-el-baile/">postfix entrando en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/06/09/dovecot-entra-en-el-baile/">dovecot entra en el baile</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/05/02/wordpress-para-todos/">wordpress para todos</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/06/squid-en-infomed/">el toten de proxies</a>
		</li>
		
		<li class="post">
			<a href="/blog/2014/04/04/en-la-cumbre-del-vedado/">el &#8220;calisto&#8221; garcía</a>
		</li>
		
	</ul>
	
</section>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - låzaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'uranio-235';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68987437-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>
</html>
