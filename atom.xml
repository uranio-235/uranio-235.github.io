<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[El SysAdmin del 3er Mundo]]></title>
  <link href="http://uranio-235.github.io/atom.xml" rel="self"/>
  <link href="http://uranio-235.github.io/"/>
  <updated>2017-02-16T20:14:53-05:00</updated>
  <id>http://uranio-235.github.io/</id>
  <author>
    <name><![CDATA[låzaro]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[a las puertas del 3g]]></title>
    <link href="http://uranio-235.github.io/blog/2017/02/05/a-las-puertas-del-3g/"/>
    <updated>2017-02-05T21:24:40-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/02/05/a-las-puertas-del-3g</id>
    <content type="html"><![CDATA[<p>Oficialmente, han anunciado en la mesa redonda que se proveerá internet por 3G.</p>

<p>La noticia me impactó bastante y supongo que todo el que se haga llamar
&ldquo;administrador de red&rdquo; (en Cuba) se halla sentido conmovido.</p>

<p>A partir de ese día no llevaremos más sobre nuestros hombros la ardua tarea de
proveerle internet a una sociedad desconectada. La penosa tarea de explicarle a
los usuarios porque fulano sí y tú no. Con ello, nuestra importancia actual en
marcos laborales; se verá considerablemente reducida. Ya no seremos las
fantásticas criaturas con acceso a internet, si no, un simple operario más (como
somos en el mundo entero). Imagino (y espero) que los proxy pasen a ser una
segunda prioridad. El uso de internet en las empresas, por fin, será para
aquello que realmente fue concebido y no para proveerle facebook a cuatro vacas
sagradas.</p>

<p>La introducción de la 3G en cuba, será un cambio. Todos debemos estar preparados
para afrontar este cambio; no solo desde el punto de vista tecnológico, si no
también social y psicológico. Si dios quiere y todo sale a pedir de boca,
caeremos de sopetón y recién llegados; a un mundo donde el internet, ya es algo
cotidiano. Todos NO están preparados para esto, en especial, aquellos que tienen
canas y teléfonos modernos.</p>

<p>Si bien, las tarifas siguen siendo un misterio por resolver, este es un momento
en que no hay lugar para el pesimismo. Nuestro país está haciendo un esfuerzo
sin precedentes (al menos en ese aspecto) y nosotros, esperamos lo mejor. Hay
mucho optimismo y la gente habla del tema con brillo en lo ojos. Esperamos que
esto se materialize y no se convierta en un vaporware. Por otra parte, muchas
personas tienen la expectativa muy alta; en especial aquellas que han viajado y
conocen el 4g. Esto podría dar lugar a disgustos y desilusiones en aquellas
personas que como ya dije &ldquo;tienen las expectativas muy altas&rdquo;. Yo solo espero,
poder tener internet en mi bolsillo con el salario que me gano.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[dns con vistas]]></title>
    <link href="http://uranio-235.github.io/blog/2017/02/05/dns-con-vistas/"/>
    <updated>2017-02-05T18:57:26-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/02/05/dns-con-vistas</id>
    <content type="html"><![CDATA[<p>Que lindo corre bind9 en alpine linux. Ahora que mis servidores están todo en el
pool de xenserver (los reyes magos me trajeron un servidor pro) tengo un nuevo
problema. Dentro de la red interna de xen, los servidores tienen una ip
distinta. Por ejemplo, para todo el mundo, el alpine linux que hace de router,
es 192.168.0.1, pero para los servidores, es 169.254.0.10</p>

<p>Además, el forward para infomed, es un privilegio que solo los servidores
tienen. Por tanto, lo más seguro, será usar una zona para la LAN y otra para la
red interna del pool.</p>

<p>Esto me recuerda las DMZ, pero no es lo mismo, porque no estoy creando cuellos
de botella. La red interna del pool es una vif, que funciona sin emitir
tráfico real por alguna pif.</p>

<figure class='code'><figcaption><span>&#8220;/etc/bind/named.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// vim:set <span class="nv">ts</span><span class="o">=</span><span class="m">4</span> <span class="nv">sw</span><span class="o">=</span><span class="m">4</span> et:
</span><span class='line'>
</span><span class='line'>options <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>   directory <span class="s2">&quot;/etc/bind/&quot;</span><span class="p">;</span>
</span><span class='line'>   pid-file <span class="s2">&quot;/run/named/named.pid&quot;</span><span class="p">;</span>
</span><span class='line'>   listen-on-v6 <span class="o">{</span> none<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span><span class='line'>   listen-on <span class="o">{</span> 169.254.0.0/16<span class="p">;</span> localhost<span class="p">;</span> 192.168.1.0/24<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span><span class='line'>   allow-transfer <span class="o">{</span> none<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span><span class='line'>   allow-update <span class="o">{</span> none<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span><span class='line'>   version none<span class="p">;</span>
</span><span class='line'>   hostname none<span class="p">;</span>
</span><span class='line'>   server-id none<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   // los servidores hacen recursion
</span><span class='line'>   allow-recursion <span class="o">{</span> 169.254.0.0/16<span class="p">;</span> localhost<span class="p">;</span><span class="o">}</span><span class="p">;</span>
</span><span class='line'>   recursion yes<span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>view lan  <span class="o">{</span> // la red LAN
</span><span class='line'>
</span><span class='line'>   match-clients <span class="o">{</span>192.168.1.0/24<span class="p">;</span><span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;localhost&quot;</span> IN <span class="o">{</span>
</span><span class='line'>      <span class="nb">type </span>master<span class="p">;</span>
</span><span class='line'>      file <span class="s2">&quot;localhost.zone&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;hcg.sld.cu&quot;</span> IN <span class="o">{</span>
</span><span class='line'>      <span class="nb">type </span>master<span class="p">;</span>
</span><span class='line'>      file <span class="s2">&quot;hcg.zone&quot;</span><span class="p">;</span>
</span><span class='line'>      notify no<span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;.&quot;</span> <span class="o">{</span>
</span><span class='line'>      <span class="nb">type </span>master<span class="p">;</span>
</span><span class='line'>      file <span class="s2">&quot;fakeroot.zone&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span><span class="p">;</span> // view lan
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>view xen <span class="o">{</span> // la red interna de XenServer
</span><span class='line'>
</span><span class='line'>   match-clients <span class="o">{</span>169.254.0.0/16<span class="p">;</span> localhost<span class="p">;</span><span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;localhost&quot;</span> IN <span class="o">{</span>
</span><span class='line'>      <span class="nb">type </span>master<span class="p">;</span>
</span><span class='line'>      file <span class="s2">&quot;localhost.zone&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;xen&quot;</span> IN <span class="o">{</span>
</span><span class='line'>      <span class="nb">type </span>master<span class="p">;</span>
</span><span class='line'>      file <span class="s2">&quot;xen.zone&quot;</span><span class="p">;</span>
</span><span class='line'>      notify no<span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;hcg.sld.cu&quot;</span> IN <span class="o">{</span>
</span><span class='line'>      <span class="nb">type </span>master<span class="p">;</span>
</span><span class='line'>      file <span class="s2">&quot;hcg.zone&quot;</span><span class="p">;</span>
</span><span class='line'>      notify no<span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   zone <span class="s2">&quot;sld.cu&quot;</span> <span class="o">{</span>
</span><span class='line'>      forwarders <span class="o">{</span> 201.220.222.131<span class="p">;</span> 201.220.222.132<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span><span class='line'>      <span class="nb">type </span>forward<span class="p">;</span>
</span><span class='line'>      forward only<span class="p">;</span>
</span><span class='line'>   <span class="o">}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span><span class="p">;</span> // view xen
</span></code></pre></td></tr></table></div></figure>


<p>Como ven, cree el dominio &ldquo;.xen&rdquo; que solo será visible a la red interna del
pool. La zona &ldquo;hcg.sld.cu&rdquo; también será visible para los servidores ya que estos
tienen una pata en la LAN; a esto suele llamarse &ldquo;shared zone&rdquo; (zona
compartida). Finalmente, la zona &ldquo;sld.cu&rdquo; (debajo de hcg) es una zona forward en
la vista de la interfaz interna.</p>

<p>El host proxy.hcg.sld.cu resolverá una ip de la lan; de esta misma manera, el
host proxy.xen, resolverá la ip de dicho host, pero dentro de la red interna del
pool.</p>

<p><strong>¿y por qué?</strong></p>

<p>Por que esta menera, solo los servidores (a través de la red del pool), harán
forward. Por ejemplo, el servidor de correo, podrá enviar y recibir su correo
multipop, ya que el alpine que está haciendo como router, permite forward desde
la red del pool hacia la WAN; o sea, todos los servidores, ven a la WAN. Es
obligaría al servidor de correo, a usar el dns de infomed para resolver
direcciones de infomed y el servidor local para resolver las direcciones de la
LAN, lo cual funciona de asco. Sin embargo, la vista del pool tiene una zona
forward. Cabe destacar, que una zona forward y un fakeroot, no se por qué; hace
que ninguna pinche.</p>

<p>Sensillo y seguro.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ipfw simple y conciso]]></title>
    <link href="http://uranio-235.github.io/blog/2017/02/01/ipfw-simple-y-consiso/"/>
    <updated>2017-02-01T23:15:47-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/02/01/ipfw-simple-y-consiso</id>
    <content type="html"><![CDATA[<p>Las instrucciones para hacer un cortafuegos realmente <strong>SIMPLE</strong> y la vez
funcional (statefull firewall) con ipfw; sensillamente <em>&ldquo;no existen&rdquo;</em>, al menos
No de manera oficial. El cortafuegos ejemplificado en el handbook es bastante
complejo. Cosas como pasar los paquetes de conexiones relacionadas, hacer drop o
&ldquo;reiniciar el cortafuegos&rdquo;, no se tomaron la molestia de documentarlas &ldquo;bien&rdquo;.
Otras cosas como el filtrado por mac address, simplemente no funciona; a menos
que hagas un ritual previo que NO está documentado en el man.</p>

<p>Para empezar, el módulo debe ser cargado en el kernel, así que inicializaremos
ipfw como si fuera un demonio más del sistema. Esto quiere decir que lo
añadiremos al <strong>/etc/rc.conf</strong></p>

<figure class='code'><figcaption><span>&#8220;/etc/rc.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> <span class="nv">firewall_enable</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>
</span><span class='line'> <span class="nv">firewall_type</span><span class="o">=</span><span class="s2">&quot;/usr/local/etc/ipfw.rules&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Te recomiendo reiniciar ahora; para que todo se cargue correctamente.</p>

<p>La <a href="https://www.freebsd.org/doc/handbook/firewalls-ipfw.html">documentación oficial</a> aclara que
los firewall pueden ser (además) del tipo: open, client, simple, closed o
UNKNOWN. Sin embargo, <strong>en mi opinión</strong> estas configuraciones prefabricadas, no
son suficiente para un servidor (por ejemplo proxy).</p>

<p>Para mantener la armonía chea y anticuada de freebsd; colocamos el cortafuegos
en el /etc dentro /usr/local/. Ten en cuenta que casi todas las aplicaciones que
instales, tendrán su /etc ahí.</p>

<p>Reiniciar ipfw no es tan jamón como un usuario de iptables haría. Hacer un flush
de las reglas, significa quedarse trancado y perder la conexión por ssh. Para
reiniciar el cortafuegos, deberás tener un script que haga flush y además,
reiniciar el servicio. Este scriptsito me lo hice para la faena de toquetear el
cortafuegos</p>

<figure class='code'><figcaption><span>&#8220;/usr/local/bin/reiniciar_ipfw.sh&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/csh</span>
</span><span class='line'>service ipfw stop
</span><span class='line'>ipfw -q flush
</span><span class='line'>service ipfw start
</span><span class='line'>ipfw show
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>La documentación oficial (y otras muchas) indican que cada regla se cree
enumerada y que bebes mantener esta numeración manualmente. Sin embargo, esto no
es estrictamente necesario. Cada regla incrementará el número de una manera
automáticamente curiosa.</p>

<p>Veamos pues un <strong>ipfw.rules</strong> bien básico. La interfaz <strong>lo0</strong> es el localhost.
La interfaz xn0 es la WAN y xn1 es la LAN.</p>

<figure class='code'><figcaption><span>&#8220;ipfw.rules&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># para afuera todo</span>
</span><span class='line'>ipfw -q add allow all from any to any out
</span><span class='line'>
</span><span class='line'><span class="c"># permite todo por el localhost</span>
</span><span class='line'>ipfw -q add allow all from any to any via lo0
</span><span class='line'>
</span><span class='line'><span class="c"># las conexiones que ya estén iniciadas, tíralas</span>
</span><span class='line'>ipfw -q add allow tcp from any to any established
</span><span class='line'>
</span><span class='line'><span class="c"># permite que te hagan ping desde la LAN con la ip</span>
</span><span class='line'>ipfw -q add allow icmp from 10.1.1.0/24 to any via xn1
</span><span class='line'>
</span><span class='line'><span class="c"># permite que accedan al proxy desde la LAN</span>
</span><span class='line'>ipfw -q add allow tcp from any to any dst-port <span class="m">3128</span> via xn1
</span><span class='line'>
</span><span class='line'><span class="c"># permite el servidor web pero solo deade la WAN</span>
</span><span class='line'>ipfw -q add allow tcp from any to any dst-port <span class="m">80</span> via xn0
</span><span class='line'>
</span><span class='line'><span class="c"># descarta el resto</span>
</span><span class='line'>ipfw -q add drop all from any to any
</span></code></pre></td></tr></table></div></figure>


<p>Veamos algunas características de este cortafuegos&hellip;</p>

<p>La salida, por definición, está bloqueada. La primera regla; autoriza la salida
del tráfico.</p>

<p>Como ven, este cortafuegos no arranca haciendo flush como los de iptables. De
hecho, hacer flush como primera linea puede causarte problemas muy serios. Por
otro parte, reiniciar el cortafuegos sin hacer flush, provoca que se dupliquen
las reglas.</p>

<p>Al igual que iptables, que puede llegar a ser tan extrafalario como potente;
ipfw, tiene cosas verdaderamente hermosas. Por ejemplo, en iptables hacíamos
esto.</p>

<figure class='code'><figcaption><span>&#8220;iptables&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iptables -A INPUT -i eth0 -s 127.0.0.1/8 -j DROP
</span><span class='line'>iptables -A INPUT -i eth0 -s 192.168.0.0/16 -j DROP
</span></code></pre></td></tr></table></div></figure>


<p>Para evitar que direcciones provenientes de ip &ldquo;raras&rdquo; entraran a través de
nuestro cortafuegos y nos hicieran un &ldquo;firewalking&rdquo;. Sin embargo, con ipfw,
bastaría con:</p>

<figure class='code'><figcaption><span>&#8220;ipfw&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ipfw add deny ip from any to any not verrevpath in
</span></code></pre></td></tr></table></div></figure>


<p>En iptables, hacemos DROP cuando queremos desechar paquetes. En ipfw hacemos
<strong>reset</strong>; sin embargo, podemos hacer algo mucho más creativo. Por ejemplo,
queremos hacer una putada y darle creer a alguien que haga ping en la LAN, que
el servidor tiene muuuuucho tráfico. Esto desechará los paquetes con una
probabilidad del 9%</p>

<figure class='code'><figcaption><span>&#8220;ipfw&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ipfw add prob 0.09 deny ip from any to any in
</span></code></pre></td></tr></table></div></figure>


<p>Otro tema que le retraquetea el mango; es la gestión del ancho de vianda. Porque
tc es asco. Sin embargo, si conocemos ipfw, sabremos que maneja el ancho de
vianda de una menera muy peculiar. Este ejemplo, permite limitar el ancho de
vianda para la red 192.168.1.0/24 a 128Kbit</p>

<figure class='code'><figcaption><span>&#8220;ipfw&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ipfw add pipe <span class="m">1</span> ip from 192.168.1.0/24 to any in via xn1
</span><span class='line'>ipfw pipe <span class="m">1</span> config bw 128Kbit/s queue 25KBytes
</span></code></pre></td></tr></table></div></figure>


<p>O este otro, más estrafalario aún, permite limitar el ancho de vianda a cada
host de manera individual. Además, en este ejemplo lo veremos de manera
<strong>bidireccional</strong></p>

<figure class='code'><figcaption><span>&#8220;ipfw&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ipfw add pipe <span class="m">1</span> ip from 192.168.2.0/24 to any out via xn1
</span><span class='line'>ipfw add pipe <span class="m">2</span> ip from any to 192.168.2.0/24 in via xn1
</span><span class='line'>ipfw pipe <span class="m">1</span> config mask src-ip 0x000000ff bw 200Kbit/s queue 20Kbytes
</span><span class='line'>ipfw pipe <span class="m">2</span> config mask dst-ip 0x000000ff bw 200Kbit/s queue 20Kbytes
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mis crónicas con freebsd]]></title>
    <link href="http://uranio-235.github.io/blog/2017/01/28/freebsd-11/"/>
    <updated>2017-01-28T23:39:52-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/01/28/freebsd-11</id>
    <content type="html"><![CDATA[<p>Si vas a leer este artículo, te aviso, que no tiene nada que ver con el blog. Me
dispongo a expresar mi criterio sobre FreeBSD y un tanto de como ha formado
parte de mi vida profesional.</p>

<p>   <blockquote><p>FreeBSD, tecnología arcana para algunos y arcaica para otros.</p></blockquote></p>

<p>Se cuentan leyendas sobre FreeBSD, como que es el sistema operativo de los nodos
y cosas así. Mucha gente lo tiene como un arcano o algo que probarán <em>un día de
estos</em>. Yo pienso que no tiene nada del otro mundo. De hecho, en mi opinión,
gentoo es más complicado que freebsd.</p>

<p>Lo que si me queda claro que es un excelente sistema operativo para servidores
proxy. Además, ipfw, su cortafuegos, es sólido como una piedra. En FreeBSD eso
de caer de rodillas ante un ataque DoS, es simplemente utópico.</p>

<p>En ambientes libres de proxy, el binomio dummynet-<a href="https://www.freebsd.org/doc/handbook/firewalls-ipfw.html">ipfw</a>
permite un manejo del ancho de banda con una simpleza que ya quisiera <strong>tc</strong>. Un
solo pipe puede tener valores diferentes para su ancho de banda, encolamiento y
delay.</p>

<p>Por otra parte, el sistema de <a href="https://www.freebsd.org/doc/handbook/jails.html">jails</a>
es un batazo. Sobre todo en ambientes donde te ves obligado a meter la pata y no
dispones de virtualización. Los jails combinado con ZFS, permiten hacer cosas
alucinantes.</p>

<p>El gestor de paquetes ha mejorado muchísimo. En cuanto a resolución de
dependencias y velocidad. Lo han optimizado bastante en mi opinión y ahora
maneja mejor el tema de las redes lentas.</p>

<p>Cada versión nueva que sale la pruebo; y aunque había hecho mis cositas con él,
siempre acababa dejándolo de lado por el tema del ancho de banda. Cualquier
operación que hagas con la paquetería requiere conexión y poco ancho de banda
provoca que la operación falle. La versión 9 en mi opinión fue un desastre.
Especialmente por el sistema de ports que daba unos palos horribles.</p>

<p>FreeBSD 10 no lo toqué, estuve más girado para OpenIndiana.</p>

<p>Pero la versión 7 de OI parecía no terminar nunca. Finalmente el avión no
despegó. El fiasco de nexenta store y la insertidumbre de oracle, golpearon
fuertemente a la comunidad de OpenIndiana. El mundo se dio cuenta que OI tenía
el futuro de un submarino descapotable y gran parte de la comunidad de illumos
se mudó pa BSD. La comunidad de OpenIndiana se desmoronaba con las botas
puestas. El agitado canal de freenode #openindiana se convirtió en un canal
muerto. En lo personal, tras fracasar en mi afán por portar Ruby a OI, en parte
debido a que no tengo ancho de banda para hacer operaciones en el Userland; alcé
bandera blanca también.</p>

<p>Pero como soy Linuxero! Volví a poner mis servidores en debian y comencé a mirar
a fedora. De nuevo el ancho de vianda me golpeó; además de otros avatares de la
vida. Terminé usando un chroot de arch, sobre la viejísima instalación de debian
en mi laptop Pentium 3 que ya estaba más que obsoleta. Todas mis aplicaciones,
mi /home, etc&hellip; Eran un chroot de arch dentro de un debian desnudo. Corría i3 y
levantaba con startx luego de entrar al chroot.</p>

<p>Free BSD andaba por finales de la 9 y la 10 en el horno; si mal no recuerdo&hellip;
Yo, me dedicaba a leer noticias y continuaba suscrito a la lista de freebsd en
español; donde hacer top-posting se paga con la pena capital.</p>

<p>Mientras tanto, perdía yo mi trabajo y paradógicamente recién adquiría una nueva
laptop. Apostar por el recién abierto &ldquo;modelo de trabajo por cuenta propia&rdquo;; me
costó perder mi empleo y quedarme sentado un buen rato. Instalé ArchLinux en la
laptop nueva para conservar las configuraciones de la anterior. Para este
entonces me consideraba usuario de archlinux &ldquo;por casualidad&rdquo;. Me soñaba como un
feliz usuario de Fedora. Consideraba ya a Debian; única y expresamente una
herramienta para servidores.</p>

<p>A todas esas: ¿¿¿FreeBSD??? Relegado a: &ldquo;proyecto para cuando tenga tiempo&rdquo;</p>

<p>El período más jodido de mi vida estaba aconteciendo en ese momento. No voy a
escribir aquí mis problemas personales; pero hasta sin donde vivir me quedé. Por
tanto, el único producto que podía ofrecer eran servidores con debian. A
mediados del 2014, arranqué en el calixto, pero el ancho de vianda seguía siendo
un problema; también el tema de la cuota. ¿¿FreeBSD?? Simplemente olvidado hasta
entonces.</p>

<p>A finales del 2016, me trajeron el servidor de gama media para remplazar el
totem de servidores. Además, habían ampliado el susodicho ancho de vianda. Fue
entonces cuando decidí, que el nuevo proxy, no podía quedarse mariado como le
pasa al squid en linux; muchísimo menos con el micro tan poco potente del
servidor (gama media).</p>

<p>Para mi sopresa, FreeBSD andaba por la 11 (yo lo hacía por la 10 todavía) por lo
lento que se desarrolla; el pobre. Ahora estoy muy contento con mi
squid+squidGuard sobre FreeBSD 11. Que si bien también se marea, lo hace
bastante poco y se recupera rápido.</p>

<p>Por lo que veo ya no son tan retrógrados como antes; han mejorado mucho en ese
aspecto, aunque siguen siendo una mirada al futuro desde el pasado. Mantienen la
onda chea reflejada en su configuración; pero todo bien afinado, fresco y
modernizado.</p>

<p>Dejaron de ser retrógrados para convertirse en modernos pero anticuados.</p>

<p>FreeBSD es un buen sistema operativo para los enemigos de systemd.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[animación del palito]]></title>
    <link href="http://uranio-235.github.io/blog/2017/01/21/palito/"/>
    <updated>2017-01-21T12:47:55-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/01/21/palito</id>
    <content type="html"><![CDATA[<p>Por si se me olvida, porque lo he olvidado varias veces. En ocasiones, queremos
hacer una simple animación de consola, para representar trabajo de un script sin
mostrar lo que está procesando. Este script de ejemplo, itera por cada caracter
de la fecha y muestra la barra cambiando de posición, el clásico palito girando.</p>

<figure class='code'><figcaption><span>&#8220;scope&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># esta es la animación, puedes sustituirla</span>
</span><span class='line'><span class="c1"># por lo que más te guste, solo pon la secuencia</span>
</span><span class='line'><span class="n">animacion</span><span class="o">=[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;\ &#39;</span><span class="o">.</span><span class="n">strip</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">d</span><span class="p">,</span><span class="n">i</span>  <span class="k">in</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">chars</span><span class="o">.</span><span class="n">each_with_index</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1"># múeve a la siguiente frama de la animación</span>
</span><span class='line'>   <span class="n">palito</span><span class="o">=</span><span class="p">(</span><span class="n">animacion</span><span class="o">.</span><span class="n">push</span> <span class="n">animacion</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1"># muestra el palito y has un retorno de carro</span>
</span><span class='line'>   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">palito</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1"># has una media</span>
</span><span class='line'>   <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">3</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">d</span><span class="o">=</span><span class="n">d</span> <span class="c1"># nada que hacer con los datos</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>En el array, el último caracter tiene un String#strip porque al escribir <strong>\&lsquo;</strong>
el compilador suele interpretarlo como que estás escapando la comilla simple.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DataTables en español]]></title>
    <link href="http://uranio-235.github.io/blog/2017/01/20/datatables-espanol/"/>
    <updated>2017-01-20T16:39:32-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/01/20/datatables-espanol</id>
    <content type="html"><![CDATA[<p>Siempre hay un cliente exquisito que le molesta la aplicación completa en
español, a excepción del puñetero paginador que está en inglés.</p>

<p>Como ya no uso kaminari ni will_paginate la cosa se complica. Decidí llamar a
todas las tables id=&ldquo;latabla&rdquo; y en el <strong>application.js</strong>, según la
documentación de la API de DataTables, le ponemos la clave <em>language</em> con sus
pertinentes componentes.</p>

<figure class='code'><figcaption><span>&#8220;application.js&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#latabla&#39;</span><span class="p">).</span><span class="nx">DataTable</span><span class="p">(</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="s2">&quot;language&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;decimal&quot;</span><span class="o">:</span>        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;emptyTable&quot;</span><span class="o">:</span>     <span class="s2">&quot;No hay datos para mostrar&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;info&quot;</span><span class="o">:</span>           <span class="s2">&quot;del _START_ al _END_ (_TOTAL_ total)&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;infoEmpty&quot;</span><span class="o">:</span>      <span class="s2">&quot;del 0 al 0 (0 total)&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;infoFiltered&quot;</span><span class="o">:</span>   <span class="s2">&quot;(filtrado de todas las _MAX_ entradas)&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;infoPostFix&quot;</span><span class="o">:</span>    <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;thousands&quot;</span><span class="o">:</span>      <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;lengthMenu&quot;</span><span class="o">:</span>     <span class="s2">&quot;Mostrar _MENU_ entradas&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;loadingRecords&quot;</span><span class="o">:</span> <span class="s2">&quot;Cargando...&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;processing&quot;</span><span class="o">:</span>     <span class="s2">&quot;Procesando...&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;search&quot;</span><span class="o">:</span>         <span class="s2">&quot;Buscar:&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;zeroRecords&quot;</span><span class="o">:</span>    <span class="s2">&quot;No hay resultados&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;paginate&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;first&quot;</span><span class="o">:</span>      <span class="s2">&quot;Primero&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;last&quot;</span><span class="o">:</span>       <span class="s2">&quot;Último&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;next&quot;</span><span class="o">:</span>       <span class="s2">&quot;Siguiente&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;previous&quot;</span><span class="o">:</span>   <span class="s2">&quot;Anterior&quot;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="s2">&quot;aria&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;sortAscending&quot;</span><span class="o">:</span>  <span class="s2">&quot;: ordenar de manera Ascendente&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;sortDescending&quot;</span><span class="o">:</span> <span class="s2">&quot;: ordenar de manera Descendente &quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span> <span class="p">);</span> <span class="c1">// document ready</span>
</span></code></pre></td></tr></table></div></figure>


<p>Claro, realmente no lo hice así, ya que en vez de <strong>&ldquo;Anterior&rdquo;</strong> puse
<strong>t(:dt_prev)</strong>  y cree su pertinente fichero de idioma con la traducción, pero
escribí esta entrada pensando en gente que puede o no usar RoR. No obstante, el
buen desarrollador de rails, sabe que lo correcto sería usar la in API de i18n.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[tendencias tecnológicas]]></title>
    <link href="http://uranio-235.github.io/blog/2017/01/09/tendencias-tecnologicas/"/>
    <updated>2017-01-09T21:04:02-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/01/09/tendencias-tecnologicas</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://uranio-235.github.io/images/bandwagon.jpg" width="400" height="500" title="" ></p>

<p>Por suerte, la era de Zentyal está a punto de terminar.</p>

<p>Ahora tenemos tocadores de pfSense, que se creen usuarios de FreeBSD.</p>

<p>Siempre me ha maravillado el criterio de selección tecnológica de la mayoría (NO
todos) los cubanos</p>

<h4>puro efecto bandwagon</h4>

<p>Funciona como especie de moda, donde el software más popular triunfa,
simplemente por su popularidad, no por su adecuación, o idoneidad.</p>

<p>Por ejemplo, nginx se puso de moda, porque el jovenclub lo usa. El jovenclub es
famoso por sus disparates tecnológicos, pero no importa. ¡Usemos nginx! Antes yo
usaba nginx, como proxy inverso, balanceo de carga y servidor web de contenido
estático. Entonces yo era &ldquo;un extravagante&rdquo;. Ahora todo el mundo usa nginx para
TODO. Tipos que AYER tocaron la puntica de nginx, te dicen: &ldquo;¿aún usas apache?&rdquo;
y te miran como si tú fueras un bicho raro. Curiosamente, la misma mirada que
ponían cuando les decías que usabas nginx (además de apache).</p>

<p>Muchos dicen que &ldquo;systemd es una mierda&rdquo;, pero al preguntar &ldquo;por qué&rdquo;, son pocos
los que dan argumentos técnicos que vallan más allá de simple resistencia al
cambio. Parece no haber un término medio. Todo es blanco y negro. Nadie dice por
ejemplo que systemd es bueno para máquinas de escritorios pero no tan bueno para
servidores. NOOoo&hellip;</p>

<p>Otro que bien baila es Proxmox. La herramienta de virtualización que ha caído en
manos de los mas perezosos como dedo en el anillo. Al parecer soy el único
cubano que usa Xen. Actualmente me dicen: &ldquo;ah! ¿no usas proxmox?&rdquo;. Pero cuando
pregunto: ¿qué tiene proxmox superior a xen? Estoo, es queeee, veráaas,
bueeenooo&hellip;. Nada, que está moda. La ecuación es simple:</p>

<h4>Virtualización = Proxmox</h4>

<p>click-click-click-click-click ¡<strong>ZAS</strong>! Todo está listo!!</p>

<p>Dejaron de usar windows Server (click, click listo!)</p>

<p>Para usar:</p>

<p>Proxmox+Zimbra+pfSense (click, click ¡LISTO! ¡¡¡y además FUNCIONA!!)</p>

<p>¿Cambio de paradigma? ¿Filosofía UNIX? ¿Estilo de trabajo? ¿Teorema de KISS?
¿Software Libre? <em>-pfff, que chiste. Ese tipo está loco, anda con la pila de
consolas que parecen salida de la matrix. Nerd!</em></p>

<p>No saben que demonios es un cortafuegos, no son capaces de elaborar una solución
a la medida de su problema y ni siquiera entienden el software que usan pero
eso son nimiedades.</p>

<p>Cuando las necesidades tan pecularies de cubita la bella dicen &ldquo;aquí estoy&rdquo;,
entonces no saben como van a modificar el comportamiento del software para
adecuarse a nuestras extravagantes necesidades. Por que hay cientos de menus con
cientos de click y checkmarks, pero ninguna hace lo que le exigen al sysadmin
cubano.</p>

<p>El servidor de correos, es su mayor dolor de cabeza, pero hay Zimbra. A veces
necesitan un servidor SIMPLE o un servidor COMPLEJO, nada que ver con Zimbra y
bueno, prueba a ver si iRedMail te lo resuelve.</p>

<p>Ven herramientas como nagios o smokeping, se quedan con la boca abierta, pero
¡joder! es muy complicado, me paso. Al menos,  hasta que alguien me de una
configuración que funcione y yo cambiarle los valores para que se adecue a mi
entorno.</p>

<p>Reza porque todo funcione. Ya que es tanta la ignorancia, que si hay un
problema, ni siquiera saben como van a pedir ayuda, porque ni siquiera entienden
con que están tratando.</p>

<p>Siempre puedes decirle al jefe &ldquo;no se puede&rdquo;. Después de todo, eres un
<strong>tolerable asalariado</strong> y no te pasará nada por incumplir. Le puedes echar la
culpa <em>al país que es una mierda por el atraso tecnológico</em> y bla bla bla; todas
esas excusas que usan los mediocres de gama alta.</p>

<h4>pero tienen más horas de facebook que de consola</h4>

<p>Los más triste del caso, es que luego quieren venir a discutir de tecnología y
uno no sabe como va a llevar la conversación para no humillarlos.</p>

<h4>punto y aparte</h4>

<p>Además, están los tipos que <strong>Sí SABEN</strong>, pero que usan todo eso porque &ldquo;no
tienen tiempo&rdquo;. Trabajan sentados, el día entero apretando teclas en aire
acondicionado y &ldquo;no tienen tiempo&rdquo;.</p>

<p>Pierden su tiempo en jugar con toda esta parafernalia modista, para luego darse
cuenta que esos sistemas, están incompletos. Les falta algo que ellos ya han
hecho mejor y es cuando se dan cuenta, que están andando con juguetes.</p>

<h4>para los extremistas</h4>

<p>No digo que Zimbra/pfSense/Proxmox sean malos, digo que el método perezoso, es
malo.</p>

<p>No puedes comparar la picoloro con la llave inglesa.</p>

<p>Tampoco puedes pensar que solo necesitas una de las dos para hacerlo todo. Ambas
son útiles, en su adecuado ambiente y para la tarea que fueron diseñadas.</p>

<p>Antes de emitir un criterio tecnológico, pruebo el software, lo instalo, lo
manoceo, trato de romperlo, de ver como funciona, que tiene por detrás;
finalmente, que haría yo si quisiera/pudiera mejorarlo. Entonces me hago un
criterio.</p>

<p>La gente que me conoces, sabe que aveces digo: &ldquo;eso es una mierda&rdquo;. Otros, que
me conocen mejor y que hace lo mismo que yo; suelen oírme cuando digo: -eso es
una mierda y te contaré como llegué a esa conclusión, ya que seguro que a ti te
ha pasado parecido.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[flasheando modem al S4]]></title>
    <link href="http://uranio-235.github.io/blog/2017/01/09/flasheando-modem-al-s4/"/>
    <updated>2017-01-09T19:00:58-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/01/09/flasheando-modem-al-s4</id>
    <content type="html"><![CDATA[<p>Es un mojón de los Samsung, tener el módem (banda base) como una partición y
(por ende un firmware) aparte del sistema. Por este motivo, cuando flasheas
cyanogen (léase &ldquo;cualquier ROM&rdquo;) una y otra vez; o cuando el teléfono se apaga
abruptamente&hellip; Diiiicen que se corrompe el módem.</p>

<p>Entonces, de buenas a primeras, el teléfono te dice &ldquo;tarjeta SIM expulsada,
Reinicie&rdquo;. Aveces al reiniciar no se soluciona el problema. Yo he estado hasta 3
días sin teléfono. Quitarle la batería un rato y volverla a poner, suele ser una
solución, pero aveces, hasta 7 veces al día; he tenido que lidiar con el
errorsito de los cojones.</p>

<p><img class="right" src="http://uranio-235.github.io/images/acercade_baseband.png" width="200" height="300" title="" ></p>

<p>La única solución paliativa que he visto, es, de vez en vez, al menos una cada
dos mes; flahsear el módem.</p>

<p>El cómo dar con el módem te lo dejo de tarea. Lo siento, no soy la base de datos
de bandas bases de samsung. La mía la <strong>busqué en google</strong> escribiendo el texto:</p>

<p>&ldquo;modem SGH-M919&rdquo;</p>

<p>Oséase, pidiendo el módem para mi modelo del teléfono, que al parecer, la
<strong>M919UVUFNH7</strong>, es la última disponible para mi canchanfleta.</p>

<p>El proceso de flasheo, la primera vez, requiere que nos hagamos con el
fichero PIT del teléfono.</p>

<p>Reinicia el teléfono en modo descarga. Si no sabes cómo hacerlo, googlea, cada
samsung tiene su forma. El mío (S4 T-Mobile) es Power+VolDown+Home. Luego, en el
modo descarga; una vez que (presiones VolUp) para inicializar la conexión,
pasamos a Heimdall.</p>

<p>Nota para los imbéciles: Conecte el teléfono a la computadora mediante un cable
USB <strong>en buen estado</strong>.</p>

<p><img class="right" src="http://uranio-235.github.io/images/pitfile.png" width="600" height="700" title="" ></p>

<p>En Heimdall, vamos a la pestaña <strong>Utilities</strong>. Presiona botón
<em>Detect</em><sup>1</sup>, cuando te coja el teléfono, presiona <em>Save As</em><sup>2</sup>
y te dará un nombre de fichero para salvar, por ejemplo, <strong>fulanito.pit</strong>.
Finalmente presiona <em>Download</em><sup>3</sup> y te creará el fichero.</p>

<p>Decirte quiero que este ficherito es muy famoso, ya que es algo así como tu
tabla de particiones.</p>

<p>Una vez que tienes el fichero en tu poder, Heimdall, será capaz de saber <em>a
ciegas</em> donde están las particiones de tu teléfono sin tener que preguntárselo
una y otra vez, así que guardalo en un directorio donde pongas todas las
gangarreas de tu teléfono. Por cierto, terminamos con el teléfono; aunque diga
&ldquo;do not turn off&rdquo; cágate en la noticia y reinicia (quita la batería).</p>

<p>Ahora viene tiempo de google, muuuuucho google, para dar con tu módem.</p>

<p>Digamos que finalmente diste con el módem de tu samsung. Seguro tiene un nombre
muy genérico, casi siempre se llaman <strong>modem.bin</strong>. Procede con el mismo
preludio del ritual (modo descarga y abre heimdall)</p>

<p><img class="left" src="http://uranio-235.github.io/images/flasheo_modem.png" width="600" height="700" title="" ></p>

<p>Ahí ve para la pestaña que dice <strong>Flash</strong>. Click en <em>Browse</em><sup>1</sup> y
localiza tu pitfile. Click en <em>Add</em><sup>2</sup> y luego en el <em>select</em> del campo
<em>partition name</em><sup>3</sup> selecciona la partición <strong>MDM</strong>. Finalmente, le
buscamos el fichero modem.bin haciendo click en Browse<sup>4</sup>.</p>

<p>¿No tengo que decirte que pulses <strong>Start</strong>, verdad?</p>

<p>Si todo salió bien, se reiniciará y tendrás tu módem recién flasheado. Pero no
cantes victoria. Si tu modem se deterioró, fue que ALGO lo deterioró y ese algo,
lo joderá de nuevo, así que, mantén las herramientas a manos; las necesitarás
pronto.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails-assets]]></title>
    <link href="http://uranio-235.github.io/blog/2017/01/02/rails-assets/"/>
    <updated>2017-01-02T18:55:02-05:00</updated>
    <id>http://uranio-235.github.io/blog/2017/01/02/rails-assets</id>
    <content type="html"><![CDATA[<p>Gemas como twitter-bootstrap-rails, hacen que el trabajo con CSS complejas
supuestamente se haga &ldquo;al click&rdquo;. Pero cuando deseas ir un poco más allá, por
ejemplo, si quieres DataTables, notarás que tienes dos opciones, la primera,
usar una gema desfasada (si hay, que casi siempre la hay, aunque buena para
nada).</p>

<p>Sin embargo, parece que algún cerebrito, hizo un sitio en el cual la fuente
oficial de las assets (quizás a través de npm) se convierten de manera
automatizada en una gema de rails.</p>

<p>De esta manera, al poner en el Gemfile de tu aplicación esto:</p>

<figure class='code'><figcaption><span>&#8220;Gemfile&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span>  <span class="s1">&#39;https://rails-assets.org&#39;</span> <span class="k">do</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-underscore&#39;</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-DataTables&#39;</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-bootstrap&#39;</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-jquery-ui&#39;</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-stringjs&#39;</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-iCheck&#39;</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s1">&#39;rails-assets-jquery&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instalarás dichas js/css en tu aplicación.</p>

<p>En el <a href="https://rails-assets.org">sito web de rails-assets</a> explica con unos
diff, que debes poner en el application.js y aaplication.css para incluir cada
una de las assets. Casi siempre es algo genérico al nombre, lo puedes intuir.</p>

<p>De todas maneras, el fracasado proyecto de crear un jquery unobstructive;
condujo a que jquery fuera expulsada del core de rails. Así que al parecer la
tendencia de rails 5 en adelante, será usar las js aparte. Más vale tener un
buen jquery a mano.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[xgproyect]]></title>
    <link href="http://uranio-235.github.io/blog/2016/12/29/xgproyect/"/>
    <updated>2016-12-29T21:48:32-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/12/29/xgproyect</id>
    <content type="html"><![CDATA[<p>Se supone que te cuente la historia de Xnova, OAgame y XGProyect pero de verdad
que NO estoy pa eso; ya me la disparé en la wikipedia más dos alemanes que mi
hicieron su propia versión de la historia. Pa hacerte el cuento corto, es un
juego de exploración y conquista del universo. Suena emocionante, pero todo
sucede en páginas web.  Cosas como &ldquo;tus naves destruyeron la flota enemiga&rdquo; el
juego te las cuenta, tú no las vez.</p>

<p>La tercera vez que me preguntaron en el calixto si &ldquo;tenía montado un xnova&rdquo;
decidí tomar cartas del asunto. Después de mucho rodar por google, no di con el
código fuente de xnova. El colega Leslie (alias &ldquo;Curielete&rdquo;) me comenta que
ahora lo que se usa es XGProyect.</p>

<p>La versión más reciente, es la <a href="https://github.com/XGProyect/XG-Proyect-v3.x.x/releases/download/v3.0.3/XGP3.0.3.zip">3.0.3, bájatela aquí</a></p>

<p>En mi caso, dispuse de un Virtualhost en el servidor web, para la aplicación. El
document root de este virtualhost, apuntará a <strong>/var/www/xgp</strong></p>

<figure class='code'><figcaption><span>&#8220;descargando&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget -c https://github.com/XGProyect/XG-Proyect-v3.x.x/releases/download/v3.0.3/XGP3.0.3.zip
</span><span class='line'>unzip XGP3.0.3.zip
</span><span class='line'>mv xgp3.0.3/upload /var/www/xgp
</span></code></pre></td></tr></table></div></figure>


<p>Setea los permisos como prefieras, pero al directorio de configuración, deberás
darle permiso de escritura HASTA que culmine el proceso de instalación.</p>

<figure class='code'><figcaption><span>&#8220;poniendo permisos temporales&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chmod -R <span class="m">0777</span> application/config/
</span></code></pre></td></tr></table></div></figure>


<h4>OJO</h4>

<p>Requiere mysql, así que para este ejemplo, crearemos una base de datos llamada
<strong>&ldquo;x&rdquo;</strong></p>

<p>Al abrir un navegador y dirigirnos al sitio, te redireccionará al instalador de
manera automática. Pedirá irremediablemente los parámetros. Luego de establecer
la conexión con la base de datos, creará el fichero de configuración. Al hacer
click en continuar, creará la complejísima base de datos que contendrá el
universo del juego.</p>

<p><img class="center" src="http://uranio-235.github.io/images/xg_1.png" width="500" height="600" title="" ></p>

<p>Si te da un error 500, es porque tu versión de php o de mysql, no le juega. Para
este ejemplo, se usó debian 8 (el container de docker para ser más preciso)</p>

<p>Más específicamente estas:</p>

<figure class='code'><figcaption><span>&#8220;versiones&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@40e0cc02bcd7:/# php -v
</span><span class='line'>PHP 5.6.24-0+deb8u1 <span class="o">(</span>cli<span class="o">)</span> <span class="o">(</span>built: Jul <span class="m">26</span> <span class="m">2016</span> 08:17:07<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>c<span class="o">)</span> 1997-2016 The PHP Group
</span><span class='line'>Zend Engine v2.6.0, Copyright <span class="o">(</span>c<span class="o">)</span> 1998-2016 Zend Technologies
</span><span class='line'>    with Zend OPcache v7.0.6-dev, Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2016, by Zend Technologies
</span><span class='line'>
</span><span class='line'>root@40e0cc02bcd7:/# mysqld -V
</span><span class='line'>mysqld  Ver 5.5.52-0+deb8u1 <span class="k">for</span> debian-linux-gnu on x86_64 <span class="o">((</span>Debian<span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con el php de archlinux, no me pinchó, todo daba error 500</p>

<p>Finalmente, nos pedirá crear el primer usuario que es además, el administrador
del juego. Deja que veas el panel de admin, tiene más botones y menú, que la
cabina de cualquier nave espacial.</p>

<p>Una vez terminado ese proceso, nos pide borrar el directorio &ldquo;install&rdquo;.
Renombrarlo trae horribles consecuencias, así que bórralo o cámbialo de lugar.</p>

<p>Por último, le devolvemos sus permisos al directorio de configuración.</p>

<figure class='code'><figcaption><span>&#8220;poniendo permisos temporales&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chmod -R <span class="m">0444</span> application/config/
</span></code></pre></td></tr></table></div></figure>


<p>De regreso a la ventana del juego, tendrás la landing-page y el botón entrar.</p>

<p><img class="center" src="http://uranio-235.github.io/images/xg_2.png" width="500" height="600" title="" ></p>

<p>Ahí te logueas y localizas el menú de administración. Puedes llegar por
<a href="http://tuservidor/admin.php">http://tuservidor/admin.php</a> Por ahí puede para empezar, hacer la tarea más
elemental: Crear usuarios.</p>

<p><img class="center" src="http://uranio-235.github.io/images/xg_3.png" width="600" height="700" title="" ></p>

<p>Entra cuanto antes al panel de administración y verás que te pida una
actualización. Al pulsar el botón, te saldrán unas sentencias SQL. Quizás las
ejecute, quizás no lo consiga. Por si acaso, tu las ejecutas en una consola SQL.
Si tienes ese error (actualización disponible) no te dejará hacer nada hasta que
no lo resuelvas.</p>

<p>Luego llégate a &ldquo;Errores DB&rdquo; y subsánalos. Por suerte es tan simple como hacer
click en &ldquo;Eliminar Todos&rdquo;. También en el menú &ldquo;Características del Juego&rdquo;, te
recomiendo desactivar &ldquo;Mercader&rdquo; y &ldquo;Oficiales&rdquo;, enseguida te darás cuenta por
qué lo digo.</p>

<p><img class="right" src="http://uranio-235.github.io/images/xg_4.png" width="600" height="700" title="" ></p>

<p>Los usuarios se hacen en el menú &ldquo;Creador&rdquo; (no en &ldquo;Usuarios&rdquo;)</p>

<p>Otra cosa, el panel de admin carga lento, es bastante lento pero eso es normal.</p>

<p>Realmente el juego tiene su encanto. Abres la página cada una o dos horas, hace
una que otra bobería y dejas las tarea en cola. Me resulta más entretenido que
facebook. En el Link &ldquo;notas&rdquo; vas tomando nota de lo que tienes por hacer, cuando
te vuelvas a loguear el lunes, solo tienes que mirarlas. Consejo, haste una
&ldquo;fabrica de robots&rdquo; cuanto antes.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cambiar mac a un nano]]></title>
    <link href="http://uranio-235.github.io/blog/2016/12/27/cambiar-mac-a-un-nano/"/>
    <updated>2016-12-27T09:39:44-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/12/27/cambiar-mac-a-un-nano</id>
    <content type="html"><![CDATA[<p>Un socio me preguntó hace poquito si yo podía cambiarle la MAC a un nano. Me
pareció muy estrafalaria la necesidad de él, pero según me contó, en la red
criolla que está suscrito, suelen banear los nanos cuando los usuarios se portan
mal.</p>

<p>Tras una búsqueda en internet vi unos post en un forum pero ninguno me funcionó.
La idea es, correr un fichero al iniciar el sistema, que corra ifconfig y le
cambie la MAC a las interfaces.</p>

<p>La problemática radica, que a la interfaz &ldquo;ath0&rdquo;, no se le puede cambiar la MAC,
ya que aún estando down, te dice dispositivo ocupado. Por esa razón, parecía no
pinchar la solución de los post. Sin embargo, si bajas las 3 interfaces
involucradas en la conexión, luego cambias dichas mac, <strong>sí pincha</strong>.</p>

<p>Para ello crearemos el fichero <strong>/etc/persistent/rc.poststart</strong></p>

<figure class='code'><figcaption><span>&#8220;/etc/persistent/rc.poststart&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>
</span><span class='line'>ifconfig br0 down
</span><span class='line'>ifconfig wifi0 down
</span><span class='line'>ifconfig ath0 down
</span><span class='line'>
</span><span class='line'>ifconfig wifi0 hw ether 5e:53:84:bc:a3:54
</span><span class='line'>ifconfig ath0 hw ether 5e:53:84:bc:a3:54
</span><span class='line'>
</span><span class='line'>ifconfig ath0 up
</span><span class='line'>ifconfig wifi0 up
</span><span class='line'>ifconfig br0 up
</span></code></pre></td></tr></table></div></figure>


<p>A ese fichero le ponemos el ejecutable, si no, no pinchará.</p>

<figure class='code'><figcaption><span>&#8220;ejecutable&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>XW.v5.6.2# chmod a+rx /etc/persistent/rc.poststart
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente, le decimos al firmware que modifique los cambios y que reinicie.</p>

<figure class='code'><figcaption><span>&#8220;salva y reinicia&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>XW.v5.6.2# cfgmtd -w -p /etc/
</span><span class='line'>XW.v5.6.2# reboot
</span></code></pre></td></tr></table></div></figure>


<p>Todavía hay quien cree que las MAC son una medida segura para crear reglas de
control de acceso&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[phpmyadmin múltiples servidores]]></title>
    <link href="http://uranio-235.github.io/blog/2016/12/19/phpmyadmin-multiples-servidores/"/>
    <updated>2016-12-19T14:50:26-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/12/19/phpmyadmin-multiples-servidores</id>
    <content type="html"><![CDATA[<p>Cuando tienes que manejar múltiples servidores SQL, no da la talla tener un
phpmyadmin por cada servidor. Opté por tener un phpmyadmin instalado en mi
laptop.</p>

<p>Una manera muy sencilla de hacer la pincha, es mapear con SSH el puerto de mysql
y conectar a todo el mundo como si fuera localhost.</p>

<figure class='code'><figcaption><span>&#8220;ssh y mysql&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ssh root@192.168.0.9 -L 3306:127.0.0.1:3306 -N
</span></code></pre></td></tr></table></div></figure>


<p>Pero en algunos casos, no hay SSH, el servidor no escucha por TCP, etc&hellip; En tal
caso, podrías permitir que el root se administre remotamente.</p>

<p>Para lograrlo hay que decirle a mysql que escuche por la dirección ip además de
por el socket local. En infraestructuras grandes, por lo general, ya está hecho.
Localiza en <strong>/etc/mysql/my.cnf</strong> el parámetro llamado <strong>bind-address</strong></p>

<figure class='code'><figcaption><span>&#8220;/etc/mysql/my.cnf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Instead of skip-networking the default is now to listen only on</span>
</span><span class='line'><span class="c"># localhost which is more compatible and is not less secure.</span>
</span><span class='line'><span class="nb">bind</span>-address      <span class="o">=</span> 0.0.0.0
</span></code></pre></td></tr></table></div></figure>


<p>y reinicia el mysql, claro está&hellip;</p>

<p>Ahora hacemos una consulta SQL, en la cual le daremos al usuario root, el
permiso para conectarse de una ip dada. Por ejemplo, la computadora del sysadmin
está en 192.168.0.222</p>

<figure class='code'><figcaption><span>&#8220;grant root&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="n">root</span><span class="o">@</span><span class="s1">&#39;192.168.0.222&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;tupassword&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora viene el truco mágico en la configuración de phpmyadmin. El fichero de
configuración de phpmyadmin, en el caso de arch, está en
/etc/webapps/phpmyadmin/config.inc.php en otras distros, no sé, pero siempre se
llama <strong>config.inc.php</strong></p>

<p>En ese fichero, localiza la cadena de texto &ldquo;First Server&rdquo;, debes ver algo como
esto pero con muchos comentarios:</p>

<figure class='code'><figcaption><span>&#8220;config.inc.php&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;auth_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cookie&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;connect_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tcp&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;compress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;AllowNoPassword&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Solo tienes que añadirle otra <strong>$i++;</strong> y poner los parámetros en el array $cfg</p>

<figure class='code'><figcaption><span>&#8220;ejemplo de múltiples servidores&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;auth_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cookie&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;connect_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tcp&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;compress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;AllowNoPassword&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$i</span><span class="o">++</span><span class="p">;</span> <span class="c1">// otro servidor</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;otro servidor&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;192.168.1.9&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;connect_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tcp&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;compress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;AllowNoPassword&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$i</span><span class="o">++</span><span class="p">;</span> <span class="c1">// el leviatand de los mares</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;otro servidor mas&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;192.168.2.9&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;connect_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tcp&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;compress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="nv">$cfg</span><span class="p">[</span><span class="s1">&#39;Servers&#39;</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;AllowNoPassword&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Cuantos servidores quieras añadirle&hellip; Cuando vallas a loguearte en el
phpmyadmin verás debajo de la caja de login, un select, con el servidor que
quieres acceder.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iptables y ftp]]></title>
    <link href="http://uranio-235.github.io/blog/2016/12/19/iptables-y-ftp/"/>
    <updated>2016-12-19T11:34:13-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/12/19/iptables-y-ftp</id>
    <content type="html"><![CDATA[<p>Instalé un proftpd y le puse un cortafuegos a dicho servidor. Al instante,
nagios reportó que el FTP pinchaba, así que di por terminada la tarea. Sin
embargo, a las dos horas un usuario me pregunta si &ldquo;el ftp está caído&rdquo;.</p>

<p>Resulta que los puertos pasivos, se comportan de una manera &ldquo;inesperada&rdquo;. Una
solución común es abrir el rango de puertos que se configuran como pasivos, pero
eso no me cuadra.</p>

<p>Por suerte, linux cuenta con un módulo especial llamado <strong>ip_conntrack_ftp</strong>,
especial para el tema.</p>

<p>Si quieres ver más detalles y otras soluciones, llégate aquí:</p>

<p><a href="http://unix.stackexchange.com/questions/93554/iptables-to-allow-incoming-ftp">http://unix.stackexchange.com/questions/93554/iptables-to-allow-incoming-ftp</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails en alpine]]></title>
    <link href="http://uranio-235.github.io/blog/2016/12/09/rails-en-alpine/"/>
    <updated>2016-12-09T20:14:28-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/12/09/rails-en-alpine</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://uranio-235.github.io/images/shinkasen.jpg" width="400" height="500" title="" ></p>

<p>Finalmente el boom de docker llegó a Cuba. En mi caso personal, hace rato lo uso
para desplegar aplicaciones de Ruby on Rails y siempre me pareció que debian era
la mejor base para hacer una imagen. Si bien, hay containers de rails, eso de
usar en producción, con una distro hecha por un cualquiera, como que me da cosa.
Hacer una a partir de la oficial, es más sencillo que verificar la integridad de
una ya hecha.</p>

<p>AlpineLinux para docker es un batazo, eso es in-negable. Pero instalar rails en
alpine, resultó ser más complicado de lo que yo pensaba.</p>

<figure class='code'><figcaption><span>&#8220;docker y alpine&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker pull alpine
</span><span class='line'>docker run -ti alpine /bin/sh
</span></code></pre></td></tr></table></div></figure>


<p>Ante todo necesitamos instalar las librerías requeridas para compilar, sobre
todo las dependencias de nokogiri. Instalaremos los paquetes: build-base,
nodejs, tzdata, libxml2-dev,  libxslt-dev, sqlite-dev y claro, ruby</p>

<p>En este caso, usaremos sqlite como ejemplo, pero a ti quizás te cuadre más con
<strong>mariadb-dev</strong> (mysql) o <strong>postgresql-dev</strong></p>

<figure class='code'><figcaption><span>&#8220;apk add&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apk update
</span><span class='line'>apk add build-base nodejs tzdata libxml2-dev  libxslt-dev
</span><span class='line'>apk add sqlite-dev mariadb-dev postgresql-dev
</span><span class='line'>apk add ruby ruby-dev ca-certificates libffi libffi-dev
</span></code></pre></td></tr></table></div></figure>


<p>Como nokogiri es un caso tan peculiar, le diremos que compile usando las
librerías del sistema, para ellos lo instalaremos aparte. Alpine <strong>no</strong> usa
glibc, usa musl-libc y nokogiri NO compila, por tanto, hay que usar las
librerías del sistema; en vez de las que provee nokogiri.</p>

<figure class='code'><figcaption><span>&#8220;nokogiri&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem inst --no-document nokogiri -- --use-system-libraries
</span></code></pre></td></tr></table></div></figure>


<p>Con eso ya tenemos los cimientos echados. Nuestra imagen habrá crecido 200
megas. Ahora vamos instalar rails.</p>

<figure class='code'><figcaption><span>&#8220;gem&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem inst --no-document rails io-console
</span></code></pre></td></tr></table></div></figure>


<p>El paso de instalar rails como gema del sistema es cuestionable para una pila de
gente; pero ten en cuenta que es la manera de saber si rails funciona, recuerda
que esto es un ejemplo. La primera vez me topé con que debía instalar
<strong>io-console</strong>, ya que a pesar de ser dependencia, nadie la requería. Bueno a
ver&hellip;</p>

<figure class='code'><figcaption><span>&#8220;rails&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/ <span class="c"># rails -v</span>
</span><span class='line'>Rails 5.0.0.1
</span></code></pre></td></tr></table></div></figure>


<p>Tengo una imagen llamada &ldquo;alpine_ruby&rdquo; en la que tengo todo lo necesario para
instalar y No tengo la gema de rails instalada. Entonces, con cada versión de
rails, por ejemplo, derivar de &ldquo;alpine_ruby&rdquo; la imagen alpine_rails50 , así
cuando salga el rails 5.1 le llamaré alpine_rails51</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[squid3 bloquear user-agent]]></title>
    <link href="http://uranio-235.github.io/blog/2016/11/24/squid3-bloquear-user-agent/"/>
    <updated>2016-11-24T14:36:13-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/11/24/squid3-bloquear-user-agent</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://uranio-235.github.io/images/noiexplore.png" width="400" height="500" title="" ></p>

<p>Recién, he tenido algunos problemas con descargadores multi-hilos que se chupan
el ancho de banda y se cagan en los delay_pools. Buscando como bloquear dichos
descargadores, el colega Agustín Ybarra me recomienda bloquear los user_agent.</p>

<p>Pero pensándolo bien, resolví unos cuantos problemas. Pues por ejemplo, google
play service de los teléfonos android, consume muchísimo y resuelve poco, de
forma que el que navega en un delay_pool, ve afectado su ancho de banda por
cosas que ignora.</p>

<p>Solución, bloquear los User-Agent. La idea suena bien, pero primero hay que
loguear los user agent. Para ellos usaremos un custom_log de squid, loguearemos
los usuarios y los user-agent. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;squid.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># loguea los user-agent</span>
</span><span class='line'>logformat useragent  %un <span class="s2">&quot;%{User-Agent}&gt;h&quot;</span>
</span><span class='line'>access_log daemon:/var/log/squid3/user_agent.log useragent
</span></code></pre></td></tr></table></div></figure>


<p>Ahora tenemos el fichero <em>user_agent.log</em>, logueando usuario y user_agent; claro
está, podría loguear, usuario, user-agent y url, pero la linea queda muy larga.</p>

<p>Una vez que hallas encontrado el user-agent que te moleste, crea una ACL
<strong>arriba</strong> de la ACL que autorize la navegación.</p>

<figure class='code'><figcaption><span>&#8220;squid.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># por ejemplo, blqueamos zapya y se fana</span>
</span><span class='line'>acl zapya browser ^com<span class="se">\.</span>dewmobile
</span><span class='line'>http_access deny zapya
</span><span class='line'>http_reply_access deny zapya
</span></code></pre></td></tr></table></div></figure>


<p>Seguiré aquí, como <a href="https://es.wikipedia.org/wiki/The_Catcher_in_the_Rye">el pescador del centeno</a>, esperando a que vuelva a usar su descargadorcito multi-hilo de mierda&hellip; aunque seguro puede cambiarle el user-agent.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[redimensionar lvm]]></title>
    <link href="http://uranio-235.github.io/blog/2016/11/22/redimensionar-lvm/"/>
    <updated>2016-11-22T21:00:22-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/11/22/redimensionar-lvm</id>
    <content type="html"><![CDATA[<p>Este post es a método de memorando, ya que SIEMPRE se me olvida como hacerlo.</p>

<p>En materia de virtualización, el sistema de plantillas nunca me ha gustado,
<strong>porque NO SÉ quién instala esos sistemas operativos ni como.</strong></p>

<p><strong>Yo prefiero</strong> por ejemplo, instalar un debian, acomodarle todo a mi manera y
usar esa instalación para generar nuevas máquinas, con todo ya listo. Por
ejemplo, un prototipo de firewall, las configuraciones de interfaz puesta con
dhcp, pero una configuración estática bien comentada, etc..</p>

<p>Mantengo esa máquina detenida y la arranco de vez en cuando para actualizar.
Cuando voy a hacer una nueva, <strong>simplemente clono esa máquina</strong>.</p>

<p>Prefiero llamarlo <strong>matriz</strong> que <em>plantilla</em>. El resto del tiempo, dicha máquina
permanece detenida (apagada) evitando así desgaste, envejecimiento, generación
de logs, etc&hellip;</p>

<p>Eso en la práctica, es lo mismo que una plantilla (para los criticones y amantes
de la moda).</p>

<p>Un inconveniente que afronté al principio con esto, fue &ldquo;el tamaño asignado al
disco duro&rdquo;. Por ejemplo, el servidor de correo que me lleva 500 gigas, mientras
que en el sistema de monitoreo (nagios) solo se lleva 5 gigas.</p>

<p>La matriz tiene un disco de 5 gigas donde se instaló todo. Sobra espacio, ya que
borrando /usr/share/doc/ y la cache de apt, se quedo en menos de un giga. El
problema (con Xen) viene a la hora de agrandar el disco.</p>

<p>No se como proxmox maneja esa situación y sinceramente, <strong>no me interesa</strong>, ya
que:</p>

<p><strong>LVM resuelve el problema!</strong></p>

<p>Si no tienes la costumbre de instalar sobre LVM, deberías hacértela&hellip; Es muy
versátil.</p>

<p>BTRfs es otra buena opción, pero su rendimiento decae mucho con el tiempo (<strong>mi
experiencia</strong>).</p>

<p>Añadir un disco al volumen lógico y aumentar su tamaño <strong>resuelve el problema</strong>.</p>

<p>Claro, el sistema de archivos que instalaste, debe soportar tal operación, pero
por suerte, ext4 lo hace perfectamente y sin tener que desmontar el sistema de
archivos.</p>

<p>El problema es que <strong>NUNCA ME ACUERDO</strong> de los comandos para redimensionar el
volumen lógico.</p>

<figure class='code'><figcaption><span>&#8220;la nota&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pvcreate /dev/xvdb
</span><span class='line'>vgextend lvm /dev/xvdb
</span><span class='line'>lvm lvextend -l +100%FREE /dev/lvm/lv1
</span><span class='line'>resize2fs -p /dev/lvm/lv1
</span></code></pre></td></tr></table></div></figure>


<p>Note que mi grupo de volúmenes se llama <strong>lvm</strong> y que el volumen lógico se llama
<strong>lv1</strong> (no soy muy creativo con nombres para lvm). O sea, el disco quedaría
así:</p>

<h4>/dev/mapper/lvm-lv1</h4>

<p><strong>Nota para los retardados:</strong> <em>El dispositivo /dev/xvdb es OTRO disco que se le
añadió a la máquina para aumentar su espacio. Tenía /dev/xvda con 5 gigas y se
le añádió otro disco, el llamado /dev/xvdb, con más espacio. Oséase colocaste
otro disco en la máquina virtual o simplemente conectaste otro disco duro en el
canal sata de una máquina física</em></p>

<p>Entonces, linea por linea, en cámara lenta:</p>

<p>1- Convierte el disco /dev/xvdb en un volumen físico (mete el disco pal saco de
LVM) En mi caso, el  grupo de volúmenes se llama <strong>lvm</strong>, así que:</p>

<p>2- Extenderemos el grupo llamado <strong>lvm</strong> añadiendo el volumen físico
<strong>/dev/xvdb</strong> al volumen lógico <strong>lv1</strong>.</p>

<p>3- La parte que siempre se me olvida (el parámetro está raro con cojone)
Redimensionar el volumen lógico <strong>lv1</strong> a su máxima capacidad.</p>

<p>4- Por último, redimensionar el ext4 en <strong>/dev/lvm/lv1</strong> a su máxima capacidad.</p>

<p>Y listo! Ya tienes tu disco del tamaño que te de la gana ;-)</p>

<p>Puedes correr <strong>lvmdiskscan -l</strong> para cerciorarte de que todo esté como esperas,
no sea que hallas metido la delicada.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sysinfo en el motd]]></title>
    <link href="http://uranio-235.github.io/blog/2016/11/20/sysinfo-en-el-motd/"/>
    <updated>2016-11-20T17:13:27-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/11/20/sysinfo-en-el-motd</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://uranio-235.github.io/images/sysinfo.png" width="400" height="500" title="" ></p>

<p>Desde que lo vi en unbuntu server, había querido hacer que mi servidores
mostraran un overview en el <a href="https://en.wikipedia.org/wiki/Motd_(Unix">MOTD</a>)</p>

<p>Al menos debian, tiene una manera de cambiar el MOTD dinamicamente. Para sazonar
bien el MOTD, vamos a usar figlet, una aplicación que genera letras en ascii-art a
partir de una palabra dada.</p>

<figure class='code'><figcaption><span>&#8220;instalando todo&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aptitude install figlet
</span></code></pre></td></tr></table></div></figure>


<p>El directorio <strong>/etc/update-motd.d/</strong> ejecutará en orden alfabético (o numérico
en nuestro caso) aquellos script cuya salida estandard, compondrán nuestro MOTD.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando el update-motd.d&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir /etc/update-motd.d/
</span><span class='line'><span class="nb">cd</span> /etc/update-motd.d/
</span><span class='line'>touch 00-header <span class="o">&amp;&amp;</span> touch 01-sysinfo <span class="o">&amp;&amp;</span> touch 02-footer
</span><span class='line'>chmod +x /etc/update-motd.d/*
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente, nos echamos el MOTD de debian por defecto; que no deja de
restregarnos en cara la falta de garantía.</p>

<p>Además, el fichero <strong>/var/run/motd</strong> contendrá nuestro motd resultante, así que
lo lincamos con el que borramos.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando el update-motd.d&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rm /etc/motd
</span><span class='line'>ln -s /var/run/motd /etc/motd
</span></code></pre></td></tr></table></div></figure>


<p>Por una cuestión de organización, usaremos 3 ficheros:</p>

<p><strong>00-header</strong> con lo que queremos poner primero. En este caso, el nombre y
version de la distribución, además de un mensajito de bienvenida.</p>

<figure class='code'><figcaption><span>&#8220;00-header&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="o">[</span> -r /etc/lsb-release <span class="o">]</span> <span class="o">&amp;&amp;</span> . /etc/lsb-release
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$DISTRIB_DESCRIPTION&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -x /usr/bin/lsb_release <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>        <span class="nv">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="k">$(</span>lsb_release -s -d<span class="k">)</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>figlet <span class="k">$(</span>hostname<span class="k">)</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;\n&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Welcome to %s (%s).\n&quot;</span> <span class="s2">&quot;$DISTRIB_DESCRIPTION&quot;</span> <span class="s2">&quot;$(uname -r)&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yo instalo los sistemas en inglés, así que para mantener todo parejo, escribimos
<em>güelcome</em> y lo hacemos con <strong>printf</strong> para procesar mejor los &ldquo;\n&rdquo; y que pinche
sin importar la shell que se esté usando.</p>

<p>El segundo fichero será <strong>01-sysinfo</strong> y contendrá la parte linda, de la memoria
RAM en uso, el CPU, la carga y la dirección ip de la primera interfaz.</p>

<figure class='code'><figcaption><span>&#8220;01-sysinfo&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">date</span><span class="o">=</span><span class="sb">`</span>date<span class="sb">`</span>
</span><span class='line'><span class="nv">load</span><span class="o">=</span><span class="sb">`</span>cat /proc/loadavg <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">root_usage</span><span class="o">=</span><span class="sb">`</span>df -h / <span class="p">|</span> awk <span class="s1">&#39;/\// {print $(NF-1)}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">memory_usage</span><span class="o">=</span><span class="sb">`</span>free -m <span class="p">|</span> awk <span class="s1">&#39;/Mem:/ { total=$2 } /buffers\/cache/ { used=$3 } END { printf(&quot;%3.1f%%&quot;, used/total*100)}&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">swap_usage</span><span class="o">=</span><span class="sb">`</span>free -m <span class="p">|</span> awk <span class="s1">&#39;/Swap/ { printf(&quot;%3.1f%%&quot;, &quot;exit !$2;$3/$2*100&quot;) }&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">users</span><span class="o">=</span><span class="sb">`</span>users <span class="p">|</span> wc -w<span class="sb">`</span>
</span><span class='line'><span class="nb">time</span><span class="o">=</span><span class="sb">`</span>uptime <span class="p">|</span> grep -ohe <span class="s1">&#39;up .*&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/,/\ hours/g&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{ printf $2&quot; &quot;$3 }&#39;</span><span class="sb">`</span>
</span><span class='line'><span class="nv">processes</span><span class="o">=</span><span class="sb">`</span>ps aux <span class="p">|</span> wc -l<span class="sb">`</span>
</span><span class='line'><span class="nv">ip</span><span class="o">=</span><span class="sb">`</span>ip a  s dev eth0<span class="p">|</span>grep inet<span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="p">|</span>cut -d <span class="s1">&#39;/&#39;</span> -f 1<span class="sb">`</span>
</span><span class='line'>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;System information as of: $date\n&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;System load:\t%s\tIP Address:\t%s\n&quot;</span> <span class="nv">$load</span> <span class="nv">$ip</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Memory usage:\t%s\tSystem uptime:\t%s\n&quot;</span> <span class="nv">$memory_usage</span> <span class="s2">&quot;$time&quot;</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Usage on /:\t%s\tSwap usage:\t%s\n&quot;</span> <span class="nv">$root_usage</span> <span class="nv">$swap_usage</span>
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;Local Users:\t%s\tProcesses:\t%s\n\n&quot;</span> <span class="nv">$users</span> <span class="nv">$processes</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por último <strong>02-footer</strong> será la parte de abajo. Contendrá cualquier cosa que
quieras poner en el fichero <strong>/etc/motd.tail</strong> por ejemplo, una anotación que
quieras hacer específica para ese servidor. Se mostrará si existe el fichero.</p>

<figure class='code'><figcaption><span>&#8220;02-footer&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="o">[</span> -f /etc/motd.tail <span class="o">]</span> <span class="o">&amp;&amp;</span> cat /etc/motd.tail <span class="o">||</span> <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[openvpn user+pass]]></title>
    <link href="http://uranio-235.github.io/blog/2016/11/14/openvpn-user-plus-pass/"/>
    <updated>2016-11-14T21:41:05-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/11/14/openvpn-user-plus-pass</id>
    <content type="html"><![CDATA[<p>Si bien, openvpn con una llave estática es algo bastante sencillo de configurar;
tiene un grave problema: Que solo un cliente puede conectarse a la vez. En un
escenario donde por ejemplo, queremos crear una vpn para múltiples servidores
que deben conectarse, usar un clave estática se vuelve un problema. Una
topología de anillo podría ayudarnos resolverlo, pero cada servidor debería ser
cliente y servidor a la vez. Una VPN autenticada por usuario y contraseña
resuelve el problema de la manera más simplificada posible.</p>

<p>Creamos la infraestructura de certificados:</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando easy-rsa&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>mkdir Downloads/vpn
</span><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span><span class="nb">cd </span>Downloads/vpn
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r /etc/easy-rsa/* ./
</span></code></pre></td></tr></table></div></figure>


<p>Si quieres, si te da la mariconería, edita los parámetros del fichero que acabas
de copiar, pa que pongas los parámetros bonitillos, si no, espera a que openssl
los pregunte; a lo mejor ni los pregunta.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionamiento de certificados&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa init-pki
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa build-ca nopass
</span></code></pre></td></tr></table></div></figure>


<p>Note que la cadena de texto <strong>tuservidor</strong> debe ser remplazada por el nombre de
tu actor asiático preferido o, por algún nombre de tu agrado para el servidor.</p>

<figure class='code'><figcaption><span>&#8220;creando el certificado del servidor&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa build-server-full tuservidor nopass
</span></code></pre></td></tr></table></div></figure>


<p>Ahora el <a href="https://es.wikipedia.org/wiki/Diffie-Hellman">Diffie Hellman</a>, MUY
importante. Ponte cómodo que va pa largo:</p>

<figure class='code'><figcaption><span>&#8220;creando el diffie hellman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa gen-dh
</span></code></pre></td></tr></table></div></figure>


<p>Tiramos todo eso para /etc/openvpn en un directorio que designaremos con el
nombre de &ldquo;servidor&rdquo; (por una cuestión de orden).</p>

<figure class='code'><figcaption><span>&#8220;/etc/openvpn/&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>mkdir /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp pki/ca.crt /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp pki/dh.pem /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r pki/private/*.* /etc/openvpn/servidor/
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r pki/issued/tuservidor.* /etc/openvpn/servidor/
</span></code></pre></td></tr></table></div></figure>


<p>Ya tenemos todo listo pa armar el muñeco. Ahora vamos a crear la configuración
del servidor. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;servidor.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span><span class="nb">cd</span> /etc/openvpn/
</span><span class='line'><span class="o">[</span>lazaro@artema openvpn<span class="o">]</span><span class="nv">$ </span>cat servidor.conf
</span><span class='line'><span class="c"># como y por donde escuhan</span>
</span><span class='line'>port 1194
</span><span class='line'>proto udp
</span><span class='line'>dev tun
</span><span class='line'>
</span><span class='line'><span class="c"># los certificados</span>
</span><span class='line'>ca /etc/openvpn/servidor/ca.crt
</span><span class='line'>cert  /etc/openvpn/servidor/tuservidor.crt
</span><span class='line'>key /etc/openvpn/servidor/tuservidor.key
</span><span class='line'>
</span><span class='line'><span class="c"># el diffie hellman</span>
</span><span class='line'>dh /etc/openvpn/servidor/dh.pem
</span><span class='line'>
</span><span class='line'><span class="c"># la red que vamos a operar</span>
</span><span class='line'>server 10.8.0.0 255.255.255.0
</span><span class='line'>
</span><span class='line'><span class="c"># manda un ping cada 10 segundos</span>
</span><span class='line'><span class="c"># y tumba el tunel si a los 120 no hay respuesta</span>
</span><span class='line'>keepalive <span class="m">10</span> 120
</span><span class='line'>
</span><span class='line'><span class="c"># usa la compresión lzo</span>
</span><span class='line'>comp-lzo
</span><span class='line'>
</span><span class='line'><span class="c"># opera con los siguientes privilegios</span>
</span><span class='line'><span class="c">#user nobody</span>
</span><span class='line'><span class="c">#group nogroup</span>
</span><span class='line'>
</span><span class='line'><span class="c"># esto es para reforzarlo</span>
</span><span class='line'>persist-key
</span><span class='line'>persist-tun
</span><span class='line'>
</span><span class='line'><span class="c"># que tan elocuente será</span>
</span><span class='line'>verb 3
</span><span class='line'>
</span><span class='line'><span class="c"># mándale estos parámetros al cliente</span>
</span><span class='line'>push <span class="s2">&quot;redirect-gateway def1&quot;</span>
</span><span class='line'>push <span class="s2">&quot;dhcp-option DNS 8.8.8.8&quot;</span>
</span><span class='line'>push <span class="s2">&quot;dhcp-option DNS 8.8.4.4&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># y he aquí el truco de la autenticación</span>
</span><span class='line'>plugin /usr/lib/openvpn/plugins/openvpn-plugin-auth-pam.so login
</span><span class='line'>client-cert-not-required
</span><span class='line'>username-as-common-name
</span></code></pre></td></tr></table></div></figure>


<p>Con eso tenemos el servidor pinchando. Ahora vamos a hacer un fichero <strong>.ovpn</strong>
genérico, para dar a entender como sería la configuración de nuestro cliente.</p>

<p><strong>OJO</strong> El certificado que se le dará al cliente será el <strong>ca.crt</strong></p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;cliente.ovpn&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema openvpn<span class="o">]</span><span class="nv">$ </span>cat tuservidor.ovpn
</span><span class='line'>client
</span><span class='line'>dev tun
</span><span class='line'>proto udp
</span><span class='line'>remote 192.168.0.1 1194
</span><span class='line'>remote-cert-tls server
</span><span class='line'>auth-user-pass ~/autenticacion.conf
</span><span class='line'>comp-lzo
</span><span class='line'>&lt;ca&gt;
</span><span class='line'>-----BEGIN CERTIFICATE-----
</span><span class='line'>Lorem ipsum ad his scripta blandit partiendo, eum fastidii
</span><span class='line'>accumsan euripidis in, eum liber hendrerit an. Qui ut wisi
</span><span class='line'>vocibus suscipiantur, quo dicit ridens inciderint id. Quo mundi
</span><span class='line'>lobortis reformidans eu, legimus senserit definiebas an eos. Eu
</span><span class='line'>sit tincidunt incorrupte definitionem, vis mutat affert
</span><span class='line'>percipit cu, eirmod consectetuer signiferumque eu per. In usu
</span><span class='line'>latine equidem dolores. Quo no falli viris intellegam, ut fugit
</span><span class='line'>veritus placerat per.  Ius id vidit volumus mandamus, vide
</span><span class='line'>veritus democritum te nec, ei eos debet libris consulatu. No
</span><span class='line'>mei ferri graeco dicunt, ad cum veri accommodare. Sed at malis
</span><span class='line'>omnesque delicata, usu et iusto zzril meliore. Dicunt maiorum
</span><span class='line'>eloquentiam cum cu, sit summo dolor essent te. Ne quodsi
</span><span class='line'>nusquam legendos has, ea dicit voluptua eloquentiam pro, ad sit
</span><span class='line'>quas qualisque. Eos vocibus deserunt quaestio ei.
</span><span class='line'>-----END CERTIFICATE-----
</span><span class='line'>&lt;/ca&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Cada cliente de OpenVPN tiene su librito&hellip; Pero ese .ovpn genérico, debe ser
capaz de ser importado sin problema.</p>

<p>Por una cuestión de orden y seguridad, yo borro la base con la que se creó todo:</p>

<figure class='code'><figcaption><span>&#8220;clear area&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>rm -rf Downloads/vpn
</span></code></pre></td></tr></table></div></figure>


<p>Por cierto, cada configuración que pongas en <strong>/etc/openvpn</strong> cuya extensión
sea <strong>.conf</strong> se puede echar a andar con systemd.</p>

<figure class='code'><figcaption><span>&#8220;systemctl</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># systemctl status openvpn@servidor</span>
</span><span class='line'>● openvpn@servidor.service - OpenVPN connection to servidor
</span><span class='line'>   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/openvpn@.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
</span><span class='line'>   Active: inactive <span class="o">(</span>dead<span class="o">)</span>
</span><span class='line'>     Docs: man:openvpn<span class="o">(</span>8<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[recolección DomainPOP]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/el-domain-pop/"/>
    <updated>2016-10-22T22:44:36-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/el-domain-pop</id>
    <content type="html"><![CDATA[<p>Esta entrada ha sido copiada de mi antiguo blog <a href="http://otherlinuxblog.blogspot.com">puheroska</a>.
Vale aclarar que la escribí en el 2012&hellip;</p>

<p>Se sabe poco sobre los orígenes de ese aborto de la naturaleza que es conocido
por algunos como &ldquo;recolección aPOP&rdquo; o por otros como &ldquo;DomainPOP&rdquo;.</p>

<p><img class="right" src="http://uranio-235.github.io/images/apartado_postal.jpg" width="200" height="300" title="" ></p>

<p>Haciendo referencia al hecho de bajar todo el correo para un dominio de un pop
remoto. Muchos seguron lo identifican con un popular, potente y hermoso servidor
de correo, para windows llamado MDeamon (pronunciado por algunos como
&ldquo;emodimons&rdquo; y por otro como &ldquo;emdaimons&rdquo;). Muy conocido por su simple pero
elegante cliente web, el World Client. Entre sus <em>features</em>, podemos ver el
almacenamiento de TODO el correo de un dominio en un mismo buzón. Esto, sumado a
que en cuba todo el software es gratis :D lo convirtió en la herramienta
definitiva para las redes conmutadas.</p>

<p>Por otra parte, no todo se le impugna windows. Cuando aún el morro era de palo y
los cañones tiraban taquitos; ya citmatel usaba un CuciPOP (vean que clase de
nombre &ldquo;Cubic Circles = CuCiPOP&rdquo;) para depositar el correo de sus clientes por
lineas conmutadas; una clara implementación de aPOP. Esto resolvió ser la manera
mas burda pero eficiente para resolver el problema del correo en lineas
conmutadas.</p>

<p>Lo único que perturba este barato panorama, es el hecho de que si el correo
no tiene un To: bien claro, se jode todo y te ves obligado a usar MDeamon, que
en ese aspecto se saca todos los premios. Por su puesto, él es una de
la principales implementaciones de este modelo.</p>

<p>A menudo nos encontramos con que al bajar el correo con fetchmail, uno o varios
correos no van a su destino, y, por el contrario, van al postmaster sin tener
coincidencias de usuarios locales.</p>

<p>Hay quien esta acostumbrado a que el postmaster este LLENO de correos y eso
le parece normal, cuando el buen funcionamiento de un servidor, se mide por el
postmaster vacío.</p>

<p>Si un correo tiene un To: o un Cc: fetchmail lo parsea (del infintivo &ldquo;parsear&rdquo;)
y localiza una dirección de nuestro dominio basándose en que tiene el dominio en
la configuración. Como le dijimos &lsquo;is * here&rsquo; buscará cual nombre que este
delante de lo que se parezca a nuestro dominio y lo entregara.</p>

<p>Pero: Qué pasa si el To: o el Cc: NO tienen una dirección de nuestro dominio?</p>

<p>Supongamos que el correo viene Bcc: (blink carbon copy)</p>

<p>Como por ejemplo, los correos de listas de distribuciones, etc&hellip; En ese caso
los destinos se especifican en la orden RCPTO durante la sesión SMTP. Algunos
servidores incluyen encabezados como: &ldquo;Delivery-To&rdquo;,&ldquo;Envelope-To&rdquo; o
&ldquo;X-Orignial-To&rdquo; En mi opinión todos están de más, porque el Received: tiene esta
información; pero bueno, podríamos decirle a fetchmail que ademas de esos,
parsee encabezados Received: Eso parecería una solución, el único problema es
que no pincha :-P</p>

<h4>Hasta aquí la entrada de puheroska.</h4>

<p>En aquel momento consideraba eso &ldquo;un problema sin solución&rdquo;</p>

<p>Cuando llegué a salud, me encontré nuevamente con los DomainPOP, pero <strong>por
suerte</strong>, los exim de infomed hacen bien esa pincha y dejan plasmado el
destinatario en un encabezado &ldquo;Envelope-To&rdquo;</p>

<p>He aquí el fetchmailrc que tengo en el calixto:</p>

<figure class='code'><figcaption><span>&#8220;/etc/fetchmailrc&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Fichero de configuración de fethcmail, adecuado para los MultiPOP de infomed</span>
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>daemon 60
</span><span class='line'><span class="nb">set </span>postmaster <span class="s2">&quot;root&quot;</span>
</span><span class='line'><span class="nb">set </span>no bouncemail
</span><span class='line'><span class="nb">set </span>no spambounce
</span><span class='line'><span class="nb">set </span>logfile .fetchmail.log
</span><span class='line'><span class="nb">set </span>no syslog
</span><span class='line'>
</span><span class='line'>defaults
</span><span class='line'>    timeout 10
</span><span class='line'>    no keep
</span><span class='line'>    fetchall
</span><span class='line'>    expunge 5
</span><span class='line'>    dropstatus
</span><span class='line'>
</span><span class='line'>poll multipop.sld.cu port <span class="m">110</span> protocol pop3 localdomains tudominio.sld.cu
</span><span class='line'>    envelope <span class="m">1</span> <span class="s2">&quot;Envelope-to:&quot;</span>
</span><span class='line'>    no dns
</span><span class='line'>    username tuusuario
</span><span class='line'>    password tupassword
</span><span class='line'>    to * here
</span><span class='line'>    limitflush
</span><span class='line'>    smtphost localhost
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[domainpop con postfix]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/domainpop-con-postfix/"/>
    <updated>2016-10-22T17:35:46-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/domainpop-con-postfix</id>
    <content type="html"><![CDATA[<p>Otra importante entrada que decidí migrar de <a href="http://otherlinuxblog.blogspot.com">puheroska</a></p>

<p>Es tan sencillo como crear un dominio virtual y asignarle usuarios reales. Para
no volverte loco pon el nombre del usaurio igual que el del dominoio.</p>

<p>Por ejemplo, crea dos usuarios, uno llamado <em>subdom</em> y un segndo llamado <em>otro</em>.
Luego crea el fichero /etc/postfix/virtual y ponle esto:</p>

<figure class='code'><figcaption><span>&#8220;/etc/postfix/virtual&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>@subdom.tudomionio.cu   subdom
</span><span class='line'>@otro.tudominio.cu      otro
</span></code></pre></td></tr></table></div></figure>


<p><strong>postmap</strong> que tú conoces y <strong>postfix reload</strong></p>

<figure class='code'><figcaption><span>&#8220;postmap&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>postmap /etc/postfix/virtual
</span><span class='line'>postfix reload
</span></code></pre></td></tr></table></div></figure>


<p>Ya hemos declarado que <em>subdom</em> y <em>otro</em>, serán usuarios y que todo lo que se envíe
a los dominios virtuales @otro.tudominio.cu será almacenado en /var/mail/otro</p>

<p>Finalmente en el /etc/main.cf pones:</p>

<figure class='code'><figcaption><span>&#8220;/etc/postfix/main.cf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">virtual_alias_domains</span> <span class="o">=</span> subdom.tudominio.cu otro.tudominio.cu
</span><span class='line'><span class="nv">virtual_alias_maps</span> <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/virtual
</span></code></pre></td></tr></table></div></figure>


<p>OJO no olvides que en <strong>mydestination</strong> y debes incluir ambos dominios virtuales.</p>
]]></content>
  </entry>
  
</feed>
