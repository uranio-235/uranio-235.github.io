<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[El SysAdmin del 3er Mundo]]></title>
  <link href="http://uranio-235.github.io/atom.xml" rel="self"/>
  <link href="http://uranio-235.github.io/"/>
  <updated>2016-11-17T15:30:35-05:00</updated>
  <id>http://uranio-235.github.io/</id>
  <author>
    <name><![CDATA[låzaro]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[openvpn user+pass]]></title>
    <link href="http://uranio-235.github.io/blog/2016/11/14/openvpn-user-plus-pass/"/>
    <updated>2016-11-14T21:41:05-05:00</updated>
    <id>http://uranio-235.github.io/blog/2016/11/14/openvpn-user-plus-pass</id>
    <content type="html"><![CDATA[<p>Si bien, openvpn con una llave estática es algo bastante sencillo de configurar;
tiene un grave problema: Que solo un cliente puede conectarse a la vez. En un
escenario donde por ejemplo, queremos crear una vpn para múltiples servidores
que deben conectarse, usar un clave estática se vuelve un problema. Una
topología de anillo podría ayudarnos resolverlo, pero cada servidor debería ser
cliente y servidor a la vez. Una VPN autenticada por usuario y contraseña
resuelve el problema de la manera más simplificada posible.</p>

<p>Creamos la infraestructura de certificados:</p>

<figure class='code'><figcaption><span>&#8220;aprovisionando easy-rsa&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>mkdir Downloads/vpn
</span><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span><span class="nb">cd </span>Downloads/vpn
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r /etc/easy-rsa/* ./
</span></code></pre></td></tr></table></div></figure>


<p>Si quieres, si te da la mariconería, edita los parámetros del fichero que acabas
de copiar, pa que pongas los parámetros bonitillos, si no, espera a que openssl
los pregunte; a lo mejor ni los pregunta.</p>

<figure class='code'><figcaption><span>&#8220;aprovisionamiento de certificados&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa init-pki
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa build-ca nopass
</span></code></pre></td></tr></table></div></figure>


<p>Note que la cadena de texto <strong>tuservidor</strong> debe ser remplazada por el nombre de
tu actor asiático preferido o, por algún nombre de tu agrado para el servidor.</p>

<figure class='code'><figcaption><span>&#8220;creando el certificado del servidor&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa build-server-full tuservidor nopass
</span></code></pre></td></tr></table></div></figure>


<p>Ahora el <a href="https://es.wikipedia.org/wiki/Diffie-Hellman">Diffie Hellman</a>, MUY
importante. Ponte cómodo que va pa largo:</p>

<figure class='code'><figcaption><span>&#8220;creando el diffie hellman&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>easyrsa gen-dh
</span></code></pre></td></tr></table></div></figure>


<p>Tiramos todo eso para /etc/openvpn en un directorio que designaremos con el
nombre de &ldquo;servidor&rdquo; (por una cuestión de orden).</p>

<figure class='code'><figcaption><span>&#8220;/etc/openvpn/&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>mkdir /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp pki/ca.crt /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp pki/dh.pem /etc/openvpn/servidor
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r pki/private/*.* /etc/openvpn/servidor/
</span><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span>cp -r pki/issued/tuservidor.* /etc/openvpn/servidor/
</span></code></pre></td></tr></table></div></figure>


<p>Ya tenemos todo listo pa armar el muñeco. Ahora vamos a crear la configuración
del servidor. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;servidor.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema vpn<span class="o">]</span><span class="nv">$ </span><span class="nb">cd</span> /etc/openvpn/
</span><span class='line'><span class="o">[</span>lazaro@artema openvpn<span class="o">]</span><span class="nv">$ </span>cat servidor.conf
</span><span class='line'><span class="c"># como y por donde escuhan</span>
</span><span class='line'>port 1194
</span><span class='line'>proto udp
</span><span class='line'>dev tun
</span><span class='line'>
</span><span class='line'><span class="c"># los certificados</span>
</span><span class='line'>ca /etc/openvpn/servidor/ca.crt
</span><span class='line'>cert  /etc/openvpn/servidor/tuservidor.crt
</span><span class='line'>key /etc/openvpn/servidor/tuservidor.key
</span><span class='line'>
</span><span class='line'><span class="c"># el diffie hellman</span>
</span><span class='line'>dh /etc/openvpn/servidor/dh.pem
</span><span class='line'>
</span><span class='line'><span class="c"># la red que vamos a operar</span>
</span><span class='line'>server 10.8.0.0 255.255.255.0
</span><span class='line'>
</span><span class='line'><span class="c"># manda un ping cada 10 segundos</span>
</span><span class='line'><span class="c"># y tumba el tunel si a los 120 no hay respuesta</span>
</span><span class='line'>keepalive <span class="m">10</span> 120
</span><span class='line'>
</span><span class='line'><span class="c"># usa la compresión lzo</span>
</span><span class='line'>comp-lzo
</span><span class='line'>
</span><span class='line'><span class="c"># opera con los siguientes privilegios</span>
</span><span class='line'><span class="c">#user nobody</span>
</span><span class='line'><span class="c">#group nogroup</span>
</span><span class='line'>
</span><span class='line'><span class="c"># esto es para reforzarlo</span>
</span><span class='line'>persist-key
</span><span class='line'>persist-tun
</span><span class='line'>
</span><span class='line'><span class="c"># que tan elocuente será</span>
</span><span class='line'>verb 3
</span><span class='line'>
</span><span class='line'><span class="c"># mándale estos parámetros al cliente</span>
</span><span class='line'>push <span class="s2">&quot;redirect-gateway def1&quot;</span>
</span><span class='line'>push <span class="s2">&quot;dhcp-option DNS 8.8.8.8&quot;</span>
</span><span class='line'>push <span class="s2">&quot;dhcp-option DNS 8.8.4.4&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># y he aquí el truco de la autenticación</span>
</span><span class='line'>plugin /usr/lib/openvpn/plugins/openvpn-plugin-auth-pam.so login
</span><span class='line'>client-cert-not-required
</span><span class='line'>username-as-common-name
</span></code></pre></td></tr></table></div></figure>


<p>Con eso tenemos el servidor pinchando. Ahora vamos a hacer un fichero <strong>.ovpn</strong>
genérico, para dar a entender como sería la configuración de nuestro cliente.</p>

<p><strong>OJO</strong> El certificado que se le dará al cliente será el <strong>ca.crt</strong></p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;cliente.ovpn&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema openvpn<span class="o">]</span><span class="nv">$ </span>cat tuservidor.ovpn
</span><span class='line'>client
</span><span class='line'>dev tun
</span><span class='line'>proto udp
</span><span class='line'>remote 192.168.0.1 1194
</span><span class='line'>remote-cert-tls server
</span><span class='line'>auth-user-pass ~/autenticacion.conf
</span><span class='line'>comp-lzo
</span><span class='line'>&lt;ca&gt;
</span><span class='line'>-----BEGIN CERTIFICATE-----
</span><span class='line'>Lorem ipsum ad his scripta blandit partiendo, eum fastidii
</span><span class='line'>accumsan euripidis in, eum liber hendrerit an. Qui ut wisi
</span><span class='line'>vocibus suscipiantur, quo dicit ridens inciderint id. Quo mundi
</span><span class='line'>lobortis reformidans eu, legimus senserit definiebas an eos. Eu
</span><span class='line'>sit tincidunt incorrupte definitionem, vis mutat affert
</span><span class='line'>percipit cu, eirmod consectetuer signiferumque eu per. In usu
</span><span class='line'>latine equidem dolores. Quo no falli viris intellegam, ut fugit
</span><span class='line'>veritus placerat per.  Ius id vidit volumus mandamus, vide
</span><span class='line'>veritus democritum te nec, ei eos debet libris consulatu. No
</span><span class='line'>mei ferri graeco dicunt, ad cum veri accommodare. Sed at malis
</span><span class='line'>omnesque delicata, usu et iusto zzril meliore. Dicunt maiorum
</span><span class='line'>eloquentiam cum cu, sit summo dolor essent te. Ne quodsi
</span><span class='line'>nusquam legendos has, ea dicit voluptua eloquentiam pro, ad sit
</span><span class='line'>quas qualisque. Eos vocibus deserunt quaestio ei.
</span><span class='line'>-----END CERTIFICATE-----
</span><span class='line'>&lt;/ca&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Cada cliente de OpenVPN tiene su librito&hellip; Pero ese .ovpn genérico, debe ser
capaz de ser importado sin problema.</p>

<p>Por una cuestión de orden y seguridad, yo borro la base con la que se creó todo:</p>

<figure class='code'><figcaption><span>&#8221;&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>rm -rf Downloads/vpn
</span></code></pre></td></tr></table></div></figure>


<p>Por cierto, cada configuración que pongas en <strong>/etc/openvpn</strong> cuya extensión
sea <strong>.conf</strong> se puede echar a andar con systemd.</p>

<figure class='code'><figcaption><span>&#8220;systemctl</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># systemctl status openvpn@servidor</span>
</span><span class='line'>● openvpn@servidor.service - OpenVPN connection to servidor
</span><span class='line'>   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/openvpn@.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
</span><span class='line'>   Active: inactive <span class="o">(</span>dead<span class="o">)</span>
</span><span class='line'>     Docs: man:openvpn<span class="o">(</span>8<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># file /etc/openvpn/servidor.conf </span>
</span><span class='line'>/etc/openvpn/servidor.conf: UTF-8 Unicode text
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[recolección DomainPOP]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/el-domain-pop/"/>
    <updated>2016-10-22T22:44:36-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/el-domain-pop</id>
    <content type="html"><![CDATA[<p>Esta entrada ha sido copiada de mi antiguo blog <a href="http://otherlinuxblog.blogspot.com">puheroska</a>.
Vale aclarar que la escribí en el 2012&hellip;</p>

<p>Se sabe poco sobre los orígenes de ese aborto de la naturaleza que es conocido
por algunos como &ldquo;recolección aPOP&rdquo; o por otros como &ldquo;DomainPOP&rdquo;.</p>

<p><img class="right" src="http://uranio-235.github.io/images/apartado_postal.jpg" width="200" height="300" title="" ></p>

<p>Haciendo referencia al hecho de bajar todo el correo para un dominio de un pop
remoto. Muchos seguron lo identifican con un popular, potente y hermoso servidor
de correo, para windows llamado MDeamon (pronunciado por algunos como
&ldquo;emodimons&rdquo; y por otro como &ldquo;emdaimons&rdquo;). Muy conocido por su simple pero
elegante cliente web, el World Client. Entre sus <em>features</em>, podemos ver el
almacenamiento de TODO el correo de un dominio en un mismo buzón. Esto, sumado a
que en cuba todo el software es gratis :D lo convirtió en la herramienta
definitiva para las redes conmutadas.</p>

<p>Por otra parte, no todo se le impugna windows. Cuando aún el morro era de palo y
los cañones tiraban taquitos; ya citmatel usaba un CuciPOP (vean que clase de
nombre &ldquo;Cubic Circles = CuCiPOP&rdquo;) para depositar el correo de sus clientes por
lineas conmutadas; una clara implementación de aPOP. Esto resolvió ser la manera
mas burda pero eficiente para resolver el problema del correo en lineas
conmutadas.</p>

<p>Lo único que perturba este barato panorama, es el hecho de que si el correo
no tiene un To: bien claro, se jode todo y te ves obligado a usar MDeamon, que
en ese aspecto se saca todos los premios. Por su puesto, él es una de
la principales implementaciones de este modelo.</p>

<p>A menudo nos encontramos con que al bajar el correo con fetchmail, uno o varios
correos no van a su destino, y, por el contrario, van al postmaster sin tener
coincidencias de usuarios locales.</p>

<p>Hay quien esta acostumbrado a que el postmaster este LLENO de correos y eso
le parece normal, cuando el buen funcionamiento de un servidor, se mide por el
postmaster vacío.</p>

<p>Si un correo tiene un To: o un Cc: fetchmail lo parsea (del infintivo &ldquo;parsear&rdquo;)
y localiza una dirección de nuestro dominio basándose en que tiene el dominio en
la configuración. Como le dijimos &lsquo;is * here&rsquo; buscará cual nombre que este
delante de lo que se parezca a nuestro dominio y lo entregara.</p>

<p>Pero: Qué pasa si el To: o el Cc: NO tienen una dirección de nuestro dominio?</p>

<p>Supongamos que el correo viene Bcc: (blink carbon copy)</p>

<p>Como por ejemplo, los correos de listas de distribuciones, etc&hellip; En ese caso
los destinos se especifican en la orden RCPTO durante la sesión SMTP. Algunos
servidores incluyen encabezados como: &ldquo;Delivery-To&rdquo;,&ldquo;Envelope-To&rdquo; o
&ldquo;X-Orignial-To&rdquo; En mi opinión todos están de más, porque el Received: tiene esta
información; pero bueno, podríamos decirle a fetchmail que ademas de esos,
parsee encabezados Received: Eso parecería una solución, el único problema es
que no pincha :-P</p>

<h4>Hasta aquí la entrada de puheroska.</h4>

<p>En aquel momento consideraba eso &ldquo;un problema sin solución&rdquo;</p>

<p>Cuando llegué a salud, me encontré nuevamente con los DomainPOP, pero <strong>por
suerte</strong>, los exim de infomed hacen bien esa pincha y dejan plasmado el
destinatario en un encabezado &ldquo;Envelope-To&rdquo;</p>

<p>He aquí el fetchmailrc que tengo en el calixto:</p>

<figure class='code'><figcaption><span>&#8220;/etc/fetchmailrc&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Fichero de configuración de fethcmail, adecuado para los MultiPOP de infomed</span>
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>daemon 60
</span><span class='line'><span class="nb">set </span>postmaster <span class="s2">&quot;root&quot;</span>
</span><span class='line'><span class="nb">set </span>no bouncemail
</span><span class='line'><span class="nb">set </span>no spambounce
</span><span class='line'><span class="nb">set </span>logfile .fetchmail.log
</span><span class='line'><span class="nb">set </span>no syslog
</span><span class='line'>
</span><span class='line'>defaults
</span><span class='line'>    timeout 10
</span><span class='line'>    no keep
</span><span class='line'>    fetchall
</span><span class='line'>    expunge 5
</span><span class='line'>    dropstatus
</span><span class='line'>
</span><span class='line'>poll multipop.sld.cu port <span class="m">110</span> protocol pop3 localdomains tudominio.sld.cu
</span><span class='line'>    envelope <span class="m">1</span> <span class="s2">&quot;Envelope-to:&quot;</span>
</span><span class='line'>    no dns
</span><span class='line'>    username tuusuario
</span><span class='line'>    password tupassword
</span><span class='line'>    to * here
</span><span class='line'>    limitflush
</span><span class='line'>    smtphost localhost
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[domainpop con postfix]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/domainpop-con-postfix/"/>
    <updated>2016-10-22T17:35:46-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/domainpop-con-postfix</id>
    <content type="html"><![CDATA[<p>Otra importante entrada que decidí migrar de <a href="http://otherlinuxblog.blogspot.com">puheroska</a></p>

<p>Es tan sencillo como crear un dominio virtual y asignarle usuarios reales. Para
no volverte loco pon el nombre del usaurio igual que el del dominoio.</p>

<p>Por ejemplo, crea dos usuarios, uno llamado <em>subdom</em> y un segndo llamado <em>otro</em>.
Luego crea el fichero /etc/postfix/virtual y ponle esto:</p>

<figure class='code'><figcaption><span>&#8220;/etc/postfix/virtual&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>@subdom.tudomionio.cu   subdom
</span><span class='line'>@otro.tudominio.cu      otro
</span></code></pre></td></tr></table></div></figure>


<p><strong>postmap</strong> que tú conoces y <strong>postfix reload</strong></p>

<figure class='code'><figcaption><span>&#8220;postmap&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>postmap /etc/postfix/virtual
</span><span class='line'>postfix reload
</span></code></pre></td></tr></table></div></figure>


<p>Ya hemos declarado que <em>subdom</em> y <em>otro</em>, serán usuarios y que todo lo que se envíe
a los dominios virtuales @otro.tudominio.cu será almacenado en /var/mail/otro</p>

<p>Finalmente en el /etc/main.cf pones:</p>

<figure class='code'><figcaption><span>&#8220;/etc/postfix/main.cf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">virtual_alias_domains</span> <span class="o">=</span> subdom.tudominio.cu otro.tudominio.cu
</span><span class='line'><span class="nv">virtual_alias_maps</span> <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/virtual
</span></code></pre></td></tr></table></div></figure>


<p>OJO no olvides que en <strong>mydestination</strong> y debes incluir ambos dominios virtuales.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[túnel 6in4]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/tunel-6in4/"/>
    <updated>2016-10-22T03:18:11-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/tunel-6in4</id>
    <content type="html"><![CDATA[<p>Típico: Quiero darle cumplimiento a la resolución 185/2016, pero mi proveedor
no me ha dado una ipv6</p>

<p>¿Tienes una ipv4 pública? Felicidades, puedes jugar con ipv6</p>

<p>Existe una tecnología transisional poco recomendada que se conoce como <a href="https://es.wikipedia.org/wiki/6to4?">6in4</a>,
consiste en levantar un túnel especial que te permite hacerte con un rango ipv6
pa jugar y comer mierda, porque no es ipv6 puro. Supuestamente internet debe
tener servididores que hagan relay hacia ipv6 real pero hoy en día son cada vez
menos.</p>

<p>y ahora un mensaje:</p>

<p>Si bien <em>Hurricane Electric</em> provee <a href="http://tunnelbroker.net/">túneles</a>, siendo
esto una solución PERFECTA; hay que tener en cuenta que: No se con que cuchara
etecsa se coma eso.</p>

<p>Pero volviendo al tema:</p>

<p>Las grandes redes dual-stack como google y facebook, tiene sus 6in4 bien
afinaditos, así que a través de un 6in4 puedes perfectamente llegar a ellos.
En otros tiempo, esta solución me pinchó finísimo pero recientemente no la he
probado.</p>

<p>Digamos que tu ip pública es <strong>220.110.12.190</strong> Calculamos la ipv6 que te toca:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>   ipv6calc --quiet --action conv6to4 220.110.12.190
</span><span class='line'>2002:dc6e:cbe::
</span></code></pre></td></tr></table></div></figure>


<p>Digamos que devolvió el prefijo <strong>2002:dc6e:cbe::</strong> Ese será nuestro prefijo, para
meter cuantas direcciones querramos.</p>

<figure class='code'><figcaption><span>&#8220;creando el túnel&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip tunnel add tun6to4 mode sit ttl <span class="m">255</span> remote any <span class="nb">local </span>10.0.0.1
</span><span class='line'>ip link <span class="nb">set </span>tun6to4 up
</span><span class='line'>ip -6 addr add 2002:dc6e:cbe::1/16 dev tun6to4
</span></code></pre></td></tr></table></div></figure>


<p>Una vez levantada la interfaze, levantamos una puerta de enlace que saque todas
las direcciones ipv6 del túnel que traduce las ipv4:</p>

<figure class='code'><figcaption><span>&#8220;ruta&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip -6 route add 2000::/3 via ::192.88.99.1 dev tun6to4 metric 1
</span></code></pre></td></tr></table></div></figure>


<p>Nota que la dirección ::192.88.99.1 es así de palo, es una ruta especial que da
lugar al túnel 6in4.</p>

<p>Ahora, asignamos la primera dirección ipv6 a la interfaz pública (eth0):</p>

<figure class='code'><figcaption><span>&#8220;ip a&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ip -6 addr add 2002:dc6e:cbe::cafe/64 dev eth0
</span></code></pre></td></tr></table></div></figure>


<p>A la interfaz de la LAN (eth1) le asignamos una ip también, pero le decimos que
::cafe es la puerta de enlace predeterminada. En su momento, el servidor con
debian me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/network/interfaces&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># la asignamos a la publica una ipv6</span>
</span><span class='line'>iface eth0 inet6 static
</span><span class='line'>        address 2002:a00:1::cafe
</span><span class='line'>        netmask 64
</span><span class='line'>
</span><span class='line'><span class="c"># y la interfaz de la LAN se asignamos otra</span>
</span><span class='line'><span class="c"># pero ::cafe será la puerta de enlace</span>
</span><span class='line'>iface eth1 inet6 static
</span><span class='line'>        address 2002:a00:1:21c:c0ff:feb2:91c2
</span><span class='line'>        netmask 64
</span><span class='line'>        gateway 2002:a00:1::cafe
</span></code></pre></td></tr></table></div></figure>


<p>En la entrada anterior vimos como usar el forward y como habilitarlo.
Recuerdas?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cortafuegos ipv6 sencillo]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/cortafuegos-ipv6-sencillo/"/>
    <updated>2016-10-22T02:56:00-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/cortafuegos-ipv6-sencillo</id>
    <content type="html"><![CDATA[<p>En entradas anteriores mencionábamos la necesidad urgente de un cortafuegos para
ipv6. Aquí les va uno hipotético y sencillo:</p>

<p>Sean:</p>

<ul>
<li>la red 2001:db8:: /64</li>
<li>eth0 interfaz de cara al enlace</li>
<li>eth1 interfaz de cara a la LAN</li>
<li>2001:db8::1 servidor DNS</li>
<li>2001:db8::2 servidor de correo</li>
</ul>


<figure class='code'><figcaption><span>&#8220;firewall ipv6&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># al piedra angular</span>
</span><span class='line'>ip6tables -A INPUT   -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c"># nuestro ruter no tiene ningún servicio corriendo</span>
</span><span class='line'><span class="c"># así que no permitimos nada pa adentro</span>
</span><span class='line'>ip6tables -A INPUT -j DROP
</span><span class='line'>
</span><span class='line'><span class="c"># el forward desde internet hacia la LAN va descartado</span>
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -j DROP
</span><span class='line'>
</span><span class='line'><span class="c"># permitimos que las máquinas en la LAN vean los sitios web de internet</span>
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">80</span>  -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">443</span> -j ACCEPT
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># al servidor DNS le permitimos que encueste a otros servidores dns</span>
</span><span class='line'><span class="c"># nuestro servidor dns es un servidor de cache, para la LAN. Dice:</span>
</span><span class='line'><span class="c"># lo que venga por la lan, a salir por el enlace, proveniente del servidor DNS</span>
</span><span class='line'><span class="c"># y además, cuto puerto de destino sea el 53, permítelo</span>
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p udp --dport <span class="m">53</span> -s 2001:db8::01 -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">53</span> -s 2001:db8::01 -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c"># permitimos que el servidor de correo sea visible desde afuera</span>
</span><span class='line'><span class="c"># lo que venga, de afuera, pa adentro, protocolo tcp del puerto tal</span>
</span><span class='line'><span class="c"># y como destino sea la ip del servidor de correo, permítelo</span>
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -p tcp --dport <span class="m">25</span>  -d 2001:db8::2 -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -p tcp --dport <span class="m">80</span>  -d 2001:db8::2 -j ACCEPT
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -p tcp --dport <span class="m">110</span> -d 2001:db8::2 -j ACCEPT
</span><span class='line'>
</span><span class='line'><span class="c"># el resto del tráfico proveniente de la LAN hacia internet, le hacemos reject</span>
</span><span class='line'><span class="c"># esto evita que los teléfonos no se queden locos intentando buscar salida</span>
</span><span class='line'>ip6tables -A FORWARD -i eth1 -o eth0 -j REJECT
</span><span class='line'>
</span><span class='line'><span class="c"># el resto del tráfico que venga de internet, le hacemos DROP</span>
</span><span class='line'>ip6tables -A FORWARD -i eth0 -o eth1 -j DROP
</span><span class='line'>
</span><span class='line'><span class="c"># habilita el forward</span>
</span><span class='line'>sysctl net.ipv6.conf.all.forwarding<span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[las reglas del juego ipv6]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/poniendo-direcciones-ipv6/"/>
    <updated>2016-10-22T01:17:30-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/poniendo-direcciones-ipv6</id>
    <content type="html"><![CDATA[<p>   <blockquote><p>ipv4 se parece a ipv6, lo que las damas se parecen al ajedrez</p></blockquote></p>

<p>Ambos juegos se desarrollan sobre un tablero de 64 casillas, moviendo fichas y
comiéndose las del adversario. Pero sus fundamentos, aunque similares, no son
iguales y para que hablar de las reglas.</p>

<p>En la entrada anterior, comentaba los disparates primordiales que he ido viendo
con respecto a ipv6. Aquí les dejo un básico sobre las reglas del juego con
ipv6.</p>

<h4>2001:db8:: NO ES UN RANGO USABLE</h4>

<p>Realmente sí lo es, pero está reservado <strong>para documentación</strong> esto quiere
decir que <strong>NO DEBE HABER UNA LAN CON ESTE RANGO</strong>.</p>

<h4>¿Entonces la LAN y la pública?</h4>

<p>En ipv6, las direcciones de la LAN, son parte de la pública. No existe una
distinción real entre LAN o internet y sobre todo:</p>

<p><strong>NO HAY NATEO!!!</strong></p>

<p>Te delegarán un prefijo y tú tendrás suficientes ip como para asignarle un ip a
cada partícula de polvo de tu oficina. Pero ojo:</p>

<p><strong>esas ip serán visibles desde y hacia internet</strong></p>

<p>Cada ip que delegues de tu prefijo, formará parte del ciberspacio. Visto de otra
forma. Si asignas 2001:db8::aaa1 a una máquina en tu LAN, esa dirección será de
facto, alcanzable desde internet (si tienes internet claro).</p>

<p>Para lidiar con esta situación, deberás tener bien claro el forward en tu
router.</p>

<h3>pero yo no tengo una ipv6 real</h3>

<p>No estés tan seguro&hellip; Si tienes una ipv4 pública, tienes algo parecido. Más
adelante veremos como hacer un túnel 6in4, así que el prefijo de dirección más
apropiado para tu LAN lo calcularás así:</p>

<figure class='code'><figcaption><span>&#8220;ipv6calc&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ipv6calc --quiet --action conv6to4 tu.ipv4.publica.aqui
</span></code></pre></td></tr></table></div></figure>


<p>Nota para los imbéciles: ¿¿Notaste lo que dice <strong>tu.ipv4.publica.aqui</strong>??</p>

<p>Eso te devolverá algo como <strong>2002:a00:1::</strong> lo cual es prefijo 6in4 en base a la
ipv4 pública de tu LAN. Ese será tu prefijo ipv6.</p>

<p>Otra cosa: <strong>NO SE PONEN IP CORRIDAS</strong> como por ejemplo 2002:a00:1::1 y
2002:a00:1::2 ya que una de las cosas que intenta evitar ipv6 es el escaneo de
redes. Las ipv6 se calculan en base a la mac. Más tarde veremos como lo hace el
protocolo SLAAC.</p>

<p>A mi en lo personal, me gusta ponerle al ruter &ldquo;cafe&rdquo; <strong>2002:a00:1::cafe</strong> y un
ejemplo mas creativo 2002:a00:1::caba110 (caballo) así cada servidor tendría un
nombre: cafe, caba110, ada, ded0, dad0, 1ce, a5ado</p>

<p>Por cierto, los 0 a la izquierda, se descartan</p>

<p>2002:a00:1::<strong>000</strong>1 es la misma dirección que 2002:a00:1::1 y de echo, es mucho más
largo, porque tiene una pila de 0 por medio, pero así se expresa de manera más
corta. Incluso así puede hacer ping y cualquier referencia a la dirección que el
stack ipv6 se encarga de comprimirla y descomprimirla, sepa usted.</p>

<p>Note que en <strong>a00</strong> sí se ponen los ceros, porque <strong>NO</strong> están a la izquierda.</p>

<h3>Entonces el Forward</h3>

<p>El forward de un cortafuegos será lo que controla que será visible dentro de tu
LAN. La puerta de enlace decide qué será visible o no. Más adelante veremos un
firewall ipv6 lo más sencillo posible. Usaremos ip6tables.</p>

<h3>¿y el dhcp?</h3>

<p>Hay servidores dhcp para ipv6, pero el mecanismo bacán es SLAAC. Te adelanto que
dnsmasq tiene SLAAC, pero el pro, es <strong>radvd</strong></p>

<p>Una configuración de radvd típica se ve así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/radvd.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="n">interface</span> <span class="n">eth1</span> <span class="p">{</span>
</span><span class='line'>     <span class="n">AdvSendAdvert</span> <span class="n">on</span><span class="p">;</span>
</span><span class='line'>     <span class="n">MinRtrAdvInterval</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>     <span class="n">MaxRtrAdvInterval</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>     <span class="n">prefix</span> <span class="o">::/</span><span class="mi">64</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">AdvOnLink</span> <span class="n">on</span><span class="p">;</span>
</span><span class='line'>            <span class="n">AdvAutonomous</span> <span class="n">on</span><span class="p">;</span>
</span><span class='line'>            <span class="n">AdvRouterAddr</span> <span class="n">on</span><span class="p">;</span>
</span><span class='line'>     <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Como vez, no especificas que rango de ip darás ni cosa parecida. El rango que
darás, será del mismo prefijo que tiene en la interfaz eth1 (en este caso).</p>

<h3>¿qué son las direcciones ff02 y fe80?</h3>

<p>Son direcciones link-local. En ipv6, hay direcciones del tipo &ldquo;multicast&rdquo; cuyo
destino serán todas las ip que estén dislocadas en la red. Esto no debe
confundirse con anycast y vale aclarar que en ipv6 NO EXISTE broadcast.</p>

<figure class='code'><figcaption><span>&#8220;ping multicast&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># ping ff02::1%wlp2s0</span>
</span><span class='line'>PING ff02::1%wlp2s0<span class="o">(</span>ff02::1%wlp2s0<span class="o">)</span> <span class="m">56</span> data bytes
</span><span class='line'><span class="m">64</span> bytes from fe80::420e:85ff:fe7a:e6d7%wlp2s0: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">17</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span><span class="m">112</span> ms
</span><span class='line'><span class="m">64</span> bytes from fe80::420e:85ff:fe7a:e6d7%wlp2s0: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">18</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>7.42 ms
</span></code></pre></td></tr></table></div></figure>


<p>Eso hará le hará ping a malanga y puesto de vianda que tengan un
<a href="https://es.wikipedia.org/wiki/Direcci%C3%B3n_de_Enlace-Local">link-local</a> en la
red que tiene conectado el cable de eth0.</p>

<p>Sin embargo, al hacer ping a <strong>ff02::2</strong> solo responderán aquellas ipv6 que sean
<strong>routers</strong>. Eso es una manera de saber quien es un router o simplemente si hay
alguno.</p>

<p>Las direcciones <strong>fe80::</strong> son enlaces locales. Podría decirse que las
direcciones fe80 son como decir &ldquo;arp&rdquo; pero se les puede hacer ping y otras
boberías. O sea, es de palo tener direcciones fe80:: aparte de las globales.</p>

<h4>¿y dnsmasq?</h4>

<p>Ese es otro que bien baila y con cualquier música. Tiene un SLAAC implementado
que es una maravilla. Al parámetro <strong>dhcp-range</strong> se le mandan unas clásulas
especiales que hacen maravillas. La que más me gusta es <strong>ra-names</strong> que asigna
una ip y un registro AAAA para máquina.</p>

<h4>que bolá con bind?</h4>

<p>Los registros del tipo AAAA resuelven punteros address para direcciones ipv6.</p>

<p>Sean:</p>

<ul>
<li> ns01 el nombre del servidor</li>
<li> ns01 registro A con ip 192.168.0.1</li>
<li> ns01 registro AAAA con ip 2001:db8::cafe</li>
<li> proxy registro CNAME que apunta a ns01</li>
</ul>


<p>Cuando preguntes por la ipv6 de proxy, resolverá 2001:db8::cafe, de esta manera,
el sistema operativo preguntará simplemente por &ldquo;proxy&rdquo; y el DNS le resolverá
ambas direcciones (4 y 6), la configuración de dichos stack, decidirá cual usar.</p>

<p>Esto en bind se escribe así:</p>

<figure class='code'><figcaption><span>&#8220;dominio.zone&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">;</span> El <span class="m">1</span> el proxy
</span><span class='line'>ns01         IN      A       192.168.0.1
</span><span class='line'>ns01         IN      AAAA    2001:db8::cafe
</span><span class='line'>             IN      MX  <span class="m">0</span>   ns01
</span><span class='line'>ruter        IN      CNAME   ns01
</span><span class='line'>proxy        IN      CNAME   ns01
</span></code></pre></td></tr></table></div></figure>


<p>Ejemplo vivo:</p>

<figure class='code'><figcaption><span>&#8220;ping ipv6 a un CNAME&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>ping -6 proxy.hcg.sld.cu
</span><span class='line'>PING proxy.hcg.sld.cu<span class="o">(</span>ns01 <span class="o">(</span>2002:c9dc:d582::cafe<span class="o">))</span> <span class="m">56</span> data bytes
</span><span class='line'><span class="m">64</span> bytes from ns01 <span class="o">(</span>2002:c9dc:d582::cafe<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>0.100 ms
</span><span class='line'><span class="m">64</span> bytes from ns01 <span class="o">(</span>2002:c9dc:d582::cafe<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nb">time</span><span class="o">=</span>0.174 ms
</span></code></pre></td></tr></table></div></figure>


<h3>¿Qué aprendimos?</h3>

<ul>
<li> 2001:db8:: es un rango reservado, no se usa</li>
<li> ipv6 es complejo pero no complicado.</li>
<li> hay un ip6tables aparte de iptables</li>
<li> ipv6 NO necesita nateo</li>
<li> que existen tecnologías transicionales como 6in4</li>
<li> no es DHCP, si no RA y SLAAC</li>
<li> no hay ARP, si no link-local</li>
<li> los punteros AAAA funcionan igualito que los A</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[la resolución 185/2016]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/22/ipv6/"/>
    <updated>2016-10-22T00:51:14-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/22/ipv6</id>
    <content type="html"><![CDATA[<p>El otro día, me doy por enterado que que lanzaron la resolución 185/2016 nada
menos que sobre la implementación de ipv6. Como todo en cuba; llega tarde pero
bien recibido. Me reí muchísimo cuando la leí. No con la ley, si no imaginándome
la puesta en vigor de la ley.</p>

<p>Me imaginé:</p>

<ul>
<li>la gente poniendo ipv6 en su LAN con el prefijo 2001:db8::</li>
<li>los cortafuegos sin configurar</li>
<li>los que no leen preguntando como hacer un forward o un nateo</li>
</ul>


<p>Y la mierda estaba por llover, cuando vi mi vaticinio materializándose ante mis
ojos.</p>

<h3>Podría ser este tu caso</h3>

<p>Luego de entablar un diálogo técnico, una persona a la que consideraba buena en
este asunto de los servidores y redes, me dice que implementó ipv6 hace como un
mes, pero que tenía &ldquo;un problema&rdquo;, ya que no lograba hacer un NAT para que el
servidor de correo dentro de la LAN, recibiera los correos desde afuera.</p>

<p>Cuando le dije que me mandara su cortafuegos, me dijo que no tenía un
cortafuegos aún para ipv6.</p>

<p>Me insistió que por favor le explicara <strong>cómo hacer el singao nateo</strong>.</p>

<p>Le pedí que me mostrara como tenía ipv6 desplegado y me dijo que la puerta de
enlace era 2001:db8::1 y el servidor de correo ::2</p>

<p>Llegado a ese punto, lo mandé a fumarse un peo, pero volvió a llamar; pasando
por alto el collar de insultos que le había puesto antes de tirar el teléfono.</p>

<h3>Sobre el &ldquo;nateo de ipv6&rdquo;</h3>

<p><strong>ipv6 NO lleva nateo. El nateo fue una solución que mandó a la mierda ipv6</strong></p>

<p>Si tienes una ip pública con máscara /64 es visible desde y hacia internet. O
sea, que si tu servidor de correo tiene una dirección como 2001:db8::2/64 <strong>YA
ES VISIBLE EN INTERNET</strong> y si no tienen cortafuegos pinguísimo <strong>aprepárate</strong>.</p>

<p>Más detalles en la siguiente entrada&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[driver broadcom]]></title>
    <link href="http://uranio-235.github.io/blog/2016/10/04/dirver-broadcom/"/>
    <updated>2016-10-04T14:53:41-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/10/04/dirver-broadcom</id>
    <content type="html"><![CDATA[<p>Cuando tienes un dispositivo inalámbrico de Broadcom, por lo general tienes un
bluetooth y una wifi. Me imagino que los broadcom modernos, tengan además dual
band (wifi de 5Ghz).</p>

<p>En la entrada anterior, mencioné que había adquirido unos audífonos bluetooth;
junto con él, un montón de nuevas resinguetas (como todo en archlinux). Resulta
que el driver opensource <strong>brcm80211</strong> no pinchaba bien del todo con el
bluetooth. Al punto que no podía alejarme ni un metro del dispositivo, además,
que el mero echo de moverme, hacía que el audio se cortara.</p>

<p>Usar el blob (driver propietario) parecía una variante atractiva, pero existe
el driver <strong>b43</strong> (QUE TAMBIÉN es opensource) y se jacta de ser creado con
ingeniería inversa. De un principio esto no me pareció algo atractivo; pero ya
lo había dicho el célebre comunistón Chino:</p>

<p>   <blockquote><p>Todo conocimiento auténtico nace de la experiencia directa</p><footer><strong>Mao Zedong</strong></footer></blockquote></p>

<p>Al parecer, el driver ya viene con el sistema, sin embargo, necesita un firmware
para poder levantar el hardware. Por suerte hay un paquete en <strong>AUR</strong> que hace
toda la pincha, se llama <strong>b43-firmware</strong></p>

<p>Tras instalarlo, hay que poner en la lista negra, el driver anterior, si no se
forma un reguero tremendo a la hora de cargar los driver y seleccionará el
opensource por defecto.</p>

<figure class='code'><figcaption><span>&#8220;/etc/modprobe.d/broadcom.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>cat /etc/modprobe.d/broadcom.conf
</span><span class='line'>blacklist brcmsmac
</span><span class='line'>b43
</span></code></pre></td></tr></table></div></figure>


<p>Por si las moscas, ejecuta:</p>

<figure class='code'><figcaption><span>&#8220;depmod&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span><span class="c"># depmod -a</span>
</span></code></pre></td></tr></table></div></figure>


<p>y reinicia</p>

<h3>Ahora, la comparación:</h3>

<h4>brcm80211</h4>

<p>La wifi pincha DE PINGA. Dentro de la banda de los 2.4Ghz, hace de todo, desde
AP (modo master) hasta la dichosa autenticación WPA2. Soporta incluso survey.
<strong>PERO</strong> el bluetooth pincha de asco. Se desaparece cuando lo usas más de 20
minutos, diciendo que un dispositivo USB fue desconectado.</p>

<h4>broadcom-wl</h4>

<p>Sin dudas, el driver propietario es una seda, dice que habilita los canales de
5Ghz pero es mentira. El bluetooth pincha de maravilla, sobre todo en lo
referente a calidad de audio <strong>PERO</strong> cada vez que cambias de kernel el driver
debe recompilarse y suele fallar (eso dicen). En tal caso, reinstalar el driver
es una solución. Además, te recuerdo que <strong>no es de código abierto</strong>. Sabe dios
que backdoor te mete dentro del kernel. En cuanto a las prestaciones de la wifi,
hay unas cuantas pérdidas: No puede autenticar con WPA2 y no soporta modo
master. Tampoco el survey parece pinchar.</p>

<h4>b43</h4>

<p>La wifi, tiene las mismas prestaciones que el propietario. El bluetooth funciona
excelente. La wifi se porta muy bien los primeros días. <strong>PERO</strong> El día que
amanezca con el moño virao la wifi se desparece, corriendo depmod AVEEECEES
aparece. O sea, la mismas miserias del propietario, pero con la aleatoria
posibilidad de que amanezcas sin wifi.</p>

<p>Al final, fui a un taller, di 5 pesos mi tarjeta y adquirí una Atheros&hellip;
Solución PERFECTA.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[audífonos blutú]]></title>
    <link href="http://uranio-235.github.io/blog/2016/09/22/audifonos-blutu/"/>
    <updated>2016-09-22T17:39:04-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/09/22/audifonos-blutu</id>
    <content type="html"><![CDATA[<p><img class="left" src="http://uranio-235.github.io/images/audifonos_blutu.png" width="400"></p>

<p>Más por embullo que por necesidad, me he comprado uno de esos audífonos
Bluetooth que se usan ahora. Estoy pasando un trabajo tremendo para adaptarme a
tener la morronga esa en el cuello. Como si fuera poco, archlinux no me perdonó
y me hizo de las suyas.</p>

<p>Al conectarlos se escuchaban horrible y se desaparecía el bluetooth.</p>

<p>Según me dijeron en el #archlinux de freenode. Se debe a que los audífonos se
conecta como micrófonos/audífonos y no como audífonos solamente. Para ellos
había que cambiarlos al modo A2DP.</p>

<p>El comando <strong>pacmd set-card-profile 2 a2dp_sink</strong> resuelve el problema. Pero
tener que correr el comando cada vez que los conecte, no me parece; no me da tan
fuerte todavía&hellip;</p>

<p>El gestor de audio de gnome supuestamente cambia el modo. Pero resulta que el
puto <strong>pulse-audio</strong>, si arranca con GDM, forma una cagazón con los permisos ahí
y no cambia de modo.</p>

<p>Para evitar eso, creas un fichero llamado
<strong>/var/lib/gdm/.config/pulse/client.conf</strong> donde le declaras que no arrancará
pulse-audio con gnome:</p>

<figure class='code'><figcaption><span>&#8220;/var/lib/gdm/.config/pulse/client.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">autospawn</span> <span class="o">=</span> no
</span><span class='line'>daemon-binary <span class="o">=</span> /bin/true
</span></code></pre></td></tr></table></div></figure>


<p>Pero eso no lo es todo. Si pulseaudio arranca con socket, se joden los
audifonitos. Supuestamente creando una configuración, se deshabilita el socket,
pero no pincha. Hay que deshabilitarlo con systemd. Ejecuta esto <strong>como root</strong>:</p>

<figure class='code'><figcaption><span>&#8220;sin socket plis&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span> mkdir -p /var/lib/gdm/.config/systemd/user
</span><span class='line'><span class="o">[</span>root@artema ~<span class="o">]</span> ln -s /dev/null /var/lib/gdm/.config/systemd/user/pulseaudio.socket
</span></code></pre></td></tr></table></div></figure>


<p>Reinicia y al conectar los audífonos; y, al hacerle click al dipositivo, debe
darte una opción que conduce a la configuración de audio. Ahí mismo cambias el
modo y seleccionas el dispositivo de salida de audio por defecto.</p>

<p>Otra cuestión es que pulseaudio use los audífonos como salida de audio por
defecto al conectarlos. Finalmente decidí pasar mis configuraciones de
pulseaudio al directorio de usuario:</p>

<figure class='code'><figcaption><span>&#8220;pulseudio en el home&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir ~/.config/pulse/
</span><span class='line'>cp -ruv /etc/pulse/ ~/.config/pulse/
</span></code></pre></td></tr></table></div></figure>


<p>Localiza el fichero <strong>~/.config/pulse/default.pa</strong> y al final añadele esto:</p>

<figure class='code'><figcaption><span>&#8220;default.pa&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema pulse<span class="o">]</span><span class="nv">$ </span>tail -4 ~/.config/pulse/default.pa
</span><span class='line'>
</span><span class='line'><span class="c"># file:///usr/share/doc/arch-wiki/html/en/PulseAudio/Troubleshooting.html#Bluetooth</span>
</span><span class='line'><span class="c"># automatically switch to newly-connected devices</span>
</span><span class='line'>load-module module-switch-on-connect
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[dispatcher script]]></title>
    <link href="http://uranio-235.github.io/blog/2016/09/16/dispatcher-script/"/>
    <updated>2016-09-16T10:53:51-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/09/16/dispatcher-script</id>
    <content type="html"><![CDATA[<p>El network-manager, el sistema de 2 clicasos para configurar la interfaz de red.
Resulta que cuando levanta la red, no se por qué, telepathy-salut se queda
mariado y el chat &ldquo;gente cerca&rdquo; no ve a los usuarios. Al reiniciar avahi se le
quita el mareo. Entonces la talla sería que el avahi se reiniciara solo.</p>

<p>Resulta que NetworkManger, tiene los llamados dispatcher. Puedes ver
<a href="https://developer.gnome.org/NetworkManager/stable/NetworkManager.html">la documentación aquí</a></p>

<p>Los scripts que radique en <strong>/etc/NetworkManager/dispatcher.d/</strong> se ejecutarán
sí y solo si, pertenecen al root con permisos 755.</p>

<p>Los script reciben como primer argumento, la interfaz y como segundo la acción.
Las acciones pueden ser up, down, conectivity-change, hostname y en fin, vease
<strong>man NetworkManager</strong> para más detalles.</p>

<p>Mi script quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/NetworkManager/dispatcher.d/migancho.sh&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c"># la interfaz involucrada</span>
</span><span class='line'><span class="nv">INTERFAZ</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>
</span><span class='line'><span class="c"># la acción involucrada</span>
</span><span class='line'><span class="nv">ACCION</span><span class="o">=</span><span class="nv">$2</span>
</span><span class='line'>
</span><span class='line'><span class="c"># una función para loguear</span>
</span><span class='line'><span class="k">function</span> loguear<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   logger <span class="k">$(</span>basename <span class="nv">$0</span><span class="k">)</span> <span class="nv">$@</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># un logueo simple, pa saber lo que hay</span>
</span><span class='line'>loguear <span class="s2">&quot;acción «$ACCION» en la interfaz «$INTERFAZ»&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># según la acción</span>
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$ACCION&quot;</span> in
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   up<span class="o">)</span> <span class="c"># una interfaz que se levanto</span>
</span><span class='line'>
</span><span class='line'>      loguear <span class="s1">&#39;tumbando telepathy y compañía&#39;</span>
</span><span class='line'>      pkill -9 empathy
</span><span class='line'>      pkill -9 telepathy
</span><span class='line'>
</span><span class='line'>      loguear <span class="s1">&#39;reiniciando avahi&#39;</span>
</span><span class='line'>      systemctl restart avahi-daemon
</span><span class='line'>
</span><span class='line'>      loguear <span class="s1">&#39;ajustando la hora&#39;</span>
</span><span class='line'>      systemctl start systemd-timesyncd
</span><span class='line'>
</span><span class='line'>   <span class="p">;;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   down<span class="o">)</span> <span class="c"># al tumbar una conexión</span>
</span><span class='line'>
</span><span class='line'>     loguear <span class="s1">&#39;para el clientico ntp de systemd&#39;</span>
</span><span class='line'>     systemctl stop systemd-timesyncd
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   <span class="p">;;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   *<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      loguear <span class="s1">&#39;sin accion&#39;</span>
</span><span class='line'>
</span><span class='line'>   <span class="p">;;</span>
</span><span class='line'>
</span><span class='line'><span class="k">esac</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con <strong>journalctl -f</strong> puedes ver como loguea, en este caso el argumento $0 es el
nombre del script. En fin puedes hacer muchísimas cosas creativas. Con ver en el
man de NetworkManager las acciones; podrás subsanar muchas necesidades.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[password de windows]]></title>
    <link href="http://uranio-235.github.io/blog/2016/08/16/password-de-windows/"/>
    <updated>2016-08-16T00:13:36-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/08/16/password-de-windows</id>
    <content type="html"><![CDATA[<p>Resulta que en el puesto de mando, uno de los tantos que se sientan ahí; le
cambió el password a la canchanfleta que tienen por computadora y entonces
NAADIEEE vio nada. Conclusión no apareció el autor de la contraseña y los
técnicos no sabían que hacer (para variar).</p>

<p>&ldquo;lázaro, tú que usas linux: ¿Podrías &#8220;hackear&rdquo; la contraseña?&#8221;</p>

<p>Pregunta uno de los usuarios, con cara de: <em>Cambié el password y no me acuerdo
cual puse</em>. Véase la definición del termino <a href="https://es.wikipedia.org/wiki/Hacker">hacker</a> y note lo mal empleado que está.</p>

<p>Metí un archlinux en la memoria flash de la pornografía, lo levanté en caliente
e instalé <strong>chntpw</strong>.</p>

<p>Monté el disco de windows, primera partición (alias &ldquo;C:&rdquo;) en /mnt. Con el
comando <strong>find</strong> y abusando de mi memoria, sobre un artículo que leí acerca de
las contraseñas de Windows; localicé el fichero <strong>C:/Windows/System32/config/SAM</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   pacman -S chntpw
</span><span class='line'>   mount /dev/sdb1 /mnt
</span><span class='line'>   <span class="nb">cd</span> /mnt/Windows/System32/config/
</span></code></pre></td></tr></table></div></figure>


<p>Como lo hice en un sistema en caliente, no pude copiar la salida, pero esto fue
lo que hice.</p>

<p>Paso 1: Lista los usuarios de Güindos: <strong>chntpw -l SAM</strong></p>

<p>Paso 2: Modifica el usuario &ldquo;Administrador&rdquo;: <strong>chntpw -u &ldquo;Administrador&rdquo; SAM</strong></p>

<p>Verás un pequeño asistente en modo texto que te pregunta que hacer. Lo mejor es
vaciar el password, luego desbloquearlo. Sale con <strong>quit</strong> y te preguntará si
quieres guardar los cambios. No te preocupes, se entiende mejor cuando lo ves,
es bastante simple.</p>

<p>Gracias a dios que a <a href="https://es.wikipedia.org/wiki/Bill_Gates">Rico McPato</a> no se le ocurrió meter la contraseña en el registro de windows.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Local ISO en xen]]></title>
    <link href="http://uranio-235.github.io/blog/2016/08/15/repositorio-de-iso-en-xen/"/>
    <updated>2016-08-15T22:04:07-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/08/15/repositorio-de-iso-en-xen</id>
    <content type="html"><![CDATA[<p><img class="left" src="http://uranio-235.github.io/images/openxenmanager.png" width="400"></p>

<p>Aveces se da el caso de que necesitamos aprovisionar un servidor xen desde cero
y a esa hora no tienes ningún template a mano. Quizás la forma más rápida de
montar la primera máquina virtual sea instalando desde un iso. No se por qué
openxenmanager, no tiene la opción de almacenamientos locales como &ldquo;.iso&rdquo; Cuenta
con NFS y hasta SATA over Ethernet, pero algo tan pedestre como un directorio
con los ISO, no lo tiene.</p>

<p>Loguéate por ssh para el servidor y usando <strong>xe</strong> crearemos el repositorio.
Primero designaremos un directorio que contendrá los &ldquo;.iso&rdquo;, elegimos la ruta
<strong>/var/opt/xen/isos</strong></p>

<figure class='code'><figcaption><span>&#8220;creando el directorio&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -p /var/opt/xen/isos
</span></code></pre></td></tr></table></div></figure>


<p>Creamos un <strong>Storage Repository</strong> del tipo <strong>iso</strong> y usamos el directorio como
ubicación.</p>

<figure class='code'><figcaption><span>&#8220;xe&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>xe sr-create name-label<span class="o">=</span>LocalISO <span class="nb">type</span><span class="o">=</span>iso <span class="se">\</span>
</span><span class='line'>device-config:location<span class="o">=</span>/var/opt/xen/isos <span class="se">\</span>
</span><span class='line'>device-config:legacy_mode<span class="o">=</span><span class="nb">true </span>content-type<span class="o">=</span>iso
</span></code></pre></td></tr></table></div></figure>


<p>Ahora con <strong>scp</strong> cópiale los isos a esa ubicación</p>

<figure class='code'><figcaption><span>&#8220;scp&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>scp ~/Downloads/ISO/debian-8.5.0-amd64-CD-1.iso root@tuxen.cu:/var/opt/xen/isos/
</span></code></pre></td></tr></table></div></figure>


<p>Si usas openxenmanager, desconéctate y vuélvete a conectar. Verás el repositorio
de isos locales y en Storage, verás los isos que hallas copiados pal servidor.
Podrás usarlo como unidad óptica de las máquinas virtuales.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[kiwix como servicio]]></title>
    <link href="http://uranio-235.github.io/blog/2016/07/31/kiwix-como-servicio/"/>
    <updated>2016-07-31T17:40:02-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/07/31/kiwix-como-servicio</id>
    <content type="html"><![CDATA[<p>Dos pájaros de un tiro. Como crear unit de usuario y como usar kiwix como
servicio:</p>

<p>La idea es correr un kiwix en segundo plano, como mi usuario sin que el root
lance dicha unit, ya que ésto me huele a la posibilidad de escaladas de
permisos.</p>

<p>Ante todo, vamos a crear el zoológico de systemd en el directorio de usuario.
Si mal no recuerdo, esto fue lo que hice.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -p /home/lazaro/.config/systemd/user
</span><span class='line'><span class="nb">cd</span>  /home/lazaro/.config/systemd/user
</span><span class='line'>loginctl <span class="nb">enable</span>-linger <span class="nv">$USER</span>
</span><span class='line'>systemctl --user daemon-reload
</span></code></pre></td></tr></table></div></figure>


<p>Claro, el daemon-reload ahí no es necesario, pero para que te quede claro, que
todas las operaciones de systemd, relacionadas con el usuario, se deben preceder
del argumento &ndash;user</p>

<p>Crea el la unit, en mi caso se llama <strong>kiwix.service</strong> pero tu la puedes nombrar
<strong>comotedelagana.service</strong> Trata de usar minúsculas y debes terminar con la
extensión <strong>.service</strong> A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;kiwix.service&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="k">[Unit]</span>
</span><span class='line'><span class="na">Description</span><span class="o">=</span><span class="s">el kiwix como daemon en http://localhost:9091</span>
</span><span class='line'><span class="na">After</span><span class="o">=</span><span class="s">network.target</span>
</span><span class='line'>
</span><span class='line'><span class="k">[Service]</span>
</span><span class='line'><span class="na">Type</span><span class="o">=</span><span class="s">forking</span>
</span><span class='line'><span class="na">ExecStart</span><span class="o">=</span><span class="s">/opt/kiwix/bin/kiwix-serve --daemon --port=9091 --library /home/lazaro/.www.kiwix.org/kiwix/c2oklrcd.default/data/library/library.xml </span>
</span><span class='line'>
</span><span class='line'><span class="k">[Install]</span>
</span><span class='line'><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora si mete un <strong>daemon-reload</strong></p>

<p>Por cierto, fíjate bien en la linea <strong>ExecStart</strong> que es bien larga, nota que el
parámetro <strong>&ndash;library</strong> se le envía como argumento el <strong>.xml</strong> que se genera al
añadir fichero zim a tu librería. O sea, una vez abierto en la aplicación
visual. Por tanto, Si vas a hacer un servidor, mejor será que le eches un
vistazo a <strong>library.xml</strong>; el cual contiene los metadatos que apuntan a los
&ldquo;ficheros.zim&rdquo;</p>

<p>Más o menos así luce un <strong>library.xml</strong></p>

<figure class='code'><figcaption><span>&#8220;library.xml&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;library</span> <span class="na">current=</span><span class="s">&quot;b0e8b25e-1c6e-c354-21da-ceff3607de21&quot;</span> <span class="na">version=</span><span class="s">&quot;20110515&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&quot;3b448cdb-6b20-73ed-421f-fdef87f80167&quot;</span> <span class="na">path=</span><span class="s">&quot;/opt/kiwix/data/wikipedia_es_all.zim&quot;</span> <span class="na">last=</span><span class="s">&quot;1470535686&quot;</span> <span class="na">title=</span><span class="s">&quot;Wikipedia ESP&quot;</span> <span class="na">description=</span><span class="s">&quot;Wikipedia en Español&quot;</span> <span class="na">language=</span><span class="s">&quot;spa&quot;</span> <span class="na">creator=</span><span class="s">&quot;Wikipedia&quot;</span> <span class="na">publisher=</span><span class="s">&quot;Kiwix&quot;</span> <span class="na">favicon=</span><span class="s">&quot;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&quot;</span> <span class="na">faviconMimeType=</span><span class="s">&quot;image/png&quot;</span> <span class="na">date=</span><span class="s">&quot;2015-10-12&quot;</span> <span class="na">articleCount=</span><span class="s">&quot;1206089&quot;</span> <span class="na">mediaCount=</span><span class="s">&quot;1111559&quot;</span> <span class="na">size=</span><span class="s">&quot;12988257&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&quot;b0e8b25e-1c6e-c354-21da-ceff3607de21&quot;</span> <span class="na">path=</span><span class="s">&quot;/opt/kiwix/data/wikipedia_en_all_nopic.zim&quot;</span> <span class="na">last=</span><span class="s">&quot;1470535759&quot;</span> <span class="na">title=</span><span class="s">&quot;Wikipedia ENG&quot;</span> <span class="na">description=</span><span class="s">&quot;Wikipedia en Inglés (sin imágenes)&quot;</span> <span class="na">language=</span><span class="s">&quot;eng&quot;</span> <span class="na">creator=</span><span class="s">&quot;Wikipedia&quot;</span> <span class="na">publisher=</span><span class="s">&quot;Kiwix&quot;</span> <span class="na">favicon=</span><span class="s">&quot;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&quot;</span> <span class="na">faviconMimeType=</span><span class="s">&quot;image/png&quot;</span> <span class="na">date=</span><span class="s">&quot;2015-05-17&quot;</span> <span class="na">articleCount=</span><span class="s">&quot;4858372&quot;</span> <span class="na">mediaCount=</span><span class="s">&quot;325904&quot;</span> <span class="na">size=</span><span class="s">&quot;16024312&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/library&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por ejemplo, a mi el valor de las etiquetas <em>title</em> y <em>description</em>, me gusta cambiarlo.</p>

<p>Para que se gener ese XML, abre la aplicación <strong>una vez</strong> para que se cree la biblioteca. O sea, en abrir
archivos, añadimos a nuestra librería, todos los .zim que queramos.</p>

<p><img class="center" src="http://uranio-235.github.io/images/kiwix-open.png" width="500"></p>

<p>Llegado a este punto, se habrá creado el perfil de kiwix en nuestro $HOME y
contendrá el importantísimo <strong>library.xml</strong>. Si ya añadiste a tu biblioteca
todos los <strong>.zim</strong> que quieres, terminamos con el kiwix. Ciérralo.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>lazaro@artema ~<span class="o">]</span><span class="nv">$ </span>file .www.kiwix.org/kiwix/*.default
</span><span class='line'>.www.kiwix.org/kiwix/c2oklrcd.default: directory
</span></code></pre></td></tr></table></div></figure>


<p>Usamos el comando <strong>file</strong> para determinar cual fue. En mi caso se llama
<strong>~/.www.kiwix.org/kiwix/c2oklrcd.default</strong></p>

<p>Al argumento <strong>ExecStart</strong> de la unit, debes darle la ruta absoluta de la
librería, así que nada de ~/, le pones /home/fulanito.</p>

<p>Bueno, volviendo a la unit, veamos más de cerca el <strong>ExecStart</strong></p>

<figure class='code'><figcaption><span>&#8220;scope de kiwix.service&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">ExecStart</span><span class="o">=</span><span class="s">/opt/kiwix/bin/kiwix-serve --daemon --port=9091 --library /home/lazaro/.www.kiwix.org/kiwix/c2oklrcd.default/data/library/library.xml </span>
</span></code></pre></td></tr></table></div></figure>


<p>La ruta el binario de <strong>kiwix-serve</strong> en modo daemon <strong>&ndash;daemon</strong> por el puerto
9091 <strong>&ndash;port 9091</strong> y siendo la librería <strong>&ndash;library (ruta absoluta)</strong></p>

<p>Salva y ejecuta un daemon-reload. Luego, lánzalo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl --user start kiwix.service
</span></code></pre></td></tr></table></div></figure>


<p>Abre un navegador y apunta para <a href="http://localhost:9091">http://localhost:9091</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[hibernar en archlinux]]></title>
    <link href="http://uranio-235.github.io/blog/2016/07/17/hibernar-en-archlinux/"/>
    <updated>2016-07-17T23:17:17-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/07/17/hibernar-en-archlinux</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://uranio-235.github.io/images/Hibernacion_by_Zetabox.jpg" width="250"></p>

<p>Hablando de cosas olvidables. Siempre que instalo archlinux, se me olvida que
hay que hacer una ceremonia para que la hibernación pinche.</p>

<p>De más está que te diga que necesitarás una <strong>particion</strong> swap, con al menos el
mismo tamaño de la RAM que tienes. No pincha con swapfiles.</p>

<p>En mi caso, yo hice una swap del tamaño de la RAM, lo cual me jode a la hora de
hibernar, ya que se demora mucho descartando los datos que hay en la swap (si
hay) en el momento de hibernar.</p>

<p>Bueno entrando en materia:</p>

<p>En el GRUB, le daremos el parámetros <strong>resume</strong> y usaremos como argumento, el
disco de donde se resume, o sea <strong>la swap</strong>. Veamos cual es el UUID de la swap:</p>

<figure class='code'><figcaption><span>fstab</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cat /etc/fstab <span class="p">|</span>grep swap
</span><span class='line'><span class="nv">UUID</span><span class="o">=</span>2b3ed70d-5746-4a94-bd07-77eacd99f03c  none swap defaults,discard<span class="o">=</span>pages <span class="m">0</span> 0
</span></code></pre></td></tr></table></div></figure>


<p>Vamos al cargador de arranque (grub en mi caso) y le decimos cual es el disco de
donde debe tomar la imagen y resumirla. Localiza el fichero <strong>/etc/default/grub</strong>
y en una de las primeras lineas, modifica la cláusula <strong>GRUB_CMDLINE_LINUX_DEFAULT</strong>
inclúyele <strong>resume=UUID=LaUUiDeTuDisCoSwap</strong>. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;la parte de arriba de</span><a href='http://uranio-235.github.io/etc/default/grub'>&#8221;</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">GRUB_DEFAULT</span><span class="o">=</span><span class="s">0</span>
</span><span class='line'><span class="na">GRUB_TIMEOUT</span><span class="o">=</span><span class="s">5</span>
</span><span class='line'><span class="na">GRUB_DISTRIBUTOR</span><span class="o">=</span><span class="s">&quot;Arch&quot;</span>
</span><span class='line'><span class="na">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s">&quot;ipv6.disable=1 resume=UUID=2b3ed70d-5746-4a94-bd07-77eacd99f03c&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Como ven, ahí declaramos (EL UUID DE <strong>LA SWAP</strong>) la partición donde se almacena
la imagen que crea el proceso de hibernación.</p>

<p>Pero no todo está listo, aún initramfs no se ha dado por enterado que vamos a
hibernar. Localiza el fichero <strong>/etc/mkinitcpio.conf</strong> y añadele el <strong>hook</strong> de
resume, a mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;fragmento de mkinitcpio.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">##   NOTE: If you have /usr on a separate partition, you MUST include the</span>
</span><span class='line'><span class="c1">#    usr, fsck and shutdown hooks.</span>
</span><span class='line'><span class="na">HOOKS</span><span class="o">=</span><span class="s">&quot;base udev resume autodetect modconf block filesystems keyboard fsck&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Generalmente debes ponerlo después de <strong>udev</strong> y antes de <strong>autodetect</strong>. No te
olvides de regnerar el initramfs:</p>

<figure class='code'><figcaption><span>initramfs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkinitcpio -p linux
</span></code></pre></td></tr></table></div></figure>


<p>Si te molesta que la swap haga su pincha de swap (como en mi caso) puede
deshabilitar el swapiness. Crea un fichero <strong>/etc/sysctl.d/00-noswap.conf</strong>
y ponle adentro el siguiete valor: <strong>vm.swappiness=0</strong></p>

<p>Y hibernan como los osos :D</p>

<p>Seguro te preguntarás como hacer que se ejecute algo al hibernar o despertar.
Pues puedes crear una unit llamadas <strong>root-resume</strong> y <strong>root-suspend</strong>.</p>

<p>Por
ejemplo, a mi en lo personal, me interesa parar el puto networkmanager cuando
hiberno, ya que es poco probable que cuando despierte, esté en otro lugar y
probablemente sin red. En mi caso yo habilito el networkmanager solo cuando lo
necesito. En este caso, asumiré que para al hibernar y enciende al despertar.</p>

<figure class='code'><figcaption><span>&#8220;/etc/systemd/system/root-suspend.service&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="k">[Unit]</span>
</span><span class='line'><span class="na">Description</span><span class="o">=</span><span class="s">Local system suspend actions</span>
</span><span class='line'><span class="na">Before</span><span class="o">=</span><span class="s">sleep.target</span>
</span><span class='line'>
</span><span class='line'><span class="k">[Service]</span>
</span><span class='line'><span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
</span><span class='line'><span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/systemctl stop NetworkManager</span>
</span><span class='line'>
</span><span class='line'><span class="k">[Install]</span>
</span><span class='line'><span class="na">WantedBy</span><span class="o">=</span><span class="s">sleep.target</span>
</span></code></pre></td></tr></table></div></figure>


<p>Al despertar arranca:</p>

<figure class='code'><figcaption><span>&#8220;/etc/systemd/system/root-resume.service &#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="k">[Unit]</span>
</span><span class='line'><span class="na">Description</span><span class="o">=</span><span class="s">Local system suspend actions</span>
</span><span class='line'><span class="na">Before</span><span class="o">=</span><span class="s">sleep.target</span>
</span><span class='line'>
</span><span class='line'><span class="k">[Service]</span>
</span><span class='line'><span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
</span><span class='line'><span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/systemctl start NetworkManager</span>
</span><span class='line'>
</span><span class='line'><span class="k">[Install]</span>
</span><span class='line'><span class="na">WantedBy</span><span class="o">=</span><span class="s">sleep.target</span>
</span></code></pre></td></tr></table></div></figure>


<p>Todo lo que necesitas está en el artículo de la wiki de archlinux: <a href="https://wiki.archlinux.org/index.php/Power_management">Power Management</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rsync básico]]></title>
    <link href="http://uranio-235.github.io/blog/2016/07/17/rsync-basico/"/>
    <updated>2016-07-17T16:49:25-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/07/17/rsync-basico</id>
    <content type="html"><![CDATA[<p>Este es el tipo de cosas que uno hace cada 120 días y claro, cuando lo vas hacer
ya se te olvidó; así que para el blog:</p>

<p>Como compartir un directorio vía rsyncd. En el siguiente ejemplo, usaré mi
directorio de Downloads, donde tengo cosas que copiar por SSH requiere mucha
entropía y la copia se vuelve lenta, por ejemplo, los ficheros con la wikipedia
(kiwix)</p>

<p>La configuración de <strong>rsyncd</strong> radica en un lugar bastante obvio:
<strong>/etc/rsyncd.conf</strong> a mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;/etc/rsyncd.conf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">max connections</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'><span class="na">log file</span> <span class="o">=</span> <span class="s">/var/log/rsync.log</span>
</span><span class='line'><span class="na">timeout</span> <span class="o">=</span> <span class="s">300</span>
</span><span class='line'>
</span><span class='line'><span class="k">[descargas]</span>
</span><span class='line'>   <span class="na">comment</span> <span class="o">=</span> <span class="s">las cosas que descargué</span>
</span><span class='line'><span class="s">   path = /home/lazaro/Download/</span>
</span><span class='line'><span class="s">   read only = yes</span>
</span><span class='line'><span class="s">   list = yes </span>
</span><span class='line'><span class="s">   uid = lazaro</span>
</span><span class='line'><span class="s">   gid = nobody</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahí tenemos el directorio <strong>descargas</strong> servido por rsyncd. Vamos a efectuar una
copia:</p>

<figure class='code'><figcaption><span>&#8220;rsync&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rsync --include<span class="o">=</span><span class="s1">&#39;*.gz&#39;</span> --exclude<span class="o">=</span><span class="s1">&#39;*&#39;</span>  -aPv rsync://pub@10.1.1.187/descargas/ ./
</span></code></pre></td></tr></table></div></figure>


<p>En ese ejemplo, usamos los parámetros <strong>&ndash;include</strong> y <strong>&ndash;exclude</strong>, para copiar
solamente los fichero <strong>.gz</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[correos del cron]]></title>
    <link href="http://uranio-235.github.io/blog/2016/06/20/correos-del-cron/"/>
    <updated>2016-06-20T14:14:06-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/06/20/correos-del-cron</id>
    <content type="html"><![CDATA[<p>Conflictivísima tarea, lograr que el cron mande correos adecuadamente&hellip; En este
caso, cronie, da la solución al problema. Aunque me imagino que dicha
configuración sea estándar para el cron.</p>

<p>Así es la cosa, declaramos <strong>MAILTO</strong> y <strong>MAILFROM</strong> como unas variables en el
fichero crontab.</p>

<figure class='code'><figcaption><span>crontab</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="c1"># DO NOT EDIT THIS FILE - edit the master and reinstall.</span>
</span><span class='line'><span class="c1"># (/tmp/crontab.f36hiB/crontab installed on Tue May  5 08:48:38 2015)</span>
</span><span class='line'><span class="c1"># (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># añadimos las variables</span>
</span><span class='line'><span class="na">MAILTO</span><span class="o">=</span><span class="s">root@tudominio.cu</span>
</span><span class='line'><span class="na">MAILFROM</span><span class="o">=</span><span class="s">cron@tudominio.cu</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># m h  dom mon dow   command</span>
</span><span class='line'><span class="err">00</span> <span class="err">00</span> <span class="err">*</span> <span class="err">*</span> <span class="err">*</span> <span class="err">/bin/bash</span> <span class="err">/home/fulanito/script.sh</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora faltaría un MTA. Pues la solución más sensilla es <strong>esmtp</strong> y su
configuración sería más o menos así en el fichero <strong>/etc/esmtprc</strong></p>

<figure class='code'><figcaption><span>&#8220;/etc/esmtprc&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">identity</span> <span class="err">micuenta</span>
</span><span class='line'>   <span class="err">hostname</span> <span class="err">smtp.tudominio.cu</span>
</span><span class='line'>   <span class="err">username</span> <span class="err">&quot;cron&quot;</span>
</span><span class='line'>   <span class="err">password</span> <span class="err">&quot;pinpanpun&quot;</span>
</span><span class='line'>   <span class="err">starttls</span> <span class="err">enabled</span>
</span><span class='line'>   <span class="err">default</span>
</span><span class='line'><span class="err">mda</span> <span class="err">&quot;/usr/bin/procmail</span> <span class="err">-d</span> <span class="err">%T&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Listo! El correo <a href="&#x6d;&#x61;&#105;&#x6c;&#116;&#111;&#x3a;&#114;&#111;&#x6f;&#x74;&#64;&#116;&#117;&#100;&#x6f;&#109;&#105;&#x6e;&#105;&#x6f;&#46;&#99;&#x75;">&#114;&#111;&#111;&#x74;&#64;&#x74;&#117;&#x64;&#x6f;&#109;&#105;&#x6e;&#105;&#x6f;&#46;&#99;&#117;</a> recibirá correos de <a href="&#x6d;&#97;&#105;&#x6c;&#116;&#x6f;&#58;&#99;&#x72;&#111;&#110;&#x40;&#116;&#x75;&#x64;&#111;&#x6d;&#105;&#110;&#x69;&#111;&#x2e;&#99;&#117;">&#x63;&#x72;&#111;&#110;&#x40;&#116;&#x75;&#100;&#111;&#x6d;&#105;&#110;&#x69;&#111;&#x2e;&#99;&#117;</a> con la
salida del cron&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[dkim y spf en postfix]]></title>
    <link href="http://uranio-235.github.io/blog/2016/06/18/dkim-y-spf-en-postfix/"/>
    <updated>2016-06-18T13:57:51-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/06/18/dkim-y-spf-en-postfix</id>
    <content type="html"><![CDATA[<p>Aunque no de mi agrado, reconozco que es una solución muy buena. DKIM y SPF, se
ha vuelto hoy en día un mecanismo para mitigar el SPAM en el correo electrónico.</p>

<p>Esto no quita, que un spammer puede hacerse con un buen esquema de DKIM para sus
dominos de porquería; lo cual sería un estupendo negocio, teniendo en cuenta que
un servidor puede tener tantos dominios como quiera. Si conoce a algún spammer
que quiera tener DKIM y SPF en su negocio, por favor, mándele mi tarjeta.</p>

<p>Me imagino que a los usuarios de nauta, les duela bajar un mensaje que
aparentemente tiene dos lineas, pagando por uno que realmente tiene más de 20
líneas de pura mierda que no les incumbe. Espero que etecsa se digne a retirar
encabezados innecesarios como esos (para el cliente).</p>

<p>Por otra parte, mucha gente tiene antivirus que modifican el correo o son
fanáticos a instalar mil gangarreas (mailscanner, clamav, etc&hellip;) que también
modifican el correo. Con esto, DKIM y SPF <strong>se van a la mierda</strong>.</p>

<p>Le diré que hice con un postfix que ya estaba instalado en un debian8 para
ponerle DKIM y SPF.</p>

<p>Instalamos los jueguetes requeridos ante todo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt-get install opendkim opendkim-tools postfix-policyd-spf-python
</span></code></pre></td></tr></table></div></figure>


<p>y establecemos los permisos adecuados, ojo con esto, ya que dkim es muy riguroso
con el tema de los permisos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adduser postfix opendkim
</span></code></pre></td></tr></table></div></figure>


<h2>SPF</h2>

<p>Ahora procedemos a crear el registro DNS. Como hay muchos DNS y cada quién tiene
sus preferencias, me reduciré a describir de manera abstracta los registros.
Usted, aterrize la idea en su DNS.</p>

<h3>Esto tiene <strong>DOS</strong> formas de hacerse:</h3>

<h4>La primera:</h4>

<p>Declarar que TODOS los <strong>MX</strong> del dominio, pueden mandar correo (lo cual
inspira desconfianza) en este caso, registra un puntero del tipo <strong>TXT</strong> con el
siguiente valor</p>

<pre><code>v=spf1 mx -all
</code></pre>

<p>Por ejemplo, bind9</p>

<figure class='code'><figcaption><span>&#8220;registro&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">@               IN      TXT     &quot;v</span><span class="o">=</span><span class="s">spf1 mx -all&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>La segunda:</h4>

<p>Declarar que un host, que tiene un registro <strong>A</strong>, está autorizado a enviar
correos (esta me gusta más, si tienes un solo servidor de correo) Si fueran
varios, por ejemplo 3. Podrías declarar un A para cada uno y de manera
individual, ellos generarían su SPF apuntándose a si mismo.</p>

<pre><code>v=spf1 a:mx1.tudominio.cu -all
</code></pre>

<p>Como ya sabemos, un puntero MX siempre deberá apuntar a un rgistro A, ya que no
se recomienda apuntar a un CNAME&hellip;</p>

<p><strong>Nota para los apurados:</strong> &ldquo;Si declaras ambos registros, no pincha, LEE!!&rdquo;</p>

<p>Otra cosa, puedes declarar <strong>-all</strong> o <strong>~all</strong> El primero le dirá al receptor
que si el correo no viene del dominio que dice enviarlo (el puntero A o los MX),
lo rechace porque es falso (muy radical) y el segundo, que empieza por ~ le
indica al receptor, que puede recibir el mensaje y si no pude verificarlo que lo
marque como spam, pero que por favor, no lo rechaze.</p>

<p>Esto nos lleva a una:</p>

<h3>Situación peligrosa</h3>

<p>Cuba, un descerebrado configuró verificación de DKIM, <strong>porque está de moda</strong>.
PERO! Está detrás de un smarthost (pasarela) o simplemente, su configuración de
DNS no vale un quilo (por culpa del proveedor)</p>

<p>Metedura de pata - A:</p>

<p>Ese servidor de correo, que se cree <em>Oggun con machete en mano</em>; descartará todo
correo con <strong>-all</strong> debido a su incapacidad de realizar un lookup decente.</p>

<p>Metedura de pata - B:</p>

<p>Uno más descerebrado todavía, vio que DKIM estaba de moda y sin importar que no
tiene control de su DNS, lo hizo todo, saltándose el paso del DNS. Su servidor
le estará gritando a toda voz al mundo entero, <strong>que está falseando el dominio</strong></p>

<p>Su ignorancia le costará caer de cabeza en las listas negras&hellip;</p>

<p>Y es que:</p>

<p>Generalmente, los servidores que entregan a través de un smarthost, carecen de
DNS real. También hay una pila de gente que administran servidores sin tener
control de su DNS.</p>

<h4>Seguimos&hellip;</h4>

<p>Ya que tenemos el SPF pinchando, podemos añadirle chequeo de SPF a nuestro
postfix <strong>que tiene bien configurado el DNS y entrega de cara a internet sin
smarthost</strong></p>

<p>En el fichero <strong>/etc/postfix/master.cf</strong> le agregamos esto:</p>

<figure class='code'><figcaption><span>master.cf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">policyd-spf</span>  <span class="err">unix</span>  <span class="err">-</span>       <span class="err">n</span>       <span class="err">n</span>       <span class="err">-</span>       <span class="err">0</span>       <span class="err">spawn</span>
</span><span class='line'>    <span class="na">user</span><span class="o">=</span><span class="s">policyd-spf argv=/usr/bin/policyd-spf</span>
</span></code></pre></td></tr></table></div></figure>


<p>y a los posftfix cubanos, le decimos que sea paciente con el proceso de
verificación, incrementando el tiempo que tiene que esperar por el policyd, ya
que dicha verificación puede tardar (dns lookup, cpu a tope, etc..) Añadimos
esto a <strong>/etc/postfix/main.cf</strong></p>

<figure class='code'><figcaption><span>main.cf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">policyd-spf_time_limit</span> <span class="o">=</span> <span class="s">3600</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora viene una parte complicada, pues no hay manera de que pueda reflejarla
como para copiar y pegar.</p>

<p>Deberás modificar tus reglas de postfix, de forma que antepongas el chequeo SPF,
como una más de tus restricciones de recibo. Para mi caso, está bien la última
linea.</p>

<figure class='code'><figcaption><span>&#8220;scpe del main.cf&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">smtpd_sender_restrictions</span> <span class="o">=</span><span class="s"></span>
</span><span class='line'><span class="s">   reject_non_fqdn_sender,</span>
</span><span class='line'><span class="s">   reject_non_fqdn_recipient,</span>
</span><span class='line'><span class="s">   permit_sasl_authenticated,</span>
</span><span class='line'><span class="s">   reject_unknown_sender_domain,</span>
</span><span class='line'><span class="s">   reject_unknown_recipient_domain,</span>
</span><span class='line'><span class="s">   reject_rbl_client bl.spamcop.net,</span>
</span><span class='line'><span class="s">   reject_rbl_client sbl.spamhaus.org,</span>
</span><span class='line'><span class="s">   reject_rbl_client xbl.spamhaus.org,</span>
</span><span class='line'><span class="s">   defer_unauth_destination,</span>
</span><span class='line'><span class="s">   reject_unverified_sender,</span>
</span><span class='line'><span class="s">   check_policy_service unix:private/policyd-spf</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reinicia postfix y chequea el <strong>/var/log/mail.log</strong> para que veas SPF pinchando.</p>

<h2>DKIM</h2>

<p>Me parece que la configuración de DKIM en debian está buena, pero por si las
moscas. Copias esta que pongo aquí y métela en tu <strong>/etc/opendkim.conf</strong></p>

<figure class='code'><figcaption><span>/etc/opendkim.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">Syslog</span>          <span class="err">yes</span>
</span><span class='line'><span class="err">UMask</span>           <span class="err">002</span>
</span><span class='line'><span class="err">UserID</span>          <span class="err">opendkim</span>
</span><span class='line'><span class="err">KeyTable</span>        <span class="err">/etc/opendkim/key.table</span>
</span><span class='line'><span class="err">SigningTable</span>        <span class="err">refile:/etc/opendkim/signing.table</span>
</span><span class='line'><span class="err">ExternalIgnoreList</span>  <span class="err">/etc/opendkim/trusted.hosts</span>
</span><span class='line'><span class="err">InternalHosts</span>       <span class="err">/etc/opendkim/trusted.hosts</span>
</span><span class='line'><span class="err">Canonicalization</span>    <span class="err">relaxed/simple</span>
</span><span class='line'><span class="err">Mode</span>            <span class="err">sv</span>
</span><span class='line'><span class="err">SubDomains</span>      <span class="err">no</span>
</span><span class='line'><span class="c1">#ADSPAction     continue</span>
</span><span class='line'><span class="err">AutoRestart</span>     <span class="err">yes</span>
</span><span class='line'><span class="err">AutoRestartRate</span>     <span class="err">10/1M</span>
</span><span class='line'><span class="err">Background</span>      <span class="err">yes</span>
</span><span class='line'><span class="err">DNSTimeout</span>      <span class="err">5</span>
</span><span class='line'><span class="err">SignatureAlgorithm</span>  <span class="err">rsa-sha256</span>
</span><span class='line'><span class="err">OversignHeaders</span>     <span class="err">From</span>
</span></code></pre></td></tr></table></div></figure>


<p>De ahí puede que quizás te interese la variables <strong>SubDomains</strong>, sobre todo si
eres proveedor de correo.</p>

<p>Como ya te dije, los permisos son sumamente importantes en este caso</p>

<figure class='code'><figcaption><span>permisos</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chmod <span class="nv">u</span><span class="o">=</span>rw,go<span class="o">=</span>r /etc/opendkim.conf
</span></code></pre></td></tr></table></div></figure>


<p>Ahora creamos el directorio donde vamos a meter todo el zoológico requerido para
que DKIM pinche. Hay quién prefiere meterlo en <strong>/var</strong>, para mi en
<strong>/etc/opendkim</strong> es un buen lugar.</p>

<figure class='code'><figcaption><span>&#8220;creando el directorio de residencia&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir /etc/opendkim
</span><span class='line'>mkdir /etc/opendkim/keys
</span><span class='line'>chown -R opendkim:opendkim /etc/opendkim
</span><span class='line'>chmod go-rw /etc/opendkim/keys
</span></code></pre></td></tr></table></div></figure>


<h3>La Firma</h3>

<p>Ahora vamos a crear la <em>tabla de rúbricas</em> (se aceptan contribuciones para
traducir). Ahí, ponemos una linea por cada dominio que tengas. Creas el fichero
<strong>/etc/opendkim/signing.table</strong> y está recomendado que le pongas lo siguiente:</p>

<figure class='code'><figcaption><span>&#8220;como dicen que debe ser&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'>   <span class="err">*@tudominio.cu</span>   <span class="err">tudominio</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Nota para los imbéciles:</strong> No olvide remplazar <em>tudominio.cu</em> por el nombre
del dominio suyo.</p>

<p>Con eso, casamos todos los correos que parezcan a tu dominio, con el DKIM que
llamamos &ldquo;tudominio&rdquo;, si quiere atrás le puede poner &ldquo;pepe&rdquo;. Lo que debe
quedarte claro, es que todos los correos que macheen a la expresión regular de
alante, pasarán por el filtro llamado <em>tudominio</em> (o &ldquo;pepe&rdquo; si lo cambiaste) ¿Se
entendió?</p>

<p>Por ejemplo, si tu dominio fuera *@cacocum.hlg.sld.cu podrías ponerle detrás
&ldquo;midkim&rdquo; para que todos los correos de ese dominio, se firmen con la firma que
será configurada bajo el nombre &ldquo;midkim&rdquo; Quedaría así:</p>

<pre><code>  *@cacocum.hlg.sld.cu  midkim
</code></pre>

<p>Resumen:</p>

<p>El primero campo, es una expresión regular que mache las direcciones de correo y
el segundo el nombre de la firma que se usará. Para mayor confusión, se
recomienda que se hagan nombres parecidos. Finalmente nos quedó así:</p>

<figure class='code'><figcaption><span>/etc/opendkim/signing.table</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">*@tudominio.cu</span>    <span class="err">tudominio</span>
</span></code></pre></td></tr></table></div></figure>


<h3>La clave</h3>

<p>Ahora creamos el fichero, donde le diremos a &ldquo;midkim&rdquo; donde va a encontrar su
parafernalia cifradora. Crea el fichero <strong>/etc/opendkim/key.table</strong> y ponle
dentro esto:</p>

<figure class='code'><figcaption><span>/etc/opendkim/key.table</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">tudominio</span>     <span class="err">tudominio.cu:YYYYMM:/etc/opendkim/keys/example.private</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>IMPORTANTE</strong></p>

<p>Remplaza <strong>YYYYMM</strong> por el año y el número de mes en el que estamos.</p>

<p><strong>SI NO, NO PINCHA</strong></p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>/etc/opendkim/key.table</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">tudominio</span>     <span class="err">tudominio.cu:201606:/etc/opendkim/keys/example.private</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ya que estamos en el año <strong>2016</strong> y el mes <strong>0</strong>6 no el 6 (lleva cero delante).</p>

<p>Ojo aquí, ya que si tienes más dominios, es complicado. Nota que debes reflejar
a localhost con sus pertinentes ip, además, tu nombre de host, tu dominio y el
nombre del host conjugado con el dominio. Siendo entonces <strong>fulanito</strong> el nombre
del host, quedaría así en el fichero <strong>/etc/opendkim/trusted.hosts</strong></p>

<figure class='code'><figcaption><span>/etc/opendkim/trusted.hosts</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="err">127.0.0.1</span>
</span><span class='line'><span class="err">::1</span>
</span><span class='line'><span class="err">localhost</span>
</span><span class='line'><span class="err">fulanito</span>
</span><span class='line'><span class="err">fulanito.dominio.cu</span>
</span><span class='line'><span class="err">dominio.cu</span>
</span></code></pre></td></tr></table></div></figure>


<p>Los permisos, ya tu sabes:</p>

<figure class='code'><figcaption><span>&#8220;seteando permisos&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chown -R opendkim:opendkim /etc/opendkim
</span><span class='line'>chmod -R go-rwx /etc/opendkim/keys
</span></code></pre></td></tr></table></div></figure>


<p>FINALMENTE! Vamos a generar la clave para el dominio:</p>

<figure class='code'><figcaption><span>&#8220;generando las claves&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/opendkim/keys/
</span><span class='line'>opendkim-genkey -b <span class="m">2048</span> -r -s 201606
</span></code></pre></td></tr></table></div></figure>


<p>Las claves se generan en base a la fecha, pero luego se colocan en base al
dominio. Esto se hace porque <strong>hay que renovarlos</strong> pero si configuramos
opendkim para que apunte a un fichero cuyo nombre sea la fecha, tendríamos que
cambiar la configuración cada vez que renovamos.</p>

<figure class='code'><figcaption><span>&#8220;la clave por su nombre&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mv 201606.private tudominio.private
</span><span class='line'>mv 201606.txt tudominio.txt
</span></code></pre></td></tr></table></div></figure>


<p>Si tu clave se llamase &ldquo;pepe&rdquo; o &ldquo;midkim&rdquo;, ya sabes que esos ficheros se
llamarían &ldquo;pepe.private&rdquo; o &ldquo;tudkim.txt&rdquo; ¿Entiendes ahora? Seguimos&hellip;</p>

<p>El argumento <strong>-b</strong> indica la longitud de clave en Bit. En otros tiempo 1024 era
la tisa, pero ahora, se recomienda usar 2048 porque las máquinas son más
potentes. Quizás dentro de un par de años, sea 4096.</p>

<p>Bueno, ya sabes, la ceremonia de los permisos:</p>

<figure class='code'><figcaption><span>&#8220;seteando permisos&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chown -R opendkim:opendkim /etc/opendkim
</span><span class='line'>chmod -R go-rw /etc/opendkim/keys
</span></code></pre></td></tr></table></div></figure>


<p>Arranca opendkim y asegúrate mirando los; log que esté pinchando.</p>

<figure class='code'><figcaption><span>&#8220;arranca opendkim&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl restart opendkim
</span><span class='line'>systemctl status -l opendkim
</span></code></pre></td></tr></table></div></figure>


<h2>El DNS</h2>

<p>El patico feo de internet, el DNS. El remedio que se inventó pa ir tirando y
acabó quedándose con su pésimo diseño y su horrible arquitectura que hasta el
sol de hoy, pretende llamarse &ldquo;distribuida&rdquo;.</p>

<p>Agregamos le registro TXT con la clave. Te cuento que el fichero &ldquo;.txt&rdquo; contiene
el tabaco base64 que usualmente vemos en el encabezado DKIM-Signature, pues
proviene de este registro TXT que estamos creando.</p>

<p>Añade un registro del tipo TXT que apunte a un hostname llamado
<strong>201606._domainkey</strong> dentro de tu domino. Pero ahora viene la parte difícil:</p>

<p>Copia <strong>el texto</strong> que contiene el fichero tudominio.txt dentro de la primera
comilla hasta la última, pero sin tomar las comillas.</p>

<p><strong>¿Se entendió?</strong></p>

<p>O sea, dentro del fichero tiene esto:</p>

<figure class='code'><figcaption><span>&#8220;tudominio.txt&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">201606._domainkey  IN  TXT ( &quot;**v</span><span class="o">=</span><span class="s">DKIM1; k=rsa; s=email; &quot; &quot;p=ZjiONVGXom64jANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAu5oIUrFDWZK7F4thFxpZa2or6jBEX3cSL6b2TJdPkO5iNn9vHNXhNX31nOefN8FksX94YbLJ8NHcFPbaZTW8R2HthYxRaCyqodxlLHibg8aHdfa+bxKeiI/xABRuAM0WG0JEDSyakMFqIO40ghj/h7DUc/4OXNdeQhrKDTlgf2bd+FjpJ3bNAFcMYa3Oeju33b2Tp+PdtqIwXR&quot; &quot;ZksfuXh7m30kuyavp3Uaso145DRBaJZA55lNxmHWMgMjO+YjNeuR6j4oQqyGwzPaVcSdOG8Js2mXt+J3Hr+nNmJGxZUUW4Uw5ws08wT9opRgSpn+ThX2d1AgQePpGrWOamC3PdcwIDAQAB**&quot;)  ; ----- DKIM key 201606 for tudominio.cu</span>
</span></code></pre></td></tr></table></div></figure>


<p>Al extraer la parte que nos interesa, no quedamos con esto (sin las comillas)</p>

<figure class='code'><figcaption><span>&#8220;la clave sin las comillas&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">**v</span><span class="o">=</span><span class="s">DKIM1; k=rsa; s=email; p=ZJiONVGXom64zhNjwdAmo2XnMhAXeGXxB0p5PJkHxUk5XMXNaoUbMwfGOBOQYKsiQp0k9KwcYu2SNAlcFrGIugPG035Ng4r8mlBRLS5+dak90HuH+hb2d8aa+djRFn4PIS2RcAZZJgJjRgF1NbWZpBlj8IpXJ7MywrUxtj1e+TU/tCiWQxCc9uMqgWA53NeqRGEFPwCuTfDMKWbbMhZkbe+pOOtEqQBQ0HsvJ3n09ZNhh3AjbNP6JOpAyK+4hqHohDTrLhxdSFsNiaoAaJXsxDdAHIs2U3QNmrbAFEg7aPOBgaHLXv28k88EDqo4cIuOxa/c24e3F4O6TY3fpydRmekadtCW+waY3aCIIwIA7DdAABFUTR3ABI8WnFTjgDyj1/IQ53Af**</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>OJO</strong> Tiene más comillas en el medio!!!!</p>

<p>Auxíliate de un editor de texto decente. Deshabilita el wrap y busca la comilla
como cadena de texto.</p>

<p>Ese texto, será el valor del puntero TXT</p>

<p>A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;puntero TXT de 201606._domainkey&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">201601._domainkey    IN      TXT     &quot;**v</span><span class="o">=</span><span class="s">DKIM1; k=rsa; s=email; p=ZJiONVGXom64zhNjwdAmo2XnMhAXeGXxB0p5PJkHxUk5XMXNaoUbMwfGOBOQYKsiQp0k9KwcYu2SNAlcFrGIugPG035Ng4r8mlBRLS5+dak90HuH+hb2d8aa+djRFn4PIS2RcAZZJgJjRgF1NbWZpBlj8IpXJ7MywrUxtj1e+TU/tCiWQxCc9uMqgWA53NeqRGEFPwCuTfDMKWbbMhZkbe+pOOtEqQBQ0HsvJ3n09ZNhh3AjbNP6JOpAyK+4hqHohDTrLhxdSFsNiaoAaJXsxDdAHIs2U3QNmrbAFEg7aPOBgaHLXv28k88EDqo4cIuOxa/c24e3F4O6TY3fpydRmekadtCW+waY3aCIIwIA7DdAABFUTR3ABI8WnFTjgDyj1/IQ53Af**&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Completo! Vamos a probarlo a ver que pasa:</p>

<figure class='code'><figcaption><span>&#8220;1, 2, 3, probando&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>opendkim-testkey -d example.com -s 201606
</span></code></pre></td></tr></table></div></figure>


<p>Si sale silentemente sin mostrar algo. Es que todo está bien.</p>

<h3>opendkim y postfix</h3>

<p>Finalmente, nuestro postfix tendrá el privilegio de firmar los correos usando el
aparataje recién configurado. Vamos a crearle un cuartico de dkim en la casa de
postfix</p>

<figure class='code'><figcaption><span>&#8220;dkim en postfix&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir /var/spool/postfix/opendkim
</span><span class='line'>chown opendkim:postfix /var/spool/postfix/opendkim
</span></code></pre></td></tr></table></div></figure>


<p>y habilitamos el socket de opendkim, editando el fichero <strong>/etc/default/opendkim</strong></p>

<figure class='code'><figcaption><span>/etc/default/opendkim</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="c1"># Command-line options specified here will override the contents of</span>
</span><span class='line'><span class="c1"># /etc/opendkim.conf. See opendkim(8) for a complete list of options.</span>
</span><span class='line'><span class="c1">#DAEMON_OPTS=&quot;&quot;</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Uncomment to specify an alternate socket</span>
</span><span class='line'><span class="c1"># Note that setting this will override any Socket value in opendkim.conf</span>
</span><span class='line'><span class="na">SOCKET</span><span class="o">=</span><span class="s">&quot;local:/var/spool/postfix/opendkim/opendkim.sock&quot;</span>
</span><span class='line'><span class="c1">#SOCKET=&quot;inet:54321&quot; # listen on all interfaces on port 54321</span>
</span><span class='line'><span class="c1">#SOCKET=&quot;inet:12345@localhost&quot; # listen on loopback on port 12345</span>
</span><span class='line'><span class="c1">#SOCKET=&quot;inet:12345@192.0.2.1&quot; # listen on 192.0.2.1 on port 12345</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note como retiramos el comentario de la línea 7</p>

<p>Ahora declaramos en postfix que debe usar a opendkim como demonio de
preprocesamiento en el típico <strong>/etc/postfix/main.cf</strong></p>

<figure class='code'><figcaption><span>/etc/postfix/main.cf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="c1"># Milter configuration</span>
</span><span class='line'><span class="c1"># OpenDKIM</span>
</span><span class='line'><span class="na">milter_default_action</span> <span class="o">=</span> <span class="s">accept</span>
</span><span class='line'><span class="na">milter_protocol</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'><span class="na">smtpd_milters</span> <span class="o">=</span> <span class="s">local:/opendkim/opendkim.sock</span>
</span><span class='line'><span class="na">non_smtpd_milters</span> <span class="o">=</span> <span class="s">local:/opendkim/opendkim.sock</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente, reinicia opendkim y postfix</p>

<figure class='code'><figcaption><span>&#8220;systemctl&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>systemctl restart opendkim postfix
</span></code></pre></td></tr></table></div></figure>


<h3>COMPLETO!!!</h3>

<p>Con eso hemos terminado. Para probarlo, puede enviar un correo a <a href="mailto:check-auth@verifier.port25.com">check-auth@verifier.port25.com</a></p>

<p>Esa dirección le hará una prueba al DKIM+SPF de tu correo. No solo eso, le hará
una prueba del Pi al Pa a tu correo y te dirá todo lo que necesitas.</p>

<p>Si quieres ponerle la guinda al pastel, puede añadirle ADSP (Author Domain
Signing Practices) a tu esquema. Esto indica que todos los correos que salgan de
tu dominio deben estar firmados con DKIM, proveiendo aún más confianza al
receptor.</p>

<p>Crea un registro <strong>TXT</strong> para el hostname <strong><em>adsp.</em>domainkey</strong> y el valor del
TXT será <strong>dkim=all</strong>. A mi me quedó así:</p>

<figure class='code'><figcaption><span>&#8220;registro&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cfg'><span class='line'><span class="na">_adsp._domainkey     IN      TXT     &quot;dkim</span><span class="o">=</span><span class="s">all&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con eso, tus correos no caerán más en la bandeja SPAM de gmail.</p>

<p>Otra cosa importante, asegúrate de tener el reverse lookup de tu MX bien puesto.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[desacelerar mouse]]></title>
    <link href="http://uranio-235.github.io/blog/2016/06/06/desacelerar-mouse/"/>
    <updated>2016-06-06T23:41:44-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/06/06/desacelerar-mouse</id>
    <content type="html"><![CDATA[<p>El reducido espacio de trabajo que tengo en la casa para colocar la laptop; me
hace sentir como si viviera en el apartamento más pequeño de Tokio. Tanto así,
que no tengo ni donde desplazar el mouse y los cables me la ponen aún más
difícil. Comprar una casa más grande no es una opción; sin embargo, reducir el
mouse es más viable. Se me ocurrió adquirir un mouse inalámbrico, ya que son
pequeñitos.</p>

<p>Pero un mouse pequeño liviano, resulta que se desplaza mucho más rápido, que mi
antiguo <em>General Electric Pixart Inc. Optical Mouse</em>. Lo que más me molesta es;
no solo lo rápido que se desplaza, si no el <em>picor</em> que tiene en la aceleración.</p>

<p>La solución: Desacelerar el mouse</p>

<figure class='code'><figcaption><span>&#8220;slowmouse.sh&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>xinput --set-prop <span class="m">10</span> <span class="s2">&quot;Device Accel Constant Deceleration&quot;</span> 0.5
</span><span class='line'>xinput --set-prop <span class="m">10</span> <span class="s2">&quot;Device Accel Velocity Scaling&quot;</span> 1
</span><span class='line'>xinput --set-prop <span class="m">10</span> <span class="s2">&quot;Device Accel Profile&quot;</span> -1
</span></code></pre></td></tr></table></div></figure>


<p>Con eso, el mouse pequeñito, se desplaza tal como lo hace el grande. Ya que el
grande, es más pesado y por ende, se desplaza un tín mas lento.</p>

<p><strong>¡¡¡Tardé bastante en quedar complacido probando números!!!</strong></p>

<p>Por cierto, el <strong>10</strong> es la id del dispositivo. Puedes verlo corriendo el
comando <strong>xinput &ndash;list &ndash;short</strong> a mi se me ve así:</p>

<figure class='code'><figcaption><span>&#8220;xinput &#8211;list &#8211;short&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>lazaro@samsung ~&gt; xinput --list --short
</span><span class='line'>⎡ Virtual core pointer                      <span class="nv">id</span><span class="o">=</span>2 <span class="o">[</span>master pointer  <span class="o">(</span>3<span class="o">)]</span>
</span><span class='line'>⎜   ↳ Virtual core XTEST pointer                  <span class="nv">id</span><span class="o">=</span>4 <span class="o">[</span>slave  pointer  <span class="o">(</span>2<span class="o">)]</span>
</span><span class='line'>⎜   ↳ PixArt USB Optical Mouse                    <span class="nv">id</span><span class="o">=</span>10    <span class="o">[</span>slave  pointer  <span class="o">(</span>2<span class="o">)]</span>
</span><span class='line'>⎜   ↳ ETPS/2 Elantech Touchpad                    <span class="nv">id</span><span class="o">=</span>12    <span class="o">[</span>slave  pointer  <span class="o">(</span>2<span class="o">)]</span>
</span><span class='line'>⎣ Virtual core keyboard                     <span class="nv">id</span><span class="o">=</span>3 <span class="o">[</span>master keyboard <span class="o">(</span>2<span class="o">)]</span>
</span><span class='line'>    ↳ Virtual core XTEST keyboard               <span class="nv">id</span><span class="o">=</span>5 <span class="o">[</span>slave  keyboard <span class="o">(</span>3<span class="o">)]</span>
</span><span class='line'>    ↳ Power Button                              <span class="nv">id</span><span class="o">=</span>6 <span class="o">[</span>slave  keyboard <span class="o">(</span>3<span class="o">)]</span>
</span><span class='line'>    ↳ Video Bus                                 <span class="nv">id</span><span class="o">=</span>7 <span class="o">[</span>slave  keyboard <span class="o">(</span>3<span class="o">)]</span>
</span><span class='line'>    ↳ Power Button                              <span class="nv">id</span><span class="o">=</span>8 <span class="o">[</span>slave  keyboard <span class="o">(</span>3<span class="o">)]</span>
</span><span class='line'>    ↳ Sleep Button                              <span class="nv">id</span><span class="o">=</span>9 <span class="o">[</span>slave  keyboard <span class="o">(</span>3<span class="o">)]</span>
</span><span class='line'>    ↳ AT Translated Set <span class="m">2</span> keyboard
</span></code></pre></td></tr></table></div></figure>


<p>Como ve, el <em>PixArt USB Optical Mouse</em> dice que <strong>id=10</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[deshabilitar historial de bash]]></title>
    <link href="http://uranio-235.github.io/blog/2016/05/12/deshabilitar-historial-de-bash/"/>
    <updated>2016-05-12T14:34:13-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/05/12/deshabilitar-historial-de-bash</id>
    <content type="html"><![CDATA[<p>Alguna vez han pensado, que en algunos servidores o estaciones, en las cual
trabajan múltiples personas remotamente via consola; el historial de comandos
puede llegar a ser un problema???</p>

<p>Pues deshabilítalo. En el fichero <strong>/etc/environment</strong> ponle</p>

<figure class='code'><figcaption><span>&#8220;/etc/environment&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   <span class="nb">export </span><span class="nv">HISTFILE</span><span class="o">=</span>/dev/null
</span></code></pre></td></tr></table></div></figure>


<p>La próxima vez que etres, la función historial será deshabilitada. OJO!!! <strong>LA
PRÓXIMA VEZ</strong> esta sesión aún salva historial&hellip; Sale y vuelve a entrar.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[reparar archivos de innodb]]></title>
    <link href="http://uranio-235.github.io/blog/2016/04/29/reparar-archivos-de-innodb/"/>
    <updated>2016-04-29T23:22:33-04:00</updated>
    <id>http://uranio-235.github.io/blog/2016/04/29/reparar-archivos-de-innodb</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://uranio-235.github.io/images/hypno.png"></p>

<p>Los archivos binarios que almacenan las bases de datos de mysql (percona o
mariadb) suelen acabar corruptos o dañados por fallos eléctricos. Al mirar el
log, podemos ver que, a pesar de que la base de datos funciona; por un motivo u
otro, hay miles de warning y los ficheros binarios se vuelven cada vez más
frágiles.</p>

<p>Solución, exportar TODAS las bases de datos un fichero &ldquo;.sql&rdquo;, reinstalar mysql
e importar las bases de datos. Tenga en cuenta que también se crean los
usuarios y sus debidos permisos. Por tanto, su usuario de root se configurará de
manera automática.</p>

<figure class='code'><figcaption><span>&#8220;mysqldump&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysqldump --all-databases &gt; dumpeo.sql
</span></code></pre></td></tr></table></div></figure>


<p>Desinstalar mySQL y eliminar los ficheros binarios, generalmente están en
/var/lib/mysql Por último, instala mySQL y restaura las bases de datos.</p>

<figure class='code'><figcaption><span>&#8220;mysqldump&#8221;</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql &lt; dumpeo.sql
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
